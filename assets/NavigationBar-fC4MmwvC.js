import{T as at}from"./index-DnxWnOWO.js";import{e as W,f as lt,u as Ee,r as u,b as H,o as a,c as d,a as p,t as z,I as ot,j as M,y as it,F as X,q as te,k as L,h as s,C as Ie,B as ne,i as D,w as O,K as Le,l as de,a8 as rt,d as ut,J as Be,s as ve,S as ct,H as xe,a9 as dt,v as oe,A as ie,G as K,T as ke}from"./index-RQaPKU3q.js";import{s as Pe}from"./index-BQKo0YUX.js";import{_ as vt,a as pt,b as ft,c as gt}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_bad98aaa_lang-Cy-QTQYp.js";import{_ as re}from"./MdViewer.vue_vue_type_style_index_0_lang-Bca--o1a.js";import{_ as ht,a as mt,b as yt}from"./SubmitImageReviseViewer.vue_vue_type_script_setup_true_lang-BaZDqLr9.js";import{_ as wt}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-tC_jSBgi.js";import{s as bt}from"./index-Bjhk2rBV.js";import{C as _t}from"./cloudStorageApi-DND7mGDQ.js";import{U as Q}from"./unitApi-Y58tYEHm.js";import{u as ue,a as Ce,b as xt}from"./store-qJ2iV4r-.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{L as kt}from"./lessonApi-CDtd4rn4.js";import{m as Ct}from"./mapLessonFromDto-C2sH6sUU.js";import{m as $e,i as $t}from"./mapUnitFromDto-DRcH-Z8v.js";import{e as Se,c as St}from"./IdeButtons.vue_vue_type_script_setup_true_lang-BoC8OHM6.js";import{u as Tt}from"./useLocaleStore-yK-JXCDs.js";async function ce(T){if(T=="")return"";const v=new TextEncoder().encode(T),h=await crypto.subtle.digest("SHA-256",v);return Array.from(new Uint8Array(h)).map(C=>C.toString(16).padStart(2,"0")).join("")}function At(T){let e="",v=!1;for(let h=0;h<T.length;h++){const l=T[h];if(l==="#"&&(v=!0),v)if(l===`
`)v=!1;else continue;l!==" "&&l!=="	"&&l!==`
`&&l!=="\r"&&(e+=l)}return e}function Et(T,e){if(T.length!==e.length)return!1;const v=[...T].sort(),h=[...e].sort();return v.every((l,b)=>l===h[b])}const It={class:"border border-purple-200 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50"},Lt={class:"flex items-center gap-3"},Bt={class:"font-semibold text-purple-900"},Pt={class:"flex items-center gap-2"},jt=["title"],Dt={key:0,class:"px-4 pb-4"},Gt={key:0},Ut={class:"rounded-xl overflow-clip p-4 bg-white border border-purple-100 shadow-sm"},zt={key:1,class:"flex gap-2 flex-wrap"},Mt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Ht={key:2},Vt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Ft={key:3},Rt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Nt=W({__name:"TeacherAnswerViewer",props:{unitType:{},unitContent:{}},setup(T){const e=T,{t:v}=lt(),h=Ee(),l=u(!1),b=()=>{l.value=!l.value},C=async()=>{try{let i="";e.unitType==="open"?i=e.unitContent.answer:e.unitType==="options"?i=x.value.map(w=>w.text).join(`
`):(e.unitType==="code"||e.unitType==="pibody")&&(i=e.unitContent.answer),await navigator.clipboard.writeText(i),h.add({severity:"success",summary:v("pages.teacher.answerCopied"),detail:v("pages.teacher.answerCopiedDetail"),life:2e3})}catch(i){console.log(i),h.add({severity:"error",summary:v("pages.teacher.copyError"),detail:v("pages.teacher.copyErrorDetail"),life:2e3})}},x=H(()=>{var i;return!((i=e.unitContent)!=null&&i.options)||!e.unitContent.answer?[]:e.unitContent.options.filter(w=>e.unitContent.answer.includes(w.id))});return(i,w)=>(a(),d("div",It,[p("div",{onClick:b,class:"flex items-center justify-between cursor-pointer hover:bg-purple-100/50 p-4 rounded-xl transition-all duration-200"},[p("div",Lt,[w[0]||(w[0]=p("div",{class:"flex items-center justify-center w-6 h-6 text-purple-500"},[p("i",{class:"pi pi-crown","aria-hidden":"true"})],-1)),p("span",Bt,z(l.value?i.$t("pages.teacher.hideAnswer"):i.$t("pages.teacher.showAnswer")),1)]),p("div",Pt,[l.value?(a(),d("button",{key:0,onClick:ot(C,["stop"]),class:"flex items-center justify-center w-8 h-8 text-purple-600 hover:bg-purple-200 rounded-lg transition-colors",title:i.$t("pages.teacher.copyAnswer")},w[1]||(w[1]=[p("i",{class:"pi pi-copy","aria-hidden":"true"},null,-1)]),8,jt)):M("",!0),(a(),d("svg",{class:it(["w-5 h-5 transition-transform duration-200 text-purple-600",{"rotate-180":l.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},w[2]||(w[2]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),l.value?(a(),d("div",Dt,[e.unitType=="open"?(a(),d("div",Gt,[p("div",Ut,z(e.unitContent.answer),1)])):e.unitType=="options"?(a(),d("div",zt,[p("div",Mt,[(a(!0),d(X,null,te(x.value,n=>(a(),d("div",{key:n.id},[L(s(re),{text:n.text},null,8,["text"])]))),128))])])):e.unitType=="code"?(a(),d("div",Ht,[p("div",Vt,[L(s(re),{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(a(),d("div",Ft,[p("div",Rt,[L(s(re),{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):M("",!0)])):M("",!0)]))}}),qt={class:"flex flex-wrap justify-between items-center flex-1 gap-4"},Ot={class:"w-full flex justify-between"},Wt={class:"flex gap-2"},Yt={key:0,class:"relative w-full flex justify-between items-center p-8 rounded-border border border-surface gap-4"},Jt=["alt","src"],Kt={class:"flex flex-col gap-1"},Qt={class:"font-semibold text-ellipsis max-w-60 whitespace-nowrap overflow-hidden"},Xt={class:"absolute top-0 right-0"},Zt={class:"flex items-center justify-center flex-col"},en={class:"mt-6 mb-0"},tn=W({__name:"SubmitImageViewer",props:{state:{},unitId:{}},emits:["save-answer"],setup(T,{emit:e}){const v=T,h=e,l=Le(),b=u("");Ie(()=>{b.value=v.state.answer.url}),ne(b,()=>{h("save-answer",{url:b.value})});const C=async x=>{x.files.length>1&&(x.files.length=1);const i=x.files[0],w=new FormData;w.append("file",i);try{const{data:n}=await _t.submitImage(w,Number(l.params.id),v.unitId);b.value=n.source_url}catch(n){console.log(n)}};return(x,i)=>{const w=de,n=rt,G=bt;return a(),D(G,{name:"submit-image",mode:"advanced",multiple:!1,accept:"image/*",maxFileSize:1e6,onSelect:C,auto:!0},{header:O(({chooseCallback:f,files:m,uploadedFiles:g})=>[p("div",qt,[p("div",Ot,[p("div",Wt,[L(w,{onClick:A=>f(),icon:"pi pi-plus",label:x.$t("choose"),size:"small",disabled:m&&m.length>0||g&&g.length>0},null,8,["onClick","label","disabled"])])])])]),content:O(({uploadedFiles:f,removeUploadedFileCallback:m})=>[f.length>0?(a(),d("div",Yt,[p("div",null,[p("img",{role:"presentation",alt:f[0].name,src:f[0].objectURL,width:"100",height:"50"},null,8,Jt)]),p("div",Kt,[p("span",Qt,z(f[0].name),1),p("div",null,z(f[0].size)+" "+z(x.$t("bytes")),1),L(n,{value:x.$t("uploaded"),class:"w-fit self-end"},null,8,["value"])]),p("div",Xt,[L(w,{icon:"pi pi-times",onClick:g=>m(0),variant:"text",rounded:"",severity:"danger"},null,8,["onClick"])])])):M("",!0)]),empty:O(()=>[p("div",Zt,[i[0]||(i[0]=p("i",{class:"pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"},null,-1)),p("p",en,z(x.$t("dragAndDropImageToUpload")),1)])]),_:1})}}}),pe=ut("lesson-store",()=>{const T=Ee(),e=u(null),v=u(!1),h=u(!1),l=u(!1),b=u(!1),C=u(!1),x=u(0),i=u(0),w=u(0),n=u([]),G=u([]),f=u(0),m=u(new Map),g=u(new Map),A=u(new Map),U=u([]),I=u("continue"),N=u(!1),E=u(!1),P=u(!1),R=u(!1),Y=u(!0),k=u(!1),y=u(""),$=u(0),B=u(null),S=u(null),V=u([]),Z=u([]),De=Be(),Ge=Tt(),{lang:Ue}=ve(Ge),ee=u(void 0),ze=H(()=>{var t;return R.value&&(((t=B.value)==null?void 0:t.modulesWerePut)??!0)&&Y.value});async function Me(t,r){try{v.value=!0,m.value.clear(),g.value.clear(),A.value.clear(),ee.value=De.userRole==="editor"?Ue.value:void 0;const{data:o}=await kt.getLessonById(t,r,ee.value);e.value=Ct(o),e.value.stage=="published"&&fe()}catch(o){T.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{v.value=!1}}async function fe(){if(e.value)try{C.value=!0,x.value=0,m.value.clear();const t=[];e.value.pages.forEach(c=>{c.groups.forEach(_=>{_.units.forEach(j=>{t.push({id:j.id,lessonId:e.value.id})})})});const r=t.length,o=5;for(let c=0;c<t.length;c+=o){const j=t.slice(c,c+o).map(async({id:J,lessonId:st})=>{try{const{data:le}=await Q.getUnitByIdandLessonId(J,st,ee.value);m.value.set(J,le)}catch(le){console.warn(`Failed to preload unit ${J}:`,le)}});await Promise.all(j),x.value=Math.round(Math.min(c+o,r)/r*100)}}catch(t){console.error("Error preloading units:",t)}finally{C.value=!1}}async function se(t,r){if(m.value.has(t))return m.value.get(t);try{h.value=!0;const{data:o}=await Q.getUnitByIdandLessonId(t,r,ee.value);return m.value.set(t,o),o}catch(o){T.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{h.value=!1}}async function ge(){if(e.value!=null){l.value=!0,n.value=[],G.value=[],i.value=0,w.value=0,f.value=0,U.value=[],y.value="",Z.value=[],E.value=!1,P.value=!1;for(let t=0;t<e.value.pages.length;t++)U.value.push(0);I.value="continue",Ne(),n.value.push(e.value.pages[i.value].groups[f.value]),await ae(e.value.id),l.value=!1}}function He(t,r){var c,_;$.value=r.id,y.value==""&&(y.value=`emulator-${$.value}`);const o=r.content.starting;k.value=o!="",S.value=ue(y.value),S.value.setCode(o),t=="pibody"&&(B.value=Ce(y.value),(c=B.value)==null||c.clearSlots(),(_=B.value)==null||_.reset(),V.value=r.data.neededModules,B.value.addNeededModules(V.value),Z.value=[])}function Ve(){var c;if(y.value=="")return;Se.getSharedEmulator().stop();const r=n.value[f.value].units.find(_=>_.id===$.value),o=(r==null?void 0:r.content.starting)??"";o!=""&&(S.value=ue(y.value),S.value.setCode(o),(r==null?void 0:r.unitType)=="pibody"&&(B.value=Ce(y.value),(c=B.value)==null||c.clearSlots(),Z.value=[]))}function Fe(){if(y.value=="")return;Se.getSharedEmulator().stop()}async function ae(t){R.value=!1,N.value=!1,k.value=!1;for(let r=0;r<n.value[f.value].units.length;r++){const o=n.value[f.value].units[r];["options","open","code","pibody","submit-image"].includes(o.unitType)&&(I.value="check",N.value=!0);const c=await se(o.id,t);if(c){const _=$e(c);n.value[f.value].units[r].content=_==null?void 0:_.content,n.value[f.value].units[r].data=_==null?void 0:_.data,n.value[f.value].units[r].studentState=_==null?void 0:_.studentState,["code","pibody"].includes(o.unitType)&&(R.value=!0,_.content.answer==""&&_.data.tests.lenght==0||(Y.value=!1),He(o.unitType,_))}}N.value&&Re(),I.value=="continue"&&await he()}async function he(){if(e.value!=null)try{b.value=!0,E.value=!1;for(const t of n.value[n.value.length-1].units){if(g.value.set(t.id,t.studentState.answer),["code","pibody"].includes(t.unitType)){const r=ue(y.value).code.value;if(t.data.tests.length>0){const o=await St(y.value,r,t.data.tests,t.data.includedCommands);E.value=o.correct}else if(!t.content.hashed_answer)E.value=!0;else{const o=At(r),c=await ce(o);E.value=t.content.hashed_answer===c}}else if(t.unitType=="open"){const o=String(t.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),c=await ce(o);E.value=!t.content.hashed_answer||t.content.hashed_answer===c}else if(t.unitType=="options"){const r=t.studentState.answer.options,o=[];for(const c of r)o.push(await ce(c));E.value=t.content.hashed_answer.length==0||Et(t.content.hashed_answer,o)}else if(t.unitType=="submit-image"){const r=String(t.studentState.answer.url??"");E.value=r.length>0}else E.value=!0;if(E.value==!1)break}n.value[n.value.length-1].units.length||(E.value=!0),E.value?(U.value[i.value]++,f.value>=e.value.pages[i.value].groups.length-1?i.value<e.value.pages.length-1?I.value="continue":I.value="finish":I.value="continue"):I.value="try-again"}finally{b.value=!1}}async function Re(){if(e.value!=null){P.value=!0;for(const t of n.value[n.value.length-1].units)g.value.set(t.id,t.studentState.answer),t.unitType=="open"?P.value&&(P.value=!t.content.hashed_answer):t.unitType=="options"?P.value&&(P.value=t.content.hashed_answer.length==0):t.unitType=="submit-image"&&P.value&&(P.value=!0)}}async function me(){if(e.value!=null){if(Fe(),f.value>=e.value.pages[i.value].groups.length-1){await _e(),be();return}l.value=!0,f.value++,n.value.push(e.value.pages[i.value].groups[f.value]),await ae(e.value.id),l.value=!1}}async function ye(t){const r=n.value[n.value.length-1].id;I.value="continue",U.value[i.value]--,f.value--,n.value.pop(),r==t?i.value==0&&n.value.length==0?await ge():await me():await ye(t)}function Ne(){if(!e.value)return;let t=0;for(const r of e.value.pages)if(r.groups.every(c=>c.units.every(_=>_.studentStatus==="completed")))t!=e.value.pages.length-1&&(U.value[t]=r.groups.length,t++);else break;i.value=t,w.value=i.value-1}function qe(){i.value!=0&&(U.value[i.value]=0,U.value[i.value-1]=0,i.value-=2,be())}async function Oe(){if(!e.value)return!1;try{if(l.value=!0,w.value<0)return l.value=!1,!1;const r=[...e.value.pages[w.value].groups];for(const o of r)for(let c=0;c<o.units.length;c++){const _=await se(o.units[c].id,e.value.id);if(_){const j=$e(_);if(o.units[c].content=j==null?void 0:j.content,o.units[c].data=j==null?void 0:j.data,o.units[c].studentState=j==null?void 0:j.studentState,A.value.has(o.units[c].id)){const J=$t(A.value.get(o.units[c].id),o.units[c].unitType);o.units[c].studentState=J}}}return G.value=[...r,...G.value],w.value-=1,!0}catch(t){return console.error("Error loading previous page:",t),!1}finally{l.value=!1}}function we(t,r){if(e.value!=null){for(const[o,c]of n.value.entries())for(const[_,j]of c.units.entries())if(j.id==t){n.value[o].units[_].studentState.answer=r;break}}}async function We(){e.value!=null&&(I.value="check")}async function Ye(){e.value!=null&&(await _e(),I.value="completed")}function Je(){m.value.clear(),x.value=0,C.value=!1}async function be(){e.value!=null&&(l.value=!0,i.value-1==w.value?w.value++:G.value=[...G.value,...n.value],i.value++,n.value=[],f.value=0,I.value="continue",n.value.push(e.value.pages[i.value].groups[f.value]),await ae(e.value.id),l.value=!1)}function Ke(t){R.value=t}function Qe(){Y.value=!0}async function Xe(t){y.value!=""&&(t.code=S.value.code,we($.value,t),await Q.saveUnitByIdandLessonId($.value,e.value.id,{answer:t}))}async function _e(){if(l.value=!0,e.value==null)return;const t=Array.from(g.value.entries()).map(([o,c])=>({id:o,student_answer:c})),{data:r}=await Q.submitUnitsByLessonId(e.value.id,t);E.value=r.correct,A.value=new Map([...A.value,...g.value]),g.value=new Map,l.value=!1}const F=H(()=>e.value?e.value.pages[i.value]??null:null),q=H(()=>F.value?F.value.groups[f.value]??null:null),Ze=H({get:()=>{var t;return((t=q.value)==null?void 0:t.pibodyDrawerVisible)??!1},set:t=>{q.value&&(q.value.pibodyDrawerVisible=t)}}),et=H({get:()=>{var t;return((t=q.value)==null?void 0:t.codeDrawerVisible)??!1},set:t=>{q.value&&(q.value.codeDrawerVisible=t)}}),tt=H({get:()=>{var t;return((t=F.value)==null?void 0:t.showPibody)??!1},set:t=>{F.value&&(F.value.showPibody=t)}}),nt=H({get:()=>{var t;return((t=F.value)==null?void 0:t.showCode)??!1},set:t=>{F.value&&(F.value.showCode=t)}});return{selectedLesson:e,isLessonLoading:v,isUnitLoading:h,groups:n,finishedGroups:G,groupIndex:f,isGroupLoading:l,isSubmitLoading:b,isPreloadingUnits:C,preloadingProgress:x,groupStatus:I,submitExist:N,correct:E,isAccept:P,submitEnabled:ze,pageProgress:U,pageIndex:i,previousPageIndex:w,emulatorID:y,neededModules:V,slots:Z,pibodyDrawerVisible:Ze,codeDrawerVisible:et,showPibody:tt,showCode:nt,answersCache:g,startingCodeExist:k,setSubmitable:Ke,loadLessonById:Me,loadUnitByIdandLessonId:se,preloadAllUnits:fe,clearUnitsCache:Je,loadInitialGroup:ge,submitGroup:he,nextGroup:me,saveAnswer:we,tryAgain:We,finishLesson:Ye,runCodePressed:Qe,saveStudentIdeState:Xe,resetGroup:ye,pageBack:qe,loadPreviousPage:Oe,resetEmulator:Ve}}),nn={key:1,class:"px-4 py-2"},sn={key:4},an=W({__name:"UnitCard",props:{unit:{},loading:{type:Boolean},revise:{type:Boolean}},setup(T){const e=T,v=Le(),h=pe(),{saveAnswer:l,setSubmitable:b}=h;function C(n){e.unit.unitType=="options"?b(n.options.length>0):e.unit.unitType=="open"?b(n.open.length>0):e.unit.unitType=="submit-image"&&b(n.url.length>0),l(e.unit.id,n),x(n)}const x=xt(n=>{i(n)},1e3,{maxWait:5e3});async function i(n){await Q.saveUnitByIdandLessonId(e.unit.id,Number(v.params.id),{answer:n})}const w=H(()=>{var n;return(n=e.unit.content)!=null&&n.answer?Array.isArray(e.unit.content.answer)?e.unit.content.answer.length>0:typeof e.unit.content.answer=="string"?e.unit.content.answer.trim()!=="":!0:!1});return(n,G)=>{const f=Pe;return a(),d("div",null,[n.loading?(a(),D(f,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),d("div",nn,[e.unit.unitType=="article"?(a(),D(s(vt),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(a(),D(s(pt),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:C},null,8,["options-data","state"])):e.unit.unitType=="open"?(a(),D(s(ft),{key:2,state:e.unit.studentState,onSaveAnswer:C},null,8,["state"])):e.unit.unitType=="video"?(a(),D(s(gt),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="submit-image"?(a(),d("div",sn,[e.revise?(a(),D(s(ht),{key:0,state:e.unit.studentState},null,8,["state"])):(a(),D(s(tn),{key:1,state:e.unit.studentState,"unit-id":e.unit.id,onSaveAnswer:C},null,8,["state","unit-id"]))])):e.unit.unitType=="tinkercad"?(a(),D(s(wt),{key:5,tinkercad:e.unit.content},null,8,["tinkercad"])):e.revise&&e.unit.unitType=="code"?(a(),D(s(mt),{key:6,state:e.unit.studentState},null,8,["state"])):e.revise&&e.unit.unitType=="pibody"?(a(),D(s(yt),{key:7,state:e.unit.studentState},null,8,["state"])):M("",!0),w.value?(a(),D(s(Nt),{key:8,unitType:e.unit.unitType,unitContent:e.unit.content},null,8,["unitType","unitContent"])):M("",!0)]))])}}}),ln={key:1,class:"flex flex-col h-full w-full"},on={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Te=W({__name:"GroupCard",props:{group:{},loading:{type:Boolean},revise:{type:Boolean}},setup(T){const e=T,v=u(null);return ne(()=>e.loading,h=>{h===!1&&v.value&&requestAnimationFrame(()=>{var l;(l=v.value)==null||l.scrollIntoView({behavior:"smooth",block:"start"})})}),(h,l)=>{const b=Pe;return a(),d("div",{ref_key:"groupRef",ref:v},[h.loading?(a(),D(b,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),d("div",ln,[p("div",on,[(a(!0),d(X,null,te(h.group.units,C=>(a(),D(an,{key:C.id,unit:C,revise:e.revise},null,8,["unit","revise"]))),128))])]))],512)}}}),rn={key:0,class:"absolute right-0"},Ae=10,un=15,cn=8,dn=W({__name:"UnitsView",props:{pages:{}},setup(T){const e=pe(),{groups:v,isGroupLoading:h,previousPageIndex:l,finishedGroups:b}=ve(e),{loadInitialGroup:C,resetGroup:x,loadPreviousPage:i}=e,w=Be(),n=u(null),G=u(null),f=u(0),m=u(!1),g=u(null),A=u(!1);function U(k){let y=k;for(;y&&y.parentElement;){const $=y.parentElement,S=getComputedStyle($).overflowY;if(S==="auto"||S==="scroll")return $;y=$}return null}async function I(){await ie();const k=U(n.value),y=G.value;if(!k||!y){f.value=0;return}const $=k.clientHeight,B=y.getBoundingClientRect().height,S=Math.max(0,$-B-16);f.value=S,A.value&&k&&(await ie(),await new Promise(V=>requestAnimationFrame(V)),k.scrollTo({top:10,behavior:"smooth"}),A.value=!1)}function N(k,y){var S;const $=(S=v.value[v.value.length-1])==null?void 0:S.id;let B=null;k&&(k instanceof Element?B=k:k.$el instanceof Element&&(B=k.$el)),G.value=y.id===$?B:null}Ie(()=>{C(),I(),window.addEventListener("resize",I),g.value=U(n.value),g.value&&(g.value.addEventListener("scroll",R),g.value.scrollHeight<=g.value.clientHeight&&(E.value=!0,P.value=Ae))}),ct(()=>{window.removeEventListener("resize",I),g.value&&g.value.removeEventListener("scroll",R)}),ne(()=>v.value.length,async()=>{await I()}),ne(()=>h.value,async(k,y)=>{y===!0&&k===!1&&await I()});const E=u(!1),P=u(-40);function R(){if(!g.value)return;const k=g.value.scrollTop,y=5;if(k<=y&&l.value>=0){E.value=!0;const $=40;P.value=Math.min(Ae,-$+$*(y-k)/y)}else E.value=!1,P.value=-40}async function Y(){if(m.value||!g.value)return;m.value=!0,A.value=!0;const k=g.value;try{await i()?(await ie(),await new Promise($=>requestAnimationFrame($)),await new Promise($=>requestAnimationFrame($)),A.value&&(k.scrollTo({top:0,behavior:"smooth"}),A.value=!1)):A.value=!1}finally{m.value=!1}}return(k,y)=>{const $=de,B=at;return a(),d("div",{ref_key:"rootEl",ref:n,class:"flex flex-col gap-2"},[xe(p("div",{class:"absolute left-0 right-0 z-[9] flex justify-center pointer-events-auto",style:oe([{transition:"transform 0.25s ease, opacity 0.25s ease"},{transform:`translateY(${P.value}px)`,opacity:E.value?1:0}])},[L($,{icon:"pi pi-arrow-left",label:m.value?"–ó–∞–≥—Ä—É–∑–∫–∞...":"–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",severity:"secondary",size:"small",onClick:Y,loading:m.value,disabled:m.value},null,8,["label","loading","disabled"])],4),[[dt,E.value]]),p("div",{style:oe({paddingTop:Math.max(0,P.value+un+cn)+"px"}),class:"flex flex-col gap-2 smooth-padding"},[(a(!0),d(X,null,te(s(b),S=>(a(),d("div",{key:S.id,class:"relative"},[L(Te,{group:S,revise:!0,loading:s(h)&&S.id==s(b)[s(b).length-1].id},null,8,["group","loading"])]))),128)),(a(!0),d(X,null,te(s(v),S=>(a(),d("div",{key:S.id,ref_for:!0,ref:V=>N(V,S),class:"relative"},[!s(h)&&s(w).userRole=="editor"?(a(),d("div",rn,[xe((a(),D($,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:V=>s(x)(S.id)},{default:O(()=>y[0]||(y[0]=[p("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[B,"Reset step",void 0,{left:!0}]])])):M("",!0),L(Te,{group:S,loading:s(h)&&S.id==s(v)[s(v).length-1].id},null,8,["group","loading"])]))),128)),p("div",{style:oe({height:f.value+"px"})},null,4)],4)],512)}}}),Nn=je(dn,[["__scopeId","data-v-db2963ef"]]),vn={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},pn={key:1},fn={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},gn={key:0,class:"text-lg font-bold flex items-center gap-2"},hn={key:1,class:"text-lg font-bold flex items-center gap-2"},mn={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},yn={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},wn={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},bn={class:"text-lg font-bold flex items-center gap-2"},_n={key:2},xn={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},kn={key:0,class:"text-lg font-bold flex items-center gap-2"},Cn={key:1,class:"text-lg font-bold flex items-center gap-2"},$n={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Sn=W({__name:"NavigationBar",setup(T){const e=pe(),{isSubmitLoading:v,groupStatus:h,isGroupLoading:l,submitExist:b,correct:C,isAccept:x,submitEnabled:i}=ve(e),{submitGroup:w,nextGroup:n,tryAgain:G,finishLesson:f}=e;return(m,g)=>{const A=de;return a(),d(X,null,[s(h)=="check"?(a(),d("div",vn,[L(A,{label:s(x)?m.$t("submit"):m.$t("check").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(w),loading:s(v),disabled:s(v)||!s(i)},null,8,["label","onClick","loading","disabled"])])):M("",!0),s(h)=="continue"?(a(),d("div",pn,[L(ke,{name:"pop",appear:"",mode:"out-in"},{default:O(()=>[s(b)&&s(C)?(a(),d("div",fn,[s(x)?(a(),d("div",gn,[g[0]||(g[0]=p("span",{class:"text-3xl"},"‚úÖ",-1)),K(" "+z(m.$t("accepted"))+"!",1)])):(a(),d("div",hn,[g[1]||(g[1]=p("span",{class:"text-3xl"},"üéâ",-1)),K(" "+z(m.$t("correct"))+"!",1)])),L(A,{label:m.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(n),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])])):s(b)&&!s(C)?(a(),d("div",mn,[L(A,{label:m.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(n),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])])):(a(),d("div",yn,[L(A,{label:m.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(n),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])]))]),_:1})])):M("",!0),L(ke,{name:"shake",appear:""},{default:O(()=>[s(h)=="try-again"?(a(),d("div",wn,[p("div",bn,[g[2]||(g[2]=p("span",{class:"text-3xl"},"‚ö†Ô∏è",-1)),K(" "+z(m.$t("incorrect"))+"! ",1)]),L(A,{label:m.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(G)},null,8,["label","onClick"])])):M("",!0)]),_:1}),s(h)=="finish"?(a(),d("div",_n,[s(b)&&s(C)?(a(),d("div",xn,[s(x)?(a(),d("div",kn,[g[3]||(g[3]=p("span",{class:"text-3xl"},"‚úÖ",-1)),K(" "+z(m.$t("accepted"))+"!",1)])):(a(),d("div",Cn,[g[4]||(g[4]=p("span",{class:"text-3xl"},"üéâ",-1)),K(" "+z(m.$t("correct"))+"!",1)])),L(A,{label:m.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(f),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])])):(a(),d("div",$n,[L(A,{label:m.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(f)},null,8,["label","onClick"])]))])):M("",!0)],64)}}}),qn=je(Sn,[["__scopeId","data-v-39035ee6"]]);export{qn as N,Nn as U,pe as u};
