import{s as A}from"./index-DQafit8Y.js";import{s as H}from"./index-CfMinl4z.js";import{e as O,J as Q,s as P,B as R,r as X,C as Y,D as Z,S as ee,o as l,c as r,h as e,a as t,k as i,F as j,q as te,v as q,j as p,i as w,L as N,w as U,t as T,T as se,K as oe,n as le,l as re}from"./index-8eYd0-Co.js";import{B as ie}from"./BlocklyViewer-ujpXRAxh.js";import{b as ae}from"./store-DJ783GSL.js";import{S as ne}from"./SimulationView-_SSNKHsZ.js";import"./IdeButtons.vue_vue_type_script_setup_true_lang-BjZTJ3Qu.js";import"./CodeViewModal.vue_vue_type_style_index_0_scoped_818a8834_lang-L7cf9myE.js";import{_ as de}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-BkFfrpR3.js";import{u as ue}from"./useLocaleStore-CGKTShgd.js";import{u as ce,U as pe,N as me}from"./NavigationBar-BKZ8uUYb.js";import"./index-H-9SRDzX.js";import"./index-B3NttIqY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CH_iu5NA.js";import"./index-eKsVto-V.js";import"./index-CID063JX.js";import"./index-WXQmNEQQ.js";import"./index-B8MXaspB.js";import"./index-DRGFISwW.js";import"./index-VgJXLjdG.js";import"./index-CQCkvxda.js";import"./index-CsjCzc3Q.js";import"./language-DYQF8nnT.js";import"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_bad98aaa_lang-ETJTZl1d.js";import"./MdViewer.vue_vue_type_style_index_0_lang-1aZPBoDA.js";import"./index-C5W94n6N.js";import"./index-ahqnJA0E.js";import"./SubmitImageReviseViewer.vue_vue_type_script_setup_true_lang-BBzbA190.js";import"./index-CrUX9qwQ.js";import"./TinkercadViewer.vue_vue_type_script_setup_true_lang-BQ1DgHPi.js";import"./index-DZEPUsZQ.js";import"./index-fKBIE13H.js";import"./index-19jCyGXe.js";import"./unitApi-COQDlsTX.js";import"./lessonApi-B_VTKClk.js";import"./mapLessonFromDto-C9SLSKbW.js";import"./mapUnitFromDto-C-vlLM9s.js";const fe={key:0,class:"h-screen w-full flex flex-col overflow-hidden relative"},ve={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-neutral200 mx-auto"},ge={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},he={class:"flex items-center gap-4"},ye={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},xe={class:"w-full h-full flex gap-0 p-0 mt-16",style:{height:"calc(100vh - 64px)"}},we={key:0,class:"bg-white p-0 max-w-[450px] w-full flex flex-col relative"},_e={class:"p-0 overflow-y-scroll w-full"},be={class:"bg-white p-0 max-w-[450px] w-full flex flex-col relative"},ke={class:"flex-1 overflow-y-auto mb-24 w-full flex justify-end"},Se={key:1,class:"flex justify-center"},Be={key:2},Le={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},Ce={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},Pe={class:"flex items-center gap-3 mb-2"},Re={class:"bg-transparent shadow-md fixed bottom-0 w-[450px]"},je={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},qe={class:"flex flex-col items-center"},Ne={class:"text-4xl font-bold mb-8"},Ue={class:"text-md text-gray-500"},xt=O({__name:"BlocklyLessonPage",setup(Te){const a=oe(),u=le(),_=Q(),$=ue(),{lang:z}=P($);R(z,async(s,o)=>{s!==o&&n.value&&await k(Number(a.params.id),(a.query.route_id??"").toString())});const b=ce(),{isLessonLoading:V,selectedLesson:n,pageProgress:D,groupStatus:f,slots:m,isPreloadingUnits:M,preloadingProgress:F,answersCache:E,emulatorID:v,showPibody:y,neededModules:x}=P(b),{loadLessonById:k,saveStudentIdeState:I,pageBack:W}=b;function G(s){var d;const o=((d=n.value)==null?void 0:d.pages.reduce((g,h)=>g+h.groups.length,0))||1;return s/o*100}function S(){var s;((s=n.value)==null?void 0:s.lessonType)=="module"?u.push("/v2/docs"):a.query.route_id&&a.query.route_id!=""?u.push("/v2/route/"+a.query.route_id):_.userRole=="editor"?u.push("/v2/routes"):u.push("/v2/home")}R(m,()=>{J({slots:m.value})});const J=ae(s=>{I(s)},1e3,{maxWait:5e3}),B=X(0);Y(async()=>{var s;f.value="continue",await k(Number(a.params.id),(a.query.route_id??"").toString()),((s=n.value)==null?void 0:s.lessonType)=="project"&&u.push({path:a.path.replace("/lesson/","/project/"),query:a.query}),window.addEventListener("beforeunload",L)}),Z(()=>{});const K=()=>{u.push(`${a.path}/edit`)};ee(()=>{window.removeEventListener("beforeunload",L)});function L(s){if(f.value!="completed"&&E.value.size>0)return s.preventDefault(),!0}return(s,o)=>{const d=re,g=H,h=A;return l(),r(j,null,[e(f)!="completed"?(l(),r("div",fe,[t("div",ve,[t("div",ge,[t("div",he,[i(d,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:S})]),e(n)?(l(),r("div",ye,[(l(!0),r(j,null,te(e(n).pages,(c,C)=>(l(),r("div",{key:C,class:"h-full",style:q({width:G(c.groups.length)+"%"})},[i(g,{value:e(D)[C]/c.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3",dt:{value:{background:"var(--color-primary400)"},background:"var(--color-primary50)"}},null,8,["value"])],4))),128))])):p("",!0),o[2]||(o[2]=t("div",{class:"w-10"},null,-1))])]),t("div",xe,[e(y)?(l(),r("div",we,[(l(),w(e(ne),{id:e(v),key:e(v),slots:e(m),"onUpdate:slots":o[0]||(o[0]=c=>N(m)?m.value=c:null),neededModules:e(x),"onUpdate:neededModules":o[1]||(o[1]=c=>N(x)?x.value=c:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])):p("",!0),t("div",_e,[(l(),w(e(ie),{id:e(v),key:e(v),blocksType:e(y)?"pibody":"atlas",emulatorRun:e(y)},null,8,["id","blocksType","emulatorRun"]))]),t("div",be,[t("div",ke,[t("div",{class:"w-full h-full max-w-screen-lg",style:q({paddingLeft:B.value+"px",paddingRight:B.value+"px"})},[e(V)?(l(),w(h,{key:0,class:"flex justify-center"})):e(n)?(l(),r("div",Be,[i(pe,{pages:e(n).pages},null,8,["pages"])])):(l(),r("div",Se,"No lesson found")),e(_).userRole=="editor"?(l(),r("div",Le,[i(e(de)),i(d,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:K}),i(d,{variant:"text",severity:"contrast",onClick:e(W)},{default:U(()=>o[3]||(o[3]=[t("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):p("",!0),e(M)?(l(),r("div",Ce,[t("div",Pe,[i(h,{style:{width:"20px",height:"20px"}}),o[4]||(o[4]=t("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),i(g,{value:e(F),"show-value":!0,class:"h-2"},null,8,["value"])])):p("",!0)],4)]),t("div",Re,[i(me)])])])])):p("",!0),i(se,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:U(()=>[e(f)=="completed"?(l(),r("div",je,[o[5]||(o[5]=t("div",{class:"text-5xl"},"⚡️",-1)),t("div",qe,[t("div",Ne,T(s.$t("goodWork")),1),t("div",Ue,T(s.$t("keepLearning")),1)]),t("div",null,[i(d,{label:s.$t("continue"),class:"rounded-full w-56 text-xl",onClick:S},null,8,["label"])])])):p("",!0)]),_:1})],64)}}});export{xt as default};
