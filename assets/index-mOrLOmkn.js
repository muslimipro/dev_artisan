import{I as Ve,Z as he,J as Ae,K as Te,L as Pe,M as ze,N as Ne,q as le,O as Ue,P as Ge,Q as ge,R as Oe,b as s,k as S,w as T,e as u,S as N,f as b,T as re,U as _e,V as Q,F as j,h as g,n as Ce,t as Ke,l as D,W as je,X as Me,d as Fe,u as We,r as w,Y as be,s as ee,c as q,a as P,o as ue,G as M,j as de,x as Le,_ as qe,g as o,$ as ye,E as He,i as we,D as Ze,a0 as Ye,H as ie,a1 as Xe,p as Je}from"./index-WkhxvbEp.js";import{s as ke}from"./index-DMKuZffo.js";import{s as Qe}from"./index-ew_MPaRC.js";import{u as Se,L as et,_ as tt,d as nt}from"./defaultConfirmDeleteOptions-hF6bh4a7.js";import{u as xe,c as ot,a as st}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DP_m2ucf.js";import{S as at}from"./SimulationView-Dxs1_eNs.js";import{_ as it}from"./CodeViewer.vue_vue_type_script_setup_true_lang-DqcCPV5b.js";import"./http-BTVgacYC.js";import{m as rt}from"./mapLessonFromDto-BcisFAGx.js";import{U as H}from"./unitApi-BoGuE9cZ.js";import{m as lt}from"./mapUnitFromDto-CYGc5n9V.js";import{T as ut}from"./index-BKOoMm66.js";import{s as dt}from"./index-CErnZw7E.js";import{s as ct}from"./index-jz2TiZnS.js";import{s as pt}from"./index-Dcx8AGZK.js";import{u as $e}from"./index-CXtLmX08.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DZ84psPa.js";import"./index-C5IBY4gE.js";import"./index-CAJHyITt.js";import"./index-2gNT34e2.js";import"./index-U6Z7yZZt.js";import"./index-JGWBZkO1.js";import"./index-DLhlDzWV.js";var vt=function(e){var n=e.dt;return`
.p-drawer {
    display: flex;
    flex-direction: column;
    transform: translate3d(0px, 0px, 0px);
    position: relative;
    transition: transform 0.3s;
    background: `.concat(n("drawer.background"),`;
    color: `).concat(n("drawer.color"),`;
    border: 1px solid `).concat(n("drawer.border.color"),`;
    box-shadow: `).concat(n("drawer.shadow"),`;
}

.p-drawer-content {
    overflow-y: auto;
    flex-grow: 1;
    padding: `).concat(n("drawer.content.padding"),`;
}

.p-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    padding: `).concat(n("drawer.header.padding"),`;
}

.p-drawer-footer {
    padding: `).concat(n("drawer.footer.padding"),`;
}

.p-drawer-title {
    font-weight: `).concat(n("drawer.title.font.weight"),`;
    font-size: `).concat(n("drawer.title.font.size"),`;
}

.p-drawer-full .p-drawer {
    transition: none;
    transform: none;
    width: 100vw !important;
    height: 100vh !important;
    max-height: 100%;
    top: 0px !important;
    left: 0px !important;
    border-width: 1px;
}

.p-drawer-left .p-drawer-enter-from,
.p-drawer-left .p-drawer-leave-to {
    transform: translateX(-100%);
}

.p-drawer-right .p-drawer-enter-from,
.p-drawer-right .p-drawer-leave-to {
    transform: translateX(100%);
}

.p-drawer-top .p-drawer-enter-from,
.p-drawer-top .p-drawer-leave-to {
    transform: translateY(-100%);
}

.p-drawer-bottom .p-drawer-enter-from,
.p-drawer-bottom .p-drawer-leave-to {
    transform: translateY(100%);
}

.p-drawer-full .p-drawer-enter-from,
.p-drawer-full .p-drawer-leave-to {
    opacity: 0;
}

.p-drawer-full .p-drawer-enter-active,
.p-drawer-full .p-drawer-leave-active {
    transition: opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1);
}

.p-drawer-left .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-end-width: 1px;
}

.p-drawer-right .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-start-width: 1px;
}

.p-drawer-top .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-end-width: 1px;
}

.p-drawer-bottom .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-start-width: 1px;
}

.p-drawer-left .p-drawer-content,
.p-drawer-right .p-drawer-content,
.p-drawer-top .p-drawer-content,
.p-drawer-bottom .p-drawer-content {
    width: 100%;
    height: 100%;
}

.p-drawer-open {
    display: flex;
}

.p-overlay-mask:dir(rtl) {
    flex-direction: row-reverse;
}
`)},mt={mask:function(e){var n=e.position,c=e.modal;return{position:"fixed",height:"100%",width:"100%",left:0,top:0,display:"flex",justifyContent:n==="left"?"flex-start":n==="right"?"flex-end":"center",alignItems:n==="top"?"flex-start":n==="bottom"?"flex-end":"center",pointerEvents:c?"auto":"none"}},root:{pointerEvents:"auto"}},ht={mask:function(e){var n=e.instance,c=e.props,a=["left","right","top","bottom"],r=a.find(function(v){return v===c.position});return["p-drawer-mask",{"p-overlay-mask p-overlay-mask-enter":c.modal,"p-drawer-open":n.containerVisible,"p-drawer-full":n.fullScreen},r?"p-drawer-".concat(r):""]},root:function(e){var n=e.instance;return["p-drawer p-component",{"p-drawer-full":n.fullScreen}]},header:"p-drawer-header",title:"p-drawer-title",pcCloseButton:"p-drawer-close-button",content:"p-drawer-content",footer:"p-drawer-footer"},wt=Ve.extend({name:"drawer",theme:vt,classes:ht,inlineStyles:mt}),gt={name:"BaseDrawer",extends:Me,props:{visible:{type:Boolean,default:!1},position:{type:String,default:"left"},header:{type:null,default:null},baseZIndex:{type:Number,default:0},autoZIndex:{type:Boolean,default:!0},dismissable:{type:Boolean,default:!0},showCloseIcon:{type:Boolean,default:!0},closeButtonProps:{type:Object,default:function(){return{severity:"secondary",text:!0,rounded:!0}}},closeIcon:{type:String,default:void 0},modal:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!1}},style:wt,provide:function(){return{$pcDrawer:this,$parentInstance:this}}},Be={name:"Drawer",extends:gt,inheritAttrs:!1,emits:["update:visible","show","after-show","hide","after-hide"],data:function(){return{containerVisible:this.visible}},container:null,mask:null,content:null,headerContainer:null,footerContainer:null,closeButton:null,outsideClickListener:null,documentKeydownListener:null,watch:{dismissable:function(e){e?this.enableDocumentSettings():this.disableDocumentSettings()}},updated:function(){this.visible&&(this.containerVisible=this.visible)},beforeUnmount:function(){this.disableDocumentSettings(),this.mask&&this.autoZIndex&&he.clear(this.mask),this.container=null,this.mask=null},methods:{hide:function(){this.$emit("update:visible",!1)},onEnter:function(){this.$emit("show"),this.focus(),this.bindDocumentKeyDownListener(),this.autoZIndex&&he.set("modal",this.mask,this.baseZIndex||this.$primevue.config.zIndex.modal)},onAfterEnter:function(){this.enableDocumentSettings(),this.$emit("after-show")},onBeforeLeave:function(){this.modal&&!this.isUnstyled&&Ae(this.mask,"p-overlay-mask-leave")},onLeave:function(){this.$emit("hide")},onAfterLeave:function(){this.autoZIndex&&he.clear(this.mask),this.unbindDocumentKeyDownListener(),this.containerVisible=!1,this.disableDocumentSettings(),this.$emit("after-hide")},onMaskClick:function(e){this.dismissable&&this.modal&&this.mask===e.target&&this.hide()},focus:function(){var e=function(a){return a&&a.querySelector("[autofocus]")},n=this.$slots.header&&e(this.headerContainer);n||(n=this.$slots.default&&e(this.container),n||(n=this.$slots.footer&&e(this.footerContainer),n||(n=this.closeButton))),n&&Te(n)},enableDocumentSettings:function(){this.dismissable&&!this.modal&&this.bindOutsideClickListener(),this.blockScroll&&Pe()},disableDocumentSettings:function(){this.unbindOutsideClickListener(),this.blockScroll&&ze()},onKeydown:function(e){e.code==="Escape"&&this.hide()},containerRef:function(e){this.container=e},maskRef:function(e){this.mask=e},contentRef:function(e){this.content=e},headerContainerRef:function(e){this.headerContainer=e},footerContainerRef:function(e){this.footerContainer=e},closeButtonRef:function(e){this.closeButton=e?e.$el:void 0},bindDocumentKeyDownListener:function(){this.documentKeydownListener||(this.documentKeydownListener=this.onKeydown,document.addEventListener("keydown",this.documentKeydownListener))},unbindDocumentKeyDownListener:function(){this.documentKeydownListener&&(document.removeEventListener("keydown",this.documentKeydownListener),this.documentKeydownListener=null)},bindOutsideClickListener:function(){var e=this;this.outsideClickListener||(this.outsideClickListener=function(n){e.isOutsideClicked(n)&&e.hide()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},isOutsideClicked:function(e){return this.container&&!this.container.contains(e.target)}},computed:{fullScreen:function(){return this.position==="full"},closeAriaLabel:function(){return this.$primevue.config.locale.aria?this.$primevue.config.locale.aria.close:void 0}},directives:{focustrap:Ne},components:{Button:le,Portal:Ue,TimesIcon:Ge}},yt=["aria-modal"];function bt(t,e,n,c,a,r){var v=ge("Button"),m=ge("Portal"),h=Oe("focustrap");return s(),S(m,null,{default:T(function(){return[a.containerVisible?(s(),u("div",N({key:0,ref:r.maskRef,onMousedown:e[0]||(e[0]=function(){return r.onMaskClick&&r.onMaskClick.apply(r,arguments)}),class:t.cx("mask"),style:t.sx("mask",!0,{position:t.position,modal:t.modal})},t.ptm("mask")),[b(re,N({name:"p-drawer",onEnter:r.onEnter,onAfterEnter:r.onAfterEnter,onBeforeLeave:r.onBeforeLeave,onLeave:r.onLeave,onAfterLeave:r.onAfterLeave,appear:""},t.ptm("transition")),{default:T(function(){return[t.visible?_e((s(),u("div",N({key:0,ref:r.containerRef,class:t.cx("root"),style:t.sx("root"),role:"complementary","aria-modal":t.modal},t.ptmi("root")),[t.$slots.container?Q(t.$slots,"container",{key:0,closeCallback:r.hide}):(s(),u(j,{key:1},[g("div",N({ref:r.headerContainerRef,class:t.cx("header")},t.ptm("header")),[Q(t.$slots,"header",{class:Ce(t.cx("title"))},function(){return[t.header?(s(),u("div",N({key:0,class:t.cx("title")},t.ptm("title")),Ke(t.header),17)):D("",!0)]}),t.showCloseIcon?(s(),S(v,N({key:0,ref:r.closeButtonRef,type:"button",class:t.cx("pcCloseButton"),"aria-label":r.closeAriaLabel,unstyled:t.unstyled,onClick:r.hide},t.closeButtonProps,{pt:t.ptm("pcCloseButton"),"data-pc-group-section":"iconcontainer"}),{icon:T(function(l){return[Q(t.$slots,"closeicon",{},function(){return[(s(),S(je(t.closeIcon?"span":"TimesIcon"),N({class:[t.closeIcon,l.class]},t.ptm("pcCloseButton").icon),null,16,["class"]))]})]}),_:3},16,["class","aria-label","unstyled","onClick","pt"])):D("",!0)],16),g("div",N({ref:r.contentRef,class:t.cx("content")},t.ptm("content")),[Q(t.$slots,"default")],16),t.$slots.footer?(s(),u("div",N({key:0,ref:r.footerContainerRef,class:t.cx("footer")},t.ptm("footer")),[Q(t.$slots,"footer")],16)):D("",!0)],64))],16,yt)),[[h]]):D("",!0)]}),_:3},16,["onEnter","onAfterEnter","onBeforeLeave","onLeave","onAfterLeave"])],16)):D("",!0)]}),_:3})}Be.render=bt;const ce=Fe("lesson-store",()=>{const t=We(),e=w(null),n=w(!1),c=w(!1),a=w(!1),r=w(!1),v=w(0),m=w([]),h=w(0),l=w([]),k=w("continue"),_=w(!1),x=w(!1),L=w(!1),d=w(!0),p=w(""),$=w(null),E=w(null),B=w([]),U=w([]),pe=be(),fe=Se(),{lang:ve}=ee(fe),F=w(void 0),Z=q(()=>{var i;return L.value&&(((i=$.value)==null?void 0:i.modulesWerePut)??!0)&&d.value});async function me(i,y){try{n.value=!0,F.value=pe.userRole==="editor"?ve.value:void 0;const{data:C}=await et.getLessonById(i,y,F.value);e.value=rt(C)}catch(C){t.add({severity:"error",summary:C.response.data.error,life:2e3})}finally{n.value=!1}}async function te(i,y){try{c.value=!0;const{data:C}=await H.getUnitByIdandLessonId(i,y,F.value);return C}catch(C){t.add({severity:"error",summary:C.response.data.error,life:2e3})}finally{c.value=!1}}async function O(){if(e.value!=null){a.value=!0,m.value=[],v.value=0,h.value=0,l.value=[],p.value="",U.value=[],x.value=!1;for(let i=0;i<e.value.pages.length;i++)l.value.push(0);k.value="continue",m.value.push(e.value.pages[v.value].groups[h.value]),await K(e.value.id),a.value=!1}}function W(i,y){let C="";if(p.value==""||y.content.starting!=""){C=`emulator-${y.id}`;const G=y.content.starting;E.value=xe(C),E.value.setCode(G)}p.value=C??p.value,i=="pibody"&&($.value=st(p.value),B.value=y.data.neededModules,$.value.addNeededModules(B.value),C!=""&&(U.value=[]))}async function K(i){L.value=!1,_.value=!1;for(let y=0;y<m.value[h.value].units.length;y++){const C=m.value[h.value].units[y];["options","open","code","pibody"].includes(C.unitType)&&(k.value="check",_.value=!0);const G=await te(C.id,i);if(G){const R=lt(G);m.value[h.value].units[y].content=R==null?void 0:R.content,m.value[h.value].units[y].data=R==null?void 0:R.data,m.value[h.value].units[y].studentState=R==null?void 0:R.studentState,["code","pibody"].includes(C.unitType)&&(R.content.answer==""&&R.data.tests.lenght==0||(d.value=!1),W(C.unitType,R))}}k.value=="continue"&&await Y()}async function Y(){if(e.value!=null)try{r.value=!0,x.value=!1;for(const i of m.value[m.value.length-1].units){if(["code","pibody"].includes(i.unitType)&&i.data.tests.lenght>0){const y=xe(p.value).code.value,C=await ot(`${i.unitType}-${i.id}`,y,i.data.tests,i.data.includedCommands);if(x.value=C.correct,C.correct)await H.skipSubmitUnitByIdandLessonId(i.id,e.value.id);else{const{data:G}=await H.getUnitCodeHint(i.id,y);t.add({severity:"error",summary:G.hint})}}else{const{data:y}=await H.submitUnitByIdandLessonId(i.id,e.value.id,i.studentState.answer);x.value=y.correct}if(x.value==!1)break}x.value?(l.value[v.value]++,h.value>=e.value.pages[v.value].groups.length-1?v.value<e.value.pages.length-1?k.value="continue":k.value="finish":k.value="continue"):k.value="try-again"}finally{r.value=!1}}async function ne(){if(e.value!=null){if(h.value>=e.value.pages[v.value].groups.length-1){J();return}a.value=!0,h.value++,m.value.push(e.value.pages[v.value].groups[h.value]),await K(e.value.id),a.value=!1}}async function V(i){const y=m.value[m.value.length-1].id;h.value--,m.value.pop(),y==i?m.value.length==0?await O():await ne():await V(i)}function f(i,y){if(e.value!=null){for(const[C,G]of m.value.entries())for(const[R,Re]of G.units.entries())if(Re.id==i){m.value[C].units[R].studentState.answer=y;break}}}async function A(){e.value!=null&&(k.value="check")}async function X(){e.value!=null&&(k.value="completed")}async function J(){e.value!=null&&(a.value=!0,v.value++,m.value=[],h.value=0,k.value="continue",m.value.push(e.value.pages[v.value].groups[h.value]),await K(e.value.id),a.value=!1)}function oe(i){L.value=i}function se(){d.value=!0}async function ae(i){if(p.value=="")return;const y=Number(p.value.split("-")[1]);f(y,i),await H.saveUnitByIdandLessonId(y,e.value.id,{answer:i})}const I=q(()=>e.value?e.value.pages[v.value]??null:null),z=q(()=>I.value?I.value.groups[h.value]??null:null),De=q({get:()=>{var i;return((i=z.value)==null?void 0:i.pibodyDrawerVisible)??!1},set:i=>{z.value&&(z.value.pibodyDrawerVisible=i)}}),Ee=q({get:()=>{var i;return((i=z.value)==null?void 0:i.codeDrawerVisible)??!1},set:i=>{z.value&&(z.value.codeDrawerVisible=i)}});return{selectedLesson:e,isLessonLoading:n,isUnitLoading:c,groups:m,groupIndex:h,isGroupLoading:a,isSubmitLoading:r,groupStatus:k,submitExist:_,correct:x,submitEnabled:Z,pageProgress:l,emulatorID:p,neededModules:B,slots:U,pibodyDrawerVisible:De,codeDrawerVisible:Ee,setSubmitable:oe,loadLessonById:me,loadUnitByIdandLessonId:te,loadInitialGroup:O,submitGroup:Y,nextGroup:ne,saveAnswer:f,tryAgain:A,finishLesson:X,runCodePressed:se,saveStudentIdeState:ae,resetGroup:V}}),Ie=P({__name:"MdViewer",props:{text:{}},setup(t){const e=t;return(n,c)=>{const a=ge("v-md-preview");return s(),S(a,{text:e.text},null,8,["text"])}}}),kt=P({__name:"ArticleViewer",props:{article:{}},setup(t){const e=t;return(n,c)=>(s(),S(Ie,{text:e.article.text},null,8,["text"]))}}),xt={class:"flex flex-col gap-4 pl-4"},_t=P({__name:"OptionsViewer",props:{optionsData:{},state:{}},emits:["save-answer"],setup(t,{emit:e}){const n=t,c=e,a=w(!1),r=w(!1),v=w(!1),m=w([]),h=w([]),l=w();return ue(()=>{var k,_,x,L,d,p;a.value=((k=n.optionsData)==null?void 0:k.shuffle)??!1,r.value=((_=n.optionsData)==null?void 0:_.feedback)??!1,v.value=((x=n.optionsData)==null?void 0:x.single)??!1,m.value=((L=n.optionsData)==null?void 0:L.options)??[],h.value=((d=n.state.answer)==null?void 0:d.options)??[],l.value=n.state.answer&&n.state.answer.options&&n.state.answer.options.length>0?(p=n.state)==null?void 0:p.answer.options[0]:void 0}),M([l,h,r],()=>{v.value&&l.value?c("save-answer",{options:[l.value],feedback:r.value}):c("save-answer",{options:h.value,feedback:r.value})},{deep:!0}),(k,_)=>{const x=ct,L=dt;return s(),u("div",xt,[(s(!0),u(j,null,de(m.value,d=>(s(),u("div",{key:d.id,class:"flex gap-2 items-center"},[v.value?(s(),S(x,{key:0,modelValue:l.value,"onUpdate:modelValue":_[0]||(_[0]=p=>l.value=p),value:d.id},null,8,["modelValue","value"])):(s(),S(L,{key:1,modelValue:h.value,"onUpdate:modelValue":_[1]||(_[1]=p=>h.value=p),value:d.id},null,8,["modelValue","value"])),b(Ie,{text:d.text},null,8,["text"])]))),128))])}}}),Ct=P({__name:"OpenViewer",props:{state:{}},emits:["save-answer"],setup(t,{emit:e}){const n=t,c=e,a=w("");return ue(()=>{a.value=n.state.answer.open}),M(a,()=>{c("save-answer",{open:a.value})}),(r,v)=>{const m=pt;return s(),S(m,{type:"text",modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=h=>a.value=h),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Lt={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},St=["src"],$t={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Bt=["src"],It=P({__name:"VideoViewer",props:{video:{}},setup(t){const e=t;function n(c){return c.replace("shorts","embed")}return(c,a)=>e.video.url.includes("embed")?(s(),u("div",Lt,[g("iframe",{credentialless:"",src:n(e.video.url),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,St)])):(s(),u("div",$t,[g("iframe",{credentialless:"",src:n(e.video.url??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Bt)]))}}),Dt={key:1,class:"flex-grow px-4 py-2"},Et=P({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(t){const e=t,n=Le(),c=ce(),{saveAnswer:a,setSubmitable:r}=c;function v(l){e.unit.unitType=="options"?r(l.options.length>0):e.unit.unitType=="open"&&r(l.open.length>0),a(e.unit.id,l),m(l)}const m=$e(l=>{h(l)},1e3,{maxWait:5e3});async function h(l){await H.saveUnitByIdandLessonId(e.unit.id,Number(n.params.id),{answer:l})}return(l,k)=>{const _=ke;return s(),u("div",null,[l.loading?(s(),S(_,{key:0,class:"flex justify-center items-center w-10 h-full"})):(s(),u("div",Dt,[e.unit.unitType=="article"?(s(),S(kt,{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(s(),S(_t,{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:v},null,8,["options-data","state"])):e.unit.unitType=="open"?(s(),S(Ct,{key:2,state:e.unit.studentState,onSaveAnswer:v},null,8,["state"])):e.unit.unitType=="video"?(s(),S(It,{key:3,video:e.unit.content},null,8,["video"])):D("",!0)]))])}}}),Rt={key:1,class:"flex flex-col h-full w-full"},Vt={class:"flex-grow flex flex-col gap-4 px-4 py-2"},At=P({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(t){const e=t,n=w(null);return M(()=>e.loading,c=>{c===!1&&n.value&&requestAnimationFrame(()=>{var a;(a=n.value)==null||a.scrollIntoView({behavior:"smooth",block:"start"})})}),(c,a)=>{const r=ke;return s(),u("div",{ref_key:"groupRef",ref:n},[c.loading?(s(),S(r,{key:0,class:"flex justify-center items-center w-10 h-full"})):(s(),u("div",Rt,[g("div",Vt,[(s(!0),u(j,null,de(c.group.units,v=>(s(),S(Et,{key:v.id,unit:v},null,8,["unit"]))),128))])]))],512)}}}),Tt={key:0,class:"absolute right-0"},Pt=P({__name:"UnitsView",props:{pages:{}},setup(t){const e=ce(),{groups:n,isGroupLoading:c,showPibody:a}=ee(e),{loadInitialGroup:r,resetGroup:v}=e,m=be(),h=w(null),l=w(null),k=w(0);function _(d){let p=d;for(;p&&p.parentElement;){const $=p.parentElement,B=getComputedStyle($).overflowY;if(B==="auto"||B==="scroll")return $;p=$}return null}async function x(){await He();const d=_(h.value),p=l.value;if(!d||!p){k.value=0;return}const $=d.clientHeight,E=p.getBoundingClientRect().height,B=Math.max(0,$-E);k.value=B}function L(d,p){var B;const $=(B=n.value[n.value.length-1])==null?void 0:B.id;let E=null;d&&(d instanceof Element?E=d:d.$el instanceof Element&&(E=d.$el)),l.value=p.id===$?E:null}return ue(()=>{r(),x(),window.addEventListener("resize",x)}),qe(()=>{window.removeEventListener("resize",x)}),M(()=>n.value.length,async()=>{await x()}),M(()=>c.value,async(d,p)=>{p===!0&&d===!1&&await x()}),(d,p)=>{const $=le,E=ut;return s(),u("div",{ref_key:"rootEl",ref:h,class:Ce(["flex flex-col gap-8",o(a)?"":"max-w-screen-lg mx-auto"])},[(s(!0),u(j,null,de(o(n),B=>(s(),u("div",{key:B.id,ref_for:!0,ref:U=>L(U,B),class:"relative"},[!o(c)&&o(m).userRole=="editor"?(s(),u("div",Tt,[_e((s(),S($,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:U=>o(v)(B.id)},{default:T(()=>p[0]||(p[0]=[g("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[E,"Reset step",void 0,{left:!0}]])])):D("",!0),b(At,{group:B,loading:o(c)&&B.id==o(n)[o(n).length-1].id},null,8,["group","loading"])]))),128)),g("div",{style:ye({height:k.value+"px"})},null,4)],2)}}}),zt={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Nt={key:1},Ut={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Gt={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},Ot={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Kt={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},jt={key:2},Mt={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Ft={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Wt=P({__name:"NavigationBar",setup(t){const e=ce(),{isSubmitLoading:n,groupStatus:c,isGroupLoading:a,submitExist:r,correct:v,submitEnabled:m}=ee(e),{submitGroup:h,nextGroup:l,tryAgain:k,finishLesson:_}=e;return(x,L)=>{const d=le;return s(),u(j,null,[o(c)=="check"?(s(),u("div",zt,[b(d,{label:"CHECK",icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(h),loading:o(n),disabled:o(n)||!o(m)},null,8,["onClick","loading","disabled"])])):D("",!0),o(c)=="continue"?(s(),u("div",Nt,[b(re,{name:"pop",appear:"",mode:"out-in"},{default:T(()=>[o(r)&&o(v)?(s(),u("div",Ut,[L[0]||(L[0]=g("div",{class:"text-lg font-bold flex items-center gap-2"},[g("span",{class:"text-3xl"},"🎉"),we(" Correct!")],-1)),b(d,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(l),loading:o(a),disabled:o(a)},null,8,["onClick","loading","disabled"])])):o(r)&&!o(v)?(s(),u("div",Gt,[b(d,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(l),loading:o(a),disabled:o(a)},null,8,["onClick","loading","disabled"])])):(s(),u("div",Ot,[b(d,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(l),loading:o(a),disabled:o(a)},null,8,["onClick","loading","disabled"])]))]),_:1})])):D("",!0),b(re,{name:"shake",appear:""},{default:T(()=>[o(c)=="try-again"?(s(),u("div",Kt,[L[1]||(L[1]=g("div",{class:"text-lg font-bold flex items-center gap-2"},[g("span",{class:"text-3xl"},"⚠️"),we(" Incorrect!")],-1)),b(d,{label:"TRY AGAIN",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(k)},null,8,["onClick"])])):D("",!0)]),_:1}),o(c)=="finish"?(s(),u("div",jt,[o(r)&&o(v)?(s(),u("div",Mt,[L[2]||(L[2]=g("div",{class:"text-lg font-bold flex items-center gap-2"},[g("span",{class:"text-3xl"},"🎉"),we(" Correct!")],-1)),b(d,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(_),loading:o(a),disabled:o(a)},null,8,["onClick","loading","disabled"])])):(s(),u("div",Ft,[b(d,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(_)},null,8,["onClick"])]))])):D("",!0)],64)}}}),qt=ft(Wt,[["__scopeId","data-v-fdc42d8d"]]),Ht={key:0,class:"h-screen flex flex-col items-center overflow-hidden relative"},Zt={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 shadow-md max-w-[1920px] mx-auto"},Yt={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},Xt={class:"flex items-center gap-4"},Jt={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},Qt={class:"w-10"},en={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},tn={key:1,class:"flex justify-center"},nn={key:2},on={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},sn={class:"fixed bottom-0 left-0 right-0 z-50 bg-white shadow-md max-w-[1920px] mx-auto"},an={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},rn={class:"relative h-full"},ln={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},un={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},dn={class:"relative h-full"},cn={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},pn={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},zn=P({__name:"LessonPage",setup(t){const e=Le(),n=Je(),c=Ze(),a=be(),r=Se(),{lang:v}=ee(r);M(v,async(V,f)=>{V!==f&&l.value&&await E(Number(e.params.id),(e.query.route_id??"").toString())});const m=ce(),{isLessonLoading:h,selectedLesson:l,pageProgress:k,groupStatus:_,emulatorID:x,neededModules:L,slots:d,pibodyDrawerVisible:p,codeDrawerVisible:$}=ee(m),{loadLessonById:E,runCodePressed:B,saveStudentIdeState:U,setSubmitable:pe}=m;function fe(){c.require({...nt,header:"Close lesson",message:"Are you sure you want to exit lesson. All progress will be lost!",acceptProps:{label:"Close",severity:"danger"},accept:()=>F()})}function ve(V){var A;const f=((A=l.value)==null?void 0:A.pages.reduce((X,J)=>X+J.groups.length,0))||1;return V/f*100}function F(){e.query.route_id&&e.query.route_id!=""?n.push("/v2/route/"+e.query.route_id):window.history.length>2?n.go(-1):n.push("/v2")}const Z=w("");M([Z,d],()=>{pe(!0),me({code:Z.value,slots:d.value})});const me=$e(V=>{U(V)},1e3,{maxWait:5e3});function te(V){Z.value=V.code}const O=w(window.innerWidth),W=w(16);function K(){if(O.value=window.innerWidth,O.value<=1300){W.value=16;return}const f=452-(O.value-1024)/2;W.value=f>16?f:16}ue(()=>{_.value="continue",K(),E(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",K)}),Ye(()=>{window.removeEventListener("resize",K)});const Y=q(()=>O.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),ne=()=>{n.push(`${e.path}/edit`)};return(V,f)=>{var se,ae;const A=le,X=Qe,J=ke,oe=Be;return s(),u(j,null,[o(_)!="completed"?(s(),u("div",Ht,[g("div",Zt,[g("div",Yt,[g("div",Xt,[b(A,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:fe})]),o(l)?(s(),u("div",Jt,[(s(!0),u(j,null,de(o(l).pages,(I,z)=>(s(),u("div",{key:z,class:"h-full",style:ye({width:ve(I.groups.length)+"%"})},[b(X,{value:o(k)[z]/I.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):D("",!0),g("div",Qt,[b(A,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:ne})])])]),g("div",en,[g("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:ye({paddingLeft:W.value+"px",paddingRight:W.value+"px"})},[o(h)?(s(),S(J,{key:0,class:"flex justify-center"})):o(l)?(s(),u("div",nn,[b(Pt,{pages:o(l).pages},null,8,["pages"])])):(s(),u("div",tn,"No lesson found")),o(a).userRole=="editor"?(s(),u("div",on,[b(o(tt))])):D("",!0)],4)]),g("div",sn,[b(qt)]),(se=o(l))!=null&&se.showPibody?(s(),u("div",an,[b(A,{icon:"pi pi-microchip",severity:"secondary",onClick:f[0]||(f[0]=I=>p.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),b(oe,{visible:o(p),"onUpdate:visible":f[4]||(f[4]=I=>ie(p)?p.value=I:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${Y.value}`}}},{header:T(()=>f[9]||(f[9]=[g("div",null,null,-1)])),container:T(()=>[g("div",rn,[g("div",ln,[b(A,{icon:"pi pi-chevron-left",severity:"secondary",onClick:f[1]||(f[1]=I=>p.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(s(),S(o(at),{id:o(x),key:o(x),slots:o(d),"onUpdate:slots":f[2]||(f[2]=I=>ie(d)?d.value=I:null),neededModules:o(L),"onUpdate:neededModules":f[3]||(f[3]=I=>ie(L)?L.value=I:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):D("",!0),(ae=o(l))!=null&&ae.showCode?(s(),u("div",un,[b(A,{icon:"pi pi-code",severity:"secondary",onClick:f[5]||(f[5]=I=>$.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),b(oe,{visible:o($),"onUpdate:visible":f[8]||(f[8]=I=>ie($)?$.value=I:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${Y.value}`}}},{header:T(()=>f[10]||(f[10]=[g("div",null,null,-1)])),container:T(()=>[g("div",dn,[g("div",cn,[b(A,{icon:"pi pi-chevron-right",severity:"secondary",onClick:f[6]||(f[6]=I=>$.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(s(),S(Xe,null,[(s(),S(o(it),{id:o(x),key:o(x),connectbuttons:o(l).showPibody,"onUpdate:connectbuttons":f[7]||(f[7]=I=>o(l).showPibody=I),onRun:o(B),onSaveAnswer:te},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):D("",!0)])):D("",!0),b(re,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:T(()=>[o(_)=="completed"?(s(),u("div",pn,[f[11]||(f[11]=g("div",{class:"text-5xl"},"⚡️",-1)),f[12]||(f[12]=g("div",{class:"flex flex-col items-center"},[g("div",{class:"text-4xl font-bold mb-8"},"Good work!"),g("div",{class:"text-md text-gray-500"},"TOTAL XP"),g("div",{class:"text-3xl font-bold"},"35")],-1)),g("div",null,[b(A,{label:"Continue",class:"rounded-full w-56 text-xl",onClick:F})])])):D("",!0)]),_:1})],64)}}});export{zn as default};
