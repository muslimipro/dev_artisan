import{s as L,a as q}from"./index-BxVfWoVs.js";import{s as G,a as K}from"./index-U6bxdMDU.js";import{s as M}from"./index-D-Li2oDx.js";import{e as N,a4 as H,u as S,P as J,r as m,B as Q,o as v,i as $,w as i,a as r,k as t,l as U,R as W,g as X,s as Y,C as Z,c as D,t as y,j as T,h as x,G as B,F as ee,n as ae,b2 as te}from"./index-BXslawiU.js";import{O as F}from"./organizationApi-BitNfgig.js";import{s as oe}from"./index-UVfE29m3.js";import"./index-nahM27qd.js";import"./index-CGa94giF.js";import"./index-CG2VAMzt.js";import"./index-3ruNB34S.js";import"./index-ChaYh2fZ.js";import"./index-DBVaFmK0.js";import"./index-eWDnl5yI.js";import"./index-DrihGHDg.js";import"./index-D71fjEBX.js";import"./index-Dt3kwrS5.js";import"./index-Dz5hNrnF.js";import"./index-DkoQadpT.js";const le={class:"flex flex-col gap-1"},ne={class:"flex flex-col gap-2"},se={class:"flex gap-2 justify-end"},ie=N({__name:"EditOrganizationDialog",props:H({selectedOrganization:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(O){const f=S(),p=J(O,"modelValue"),u=O,l=m("");Q(()=>u.selectedOrganization,a=>{l.value="",a&&(l.value=a.name)},{immediate:!0});const d=m(!1);async function C(){d.value=!0;try{const{data:a}=await F.createOrganization(l.value);f.add({severity:"success",summary:a.message,life:2e3}),window.location.reload(),p.value=!1}catch(a){f.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}finally{d.value=!1}}async function V(){if(u.selectedOrganization!=null){d.value=!0;try{const{data:a}=await F.updateOrganizationById(u.selectedOrganization.id,l.value);f.add({severity:"success",summary:a.message,life:2e3}),window.location.reload(),p.value=!1}catch(a){f.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}finally{d.value=!1}}}return(a,n)=>{const h=M,w=oe,c=U,_=W;return v(),$(_,{visible:p.value,"onUpdate:visible":n[2]||(n[2]=g=>p.value=g),modal:"",draggable:!1,class:"m-4 max-w-md",header:u.selectedOrganization?"Edit organization":"Add organization"},{default:i(()=>[r("div",le,[r("div",ne,[n[3]||(n[3]=r("div",{class:"font-bold text-sm"},"Organization name",-1)),t(h,{key:"name",type:"text",modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=g=>l.value=g)},null,8,["modelValue"])]),t(w),r("div",se,[t(c,{label:"Cancel",severity:"secondary",onClick:n[1]||(n[1]=g=>p.value=!1)}),u.selectedOrganization==null?(v(),$(c,{key:0,label:"Create",onClick:C,loading:d.value,disabled:d.value},null,8,["loading","disabled"])):(v(),$(c,{key:1,label:"Save",onClick:V,loading:d.value,disabled:d.value},null,8,["loading","disabled"]))])])]),_:1},8,["visible","header"])}}}),re={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},de={class:"flex items-center"},ue={class:"flex-grow flex gap-2 items-center"},ce={key:0,class:"text-2xl"},me={class:"w-44"},pe={class:"flex gap-2"},Ie=N({__name:"OrganizationsPage",setup(O){const f=S(),p=ae(),u=m(),l=m();(()=>{l.value={global:{value:null,matchMode:te.CONTAINS}}})();const C=()=>{u.value.exportCSV()},V=X(),{userInfo:a}=Y(V),n=m(!1),h=m(null);function w(s){n.value=!0,h.value=s}const c=m([]),_=m(!1);async function g(){try{_.value=!0;const{data:s}=await F.getOrganizations();c.value=s??[]}catch(s){f.add({severity:"error",summary:s.response.data.error,life:2e3})}finally{_.value=!1}}return Z(()=>{g()}),(s,o)=>{const k=U,P=G,A=M,E=K,b=L,R=q;return v(),D(ee,null,[r("div",re,[t(R,{ref_key:"dt",ref:u,filters:l.value,"onUpdate:filters":o[2]||(o[2]=e=>l.value=e),value:c.value,dataKey:"id",loading:_.value,scrollable:"",globalFilterFields:["id","name","created_at"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:i(()=>{var e;return[r("div",de,[r("div",ue,[c.value?(v(),D("div",ce,y(s.$t("organizations"))+" - "+y(c.value.length),1)):T("",!0)]),((e=x(a))==null?void 0:e.user_type)=="super_admin"?(v(),$(k,{key:0,label:"Add",icon:"pi pi-plus",severity:"success",variant:"outlined",class:"mr-2",onClick:o[0]||(o[0]=z=>w(null))})):T("",!0),t(k,{label:s.$t("export"),icon:"pi pi-upload",severity:"info",variant:"outlined",class:"mr-2",onClick:C},null,8,["label"]),t(E,null,{default:i(()=>[t(P,null,{default:i(()=>o[4]||(o[4]=[r("i",{class:"pi pi-search"},null,-1)])),_:1}),t(A,{modelValue:l.value.global.value,"onUpdate:modelValue":o[1]||(o[1]=z=>l.value.global.value=z),placeholder:s.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]}),empty:i(()=>o[5]||(o[5]=[B(" No organizations found. ")])),loading:i(()=>o[6]||(o[6]=[B(" Loading organizations data. Please wait. ")])),default:i(()=>[t(b,{field:"id",header:"ID",sortable:""},{body:i(({data:e})=>[B(y(e.id),1)]),_:1}),t(b,{field:"name",header:s.$t("name"),sortable:""},{body:i(({data:e})=>[r("div",null,y(`${e.name}`),1)]),_:1},8,["header"]),t(b,{header:s.$t("schools"),sortable:""},{body:i(({data:e})=>[r("div",null,y(e.school_count),1)]),_:1},8,["header"]),t(b,{field:"created_at",header:s.$t("createdTime"),sortable:""},{body:i(({data:e})=>[r("div",me,y(e.created_at.split("T")[0]+" "+e.created_at.split(".")[0].split("T")[1]),1)]),_:1},8,["header"]),t(b,{frozen:!0,alignFrozen:"right",exportable:!1},{body:i(({data:e})=>{var z;return[r("div",pe,[((z=x(a))==null?void 0:z.user_type)=="super_admin"?(v(),$(k,{key:0,icon:"pi pi-pencil",outlined:"",rounded:"",severity:"warn",onClick:j=>w(e)},null,8,["onClick"])):T("",!0),t(k,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:j=>{var I;return x(p).push({name:((I=x(a))==null?void 0:I.user_type)=="super_admin"?"admin-organization":"supervisor-organization",params:{id:e.id}})}},null,8,["onClick"])])]}),_:1})]),_:1},8,["filters","value","loading"])]),t(ie,{modelValue:n.value,"onUpdate:modelValue":o[3]||(o[3]=e=>n.value=e),"selected-organization":h.value},null,8,["modelValue","selected-organization"])],64)}}});export{Ie as default};
