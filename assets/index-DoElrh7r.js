import{a as I,a2 as ce,a3 as re,r as w,c as se,o as G,G as M,b as a,e as _,h as $,f as p,w as R,t as Y,n as ie,q as F,k as S,j as W,F as j,a4 as ve,g as x,x as H,d as we,u as xe,s as P,a5 as be,Q as $e,l as B,C as de,p as me,D as ke,E as Se,U as oe,i as ne,Y as Ce}from"./index-BBjKxJpX.js";import{u as fe,d as Ue,_ as Le}from"./defaultConfirmDeleteOptions-IsVDpSsy.js";import{L as Ve}from"./lessonApi-BKclSrNj.js";import{h as E}from"./http-MdAG8vYf.js";import{m as Be}from"./mapLessonFromDto-BxEkOMg4.js";import{U as te}from"./unitApi-Cs2U2a_E.js";import{s as Ie,a as De,b as Te,c as ze}from"./index-GaM8U8Sw.js";import{s as Fe}from"./index-CDlfdSeo.js";import{_ as pe,T as Ae}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-C9SBy8KS.js";import{s as Re}from"./index-DTVS3SxX.js";import{s as Me,a as Ee}from"./index-dbk5mmtF.js";import{s as Ne}from"./index-CkFbdKBR.js";import{s as _e}from"./index-B6UH8aGD.js";import{v as ge}from"./v4-CmTdKEVZ.js";import{_ as Pe}from"./CodeEditor.vue_vue_type_script_setup_true_lang-eau425SC.js";import{C as je}from"./cloudStorageApi-CpgJR1VC.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Oe}from"./index-BEcSPJ3F.js";import{s as He}from"./index-BouNCH9d.js";import{s as ye}from"./index-Ci047gnw.js";import{u as qe}from"./index-T6Lj112h.js";import{s as Je}from"./index-C5mVLHFM.js";import{s as We}from"./index-Djw2b-K9.js";import{T as Ye}from"./index-BwXDmMAh.js";import{s as Ke}from"./index-BtxTIWJQ.js";import"./mapUnitFromDto-BXFFFlEW.js";import"./index-ccgfwjUp.js";import"./index-C-eppklx.js";import"./index-DNeSlmdD.js";import"./index-B5BSLv2C.js";import"./index-BirtEDiG.js";import"./index-GjAjsjJ7.js";import"./index-DodL1OLQ.js";const A={hideLesson:Qe,modifyLesson:Xe,publishLesson:Ze,sendLessonForReview:et,cancelLessonReview:tt,startLessonReview:st,acceptLesson:ot,rejectLesson:nt,editLesson:lt};async function Qe(i){return await E.patch(`v2/lesson/${i}/hide`)}async function Xe(i){return await E.patch(`v2/lesson/${i}/modify`)}async function Ze(i){return await E.patch(`v2/lesson/${i}/publish`)}async function et(i){return await E.patch(`v2/lesson/${i}/review/send`)}async function tt(i){return await E.patch(`v2/lesson/${i}/review/cancel`)}async function st(i){return await E.patch(`v2/lesson/${i}/review/start`)}async function ot(i){return await E.patch(`v2/lesson/${i}/review/accept`)}async function nt(i){return await E.patch(`v2/lesson/${i}/review/reject`)}async function lt(i){return await E.patch(`v2/lesson/${i}/review/edit`)}const at={class:"flex items-center"},it={class:"flex items-center mr-2"},rt=I({__name:"HighlightEditor",props:ce({index:{},usedSlots:{}},{highlight:{},highlightModifiers:{}}),emits:ce(["remove","save"],["update:highlight"]),setup(i,{emit:r}){const n=i,u=re(i,"highlight"),o=w(""),t=w(null),e=w(null),s=w(!1),c=se(()=>t.value!=null&&e.value!=null),d=r,k=()=>{d("remove",n.index)};G(()=>{u.value&&(o.value=u.value.id,t.value=u.value.module,e.value=u.value.slot,s.value=u.value.autoPut)}),M([t,e,s],()=>{t.value!=null&&d("save",n.index,o.value,t.value,e.value,s.value)}),M(c,b=>{b||(s.value=!1)});const f=w(["A","B","C","D","E","F"]),C=w(["8","9"]),m=w(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),y=se(()=>{if(t.value){if(t.value==="servo"||t.value==="led-tower"){const U=C.value.filter(T=>!(n.usedSlots??[]).includes(T));return e.value&&!U.includes(e.value)&&U.unshift(e.value),[null,...U]}const v=f.value.filter(g=>!(n.usedSlots??[]).includes(g));return e.value&&!v.includes(e.value)&&v.unshift(e.value),[null,...v]}const l=[...f.value,...C.value].filter(h=>!(n.usedSlots??[]).includes(h));return e.value&&!l.includes(e.value)&&l.unshift(e.value),[null,...l]}),L=se(()=>e.value?e.value==="8"||e.value==="9"?["servo","led-tower"]:m.value.filter(b=>b!=="servo"&&b!=="led-tower"):m.value);return(b,l)=>{const h=_e,v=Ne,g=Me,U=Ee,T=F;return a(),_("div",at,[$("div",it,[p(h,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=V=>s.value=V),binary:"","input-id":"autoput",disabled:!c.value},null,8,["modelValue","disabled"]),l[3]||(l[3]=$("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),p(U,null,{default:R(()=>[p(v,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=V=>t.value=V),options:L.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),p(g,{class:"h-[35px]"},{default:R(()=>[...l[4]||(l[4]=[$("div",null,"=>",-1)])]),_:1}),p(v,{modelValue:e.value,"onUpdate:modelValue":l[2]||(l[2]=V=>e.value=V),options:y.value,placeholder:"Select slot",size:"small"},{option:R(({option:V})=>[$("span",{class:ie(V===null?"text-gray-400":"")},Y(V===null?"[null]":V),3)]),value:R(({value:V})=>[$("span",{class:ie(V===null?"text-gray-400":"")},Y(V===null?"[null]":V),3)]),_:1},8,["modelValue","options"])]),_:1}),p(T,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:k,class:"ml-2"})])}}}),dt={class:"flex flex-col gap-2"},ut=I({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(i){const r=re(i,"neededModules");function n(){r.value=[...r.value,{autoPut:!1,module:null,slot:null,id:ge()}]}function u(t){r.value.splice(t,1)}function o(t,e,s,c,d){r.value[t].id=e,r.value[t].module=s,r.value[t].slot=c,r.value[t].autoPut=d}return(t,e)=>{const s=F,c=Re;return a(),S(c,{header:"Highlight slots & modules"},{default:R(()=>[$("div",dt,[(a(!0),_(j,null,W(r.value,(d,k)=>(a(),_("div",{key:d.id},[p(rt,{highlight:r.value[k],"onUpdate:highlight":f=>r.value[k]=f,index:k,usedSlots:r.value.filter((f,C)=>{var m;return C!==k&&((m=r.value[C])==null?void 0:m.slot)!=null}).map(f=>f.slot),onRemove:u,onSave:o},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),p(s,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:n})]),_:1})}}}),ct={class:"flex"},pt={class:"h-[500px] flex flex-col w-full relative"},vt={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},mt={class:"absolute right-2 bottom-2"},le=!1,ft=I({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content","show-tester"],setup(i,{emit:r}){const n=H(),u=i,o=r,t=w(""),e=w(""),s=w([]);let c=!0;ve(()=>{t.value=u.content.starting,e.value=u.content.answer,s.value=u.data.neededModules??[]}),M([t,e,s],()=>{if(console.log(1),c){c=!1;return}o("save-content",{starting:t.value,answer:e.value,hashed_answer:""},{neededModules:s.value.filter(k=>k.module!=null),tests:u.data.tests,includedCommandsForTests:u.data.includedCommandsForTests})},{deep:!0});function d(){o("show-tester",{lesson_id:n.params.id,unit_id:u.id.split("-")[1]})}return(k,f)=>{const C=F;return a(),_(j,null,[$("div",ct,[$("div",pt,[$("div",vt,[p(pe,{code:t.value,"onUpdate:code":f[0]||(f[0]=m=>t.value=m),runbuttons:!1,connectbuttons:le,id:u.id+"_",class:"flex-1"},null,8,["code","id"]),p(pe,{code:e.value,"onUpdate:code":f[1]||(f[1]=m=>e.value=m),connectbuttons:le,"onUpdate:connectbuttons":f[2]||(f[2]=m=>le=m),id:u.id,class:"flex-1"},null,8,["code","id"])]),$("div",mt,[p(C,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:d})]),p(x(Ae),{id:u.id,class:"flex-grow max-h-40"},null,8,["id"])])]),p(ut,{neededModules:s.value,"onUpdate:neededModules":f[3]||(f[3]=m=>s.value=m),class:"mb-2"},null,8,["neededModules"])],64)}}}),_t=["article","options","open","video","code","pibody"],O=we("lesson-edit-store",()=>{const i=xe(),r=fe(),{lang:n}=P(r),u=w(null),o=w(!1),t=w(!1),e=w(!1),s=w(!1),c=w(!1),d=w(!1);function k(b){e.value=b}async function f(b){try{o.value=!0;const{data:l}=await Ve.getLessonById(b,void 0,n.value);u.value=Be(l)}catch(l){i.add({severity:"error",summary:l.response.data.error,life:2e3})}finally{o.value=!1}}async function C(b,l){try{t.value=!0;const{data:h}=await te.getUnitByIdandLessonId(b,l,n.value);return h}catch(h){i.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{t.value=!1}}async function m(b){try{s.value=!0;const{data:l}=await te.createUnitByLessonId(u.value.id,b);i.add({severity:"success",summary:l.message,life:2e3})}catch(l){i.add({severity:"error",summary:l.response.data.error,life:2e3})}finally{s.value=!1}}async function y(b,l,h){try{c.value=!0;const{data:v}=await te.updateUnitByIdandLessonId(b,l,h,n.value);return v.unit_id}catch(v){i.add({severity:"error",summary:v.response.data.error,life:2e3})}finally{c.value=!1}}async function L(b,l){try{d.value=!0;const{data:h}=await te.deleteUnitByIdandLessonId(b,l);i.add({severity:"success",summary:h.message,life:2e3})}catch(h){i.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{d.value=!1}}return{selectedLesson:u,isLessonLoading:o,isLessonSaving:e,isUnitLoading:t,isUnitCreating:s,isUnitUpdating:c,isUnitDeleting:d,setLessonSaving:k,loadLessonById:f,loadUnitByIdandLessonId:C,createUnit:m,updateUnitByIdandLessonId:y,deleteUnitByIdandLessonId:L}}),gt={class:"flex items-start"},yt=I({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const r=re(i,"modelValue"),n=be({title:{title:"Title",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e="# <center>",s="</center>",d=t||"Title";return{text:`${e}${d}${s}`,selected:d}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(o){o.insert(()=>{const t='<span style="font-size: 20px">',e="</span>",s="⚠️";return{text:`${t}${s}${e}`,selected:s}})}},{name:"PiBody",text:"PiBody",action(o){o.insert(()=>{const t="<b>",e="</b>",s='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${t}${s}${e}`,selected:s}})}},{name:"Run",text:"Run",action(o){o.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e='<span style="">',s="</span>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(o){o.insert(t=>{const e='<span style="text-decoration: underline">',s="</span>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',s="</div>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}},note:{title:"Note",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',s="</div>",d=t||"placeholder";return{text:`${e}${d}${s}`,selected:d}})}}});async function u(o,t,e){const s=e[0],c=new FormData;c.append("file",s);try{const{data:d}=await je.uploadFile(c,"image_"),k=d.source_url;t({url:k,desc:"desc",width:"auto",height:"auto"})}catch(d){console.log(d)}}return(o,t)=>{const e=$e("v-md-editor");return a(),_("div",gt,[p(e,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),mode:"edit",onChange:t[1]||(t[1]=s=>r.value=s),"left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:n,"disabled-menus":[],onUploadImage:u},null,8,["modelValue","toolbar"])])}}}),he=Ge(yt,[["__scopeId","data-v-52e9f376"]]),ht=I({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(i,{emit:r}){const n=i,u=r,o=w("");let t=!0;return G(()=>{var e;o.value=((e=n.article)==null?void 0:e.text)??""}),M(o,()=>{if(t){t=!1;return}u("save-content",{text:o.value})},{flush:"post"}),(e,s)=>(a(),S(he,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=c=>o.value=c)},null,8,["modelValue"]))}}),wt={class:"flex flex-col gap-2"},xt={class:"flex gap-1 text-gray-500"},bt={class:"flex flex-col gap-1"},$t=I({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(i,{emit:r}){const n=i,u=r,o=w(!1),t=w(!1),e=w(!1),s=w([]),c=w([]),d=w();let k=!0;G(()=>{var m,y,L,b,l,h;o.value=((m=n.optionsData)==null?void 0:m.shuffle)??!1,t.value=((y=n.optionsData)==null?void 0:y.feedback)??!1,e.value=((L=n.optionsData)==null?void 0:L.single)??!1,s.value=((b=n.optionsData)==null?void 0:b.options)??[],c.value=((l=n.optionsData)==null?void 0:l.answer)??[],d.value=n.optionsData&&n.optionsData.answer&&n.optionsData.answer.length>0?(h=n.optionsData)==null?void 0:h.answer[0]:void 0}),M([o,t,e,s,c,d],()=>{if(k){k=!1;return}u("save-content",{shuffle:o.value,feedback:t.value,single:e.value,options:s.value,answer:e.value?d.value?[d.value]:[]:c.value,hashed_answer:[]})},{deep:!0});function f(){s.value.push({id:ge(),text:""})}function C(m){s.value=s.value.filter(y=>y.id!==m),c.value=c.value.filter(y=>y!==m),d.value==m&&(d.value=void 0)}return(m,y)=>{const L=He,b=Oe,l=_e,h=F;return a(),_("div",wt,[$("div",xt,[y[5]||(y[5]=$("div",null,"shuffle:",-1)),p(L,{modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=v=>o.value=v),class:"mr-2"},null,8,["modelValue"]),y[6]||(y[6]=$("div",null,"feedback:",-1)),p(L,{modelValue:t.value,"onUpdate:modelValue":y[1]||(y[1]=v=>t.value=v),class:"mr-2"},null,8,["modelValue"]),y[7]||(y[7]=$("div",null,"single:",-1)),p(L,{modelValue:e.value,"onUpdate:modelValue":y[2]||(y[2]=v=>e.value=v)},null,8,["modelValue"])]),$("div",bt,[(a(!0),_(j,null,W(s.value,v=>(a(),_("div",{key:v.id,class:"flex gap-2 items-center"},[e.value?(a(),S(b,{key:0,modelValue:d.value,"onUpdate:modelValue":y[3]||(y[3]=g=>d.value=g),value:v.id},null,8,["modelValue","value"])):(a(),S(l,{key:1,modelValue:c.value,"onUpdate:modelValue":y[4]||(y[4]=g=>c.value=g),value:v.id},null,8,["modelValue","value"])),p(he,{modelValue:v.text,"onUpdate:modelValue":g=>v.text=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),p(h,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:g=>C(v.id)},null,8,["onClick"])]))),128))]),p(h,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:f,class:"self-center"})])}}}),kt=I({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(i,{emit:r}){const n=i,u=r,o=w("");let t=!0;return G(()=>{var e;o.value=((e=n.open)==null?void 0:e.answer)??""}),M(o,()=>{if(t){t=!1;return}u("save-content",{answer:o.value,hashed_answer:""})}),(e,s)=>{const c=ye;return a(),S(c,{type:"text",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=d=>o.value=d??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),St=I({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(i,{emit:r}){const n=i,u=r,o=w("");let t=!0;return G(()=>{var e;o.value=((e=n.video)==null?void 0:e.url)??""}),M(o,()=>{if(t){t=!1;return}u("save-content",{url:o.value})}),(e,s)=>{const c=ye;return a(),S(c,{type:"text",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=d=>o.value=d??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Ct={class:"bg-white rounded-lg border border-gray-200"},Ut={key:1,class:"flex flex-col h-full w-full"},Lt={class:"flex items-center gap-2 px-4 pt-2"},Vt={class:"text-sm"},Bt={class:"text-sm text-gray-500"},It={key:1,class:"flex-grow px-4 py-2"},Dt={class:"flex justify-end"},Tt=I({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(i,{emit:r}){const n=i,u=r,o=H(),t=me(),e=O(),{updateUnitByIdandLessonId:s,setLessonSaving:c,loadUnitByIdandLessonId:d}=e,k=w(!1),f=w(null),C=w(null);ve(async()=>{k.value=!0;const l=await d(n.unit.id,Number(o.params.id));l&&(f.value=l.content,C.value=l.data),k.value=!1});function m(l,h){c(!0),L(l,h)}function y(l){t.push({name:"tester2",params:{lesson_id:l.lesson_id,unit_id:l.unit_id}})}const L=qe((l,h)=>{b(l,h)},1e3,{maxWait:5e3});async function b(l,h){const v=await s(n.unit.id,Number(o.params.id),{content:l,data:h});v&&u("update",n.unit,v),c(!1)}return(l,h)=>{const v=Fe,g=F;return a(),_("div",Ct,[i.loading?(a(),S(v,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),_("div",Ut,[$("div",Lt,[$("div",Vt,Y(i.unit.id),1),$("div",Bt,Y(`${i.unit.unitType}`),1)]),k.value?(a(),S(v,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),_("div",It,[i.unit.unitType=="article"?(a(),S(ht,{key:0,article:f.value,onSaveContent:m},null,8,["article"])):i.unit.unitType=="options"?(a(),S($t,{key:1,"options-data":f.value,onSaveContent:m},null,8,["options-data"])):i.unit.unitType=="open"?(a(),S(kt,{key:2,open:f.value,onSaveContent:m},null,8,["open"])):i.unit.unitType=="video"?(a(),S(St,{key:3,video:f.value,onSaveContent:m},null,8,["video"])):n.unit.unitType=="code"?(a(),S(x(Pe),{key:4,id:`code-${n.unit.id}`,code:f.value,onSaveContent:m,onShowTester:y},null,8,["id","code"])):n.unit.unitType=="pibody"?(a(),S(x(ft),{key:5,id:`code-${n.unit.id}`,content:f.value,data:C.value,onSaveContent:m,onShowTester:y},null,8,["id","content","data"])):B("",!0)])),$("div",Dt,[p(g,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:h[0]||(h[0]=de(U=>u("delete",n.unit),["stop"]))})])]))])}}}),zt={class:"group w-full relative"},Ft={class:"flex"},ae=I({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(i,{emit:r}){const n=i,u=r,o=H(),t=O(),{loadLessonById:e,createUnit:s}=t,c=w(),d=w(_t.map(f=>({label:f,command:async()=>{await s({unit_type:f,prev_unit_id:n.unitId??void 0}),await e(Number(o.params.id))}}))),k=f=>{c.value.toggle(f)};return(f,C)=>{const m=We,y=F,L=Je;return a(),_(j,null,[$("div",zt,[C[1]||(C[1]=$("div",{class:"h-3"},null,-1)),$("div",{class:ie(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",i.hided?"hidden":""])},[$("div",Ft,[p(m,{class:"w-7",type:"dashed"}),p(m,{class:"flex-grow",type:"dashed"}),p(y,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:k}),p(m,{class:"flex-grow",type:"dashed"}),i.showAddGroup?(a(),S(y,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:C[0]||(C[0]=b=>u("add-group-divider"))})):(a(),S(m,{key:1,class:"w-7",type:"dashed"}))])],2)]),p(L,{ref_key:"menu",ref:c,model:d.value,popup:!0},null,8,["model"])],64)}}}),At=I({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(i,{emit:r}){const n=r;return(u,o)=>{const t=F;return a(),S(t,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:o[0]||(o[0]=de(e=>n("remove-group-divider"),["stop"]))})}}}),Rt={class:"flex flex-col gap-2"},Mt={class:"w-full flex justify-between gap-2 mr-4"},Et={class:"flex flex-row"},Nt={class:"flex flex-col p-2 rounded-lg bg-slate-50"},Pt=I({__name:"UnitsView",props:{pages:{}},setup(i){const r=i,n=H(),u=ke(),o=O(),{isUnitDeleting:t}=P(o),{loadLessonById:e,createUnit:s,deleteUnitByIdandLessonId:c}=o,d=w(null);async function k(g){await s({unit_type:"group-divider",prev_unit_id:g.id}),await e(Number(n.params.id))}async function f(){await s({unit_type:"page-divider"}),await e(Number(n.params.id))}async function C(g){await s({unit_type:"page-divider",prev_unit_id:g}),await c(g,Number(n.params.id)),await e(Number(n.params.id))}async function m(g){await c(g,Number(n.params.id)),await e(Number(n.params.id))}function y(g){d.value=g,u.require({...Ue,message:"Are you sure you want to delete this lesson?",accept:async()=>{await c(g.id,Number(n.params.id)),await e(Number(n.params.id))}})}function L(g,U){U>g.id&&(g.id=U)}const b=Number(n.params.id),l=`openedPanels-${b}`,h=w({});G(async()=>{const g=localStorage.getItem(l);g&&(h.value=JSON.parse(g)),await Se(),setTimeout(()=>{const U=localStorage.getItem(`lastOpenedGroup-${b}`);if(U){const T=document.getElementById(`group-${U}`);if(T){T.scrollIntoView({behavior:"smooth"});return}}},1e3)}),M(h,g=>{localStorage.setItem(l,JSON.stringify(g))},{deep:!0});function v(g,U){h.value[U]=g,h.value[U].length>0&&localStorage.setItem(`lastOpenedGroup-${b}`,g[g.length-1])}return(g,U)=>{const T=F,V=Ie,K=De,Q=Te,X=ze;return a(),_("div",Rt,[(a(!0),_(j,null,W(r.pages,N=>(a(),S(X,{value:h.value[N.id]||[],"onUpdate:value":D=>v(D,N.id),multiple:"",key:N.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:R(()=>[(a(!0),_(j,null,W(N.groups,(D,q)=>(a(),S(Q,{key:D.id,value:D.id,id:`group-${D.id}`},{default:R(()=>[p(V,null,{default:R(()=>[$("div",Mt,[$("div",null,"Step: "+Y(q),1),$("div",Et,[q!=0?(a(),S(T,{key:0,icon:"pi pi-file-plus",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:de(z=>C(D.id),["stop"])},null,8,["onClick"])):B("",!0),D.id!=-1?(a(),S(At,{key:1,onRemoveGroupDivider:z=>m(D.id)},null,8,["onRemoveGroupDivider"])):B("",!0)])])]),_:2},1024),p(K,{class:"flex flex-col"},{default:R(()=>[$("div",Nt,[(a(!0),_(j,null,W(D.units,(z,Z)=>{var J;return a(),_("div",{key:z.id},[Z==0?(a(),S(ae,{key:0,hided:!0,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0),p(Tt,{unit:z,loading:((J=d.value)==null?void 0:J.id)===z.id&&x(t),onDelete:ee=>y(z),onUpdate:L},null,8,["unit","loading","onDelete"]),p(ae,{hided:!0,"unit-id":z.id,"show-add-group":!0,onAddGroupDivider:ee=>k(z)},null,8,["unit-id","onAddGroupDivider"])])}),128)),D.units.length==0?(a(),S(ae,{key:0,hided:!1,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),p(T,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:U[0]||(U[0]=N=>f())})])}}}),jt={class:"w-[24px] h-[24px]"},Gt={key:0,class:"flex items-center"},Ot={key:0,class:"material-icons text-gray-500"},Ht={key:1,class:"material-icons text-gray-500"},qt={key:1},Jt={class:"material-icons text-gray-500"},Wt=I({__name:"AutoSaveCloud",setup(i){const r=O(),{selectedLesson:n,isLessonSaving:u}=P(r);return(o,t)=>{var s;const e=Ye;return a(),_("div",jt,[(s=x(n))!=null&&s.editable?(a(),_("div",Gt,[x(u)?oe((a(),_("span",Ht,[...t[1]||(t[1]=[ne("cloud_sync",-1)])])),[[e,"Saving...",void 0,{bottom:!0}]]):oe((a(),_("span",Ot,[...t[0]||(t[0]=[ne("cloud_done",-1)])])),[[e,"Saved",void 0,{bottom:!0}]])])):(a(),_("div",qt,[oe((a(),_("span",Jt,[...t[2]||(t[2]=[ne("cloud_off",-1)])])),[[e,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Yt={key:0},Kt={key:0},Qt={key:1},Xt={key:0},Zt={key:1},es={key:2},ts={key:0,class:"flex gap-1"},ss={key:3},os={key:0},ns={key:4},ls={key:0,class:"flex gap-1"},as={key:5},is={key:0,class:"flex gap-1"},rs={key:6},ds={key:0,class:"flex gap-1"},us=I({__name:"StageButtons",setup(i){const r=H(),n=Ce(),{user:u}=P(n),o=O(),{selectedLesson:t}=P(o),e=w(!1),s=w(!1);async function c(){e.value=!0;try{await A.sendLessonForReview(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{e.value=!1}}async function d(){e.value=!0;try{await A.cancelLessonReview(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{e.value=!1}}async function k(){e.value=!0;try{await A.startLessonReview(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{e.value=!1}}async function f(){e.value=!0;try{await A.acceptLesson(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{e.value=!1}}async function C(){s.value=!0;try{await A.rejectLesson(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{s.value=!1}}async function m(){e.value=!0;try{await A.editLesson(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{e.value=!1}}async function y(){e.value=!0;try{await A.publishLesson(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{e.value=!1}}async function L(){s.value=!0;try{await A.hideLesson(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{s.value=!1}}async function b(){e.value=!0;try{await A.modifyLesson(r.params.id.toString()),window.location.reload()}catch(l){console.log(l)}finally{e.value=!1}}return(l,h)=>{var g,U,T,V,K,Q,X,N,D,q,z,Z,J,ee,ue;const v=F;return((g=x(t))==null?void 0:g.stage)=="prepare_for_submission"?(a(),_("div",Yt,[((U=x(u))==null?void 0:U.user_type)=="contributor"?(a(),_("div",Kt,[p(v,{label:"Send for review",severity:"info",size:"small",onClick:c,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((T=x(t))==null?void 0:T.stage)=="waiting_for_review"?(a(),_("div",Qt,[((V=x(u))==null?void 0:V.user_type)=="contributor"?(a(),_("div",Xt,[p(v,{label:"Cancel submission",severity:"danger",size:"small",onClick:d,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):((K=x(u))==null?void 0:K.user_type)=="editor"?(a(),_("div",Zt,[p(v,{label:"Start review",severity:"info",size:"small",onClick:k,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((Q=x(t))==null?void 0:Q.stage)=="in_review"?(a(),_("div",es,[((X=x(u))==null?void 0:X.user_type)=="editor"?(a(),_("div",ts,[p(v,{label:"Reject",severity:"danger",size:"small",onClick:C,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),p(v,{label:"Accept",size:"small",onClick:f,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((N=x(t))==null?void 0:N.stage)=="rejected"?(a(),_("div",ss,[((D=x(u))==null?void 0:D.user_type)=="contributor"?(a(),_("div",os,[p(v,{label:"Edit submission",severity:"info",size:"small",onClick:m,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((q=x(t))==null?void 0:q.stage)=="ready_for_publish"?(a(),_("div",ns,[((z=x(u))==null?void 0:z.user_type)=="editor"?(a(),_("div",ls,[x(t).createdBy!=Number(x(u).user_id)?(a(),S(v,{key:0,label:"Reject",severity:"danger",size:"small",onClick:C,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"])):B("",!0),p(v,{label:"Publish",size:"small",onClick:y,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((Z=x(t))==null?void 0:Z.stage)=="published"?(a(),_("div",as,[((J=x(u))==null?void 0:J.user_type)=="editor"?(a(),_("div",is,[p(v,{label:"Hide",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),p(v,{label:"Modify",size:"small",onClick:b,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((ee=x(t))==null?void 0:ee.stage)=="in_modify"?(a(),_("div",rs,[((ue=x(u))==null?void 0:ue.user_type)=="editor"?(a(),_("div",ds,[p(v,{label:"Hide",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),p(v,{label:"Publish",size:"small",onClick:y,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):B("",!0)}}}),cs={key:0},ps=I({__name:"StageStatus",setup(i){const r=O(),{selectedLesson:n}=P(r);return(u,o)=>{const t=Ke;return x(n)?(a(),_("div",cs,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes(x(n).stage)?(a(),S(t,{key:0,label:x(n).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes(x(n).stage)?(a(),S(t,{key:1,label:x(n).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes(x(n).stage)?(a(),S(t,{key:2,label:x(n).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):B("",!0)])):B("",!0)}}}),vs={class:"flex flex-col items-center"},ms={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},fs={class:"flex items-center gap-4"},_s={class:"flex items-center gap-4"},gs={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},ys={class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},Xs=I({__name:"LessonEditPage",setup(i){const r=H(),n=me(),u=fe(),{lang:o}=P(u),t=O(),{selectedLesson:e}=P(t),{loadLessonById:s}=t;G(()=>s(Number(r.params.id))),M(o,async(k,f)=>{k!==f&&e.value&&await s(e.value.id)});const c=()=>{const k=r.path.endsWith("/edit")?r.path.replace(/\/edit$/,""):"#";window.open(k,"_blank")};function d(){window.history.length>2?n.go(-1):n.push("/v2/routes")}return(k,f)=>{var m;const C=F;return a(),_("div",vs,[$("div",ms,[$("div",fs,[p(C,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:d}),p(ps)]),$("div",_s,[p(us)])]),$("div",gs,[(a(),S(Pt,{key:x(o),pages:(m=x(e))==null?void 0:m.pages},null,8,["pages"]))]),$("div",ys,[p(Wt),p(x(Le)),p(C,{icon:"pi pi-eye",variant:"text",severity:"contrast",onClick:c})])])}}});export{Xs as default};
