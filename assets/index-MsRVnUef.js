import{B as ge,L as X,N as ee,o,c as f,S as ve,i as l,m as Q,e as G,a as se,f as H,r as h,D as ae,q as y,j as a,ab as _e,u as le,A as ye,E as we,w as c,k as s,l as B,t as d,v as L,U as j,y as te,I as oe,g as he,$ as be,F as A,n as R}from"./index-Dr-Wug06.js";import{h as xe,z as E,s as $e}from"./index-COqCUB0C.js";import{s as ke}from"./index-BUOYlPmD.js";import{s as Ve}from"./index-CV047Mdb.js";import{s as Ce}from"./index-URIe1gb8.js";import{s as ne}from"./index-0Lyl_BSo.js";import{s as Se}from"./index-_IVXUV9l.js";import{s as Be}from"./index-I89aVLSi.js";import{s as Le}from"./index-O3QiIHbq.js";import{_ as je}from"./MainHeader.vue_vue_type_script_setup_true_lang-DzEf28nx.js";import{s as Ue}from"./index-DRQyDH3-.js";import{A as Y}from"./language-DYQF8nnT.js";import{u as ze}from"./useLocaleStore-CzkPeUgS.js";import{u as Ie}from"./index-B4CDPhDr.js";import"./index-T-sLUTd_.js";import"./index-S-qusIQR.js";import"./index-Ec2p57pq.js";import"./index-BTW-0wPb.js";import"./logo-D1-3uCnC.js";import"./index-DyXuhtfX.js";var Me=function(r){var v=r.dt;return`
.p-overlaybadge {
    position: relative;
}

.p-overlaybadge .p-badge {
    position: absolute;
    inset-block-start: 0;
    inset-inline-end: 0;
    transform: translate(50%, -50%);
    transform-origin: 100% 0;
    margin: 0;
    outline-width: `.concat(v("overlaybadge.outline.width"),`;
    outline-style: solid;
    outline-color: `).concat(v("overlaybadge.outline.color"),`;
}

.p-overlaybadge .p-badge:dir(rtl) {
    transform: translate(-50%, -50%);
}
`)},Pe={root:"p-overlaybadge"},Ae=ge.extend({name:"overlaybadge",theme:Me,classes:Pe}),Ee={name:"OverlayBadge",extends:X,style:Ae,provide:function(){return{$pcOverlayBadge:this,$parentInstance:this}}},ie={name:"OverlayBadge",extends:Ee,inheritAttrs:!1,components:{Badge:X}};function De(g,r,v,t,b,u){var p=ee("Badge");return o(),f("div",Q({class:g.cx("root")},g.ptmi("root")),[ve(g.$slots,"default"),l(p,Q(g.$props,{pt:g.ptm("pcBadge")}),null,16,["pt"])],16)}ie.render=De;const Fe=G({__name:"LocaleSelector",setup(g){const{locale:r}=se(),v=ze(),{selectedLang:t}=H(v),b=h(Y.find(u=>u.locale===r.value)??Y[0]);return ae(b,u=>{u&&(r.value=u.locale,t.value=u,localStorage.setItem("selectedLanguage",u.locale))}),(u,p)=>{const x=Ue;return o(),y(x,{modelValue:b.value,"onUpdate:modelValue":p[0]||(p[0]=_=>b.value=_),"dropdown-icon":"pi pi-globe",options:a(Y),optionLabel:"label",checkmark:"",highlightOnSelect:!0,size:"small"},null,8,["modelValue","options"])}}}),Ne={class:"text-blue-500"},Oe={class:"flex flex-col gap-1"},Te={class:"flex gap-1 justify-end"},qe=G({__name:"VerifyEmailDialog",props:{modelValue:{type:Boolean,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(g){const r=_e(g,"modelValue"),v=le(),t=ye(),{user:b}=H(t),u=h(!1),p=h(0);let x;const _=()=>{p.value=60,x=setInterval(()=>{p.value>0?p.value--:clearInterval(x)},1e3)};async function D(){u.value=!0;try{const{data:m}=await j.sendVerificationEmail();v.add({severity:"success",summary:m.message,life:2e3}),_()}catch(m){v.add({severity:"error",summary:m.response.data.error,detail:m,life:2e3})}finally{u.value=!1}}return we(()=>{clearInterval(x)}),(m,U)=>{const F=ee("i18n-t"),N=te,V=ne,$=oe;return o(),y($,{visible:r.value,"onUpdate:visible":U[0]||(U[0]=w=>r.value=w),modal:"",draggable:!1,class:"m-4 max-w-md",header:m.$t("dialog.verifyYourEmail")},{footer:c(()=>[s("div",Oe,[s("div",Te,[l(N,{label:p.value>0?`${m.$t("pages.login.resendIn")} ${p.value}s`:m.$t("dialog.sendVerificationEmail"),onClick:D,loading:u.value,disabled:u.value||p.value>0},null,8,["label","loading","disabled"])]),p.value>0?(o(),y(V,{key:0,severity:"success"},{default:c(()=>[B(d(m.$t("pages.settings.weHaveSentLinkToVerifyEmail")),1)]),_:1})):L("",!0)])]),default:c(()=>[s("div",null,[l(F,{keypath:"dialog.confirmEmailAddress"},{email:c(()=>{var w;return[s("span",Ne,d((w=a(b))==null?void 0:w.email),1)]}),_:1})])]),_:1},8,["visible","header"])}}}),Re={class:"flex flex-col items-center h-screen"},Ye={class:"w-full h-full max-w-[1400px] px-4 md:px-28 py-8"},Ge={key:1,class:"flex justify-center"},He={key:2,class:"flex flex-col gap-8"},We={class:"flex p-6 bg-white rounded-2xl"},Ze={class:"text-heading-3-semibold"},Je={class:"flex flex-col md:flex-row p-6 md:p-10 lg:p-16 bg-white rounded-2xl gap-8 md:gap-12 lg:gap-16 items-start"},Ke={class:"flex flex-col gap-6 items-center w-full md:w-64 shrink-0"},Qe={class:"flex flex-wrap space-y-2 space-x-2 justify-center gap-2 h-fit max-w-full md:max-w-60"},Xe={class:"flex flex-col gap-6 w-full"},es={class:"flex flex-col gap-2 w-full"},ss={class:"text-gray-700 font-semibold"},as={class:"flex flex-col gap-2 w-full"},ls={class:"text-gray-700 font-semibold"},ts={key:0,class:"flex flex-col gap-2 w-full"},os={class:"text-gray-700 font-semibold"},ns={key:0,class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4 w-full"},is={key:1,class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4 w-full"},rs={class:"flex flex-col gap-2 w-full"},ds={class:"text-gray-700 font-semibold"},cs={class:"flex flex-col gap-4 w-full"},us={class:"text-gray-700 font-semibold"},ms={class:"flex flex-col gap-1"},ps={for:"old_password"},fs={class:"my-0 flex flex-col gap-1"},gs={class:"flex flex-col gap-1"},vs={for:"new_password"},_s={class:"my-0 flex flex-col gap-1"},ys={class:"flex flex-col gap-1"},ws={for:"confirm_password"},hs={class:"my-0 flex flex-col gap-1"},bs={class:"flex justify-between items-center mb-8"},xs={class:"flex justify-end gap-2"},qs=G({__name:"SettingsPage",setup(g){const{t:r}=se(),v=he(),{userInfo:t,isUserInfoLoading:b,userLabel:u}=H(v),{loadUserInfo:p}=v,x=Ie(e=>{j.updateUserInfo(e),_.add({severity:"success",summary:r("pages.settings.successfullySaved"),life:2e3})},1e3,{maxWait:5e3});ae(t,async()=>{t.value&&x({name:t.value.name,school_name:t.value.school_name})},{deep:!0});const _=le(),D=be(),m=h(!1),U=h({old_password:"",new_password:""}),F=xe(E.object({old_password:E.string().min(1,{message:"Old password is required."}).max(100,{message:"Maximum 100 characters."}),new_password:E.string().min(8,{message:"Minimum 8 characters."}).max(100,{message:"Maximum 100 characters."}).refine(e=>/[a-z]/.test(e),{message:"Must have a lowercase letter."}).refine(e=>/[A-Z]/.test(e),{message:"Must have an uppercase letter."}).refine(e=>/[0-9]/.test(e),{message:"Must have a number."}),confirm_password:E.string()}).refine(e=>e.new_password===e.confirm_password,{message:"Passwords must match",path:["confirm_password"]})),N=async e=>{if(!m.value&&e.valid){m.value=!0;try{const{data:n}=await j.changePassword(e.states.old_password.value,e.states.new_password.value);_.add({severity:"success",summary:n.message,life:2e3})}catch(n){_.add({severity:"error",summary:n.response.data.error,detail:n,life:2e3})}finally{m.value=!1}}},V=h(!1),$=h(""),w=h(!1),z=h(!1);async function re(){if($.value.length!=0){z.value=!0;try{const{data:e}=await j.joinClass($.value);w.value=!1,window.location.reload(),_.add({severity:"success",summary:e.message,life:2e3})}catch(e){_.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{z.value=!1}}}const I=h(!1);function de(){D.require({message:r("pages.settings.confirmLeaveClass"),header:r("pages.settings.confirmation"),icon:"pi pi-exclamation-triangle",rejectProps:{label:r("pages.settings.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:r("pages.settings.leave"),severity:"danger"},accept:()=>{ce()}})}async function ce(){I.value=!0;try{const{data:e}=await j.leaveClass();await p(),_.add({severity:"success",summary:e.message,life:2e3})}catch(e){_.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{I.value=!1}}return(e,n)=>{const ue=Le,W=Be,O=Se,M=ne,k=te,me=ie,P=Ce,T=Ve,q=ke,pe=$e,fe=oe;return o(),f(A,null,[s("div",Re,[l(a(je)),s("div",Ye,[a(b)?(o(),y(ue,{key:0,class:"flex justify-center"})):a(t)?(o(),f("div",He,[s("div",We,[s("div",Ze,d(e.$t("header.menu.settings")),1)]),s("div",Je,[s("div",Ke,[a(t).large_avatar_url?(o(),y(W,{key:0,class:"w-24 h-24 md:w-32 md:h-32 lg:w-40 lg:h-40",shape:"circle",image:a(t).large_avatar_url},null,8,["image"])):(o(),y(W,{key:1,label:a(u),class:"w-24 h-24 md:w-32 md:h-32 lg:w-40 lg:h-40 text-xl md:text-2xl lg:text-3xl",shape:"circle"},null,8,["label"])),s("div",Qe,[l(O,{severity:"secondary",class:"w-fit"},{default:c(()=>[B(d(a(t).email),1)]),_:1}),l(O,{severity:"info",class:"w-fit"},{default:c(()=>[B(d(a(t).user_type),1)]),_:1}),l(O,{severity:"danger",class:"w-fit"},{default:c(()=>[B(d(a(t).access_type),1)]),_:1})]),a(t).verified?(o(),y(M,{key:2,severity:"success",size:"small",class:"w-fit"},{default:c(()=>[B(d(e.$t("pages.settings.verified")),1)]),_:1})):(o(),y(me,{key:3,severity:"danger"},{default:c(()=>[l(k,{label:e.$t("pages.settings.verifyYourEmail"),onClick:n[0]||(n[0]=i=>V.value=!0),variant:"outlined",size:"small",severity:"warn"},null,8,["label"])]),_:1}))]),s("div",Xe,[s("div",es,[s("div",ss,d(e.$t("pages.settings.name")),1),l(P,{id:"name",modelValue:a(t).name,"onUpdate:modelValue":n[1]||(n[1]=i=>a(t).name=i),autocomplete:"off",variant:"filled",placeholder:e.$t("pages.settings.name"),size:"small",class:"w-full"},null,8,["modelValue","placeholder"])]),s("div",as,[s("div",ls,d(e.$t("pages.settings.school")),1),l(P,{id:"school",modelValue:a(t).school_name,"onUpdate:modelValue":n[2]||(n[2]=i=>a(t).school_name=i),autocomplete:"off",variant:"filled",class:"w-full",placeholder:e.$t("pages.settings.school"),size:"small",disabled:a(t).class_name!=null||a(t).user_type!="student"},null,8,["modelValue","placeholder","disabled"])]),a(t).user_type=="student"?(o(),f("div",ts,[s("div",os,d(e.$t("pages.settings.class")),1),a(t).class_name==null?(o(),f("div",ns,[l(k,{label:e.$t("pages.settings.joinClass"),icon:"pi pi-user-plus",size:"small",variant:"outlined",class:"w-full sm:w-auto",onClick:n[3]||(n[3]=i=>w.value=!0)},null,8,["label"])])):(o(),f("div",is,[l(P,{id:"class",modelValue:a(t).class_name,"onUpdate:modelValue":n[4]||(n[4]=i=>a(t).class_name=i),autocomplete:"off",variant:"filled",placeholder:e.$t("pages.settings.class"),size:"small",class:"w-full",disabled:""},null,8,["modelValue","placeholder"]),l(k,{label:e.$t("pages.settings.leaveClass"),icon:"pi pi-user-minus",size:"small",variant:"outlined",severity:"danger",class:"w-full",onClick:de,loading:I.value,disabled:I.value},null,8,["label","loading","disabled"])]))])):L("",!0),s("div",rs,[s("div",ds,d(e.$t("language")),1),l(a(Fe),{class:"w-full"})]),s("div",cs,[s("div",us,d(e.$t("pages.settings.changePassword")),1),l(pe,{initialValues:U.value,resolver:a(F),onSubmit:N,class:"flex flex-col gap-4"},{default:c(i=>{var Z,J,K;return[s("div",ms,[l(q,{variant:"on"},{default:c(()=>[l(T,{id:"old_password",name:"old_password",feedback:!1,toggleMask:"",fluid:"",class:"w-full"}),s("label",ps,d(e.$t("pages.settings.oldPassword")),1)]),_:1}),(Z=i.old_password)!=null&&Z.invalid?(o(),y(M,{key:0,severity:"error",size:"small",variant:"simple"},{default:c(()=>[s("ul",fs,[(o(!0),f(A,null,R(i.old_password.errors,(C,S)=>(o(),f("li",{key:S},d(C.message),1))),128))])]),_:2},1024)):L("",!0)]),s("div",gs,[l(q,{variant:"on"},{default:c(()=>[l(T,{id:"new_password",name:"new_password",feedback:!1,toggleMask:"",fluid:"",class:"w-full"}),s("label",vs,d(e.$t("pages.settings.newPassword")),1)]),_:1}),(J=i.new_password)!=null&&J.invalid?(o(),y(M,{key:0,severity:"error",size:"small",variant:"simple"},{default:c(()=>[s("ul",_s,[(o(!0),f(A,null,R(i.new_password.errors,(C,S)=>(o(),f("li",{key:S},d(C.message),1))),128))])]),_:2},1024)):L("",!0)]),s("div",ys,[l(q,{variant:"on"},{default:c(()=>[l(T,{id:"confirm_password",name:"confirm_password",feedback:!1,toggleMask:"",fluid:"",class:"w-full"}),s("label",ws,d(e.$t("pages.settings.confirmPassword")),1)]),_:1}),(K=i.confirm_password)!=null&&K.invalid?(o(),y(M,{key:0,severity:"error",size:"small",variant:"simple"},{default:c(()=>[s("ul",hs,[(o(!0),f(A,null,R(i.confirm_password.errors,(C,S)=>(o(),f("li",{key:S},d(C.message),1))),128))])]),_:2},1024)):L("",!0)]),l(k,{type:"submit",label:e.$t("pages.settings.savePassword"),class:"w-fit",size:"small",loading:m.value,disabled:m.value},null,8,["label","loading","disabled"])]}),_:1},8,["initialValues","resolver"])])])])])):(o(),f("div",Ge,"No user"))])]),l(qe,{modelValue:V.value,"onUpdate:modelValue":n[5]||(n[5]=i=>V.value=i)},null,8,["modelValue"]),l(fe,{visible:w.value,"onUpdate:visible":n[8]||(n[8]=i=>w.value=i),modal:"",header:a(r)("pages.settings.joinClassByCode"),closable:!1},{default:c(()=>[s("div",bs,[l(P,{type:"text",modelValue:$.value,"onUpdate:modelValue":n[6]||(n[6]=i=>$.value=i),placeholder:a(r)("pages.settings.enterCode"),class:"w-full"},null,8,["modelValue","placeholder"])]),s("div",xs,[l(k,{type:"button",label:a(r)("pages.settings.cancel"),severity:"secondary",onClick:n[7]||(n[7]=i=>w.value=!1)},null,8,["label"]),l(k,{type:"button",label:a(r)("pages.settings.join"),onClick:re,loading:z.value,disabled:z.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])],64)}}});export{qs as default};
