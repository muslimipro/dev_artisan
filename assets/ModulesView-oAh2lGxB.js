import{d as A,af as q,a as L,ag as T,r as w,o as e,f as c,w as V,e as u,j as x,c as o,h as g,b as P,t as O,ab as E,k as F,s as N,E as H,ah as U,u as z,m as G,L as J,P as K,F as M,i as C,M as Q}from"./index-OVkfNIy2.js";import{s as W}from"./index-DebEBu7V.js";import{_ as X}from"./AHeader.vue_vue_type_script_setup_true_lang-BcfZLbzx.js";import{a as Y}from"./logo-BijXTbgP.js";import{a as $,t as S}from"./types-KvMY7xVA.js";import{P as Z}from"./pibody-BwAjMvHk.js";import{u as ee}from"./editor-store-DiaPLyAa.js";import{u as te,m as oe}from"./useSortable-xhCQVoAy.js";import"./index-DtmyrzBh.js";import"./index-ChmN1Ybg.js";import"./LocaleSwitcher.vue_vue_type_script_setup_true_lang-CwS1Kfjb.js";import"./index-BxfnHzua.js";import"./index-DLzLFWqc.js";import"./index-d-7mnu5l.js";const se={class:"p-0 w-32 h-40 relative"},ae={key:0,class:"absolute top-0 right-0"},re={key:0,class:"bg-yellow-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},le={key:1,class:"bg-green-500 text-white text-sm px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},ne={key:1,class:"absolute bottom-8 left-0"},ie={key:0,class:"bg-green-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},de={key:1,class:"bg-purple-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},ue={key:2,class:"bg-blue-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},ce={key:3,class:"bg-red-500 text-white text-sm w-full px-2 py-[1px] rounded-bl-xl rounded-tr-xl"},me={class:"w-32 h-32 overflow-clip rounded-xl"},pe={class:"flex flex-col justify-between items-center px-4 py-1"},fe={class:"pb-1 font-medium text-lg text-center line-clamp-2"},xe={class:"flex"},j=A({__name:"ModuleCard",props:{module:{}},emits:["after-remove"],setup(D,{emit:b}){const k=F(),_=q(),R=L(),{user:m}=T(R),i=w(!1),s=D,B=b;function l(){_.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{h()}})}async function h(){i.value=!0;try{await $.deleteModuleByID(s.module.id),B("after-remove")}catch(d){console.log(d)}finally{i.value=!1}}function p(){k.push(`/module/${s.module.id}/edit`)}return(d,v)=>{const I=Y,t=N,a=H("RouterLink");return e(),c(a,{to:i.value?"":`/module/${s.module.id}`},{default:V(()=>{var n,f,y,r;return[u("div",se,[((n=x(m))==null?void 0:n.user_type)=="editor"?(e(),o("div",ae,[s.module.editing_status=="inreview"?(e(),o("div",re," In review")):(e(),o("div",le,"Published"))])):g("",!0),((f=x(m))==null?void 0:f.user_type)=="editor"?(e(),o("div",ne,[s.module.access_type=="freemium"?(e(),o("div",ie,"Free")):s.module.access_type=="premium"?(e(),o("div",de,"Premium")):s.module.access_type=="demo"?(e(),o("div",ue,"Demo")):s.module.access_type=="hackaton"?(e(),o("div",ce,"Hackaton ")):g("",!0)])):g("",!0),u("div",me,[P(I,{alt:"user header",src:s.module.cover_image.length>0?s.module.cover_image:x(Z),width:"128",height:"128",class:"animate-fadein animate-once animate-duration-1000 animate-ease-in-out"},null,8,["src"])]),u("div",pe,[u("div",fe,O(s.module.title),1),u("div",xe,[((y=x(m))==null?void 0:y.user_type)=="editor"?(e(),c(t,{key:0,icon:"pi pi-pen-to-square",severity:"info",variant:"text",rounded:"","aria-label":"Edit",onClick:E(p,["prevent"])})):g("",!0),((r=x(m))==null?void 0:r.user_type)=="editor"?(e(),c(t,{key:1,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"","aria-label":"Remove",onClick:E(l,["prevent"]),disabled:i.value,loading:i.value},null,8,["disabled","loading"])):g("",!0)])])])]}),_:1},8,["to"])}}}),_e={class:"flex flex-col min-h-screen bg-slate-50"},he={class:"border border-dashed rounded-xl border-green-400 overflow-hidden h-fit"},ve={key:1,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},Se=A({__name:"ModulesView",setup(D){const b=U("el"),k=z(),{locale:_}=G(),R=F(),m=ee(),{addLesson:i}=m,s=L(),{user:B}=T(s),l=w([]),h=w(0),p=w(!1),d=w(!1);te(b,l,{onUpdate:t=>{oe(l.value,t.oldIndex,t.newIndex,t),Q(async()=>{const a=[];l.value.map(n=>{const f=parseInt(n.id,10);a.push(f)});try{await $.changeModulesOrder(a),k.add({severity:"success",summary:"Modules order saved!",life:2e3})}catch(n){k.add({severity:"error",summary:"Order set error!",detail:n,life:2e3})}})}});async function v(){if(!p.value){p.value=!0;try{const{data:t}=await $.getModules();p.value=!1,l.value=[],h.value=t.length;for(const a of t){const n=await S(a,_.value);l.value.push(n)}}catch(t){console.log(t)}finally{p.value=!1}}}J(v),K(_,v);async function I(){d.value=!0;try{const{data:t}=await $.createModule(),a=await S(t,_.value);i(a),R.push(`/module/${a.id}/edit`)}catch(t){console.log(t)}finally{d.value=!1}}return(t,a)=>{var y;const n=W,f=N;return e(),o("div",_e,[P(X),((y=x(B))==null?void 0:y.user_type)=="editor"?(e(),o("div",{key:0,ref_key:"el",ref:b,class:"flex flex-wrap justify-center gap-8 px-12 py-6"},[(e(!0),o(M,null,C(l.value,r=>(e(),c(j,{key:r.id,module:r,onAfterRemove:v},null,8,["module"]))),128)),(e(!0),o(M,null,C(h.value-l.value.length,r=>(e(),c(n,{key:r,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128)),u("div",he,[P(f,{variant:"text",style:{width:"128px",height:"128px"},class:"bg-green-50",onClick:I,loading:d.value,disabled:d.value},{icon:V(()=>a[0]||(a[0]=[u("i",{class:"pi pi-plus text-xl"},null,-1)])),_:1},8,["loading","disabled"])])],512)):(e(),o("div",ve,[(e(!0),o(M,null,C(l.value,r=>(e(),c(j,{key:r.id,module:r,onAfterRemove:v},null,8,["module"]))),128)),(e(!0),o(M,null,C(h.value-l.value.length,r=>(e(),c(n,{key:r,width:"128px",height:"128px",class:"rounded-xl shadow-sm"}))),128))]))])}}});export{Se as default};
