import{s as pe}from"./index-DlwTIti7.js";import{a as V,L as de,M as ae,r as b,c as te,o as P,E,b as n,e as f,h as x,f as v,w as A,t as J,n as le,m as F,i as S,k as q,F as N,N as ve,g as w,q as G,d as he,u as we,O as be,H as xe,K as B,A as me,l as fe,B as $e,s as O,C as ke,P as se,D as oe,Q as Se}from"./index-DzQ9i4kW.js";import{L as Le,d as Ce}from"./defaultConfirmDeleteOptions-DzgDDzmy.js";import{h as M}from"./http-gL39vg9U.js";import{m as Ue}from"./mapLessonFromDto-Dmd7ExqT.js";import{U as ee}from"./unitApi-B-QCFx1h.js";import{s as Ve,a as Be,b as Ie,c as De}from"./index-DoDlgpbS.js";import{_ as ue,T as Te}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-CcZR8S8L.js";import{s as Fe}from"./index-BkxuQHe9.js";import{s as ze,a as Ae}from"./index-BbvRDE1_.js";import{s as Me}from"./index-BWgSSl_X.js";import{s as _e}from"./index-CIEjUuGN.js";import{_ as Re}from"./CodeEditor.vue_vue_type_script_setup_true_lang-D20WUPDG.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Ne}from"./index-DBogPJ2C.js";import{s as Pe,a as je}from"./index-BfxXY3g5.js";import{v as Oe}from"./v4-CmTdKEVZ.js";import{s as ye}from"./index-Bc45zl3-.js";import{u as Ge}from"./index-CFmR-pQ2.js";import{s as He}from"./index-Dt7q4_-N.js";import{T as qe}from"./index-D8R7IdZo.js";import{s as Je}from"./index-CPZfkr9u.js";import"./mapUnitFromDto-CYGc5n9V.js";import"./index-Dxh3r_YK.js";import"./index-D078HAKW.js";import"./index-DacIl3e2.js";import"./index-5RIsFZC6.js";import"./index-Du5Pt3UV.js";import"./index-DWDNaeJ1.js";import"./index-CVxKCs4d.js";const z={hideLesson:Ke,modifyLesson:Qe,publishLesson:We,sendLessonForReview:Ye,cancelLessonReview:Xe,startLessonReview:Ze,acceptLesson:et,rejectLesson:tt,editLesson:st};async function Ke(r){return await M.patch(`v2/lesson/${r}/hide`)}async function Qe(r){return await M.patch(`v2/lesson/${r}/modify`)}async function We(r){return await M.patch(`v2/lesson/${r}/publish`)}async function Ye(r){return await M.patch(`v2/lesson/${r}/review/send`)}async function Xe(r){return await M.patch(`v2/lesson/${r}/review/cancel`)}async function Ze(r){return await M.patch(`v2/lesson/${r}/review/start`)}async function et(r){return await M.patch(`v2/lesson/${r}/review/accept`)}async function tt(r){return await M.patch(`v2/lesson/${r}/review/reject`)}async function st(r){return await M.patch(`v2/lesson/${r}/review/edit`)}const ot=["article","options","open","video","code","pibody"],nt={class:"flex items-center"},lt={class:"flex items-center mr-2"},at=V({__name:"HighlightEditor",props:de({index:{},usedSlots:{}},{highlight:{default:[]},highlightModifiers:{}}),emits:de(["remove","save"],["update:highlight"]),setup(r,{emit:d}){const l=r,u=ae(r,"highlight"),o=b(null),t=b(null),e=b(!1),s=te(()=>o.value!=null&&t.value!=null),m=d,c=()=>{m("remove",l.index)};P(()=>{o.value=u.value.module,t.value=u.value.slot,e.value=u.value.autoPut}),E([o,t,e],()=>{o.value!=null&&m("save",l.index,o.value,t.value,e.value)}),E(s,g=>{g||(e.value=!1)});const k=b(["A","B","C","D","E","F"]),_=b(["8","9"]),L=b(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),y=te(()=>{if(o.value){if(o.value==="servo"||o.value==="led-tower"){const $=_.value.filter(D=>!(l.usedSlots??[]).includes(D));return t.value&&!$.includes(t.value)&&$.unshift(t.value),[null,...$]}const C=k.value.filter(i=>!(l.usedSlots??[]).includes(i));return t.value&&!C.includes(t.value)&&C.unshift(t.value),[null,...C]}const h=[...k.value,..._.value].filter(a=>!(l.usedSlots??[]).includes(a));return t.value&&!h.includes(t.value)&&h.unshift(t.value),[null,...h]}),p=te(()=>t.value?t.value==="8"||t.value==="9"?["servo","led-tower"]:L.value.filter(g=>g!=="servo"&&g!=="led-tower"):L.value);return(g,h)=>{const a=_e,C=Me,i=ze,$=Ae,D=F;return n(),f("div",nt,[x("div",lt,[v(a,{modelValue:e.value,"onUpdate:modelValue":h[0]||(h[0]=U=>e.value=U),binary:"","input-id":"autoput",disabled:!s.value},null,8,["modelValue","disabled"]),h[3]||(h[3]=x("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),v($,null,{default:A(()=>[v(C,{modelValue:o.value,"onUpdate:modelValue":h[1]||(h[1]=U=>o.value=U),options:p.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),v(i,{class:"h-[35px]"},{default:A(()=>h[4]||(h[4]=[x("div",null,"=>",-1)])),_:1}),v(C,{modelValue:t.value,"onUpdate:modelValue":h[2]||(h[2]=U=>t.value=U),options:y.value,placeholder:"Select slot",size:"small"},{option:A(({option:U})=>[x("span",{class:le(U===null?"text-gray-400":"")},J(U===null?"[null]":U),3)]),value:A(({value:U})=>[x("span",{class:le(U===null?"text-gray-400":"")},J(U===null?"[null]":U),3)]),_:1},8,["modelValue","options"])]),_:1}),v(D,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:c,class:"ml-2"})])}}}),it={class:"flex flex-col gap-2"},rt=V({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(r){const d=ae(r,"neededModules");function l(){d.value.push({autoPut:!1,module:null,slot:null})}function u(t){d.value.splice(t,1)}function o(t,e,s,m){d.value[t].module=e,d.value[t].slot=s,d.value[t].autoPut=m}return(t,e)=>{const s=F,m=Fe;return n(),S(m,{header:"Highlight slots & modules"},{default:A(()=>[x("div",it,[(n(!0),f(N,null,q(d.value,(c,k)=>(n(),f("div",{key:String(c==null?void 0:c.module)+String(c==null?void 0:c.slot)},[v(at,{highlight:d.value[k],"onUpdate:highlight":_=>d.value[k]=_,index:k,usedSlots:d.value.filter((_,L)=>{var y;return L!==k&&((y=d.value[L])==null?void 0:y.slot)!=null}).map(_=>_.slot),onRemove:u,onSave:o},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),v(s,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:l})]),_:1})}}}),dt={class:"flex"},ut={class:"h-[500px] flex flex-col w-full relative"},ct={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},pt={class:"absolute right-2 bottom-2"},ce=!1,vt=V({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content","show-tester"],setup(r,{emit:d}){const l=G(),u=r,o=d,t=b(""),e=b(""),s=b([]);let m=!0;ve(()=>{t.value=u.content.starting,e.value=u.content.answer,s.value=u.data.neededModules}),E([t,e,s],()=>{if(m){m=!1;return}o("save-content",{starting:t.value,answer:e.value},{neededModules:s.value.filter(k=>k.module!=null),tests:u.data.tests,includedCommandsForTests:u.data.includedCommandsForTests})},{deep:!0});function c(){o("show-tester",{lesson_id:l.params.id,unit_id:u.id.split("-")[1]})}return(k,_)=>{const L=F;return n(),f(N,null,[x("div",dt,[x("div",ut,[x("div",ct,[v(ue,{code:t.value,"onUpdate:code":_[0]||(_[0]=y=>t.value=y),runbuttons:!1,id:u.id+"_",class:"flex-1"},null,8,["code","id"]),v(ue,{code:e.value,"onUpdate:code":_[1]||(_[1]=y=>e.value=y),connectbuttons:ce,"onUpdate:connectbuttons":_[2]||(_[2]=y=>ce=y),id:u.id,class:"flex-1"},null,8,["code","id"])]),x("div",pt,[v(L,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:c})]),v(w(Te),{id:u.id,class:"flex-grow max-h-40"},null,8,["id"])])]),v(rt,{neededModules:s.value,"onUpdate:neededModules":_[3]||(_[3]=y=>s.value=y),class:"mb-2"},null,8,["neededModules"])],64)}}}),j=he("lesson-edit-store",()=>{const r=we(),d=b(null),l=b(!1),u=b(!1),o=b(!1),t=b(!1),e=b(!1),s=b(!1);function m(p){o.value=p}async function c(p){try{l.value=!0;const{data:g}=await Le.getLessonById(p);d.value=Ue(g)}catch(g){r.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{l.value=!1}}async function k(p,g){try{u.value=!0;const{data:h}=await ee.getUnitByIdandLessonId(p,g);return h}catch(h){r.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{u.value=!1}}async function _(p){try{t.value=!0;const{data:g}=await ee.createUnitByLessonId(d.value.id,p);r.add({severity:"success",summary:g.message,life:2e3})}catch(g){r.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{t.value=!1}}async function L(p,g,h){try{e.value=!0;const{data:a}=await ee.updateUnitByIdandLessonId(p,g,h);return a.unit_id}catch(a){r.add({severity:"error",summary:a.response.data.error,life:2e3})}finally{e.value=!1}}async function y(p,g){try{s.value=!0;const{data:h}=await ee.deleteUnitByIdandLessonId(p,g);r.add({severity:"success",summary:h.message,life:2e3})}catch(h){r.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{s.value=!1}}return{selectedLesson:d,isLessonLoading:l,isLessonSaving:o,isUnitLoading:u,isUnitCreating:t,isUnitUpdating:e,isUnitDeleting:s,setLessonSaving:m,loadLessonById:c,loadUnitByIdandLessonId:k,createUnit:_,updateUnitByIdandLessonId:L,deleteUnitByIdandLessonId:y}}),mt={class:"flex items-start"},ft=V({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r){const d=ae(r,"modelValue"),l=be({title:{title:"Title",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e="# <center>",s="</center>",c=t||"Title";return{text:`${e}${c}${s}`,selected:c}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(o){o.insert(()=>{const t='<span style="font-size: 20px">',e="</span>",s="⚠️";return{text:`${t}${s}${e}`,selected:s}})}},{name:"PiBody",text:"PiBody",action(o){o.insert(()=>{const t="<b>",e="</b>",s='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${t}${s}${e}`,selected:s}})}},{name:"Run",text:"Run",action(o){o.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e='<span style="">',s="</span>",c=t||"placeholder";return{text:`${e}${c}${s}`,selected:c}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(o){o.insert(t=>{const e='<span style="text-decoration: underline">',s="</span>",c=t||"placeholder";return{text:`${e}${c}${s}`,selected:c}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',s="</div>",c=t||"placeholder";return{text:`${e}${c}${s}`,selected:c}})}},note:{title:"Note",icon:"v-md-icon-tip",action(o){o.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',s="</div>",c=t||"placeholder";return{text:`${e}${c}${s}`,selected:c}})}}});async function u(o,t,e){const s=e[0];new FormData().append("file",s)}return(o,t)=>{const e=xe("v-md-editor");return n(),f("div",mt,[v(e,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),mode:"edit","left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:l,"disabled-menus":[],onUploadImage:u},null,8,["modelValue","toolbar"])])}}}),ge=Ee(ft,[["__scopeId","data-v-ef888c58"]]),_t=V({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(r,{emit:d}){const l=r,u=d,o=b("");let t=!0;return P(()=>{var e;o.value=((e=l.article)==null?void 0:e.text)??""}),E(o,()=>{if(t){t=!1;return}u("save-content",{text:o.value})},{flush:"post"}),(e,s)=>(n(),S(ge,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=m=>o.value=m)},null,8,["modelValue"]))}}),yt={class:"flex flex-col gap-2"},gt={class:"flex gap-1 text-gray-500"},ht={class:"flex flex-col gap-1"},wt=V({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(r,{emit:d}){const l=r,u=d,o=b(!1),t=b(!1),e=b(!1),s=b([]),m=b([]),c=b();let k=!0;P(()=>{var y,p,g,h,a,C;o.value=((y=l.optionsData)==null?void 0:y.shuffle)??!1,t.value=((p=l.optionsData)==null?void 0:p.feedback)??!1,e.value=((g=l.optionsData)==null?void 0:g.single)??!1,s.value=((h=l.optionsData)==null?void 0:h.options)??[],m.value=((a=l.optionsData)==null?void 0:a.answer)??[],c.value=l.optionsData&&l.optionsData.answer&&l.optionsData.answer.length>0?(C=l.optionsData)==null?void 0:C.answer[0]:void 0}),E([o,t,e,s,m,c],()=>{if(k){k=!1;return}u("save-content",{shuffle:o.value,feedback:t.value,single:e.value,options:s.value,answer:e.value?c.value?[c.value]:[]:m.value})},{deep:!0});function _(){s.value.push({id:Oe(),text:""})}function L(y){s.value=s.value.filter(p=>p.id!==y),m.value=m.value.filter(p=>p!==y),c.value==y&&(c.value=void 0)}return(y,p)=>{const g=Pe,h=Ne,a=_e,C=F;return n(),f("div",yt,[x("div",gt,[p[5]||(p[5]=x("div",null,"shuffle:",-1)),v(g,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=i=>o.value=i),class:"mr-2"},null,8,["modelValue"]),p[6]||(p[6]=x("div",null,"feedback:",-1)),v(g,{modelValue:t.value,"onUpdate:modelValue":p[1]||(p[1]=i=>t.value=i),class:"mr-2"},null,8,["modelValue"]),p[7]||(p[7]=x("div",null,"single:",-1)),v(g,{modelValue:e.value,"onUpdate:modelValue":p[2]||(p[2]=i=>e.value=i)},null,8,["modelValue"])]),x("div",ht,[(n(!0),f(N,null,q(s.value,i=>(n(),f("div",{key:i.id,class:"flex gap-2 items-center"},[e.value?(n(),S(h,{key:0,modelValue:c.value,"onUpdate:modelValue":p[3]||(p[3]=$=>c.value=$),value:i.id},null,8,["modelValue","value"])):(n(),S(a,{key:1,modelValue:m.value,"onUpdate:modelValue":p[4]||(p[4]=$=>m.value=$),value:i.id},null,8,["modelValue","value"])),v(ge,{modelValue:i.text,"onUpdate:modelValue":$=>i.text=$,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),v(C,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:$=>L(i.id)},null,8,["onClick"])]))),128))]),v(C,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:_,class:"self-center"})])}}}),bt=V({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(r,{emit:d}){const l=r,u=d,o=b("");let t=!0;return P(()=>{var e;o.value=((e=l.open)==null?void 0:e.answer)??""}),E(o,()=>{if(t){t=!1;return}u("save-content",{answer:o.value})}),(e,s)=>{const m=ye;return n(),S(m,{type:"text",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=c=>o.value=c),class:"w-full",size:"small"},null,8,["modelValue"])}}}),xt=V({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(r,{emit:d}){const l=r,u=d,o=b("");let t=!0;return P(()=>{var e;o.value=((e=l.video)==null?void 0:e.url)??""}),E(o,()=>{if(t){t=!1;return}u("save-content",{url:o.value})}),(e,s)=>{const m=ye;return n(),S(m,{type:"text",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=c=>o.value=c),class:"w-full",size:"small"},null,8,["modelValue"])}}}),$t={class:"bg-white rounded-lg border border-gray-200"},kt={key:1,class:"flex flex-col h-full w-full"},St={class:"flex items-center gap-2 px-4 pt-2"},Lt={class:"text-sm"},Ct={class:"text-sm text-gray-500"},Ut={key:1,class:"flex-grow px-4 py-2"},Vt={class:"flex justify-end"},Bt=V({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(r,{emit:d}){const l=r,u=d,o=G(),t=fe(),e=j(),{updateUnitByIdandLessonId:s,setLessonSaving:m,loadUnitByIdandLessonId:c}=e,k=b(!1),_=b(null),L=b(null);ve(async()=>{k.value=!0;const a=await c(l.unit.id,Number(o.params.id));a&&(_.value=a.content,L.value=a.data),k.value=!1});function y(a,C){m(!0),g(a,C)}function p(a){t.push({name:"tester2",params:{lesson_id:a.lesson_id,unit_id:a.unit_id}})}const g=Ge((a,C)=>{h(a,C)},1e3,{maxWait:5e3});async function h(a,C){const i=await s(l.unit.id,Number(o.params.id),{content:a,data:C});i&&u("update",l.unit,i),m(!1)}return(a,C)=>{const i=pe,$=F;return n(),f("div",$t,[a.loading?(n(),S(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),f("div",kt,[x("div",St,[x("div",Lt,J(a.unit.id),1),x("div",Ct,J(`${a.unit.unitType}`),1)]),k.value?(n(),S(i,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),f("div",Ut,[a.unit.unitType=="article"?(n(),S(_t,{key:0,article:_.value,onSaveContent:y},null,8,["article"])):a.unit.unitType=="options"?(n(),S(wt,{key:1,"options-data":_.value,onSaveContent:y},null,8,["options-data"])):a.unit.unitType=="open"?(n(),S(bt,{key:2,open:_.value,onSaveContent:y},null,8,["open"])):a.unit.unitType=="video"?(n(),S(xt,{key:3,video:_.value,onSaveContent:y},null,8,["video"])):l.unit.unitType=="code"?(n(),S(w(Re),{key:4,id:`code-${l.unit.id}`,code:_.value,onSaveContent:y,onShowTester:p},null,8,["id","code"])):l.unit.unitType=="pibody"?(n(),S(w(vt),{key:5,id:`code-${l.unit.id}`,content:_.value,data:L.value,onSaveContent:y,onShowTester:p},null,8,["id","content","data"])):B("",!0)])),x("div",Vt,[v($,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:C[0]||(C[0]=me(D=>u("delete",l.unit),["stop"]))})])]))])}}}),It={class:"group w-full relative"},Dt={class:"flex"},ne=V({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(r,{emit:d}){const l=r,u=d,o=G(),t=j(),{loadLessonById:e,createUnit:s}=t,m=b(),c=b(ot.map(_=>({label:_,command:async()=>{await s({unit_type:_,prev_unit_id:l.unitId??void 0}),await e(Number(o.params.id))}}))),k=_=>{m.value.toggle(_)};return(_,L)=>{const y=He,p=F,g=je;return n(),f(N,null,[x("div",It,[L[1]||(L[1]=x("div",{class:"h-3"},null,-1)),x("div",{class:le(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",_.hided?"hidden":""])},[x("div",Dt,[v(y,{class:"w-7",type:"dashed"}),v(y,{class:"flex-grow",type:"dashed"}),v(p,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:k}),v(y,{class:"flex-grow",type:"dashed"}),_.showAddGroup?(n(),S(p,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:L[0]||(L[0]=h=>u("add-group-divider"))})):(n(),S(y,{key:1,class:"w-7",type:"dashed"}))])],2)]),v(g,{ref_key:"menu",ref:m,model:c.value,popup:!0},null,8,["model"])],64)}}}),Tt=V({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(r,{emit:d}){const l=d;return(u,o)=>{const t=F;return n(),S(t,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:o[0]||(o[0]=me(e=>l("remove-group-divider"),["stop"]))})}}}),Ft={class:"flex flex-col gap-2"},zt={class:"w-full flex justify-between gap-2 mr-4"},At={class:"flex flex-col p-2 rounded-lg bg-slate-50"},Mt=V({__name:"UnitsView",props:{pages:{}},setup(r){const d=r,l=G(),u=$e(),o=j(),{isUnitDeleting:t}=O(o),{loadLessonById:e,createUnit:s,deleteUnitByIdandLessonId:m}=o,c=b(null);async function k(i){await s({unit_type:"group-divider",prev_unit_id:i.id}),await e(Number(l.params.id))}async function _(){await s({unit_type:"page-divider"}),await e(Number(l.params.id))}async function L(i){await m(i,Number(l.params.id)),await e(Number(l.params.id))}function y(i){c.value=i,u.require({...Ce,message:"Are you sure you want to delete this lesson?",accept:async()=>{await m(i.id,Number(l.params.id)),await e(Number(l.params.id))}})}function p(i,$){$>i.id&&(i.id=$)}const g=Number(l.params.id),h=`openedPanels-${g}`,a=b({});P(async()=>{const i=localStorage.getItem(h);i&&(a.value=JSON.parse(i)),await ke(),setTimeout(()=>{const $=localStorage.getItem(`lastOpenedGroup-${g}`);if($){const D=document.getElementById(`group-${$}`);if(D){D.scrollIntoView({behavior:"smooth"});return}}},1e3)}),E(a,i=>{localStorage.setItem(h,JSON.stringify(i))},{deep:!0});function C(i,$){a.value[$]=i,a.value[$].length>0&&localStorage.setItem(`lastOpenedGroup-${g}`,i[i.length-1])}return(i,$)=>{const D=Ve,U=Be,K=Ie,Q=De,W=F;return n(),f("div",Ft,[(n(!0),f(N,null,q(d.pages,R=>(n(),S(Q,{value:a.value[R.id]||[],"onUpdate:value":I=>C(I,R.id),multiple:"",key:R.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:A(()=>[(n(!0),f(N,null,q(R.groups,(I,Y)=>(n(),S(K,{key:I.id,value:I.id,id:`group-${I.id}`},{default:A(()=>[v(D,null,{default:A(()=>[x("div",zt,[x("div",null,"Step: "+J(Y),1),I.id!=-1?(n(),S(Tt,{key:0,onRemoveGroupDivider:T=>L(I.id)},null,8,["onRemoveGroupDivider"])):B("",!0)])]),_:2},1024),v(U,{class:"flex flex-col"},{default:A(()=>[x("div",At,[(n(!0),f(N,null,q(I.units,(T,X)=>{var H;return n(),f("div",{key:T.id},[X==0?(n(),S(ne,{key:0,hided:!0,"unit-id":I.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0),v(Bt,{unit:T,loading:((H=c.value)==null?void 0:H.id)===T.id&&w(t),onDelete:Z=>y(T),onUpdate:p},null,8,["unit","loading","onDelete"]),v(ne,{hided:!0,"unit-id":T.id,"show-add-group":!0,onAddGroupDivider:Z=>k(T)},null,8,["unit-id","onAddGroupDivider"])])}),128)),I.units.length==0?(n(),S(ne,{key:0,hided:!1,"unit-id":I.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),v(W,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:$[0]||($[0]=R=>_())})])}}}),Rt={class:"w-[24px] h-[24px]"},Et={key:0,class:"flex items-center"},Nt={key:0,class:"material-icons text-gray-500"},Pt={key:1,class:"material-icons text-gray-500"},jt={key:1},Ot={class:"material-icons text-gray-500"},Gt=V({__name:"AutoSaveCloud",setup(r){const d=j(),{selectedLesson:l,isLessonSaving:u}=O(d);return(o,t)=>{var s;const e=qe;return n(),f("div",Rt,[(s=w(l))!=null&&s.editable?(n(),f("div",Et,[w(u)?se((n(),f("span",Pt,t[1]||(t[1]=[oe("cloud_sync")]))),[[e,"Saving...",void 0,{bottom:!0}]]):se((n(),f("span",Nt,t[0]||(t[0]=[oe("cloud_done")]))),[[e,"Saved",void 0,{bottom:!0}]])])):(n(),f("div",jt,[se((n(),f("span",Ot,t[2]||(t[2]=[oe("cloud_off")]))),[[e,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Ht={key:0},qt={key:0},Jt={key:1},Kt={key:0},Qt={key:1},Wt={key:2},Yt={key:0,class:"flex gap-1"},Xt={key:3},Zt={key:0},es={key:4},ts={key:0,class:"flex gap-1"},ss={key:5},os={key:0,class:"flex gap-1"},ns={key:6},ls={key:0,class:"flex gap-1"},as=V({__name:"StageButtons",setup(r){const d=G(),l=Se(),{user:u}=O(l),o=j(),{selectedLesson:t}=O(o),e=b(!1),s=b(!1);async function m(){e.value=!0;try{await z.sendLessonForReview(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{e.value=!1}}async function c(){e.value=!0;try{await z.cancelLessonReview(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{e.value=!1}}async function k(){e.value=!0;try{await z.startLessonReview(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{e.value=!1}}async function _(){e.value=!0;try{await z.acceptLesson(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{e.value=!1}}async function L(){s.value=!0;try{await z.rejectLesson(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{s.value=!1}}async function y(){e.value=!0;try{await z.editLesson(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{e.value=!1}}async function p(){e.value=!0;try{await z.publishLesson(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{e.value=!1}}async function g(){s.value=!0;try{await z.hideLesson(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{s.value=!1}}async function h(){e.value=!0;try{await z.modifyLesson(d.params.id.toString()),window.location.reload()}catch(a){console.log(a)}finally{e.value=!1}}return(a,C)=>{var $,D,U,K,Q,W,R,I,Y,T,X,H,Z,ie,re;const i=F;return(($=w(t))==null?void 0:$.stage)=="prepare_for_submission"?(n(),f("div",Ht,[((D=w(u))==null?void 0:D.user_type)=="contributor"?(n(),f("div",qt,[v(i,{label:"Send for review",severity:"info",size:"small",onClick:m,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((U=w(t))==null?void 0:U.stage)=="waiting_for_review"?(n(),f("div",Jt,[((K=w(u))==null?void 0:K.user_type)=="contributor"?(n(),f("div",Kt,[v(i,{label:"Cancel submission",severity:"danger",size:"small",onClick:c,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):((Q=w(u))==null?void 0:Q.user_type)=="editor"?(n(),f("div",Qt,[v(i,{label:"Start review",severity:"info",size:"small",onClick:k,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((W=w(t))==null?void 0:W.stage)=="in_review"?(n(),f("div",Wt,[((R=w(u))==null?void 0:R.user_type)=="editor"?(n(),f("div",Yt,[v(i,{label:"Reject",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Accept",size:"small",onClick:_,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((I=w(t))==null?void 0:I.stage)=="rejected"?(n(),f("div",Xt,[((Y=w(u))==null?void 0:Y.user_type)=="contributor"?(n(),f("div",Zt,[v(i,{label:"Edit submission",severity:"info",size:"small",onClick:y,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((T=w(t))==null?void 0:T.stage)=="ready_for_publish"?(n(),f("div",es,[((X=w(u))==null?void 0:X.user_type)=="editor"?(n(),f("div",ts,[w(t).createdBy!=Number(w(u).user_id)?(n(),S(i,{key:0,label:"Reject",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"])):B("",!0),v(i,{label:"Publish",size:"small",onClick:p,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((H=w(t))==null?void 0:H.stage)=="published"?(n(),f("div",ss,[((Z=w(u))==null?void 0:Z.user_type)=="editor"?(n(),f("div",os,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:g,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Modify",size:"small",onClick:h,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((ie=w(t))==null?void 0:ie.stage)=="in_modify"?(n(),f("div",ns,[((re=w(u))==null?void 0:re.user_type)=="editor"?(n(),f("div",ls,[v(i,{label:"Hide",severity:"danger",size:"small",onClick:g,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),v(i,{label:"Publish",size:"small",onClick:p,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):B("",!0)}}}),is={key:0},rs=V({__name:"StageStatus",setup(r){const d=j(),{selectedLesson:l}=O(d);return(u,o)=>{const t=Je;return w(l)?(n(),f("div",is,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes(w(l).stage)?(n(),S(t,{key:0,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes(w(l).stage)?(n(),S(t,{key:1,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes(w(l).stage)?(n(),S(t,{key:2,label:w(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):B("",!0)])):B("",!0)}}}),ds={class:"flex flex-col items-center"},us={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},cs={class:"flex items-center gap-4"},ps={class:"flex items-center gap-4"},vs={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},ms={key:1,class:"flex justify-center"},fs={key:2},qs=V({__name:"LessonEditPage",setup(r){const d=G(),l=fe(),u=j(),{isLessonLoading:o,selectedLesson:t}=O(u),{loadLessonById:e}=u;return P(()=>e(Number(d.params.id))),(s,m)=>{const c=F,k=pe;return n(),f("div",ds,[x("div",us,[x("div",cs,[v(c,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:m[0]||(m[0]=_=>w(l).go(-1))}),v(rs)]),x("div",ps,[v(Gt),v(as)])]),x("div",vs,[w(o)?(n(),S(k,{key:0,class:"flex justify-center"})):w(t)?(n(),f("div",fs,[v(Mt,{pages:w(t).pages},null,8,["pages"])])):(n(),f("div",ms,"No lesson found"))])])}}});export{qs as default};
