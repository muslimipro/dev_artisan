import{s as Q,a as W}from"./index-BJXW17cL.js";import{s as Z}from"./index-C2AgmY6i.js";import{s as ee,a as le}from"./index-CBvRvFRr.js";import{s as z}from"./index-DoQeMzHI.js";import{e as A,P as M,u as P,r as d,o as $,i as I,w as a,k as l,a as m,h as T,U as se,l as B,R as L,a4 as O,B as Y,s as oe,c as F,t as C,G as S,j as q,F as te,b2 as ae}from"./index-RQaPKU3q.js";import{u as D,A as j}from"./useAdminStore-Bh_LlNl3.js";import{s as h}from"./index-DP6Jkdyj.js";import{A as ie}from"./accessType-pqVUocEs.js";import"./index-CJfAG3aM.js";import"./index-5bVhi2nm.js";import"./index-Cvpkor55.js";import"./index-CdWRCESg.js";import"./index-BctX0Pow.js";import"./index-vGkf9gTg.js";import"./index-DZ_1xp5G.js";import"./index-6V6lXQ4K.js";import"./index-CY8HVpGr.js";import"./index-3r_oBTLo.js";import"./index-Rzgfwlcn.js";const G=["student","teacher","school_manager","editor","contributor","supervisor","admin-viewer"],ne={class:"flex flex-col"},re={class:"flex flex-col"},de={class:"flex flex-col"},ue={class:"flex flex-col"},pe=A({__name:"CreateUserDialog",props:{modelValue:{type:Boolean,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(x){const p=M(x,"modelValue"),v=P(),V=D(),{loadUsers:g}=V,y=d("freemium"),n=d(""),c=d(""),f=d("student"),r=d(!1);async function i(){r.value=!0;try{const{data:o}=await se.createUser({access_type:y.value,email:n.value,password:c.value,user_type:f.value});v.add({severity:"success",summary:o.message,life:2e3}),await g(),p.value=!1}catch(o){v.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}finally{r.value=!1}}return(o,s)=>{const w=h,b=z,U=B,N=L;return $(),I(N,{visible:p.value,"onUpdate:visible":s[5]||(s[5]=u=>p.value=u),modal:"",draggable:!1,class:"m-4 max-w-xl",header:"Create new user"},{footer:a(()=>[l(U,{label:o.$t("close"),severity:"secondary",onClick:s[4]||(s[4]=u=>p.value=!1)},null,8,["label"]),l(U,{label:o.$t("pages.teacher.create"),onClick:i,disabled:r.value,loading:r.value},null,8,["label","disabled","loading"])]),default:a(()=>[m("div",ne,[s[6]||(s[6]=m("div",{class:"font-bold text-sm mb-1"},"User type",-1)),l(w,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=u=>f.value=u),options:T(G),class:"w-full",placeholder:"Select user type"},null,8,["modelValue","options"])]),m("div",re,[s[7]||(s[7]=m("div",{class:"font-bold text-sm mb-1"},"Email",-1)),l(b,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=u=>n.value=u),class:"w-full"},null,8,["modelValue"])]),m("div",de,[s[8]||(s[8]=m("div",{class:"font-bold text-sm mb-1"},"Password",-1)),l(b,{type:"text",modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=u=>c.value=u),class:"w-full"},null,8,["modelValue"])]),m("div",ue,[s[9]||(s[9]=m("div",{class:"font-bold text-sm mb-1"},"Access type",-1)),l(w,{modelValue:y.value,"onUpdate:modelValue":s[3]||(s[3]=u=>y.value=u),options:T(ie),class:"w-full",placeholder:"Select access type"},null,8,["modelValue","options"])])]),_:1},8,["visible"])}}}),me=A({__name:"UpdateUserTypeDialog",props:O({userId:{},userType:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const p=M(x,"modelValue"),v=x,V=P(),g=D(),{loadUsers:y}=g,n=d(null);Y(()=>v.userType,r=>{n.value=r},{immediate:!0});const c=d(!1);async function f(){if(!(v.userId==null||n.value==null)){c.value=!0;try{const{data:r}=await j.updateUserRole(Number(v.userId),n.value);V.add({severity:"success",summary:r.message,life:2e3}),y(),p.value=!1}catch(r){V.add({severity:"error",summary:r.response.data.error,detail:r,life:2e3})}finally{c.value=!1}}}return(r,i)=>{const o=h,s=B,w=L;return $(),I(w,{visible:p.value,"onUpdate:visible":i[2]||(i[2]=b=>p.value=b),modal:"",draggable:!1,class:"m-4 max-w-md",header:"Change user type"},{footer:a(()=>[l(s,{label:r.$t("close"),severity:"secondary",onClick:i[1]||(i[1]=b=>p.value=!1)},null,8,["label"]),l(s,{label:r.$t("save"),onClick:f,disabled:c.value,loading:c.value},null,8,["label","disabled","loading"])]),default:a(()=>[l(o,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=b=>n.value=b),options:T(G),class:"w-full",placeholder:"Select user type"},null,8,["modelValue","options"])]),_:1},8,["visible"])}}}),ce=A({__name:"UpdateVerificationDialog",props:O({userId:{},verification:{type:[Boolean,null]}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const p=M(x,"modelValue"),v=x,V=P(),g=D(),{loadUsers:y}=g,n=d(null),c=d(["verified","unverified"]);Y(()=>v.verification,i=>{n.value=i?"verified":"unverified"},{immediate:!0});const f=d(!1);async function r(){if(!(v.userId==null||n.value==null)){f.value=!0;try{const{data:i}=await j.verifyUser(n.value=="verified",Number(v.userId));V.add({severity:"success",summary:i.message,life:2e3}),y(),p.value=!1}catch(i){V.add({severity:"error",summary:i.response.data.error,detail:i,life:2e3})}finally{f.value=!1}}}return(i,o)=>{const s=h,w=B,b=L;return $(),I(b,{visible:p.value,"onUpdate:visible":o[2]||(o[2]=U=>p.value=U),modal:"",draggable:!1,class:"m-4 max-w-md",header:"Change verification"},{footer:a(()=>[l(w,{label:i.$t("close"),severity:"secondary",onClick:o[1]||(o[1]=U=>p.value=!1)},null,8,["label"]),l(w,{label:i.$t("save"),onClick:r,disabled:f.value,loading:f.value},null,8,["label","disabled","loading"])]),default:a(()=>[l(s,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=U=>n.value=U),options:c.value,class:"w-full",placeholder:"Select verification"},null,8,["modelValue","options"])]),_:1},8,["visible"])}}}),ve={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},fe={class:"flex items-center"},ye={class:"flex-grow text-2xl"},be={class:"w-44 overflow-scroll"},_e={class:"w-44"},Ve={class:"flex"},ge={class:"flex"},we={key:0,class:"w-40"},Ue={key:1,class:"w-40"},ze=A({__name:"UsersView",setup(x){const p=D(),{users:v,isLoading:V}=oe(p),g=d(!1),y=d(!1),n=d(!1),c=d(null),f=d(null),r=d(null),i=d(),o=d();(()=>{o.value={global:{value:null,matchMode:ae.CONTAINS}}})();const w=u=>{console.log(u)},b=()=>{i.value.exportCSV()},U=(u,t)=>{y.value=!0,c.value=u,f.value=t},N=(u,t)=>{n.value=!0,c.value=u,r.value=t};return(u,t)=>{const k=B,K=ee,X=z,H=le,_=Q,E=Z,J=W;return $(),F(te,null,[m("div",ve,[l(J,{ref_key:"dt",ref:i,filters:o.value,"onUpdate:filters":t[2]||(t[2]=e=>o.value=e),value:T(v),dataKey:"id",loading:T(V),scrollable:"",globalFilterFields:["email","id","name","user_type","access_type"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:a(()=>[m("div",fe,[m("div",ye,"Users - "+C(T(v).length),1),l(k,{label:"Create user",icon:"pi pi-plus",variant:"outlined",class:"mr-2",onClick:t[0]||(t[0]=e=>g.value=!0)}),l(k,{label:"Export",icon:"pi pi-upload",severity:"info",variant:"outlined",class:"mr-2",onClick:b}),l(H,null,{default:a(()=>[l(K,null,{default:a(()=>t[6]||(t[6]=[m("i",{class:"pi pi-search"},null,-1)])),_:1}),l(X,{modelValue:o.value.global.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value.global.value=e),placeholder:"Search"},null,8,["modelValue"])]),_:1})])]),empty:a(()=>t[7]||(t[7]=[S(" No users found. ")])),loading:a(()=>t[8]||(t[8]=[S(" Loading users data. Please wait. ")])),default:a(()=>[l(_,{field:"email",header:"Email",frozen:"",sortable:""},{body:a(({data:e})=>[m("div",be,C(e.email),1)]),_:1}),l(_,{field:"id",header:"ID",sortable:""},{body:a(({data:e})=>[S(C(e.id),1)]),_:1}),l(_,{field:"created_time",header:"Created time",sortable:""},{body:a(({data:e})=>[m("div",_e,C(e.created_time.split("T")[0]+" "+e.created_time.split(".")[0].split("T")[1]),1)]),_:1}),l(_,{field:"name",header:"Name",sortable:""},{body:a(({data:e})=>[S(C(`${e.name} ${e.surname}`),1)]),_:1}),l(_,{field:"user_type",header:"Type",sortable:""},{body:a(({data:e})=>[m("div",Ve,[l(E,{value:e.user_type,severity:"secondary"},null,8,["value"]),e.user_type!="super_admin"?($(),I(k,{key:0,icon:"pi pi-pencil",variant:"link",size:"small",onClick:R=>U(e.id,e.user_type)},null,8,["onClick"])):q("",!0)])]),_:1}),l(_,{field:"access_type",header:"Access",sortable:""},{body:a(({data:e})=>[l(E,{value:e.access_type,severity:e.access_type=="premium"?"success":"info"},null,8,["value","severity"])]),_:1}),l(_,{field:"verified",header:"Verified",sortable:""},{body:a(({data:e})=>[m("div",ge,[l(E,{value:e.verified?"verified":"unverified",severity:e.verified?"success":"warn"},null,8,["value","severity"]),e.user_type!="super_admin"?($(),I(k,{key:0,icon:"pi pi-pencil",variant:"link",size:"small",onClick:R=>N(e.id,e.verified)},null,8,["onClick"])):q("",!0)])]),_:1}),l(_,{field:"xp",header:"XP",sortable:""},{body:a(({data:e})=>[S(C(e.xp),1)]),_:1}),l(_,{field:"subscription_end",header:"Expire date",sortable:""},{body:a(({data:e})=>[e.subscription_end?($(),F("div",we,C(e.subscription_end.split("T")[0]+" : "+e.subscription_end.split(".")[0].split("T")[1]),1)):($(),F("div",Ue,"-"))]),_:1}),l(_,{exportable:!1},{body:a(e=>[l(k,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:R=>w(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"])]),l(pe,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=e=>g.value=e)},null,8,["modelValue"]),l(me,{modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=e=>y.value=e),userId:c.value,userType:f.value},null,8,["modelValue","userId","userType"]),l(ce,{modelValue:n.value,"onUpdate:modelValue":t[5]||(t[5]=e=>n.value=e),userId:c.value,verification:r.value},null,8,["modelValue","userId","verification"])],64)}}});export{ze as default};
