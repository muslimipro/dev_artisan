import{s as Le,a as Ne}from"./index-D33CMzHx.js";import{d as Pe,r as g,e as K,o,c as n,h as e,a,t as s,v as u,b as ve,F as G,G as D,j as N,q as ee,i as O,w as $,y as Z,k as b,l as Ie,u as De,a6 as Oe,s as ge,C as Ge,B as be,L as Ae,K as je}from"./index-RQaPKU3q.js";import{_ as ze}from"./MainHeader.vue_vue_type_script_setup_true_lang-BuW7JKj1.js";import"./index-zUgF_fUw.js";import{_ as We}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-BwKFd-5u.js";import{l as Xe,O as T,v as oe,T as He,I as m,b as H,f as Ke,d as Je,g as Te,h as ye,i as he,u as Qe,a as Ye,e as ne,j as Ze,k as et,m as V,n as tt,o as st,p as ke,R as de,r as we}from"./IdeButtons.vue_vue_type_script_setup_true_lang-BoC8OHM6.js";import{o as W,v as qe,c as X,M as ie,m as $e,P as ue,p as pe,d as ce,i as q,a as at,u as lt,b as ot}from"./store-qJ2iV4r-.js";import"./CodeEditorView.vue_vue_type_script_setup_true_lang-C1HaOUBK.js";import{s as xe}from"./index-DpYX8S_8.js";import{s as nt}from"./index-CgidCdRP.js";import{s as dt}from"./index-DoQeMzHI.js";import{s as ct}from"./index-CqyLZxbP.js";import{U as Ce}from"./unitApi-Y58tYEHm.js";import{m as rt}from"./mapUnitFromDto-DRcH-Z8v.js";import{C as re}from"./cloudStorageApi-DND7mGDQ.js";import"./UserMenu.vue_vue_type_script_setup_true_lang-3l-gndQ6.js";import"./index-i87uic1r.js";import"./index-5bJt7VTk.js";import"./logo-D1-3uCnC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PremiumForm.vue_vue_type_script_setup_true_lang-DOQWPUhj.js";import"./index-CmgTJnJ7.js";import"./index-BQlFFWCz.js";import"./index-DZ_1xp5G.js";import"./index-DYe12pIs.js";import"./index-ZflZKAdM.js";import"./LocaleSelectButton.vue_vue_type_script_setup_true_lang-D5A7GxOk.js";import"./index-csPL02fk.js";import"./language-DYQF8nnT.js";import"./index-C1N2nWcC.js";import"./SimulationView-BfUuedT5.js";import"./index-DnxWnOWO.js";import"./index-BQKo0YUX.js";import"./index-CH_iu5NA.js";import"./index-CY8HVpGr.js";import"./index-Rzgfwlcn.js";import"./index-BctX0Pow.js";import"./index-6V6lXQ4K.js";import"./index-C7IwSJ15.js";import"./index-CBvRvFRr.js";import"./index-CdWRCESg.js";const it=Pe("useMPDeviceStore",()=>{const t=g(localStorage.getItem("fileContent")||""),d=g(""),r=g(""),p=g(!1),l=g([]);async function y(x,h){l.value=[x],r.value=x,t.value=h}async function C(x){l.value=[x],r.value=x,t.value=await Xe(x)}function P(x){t.value=x}return{isProject:p,activeFiles:l,fileContent:t,fileName:d,filePath:r,openFile:y,loadFile:C,setCode:P}}),ut={key:0,class:"text-nowrap"},mt={key:0,class:"text-white"},vt={key:1,class:"text-white"},xt={key:2,class:"text-white"},ft={key:3,class:"text-white"},gt={key:4,class:"text-white"},bt={key:5,class:"text-black w-full"},yt={class:"text-center font-mono px-1 text-white bg-black"},ht={key:6,class:"text-black w-full"},kt={class:"text-center font-mono px-1 text-white bg-black"},wt={key:7,class:"text-black w-full p-3"},qt={key:8,class:"text-white"},$t={key:9,class:"text-black w-full"},pt={class:"text-center font-mono px-1 text-white bg-black"},Ct={key:10,class:"text-white w-full"},_t={key:11,class:"text-white w-full"},Mt={key:12,class:"text-white w-full"},Pt={key:13,class:"text-white w-full"},It={key:14,class:"text-black w-full"},Tt={class:"text-center font-mono px-1 text-white bg-black"},Rt={key:15,class:"text-black w-full"},Et={class:"text-center px-1"},St={class:"text-center font-mono px-1 text-white bg-black"},Ut={key:16,class:"text-black w-full"},Ft={class:"text-center px-1"},Bt={class:"text-center font-mono px-1 text-white bg-black"},Vt={key:17,class:"text-black w-full"},Lt={class:"text-center px-1"},Nt={class:"text-center font-mono px-1 text-white bg-black"},Dt={key:18,class:"text-black w-full"},Ot={class:"text-center font-mono px-1 text-white bg-black"},Gt={key:19,class:"text-black w-full"},At={class:"text-center px-1"},jt={class:"text-center font-mono px-1 text-white bg-black"},zt={key:20,class:"text-black w-full"},Wt={class:"text-center px-1"},Xt={class:"text-center font-mono px-1 text-white bg-black"},Ht={key:21,class:"text-black w-full"},Kt={class:"text-center px-1"},Jt={class:"text-center font-mono px-1 text-white bg-black"},Qt={key:22,class:"text-black w-full"},Yt={class:"text-center font-mono px-1 text-white bg-black"},Zt={key:23,class:"text-black w-full"},es={class:"text-center px-1"},ts={class:"text-center font-mono px-1 text-white bg-black"},ss={key:24,class:"text-black w-full"},as={class:"text-center font-mono px-1 text-white bg-black"},ls={key:25,class:"text-black w-full"},os={class:"text-center px-1"},ns={class:"text-center font-mono px-1 text-white bg-black"},ds={key:26,class:"text-black w-full"},cs={class:"text-center font-mono px-1 text-white bg-black"},rs={key:27,class:"text-black w-full"},is={class:"text-center px-1"},us={class:"text-center font-mono px-1 text-white bg-black"},ms={key:28,class:"text-black w-full"},vs={class:"text-center px-1"},xs={class:"text-center font-mono px-1 text-white bg-black"},fs={key:29,class:"text-black w-full"},gs={class:"text-center font-mono px-1 text-white bg-black"},bs={key:30,class:"text-black w-full"},ys={key:1,class:"text-center p-3"},me=K({__name:"FeedbackNode",props:{message:{type:Object,required:!0},isExpected:{type:Boolean,required:!0}},setup(t){return(d,r)=>t.message?(o(),n("div",ut,[t.message.command===e(T).PinSetValue?(o(),n("div",mt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},s(e(oe)(t.message,t.isExpected))+" set value",5),a("div",{style:u(e(X)(t.message.request.value)),class:"text-center font-mono px-1"}," Value "+s(e(qe)(t.message.request.value)),5)])):t.message.command===e(T).PinSetMode?(o(),n("div",vt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},s(e(oe)(t.message,t.isExpected))+" set mode",5),a("div",{style:u({background:e($e)[t.message.request.mode]}),class:"text-center font-mono px-1"}," Mode "+s(e(ie)[t.message.request.mode]),5)])):t.message.command===e(T).PinSetPull?(o(),n("div",xt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},s(e(oe)(t.message,t.isExpected))+" set pull",5),a("div",{style:u({background:e(pe)[t.message.request.pull]}),class:"text-center font-mono px-1"}," Pull "+s(e(ue)[t.message.request.pull]),5)])):t.message.command===e(T).PwmDutyU16?(o(),n("div",ft,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},"PWM "+s(t.message.request.pin)+" set duty",5),a("div",{style:u(e(X)(t.message.request.duty_u16/e(ce))),class:"text-center font-mono px-1"}," u16 "+s(t.message.request.duty_u16),5)])):t.message.command===e(T).PwmFreq?(o(),n("div",gt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},"PWM "+s(t.message.request.pin)+" set freq",5),a("div",{style:u(e(X)(t.message.request.freq/e(ce))),class:"text-center font-mono px-1"}," Freq "+s(t.message.request.freq),5)])):t.message.command===e(T).Output?(o(),n("div",bt,[r[0]||(r[0]=a("div",{class:"text-center px-1"},"Print",-1)),a("div",yt,s(t.message.request.output),1)])):t.message.command===e(T).Sleep?(o(),n("div",ht,[r[1]||(r[1]=a("div",{class:"text-center px-1"},"Sleep",-1)),a("div",kt,s(t.message.request.time_ms)+" ms",1)])):t.message.command===e(He).Timeout?(o(),n("div",wt," Timeout ")):t.message.command===e(T).NeoPixelWrite?(o(),n("div",qt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},"NeoPixel "+s(t.message.request.pin)+" write pixels",5),a("div",{style:u(e(X)(0)),class:"text-center font-mono px-1"}," pixels("+s(t.message.request.pixels.length)+") ",5)])):t.message.command===e(T).DisplayText?(o(),n("div",$t,[r[2]||(r[2]=a("div",{class:"text-center px-1"},"Display print",-1)),a("div",pt,s(t.message.request.text),1)])):t.message.command===e(m).PinGetValue?(o(),n("div",Ct,[a("div",{style:u({background:e(q)}),class:"text-center font-mono px-1"},s(e(H)(t.message.request,t.message.meta,t.isExpected))+" get value",5),a("div",{style:u(e(X)(t.message.result)),class:"text-center font-mono px-1"}," Value "+s(e(qe)(t.message.result)),5)])):t.message.command===e(m).PinGetMode?(o(),n("div",_t,[a("div",{style:u({background:e(q)}),class:"text-center font-mono px-1"},s(e(H)(t.message.request,t.message.meta,t.isExpected))+" get mode",5),a("div",{style:u({background:e($e)[t.message.result]}),class:"text-center font-mono px-1"}," Mode "+s(e(ie)[t.message.result]),5)])):t.message.command===e(m).PinGetPull?(o(),n("div",Mt,[a("div",{style:u({background:e(q)}),class:"text-center font-mono px-1"},s(e(H)(t.message.request,t.message.meta,t.isExpected))+" get pull",5),a("div",{style:u({background:e(pe)[t.message.result]}),class:"text-center font-mono px-1"}," Pull "+s(e(ue)[t.message.result]),5)])):t.message.command===e(m).AdcReadU16?(o(),n("div",Pt,[a("div",{style:u({background:e(q)}),class:"text-center font-mono px-1"},"ADC "+s(t.message.request.pin)+" read",5),a("div",{style:u(e(X)(t.message.result/e(ce))),class:"text-center font-mono px-1"}," u16 "+s(t.message.result),5)])):t.message.command===e(m).Input?(o(),n("div",It,[r[3]||(r[3]=a("div",{class:"text-center px-1"},"Input",-1)),a("div",Tt,s(t.message.result),1)])):t.message.command===e(m).I2CScan?(o(),n("div",Rt,[a("div",Et,"I2CScan sda:"+s(t.message.request.sda)+" scl: "+s(t.message.request.scl),1),a("div",St,s(t.message.result),1)])):t.message.command===e(m).I2CReadFromMem?(o(),n("div",Ut,[a("div",Ft,"I2CReadFromMem sda:"+s(t.message.request.sda)+" scl: "+s(t.message.request.scl)+" addr:"+s(t.message.request.addr)+" memaddr:"+s(t.message.request.memaddr)+" nbytes:"+s(t.message.request.nbytes),1),a("div",Bt,s(t.message.result),1)])):t.message.command===e(T).I2CWriteToMem?(o(),n("div",Vt,[a("div",Lt,"I2CWriteToMem sda:"+s(t.message.request.sda)+" scl: "+s(t.message.request.scl)+" addr:"+s(t.message.request.addr)+" memaddr:"+s(t.message.request.memaddr),1),a("div",Nt,s(t.message.request.buf),1)])):t.message.command===e(T).BME280Init?(o(),n("div",Dt,[r[4]||(r[4]=a("div",{class:"text-center px-1"},"BME280 init",-1)),a("div",Ot," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).BME280ReadTemperature?(o(),n("div",Gt,[a("div",At,"BME280 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read temperature",1),a("div",jt,s(t.message.result)+" °C ",1)])):t.message.command===e(m).BME280ReadPressure?(o(),n("div",zt,[a("div",Wt,"BME280 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read pressure",1),a("div",Xt,s(t.message.result)+" Pa ",1)])):t.message.command===e(m).BME280ReadHumidity?(o(),n("div",Ht,[a("div",Kt,"BME280 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read humidity",1),a("div",Jt,s(t.message.result)+" % ",1)])):t.message.command===e(T).VEML6040Init?(o(),n("div",Qt,[r[5]||(r[5]=a("div",{class:"text-center px-1"},"VEML6040 init",-1)),a("div",Yt," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).VEML6040ReadRGB?(o(),n("div",Zt,[a("div",es,"VEML6040 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read rgb",1),a("div",ts," r:"+s(t.message.result[0])+" g:"+s(t.message.result[1])+" b:"+s(t.message.result[2]),1)])):t.message.command===e(T).VL53L0XInit?(o(),n("div",ss,[r[6]||(r[6]=a("div",{class:"text-center px-1"},"VL53L0X init",-1)),a("div",as," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).VL53L0XRead?(o(),n("div",ls,[a("div",os,"VL53L0X "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read",1),a("div",ns," distance:"+s(t.message.result)+" mm ",1)])):t.message.command===e(T).MPU6050Init?(o(),n("div",ds,[r[7]||(r[7]=a("div",{class:"text-center px-1"},"MPU6050 init",-1)),a("div",cs," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).MPU6050ReadAccel?(o(),n("div",rs,[a("div",is,"MPU6050 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read accel",1),a("div",us," ax:"+s(t.message.result[0]/16384)+" ay:"+s(t.message.result[1]/16384)+" az:"+s(t.message.result[2]/16384),1)])):t.message.command===e(m).MPU6050ReadGyro?(o(),n("div",ms,[a("div",vs,"MPU6050 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read gyro",1),a("div",xs," gx:"+s(t.message.result[0]/131)+" gy:"+s(t.message.result[1]/131)+" gz:"+s(t.message.result[2]/131),1)])):t.message.command===e(m).Random?(o(),n("div",fs,[r[8]||(r[8]=a("div",{class:"text-center px-1"},"Random",-1)),a("div",gs,s(t.message.result),1)])):(o(),n("div",bs," Todo: "+s(t.message.command),1))])):(o(),n("div",ys," Nothing "))}}),hs={class:"flex-col overflow-auto"},ks={key:0,class:"flex text-white border-2 border-blue-500"},ws={class:"text-black text-nowrap"},qs={key:1,class:"flex text-white border-2 border-blue-500"},$s={class:"text-black text-nowrap"},ps={key:2,class:"flex text-white border-2 border-blue-500"},Cs={class:"text-black text-nowrap"},_s={key:3,class:"flex text-white border-2 border-blue-500"},Ms={class:"text-black text-nowrap"},Ps={key:4,class:"flex text-white border-2 border-blue-500"},Is={class:"text-black text-nowrap"},Ts={key:5,class:"flex text-white border-2 border-blue-500"},Rs={class:"text-black text-nowrap"},Es={key:6,class:"flex text-white border-2 border-blue-500"},Ss={class:"text-black text-nowrap"},Us={key:7,class:"flex text-white border-2 border-blue-500"},Fs={class:"text-black text-nowrap"},Bs={key:8,class:"flex text-white border-2 border-blue-500"},Vs={class:"text-black text-nowrap"},Ls={key:9,class:"flex text-white border-2 border-blue-500"},Ns={class:"text-black text-nowrap"},Ds={key:10,class:"flex text-white border-2 border-blue-500"},Os={class:"text-black text-nowrap"},Gs={key:11,class:"flex text-white border-2 border-blue-500"},As={class:"text-black text-nowrap"},js={key:12,class:"flex text-white border-2 border-blue-500"},zs={class:"text-black text-nowrap"},Ws={key:13,class:"flex text-white border-2 border-blue-500"},Xs={class:"text-black text-nowrap"},Hs={key:14,class:"flex text-white border-2 border-blue-500"},Ks={class:"text-black text-nowrap"},Js={key:15,class:"flex text-black border-2 border-blue-500"},Re=K({__name:"Inputs",props:{inputs:{},isExpected:{type:Boolean}},setup(t){const d=ve(()=>{const r=[];for(const[p,l]of t.inputs){const y=Ke(p);r.push({...y,result:l})}return r});return(r,p)=>(o(),n(G,null,[d.value.length===0?(o(),n(G,{key:0},[D("Nothing")],64)):N("",!0),a("div",hs,[(o(!0),n(G,null,ee(d.value,l=>(o(),n("div",{key:l.command,class:"flex"},[l.command===e(m).PinGetValue?(o(),n("div",ks,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},s(e(H)(l.request,l.meta,r.isExpected))+" get value: ",5),a("div",ws,s(l.result),1)])):l.command===e(m).PinGetMode?(o(),n("div",qs,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},s(e(H)(l.request,l.meta,r.isExpected))+" get mode: ",5),a("div",$s,s(l.result.map(y=>e(ie)[y])),1)])):l.command===e(m).PinGetPull?(o(),n("div",ps,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},s(e(H)(l.request,l.meta,r.isExpected))+" get pull: ",5),a("div",Cs,s(l.result.map(y=>e(ue)[y])),1)])):l.command===e(m).AdcReadU16?(o(),n("div",_s,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+s(l.request.pin)+" read u16:",5),a("div",Ms,s(l.result),1)])):l.command===e(m).Input?(o(),n("div",Ps,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},"Console input:",4),a("div",Is,s(l.result),1)])):l.command===e(m).I2CScan?(o(),n("div",Ts,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},"I2CScan:",4),a("div",Rs,s(l.result),1)])):l.command===e(m).I2CReadFromMem?(o(),n("div",Es,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},"I2CReadFromMem:",4),a("div",Ss,s(l.result),1)])):l.command===e(m).BME280ReadTemperature?(o(),n("div",Us,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(l.request.sda)+" "+s(l.request.scl)+" read_temperature: ",5),a("div",Fs,s(l.result),1)])):l.command===e(m).BME280ReadPressure?(o(),n("div",Bs,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(l.request.sda)+" "+s(l.request.scl)+" read_pressure: ",5),a("div",Vs,s(l.result),1)])):l.command===e(m).BME280ReadHumidity?(o(),n("div",Ls,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(l.request.sda)+" "+s(l.request.scl)+" read_humidity: ",5),a("div",Ns,s(l.result),1)])):l.command===e(m).VEML6040ReadRGB?(o(),n("div",Ds,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"}," VEML6040 "+s(l.request.sda)+" "+s(l.request.scl)+" readRGB: ",5),a("div",Os,s(l.result),1)])):l.command===e(m).VL53L0XRead?(o(),n("div",Gs,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"}," VL53L0X "+s(l.request.sda)+" "+s(l.request.scl)+" read: ",5),a("div",As,s(l.result),1)])):l.command===e(m).MPU6050ReadAccel?(o(),n("div",js,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"}," MPU6050 "+s(l.request.sda)+" "+s(l.request.scl)+" read accel: ",5),a("div",zs,s(l.result),1)])):l.command===e(m).MPU6050ReadGyro?(o(),n("div",Ws,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"}," MPU6050 "+s(l.request.sda)+" "+s(l.request.scl)+" read gyro: ",5),a("div",Xs,s(l.result),1)])):l.command===e(m).Random?(o(),n("div",Hs,[a("div",{style:u({background:e(q)}),class:"text-center text-nowrap font-mono px-1"},"Random:",4),a("div",Ks,s(l.result),1)])):(o(),n("div",Js,"TODO: "+s(l),1))]))),128))])],64))}}),Qs={class:"flex items-center gap-2"},Ys={class:"font-bold"},Zs={class:"flex"},ea=["onClick"],ta={class:"text-center"},sa={key:0,class:"text-center"},aa={key:0,class:"flex items-center justify-center h-20"},la=K({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(t){const d=t,{selectNode:r,selectedIndex:p,firstError:l}=Je(d.id,d.result),y=ve(()=>Te(d.result.replayed)),C=g(null),P=g([]);return(x,h)=>{const R=Ie,E=xe;return o(),O(E,null,{header:$(()=>[a("div",Qs,[a("div",Ys,s(x.$t("result")),1),d.result.success===!1?(o(),O(R,{key:0,severity:"danger",onClick:h[0]||(h[0]=_=>e(l)(P.value))},{default:$(()=>[D(s(x.$t("first error")),1)]),_:1})):N("",!0)])]),default:$(()=>[a("div",{ref_key:"scrollContainer",ref:C,class:"flex overflow-auto mb-2"},[(o(!0),n(G,null,ee(d.result.feedback,(_,F)=>{var f,L;return o(),n("div",Zs,[a("button",{class:Z(["flex",e(p)===F?"border border-blue-500":""]),onClick:A=>e(r)(F),ref_for:!0,ref:A=>P.value[F]=A},[a("div",ta,[D(s(_.correct?x.$t("correct"):x.$t("incorrect"))+" ",1),b(me,{message:(f=_.replayed)==null?void 0:f.content,isExpected:!1,class:Z(["border-4 rounded-md",_.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),_.correct?N("",!0):(o(),n("div",sa,[h[1]||(h[1]=D(s("Expected")+" ")),b(me,{message:(L=_.expected)==null?void 0:L.content,isExpected:!0,class:Z(["border-4 rounded-md",_.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,ea),F+1<d.result.feedback.length?(o(),n("div",aa,"→")):N("",!0)])}),256))],512),h[2]||(h[2]=D(" Input used: ")),b(Re,{inputs:y.value,isExpected:!1},null,8,["inputs"])]),_:1})}}}),oa={class:"flex overflow-auto mb-2"},na={class:"text-center"},da={key:0,class:"flex items-center justify-center h-12"},_e=K({__name:"TestDataTimeline",props:{data:{}},setup(t){const d=ve(()=>Te(t.data));return(r,p)=>{const l=xe;return o(),O(l,{header:"Expected"},{default:$(()=>[a("div",oa,[(o(!0),n(G,null,ee(r.data,(y,C)=>(o(),n("div",{class:"flex",key:C},[a("div",na,[b(e(me),{message:y.content,isExpected:!0,class:"border-4 border-blue-500"},null,8,["message"])]),C+1<r.data.length?(o(),n("div",da,"→")):N("",!0)]))),128))]),p[0]||(p[0]=D(" Inputs: ")),b(e(Re),{inputs:d.value,isExpected:!0},null,8,["inputs"])]),_:1})}}}),ca=Pe("tester-store",()=>{const t=De(),d=g(null),r=g(!1),p=g(!1),l=g(!1),y=g(!1),C=g(!1),P=g(0),x=g(0),h=g(null),R=g(""),E=g([]),_=g(),F=g(),f=g();async function L(c,i,I){try{r.value=!0;const{data:v}=await Ce.getUnitByIdandLessonId(c,i);d.value=rt(v)}catch(v){t.add({severity:"error",summary:v.response.data.error,life:2e3})}finally{r.value=!1}try{if(d.value==null)return;if(P.value=i,x.value=c,d.value.unitType=="checklist"){if(I==null)return;h.value=I;const v=d.value.data;if(f.value=v.checks.find(S=>S.id===h.value),f.value==null)return;R.value=f.value.solution,E.value=await ye(f.value.tests),_.value=f.value.includedCommandsForTests??[...he],C.value=!0,y.value=!0;return}d.value.content&&(R.value=d.value.content.answer),d.value.data.tests&&(E.value=await ye(d.value.data.tests)),d.value.data.neededModules&&(F.value=d.value.data.neededModules),_.value=d.value.data.includedCommandsForTests??[...he],y.value=!0}catch(v){t.add({severity:"error",summary:v,life:2e3})}finally{r.value=!1}}async function A(c){if(!(x.value==null||P.value==null))try{p.value=!0,await Ce.updateUnitByIdandLessonId(x.value,P.value,c)}catch(i){t.add({severity:"error",summary:i.response.data.error,life:2e3})}finally{p.value=!1}}async function U(){if(d.value!=null){l.value=!0;try{C.value?f.value&&(f.value.solution=R.value,f.value.includedCommandsForTests=_.value):(d.value.content.answer=R.value,d.value.data.includedCommandsForTests=_.value),await A({content:d.value.content,data:d.value.data})}catch(c){let i="";c instanceof Error?i=c.message:i=String(c),t.add({severity:"error",summary:"Failed to save",detail:i,life:3e3})}finally{l.value=!1}}}async function j(c){const i=JSON.stringify(c),I=new Blob([i],{type:"application/json"}),v=new FormData;v.append("file",I,"default.test.json");const{data:S}=await re.uploadFile(v,"tests");return S.source_url}async function te(c){if(d.value!=null)try{const i=await j(c);if(i==""){t.add({severity:"error",summary:"not saved",life:2e3});return}if(C.value){if(!f.value)return;f.value.tests?f.value.tests.push({name:"",url:i}):(f.value.tests=[],f.value.tests.push({name:"",url:i}))}else d.value.data.tests?d.value.data.tests.push({name:"",url:i}):(d.value.data.tests=[],d.value.data.tests.push({name:"",url:i}));E.value.push({data:c,test:{name:"",url:i}})}catch(i){t.add({severity:"error",summary:i.response.data.error,life:2e3})}}async function z(c){var i,I,v;if(d.value!=null)try{const S=E.value[c].test.url;if(await re.deleteFile(S),C.value){const ae=d.value.data;f.value=ae.checks.find(le=>le.id===h.value),f.value&&((i=f.value.tests)==null||i.splice(c,1))}else(v=(I=d.value)==null?void 0:I.data.tests)==null||v.splice(c,1);E.value.splice(c,1)}catch(S){t.add({severity:"error",summary:S.response.data.error,life:2e3})}}async function se(c,i){if(!d.value)return;let I;const v=await j(i);if(v==""){t.add({severity:"error",summary:"not saved",life:2e3});return}if(C.value){if(!f.value||!f.value.tests)return;I=f.value.tests[c].url,f.value.tests[c].url=v}else{if(!d.value.data.tests)return;I=d.value.data.tests[c].url,d.value.data.tests[c].url=v}E.value[c].test.url=v,E.value[c].data=i;try{await re.deleteFile(I)}catch(S){t.add({severity:"error",summary:S.response.data.error,life:2e3})}}return{selectedUnit:d,isUnitLoading:r,isInited:y,code:R,testsData:E,includedCommandsForTests:_,neededModules:F,loadUnitData:L,saveUnit:U,createTest:te,deleteTest:z,updateTest:se}}),ra={class:"h-full flex flex-col"},ia={class:"p-4"},ua={class:"flex w-full gap-1"},ma={class:"material-icons"},va={class:"material-icons"},xa={class:"material-icons"},fa={class:"material-icons"},ga={class:"material-icons"},ba={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},ya={class:"flex gap-2 w-full"},ha=["for"],ka={class:"material-icons"},wa={class:"material-icons"},qa=K({__name:"TesterControls",props:{id:{},lesson_id:{},unit_id:{},check_id:{}},setup(t){const d=t,r=Oe(),p=ca(),{selectedUnit:l,isInited:y,code:C,neededModules:P,testsData:x,includedCommandsForTests:h}=ge(p),{saveUnit:R,loadUnitData:E,createTest:_,deleteTest:F,updateTest:f}=p;Ge(async()=>{try{if(await E(d.unit_id,d.lesson_id,d.check_id),!y)return;if(U.value=C.value,z.setCode(U.value),P.value)for(const k of P.value)k.module&&k.slot&&j.newModuleToSlot(k.module,k.slot)}catch(k){console.log(k)}});const L=ot(async()=>{await R()},1e3,{maxWait:5e3});function A(k){r.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{await F(k),await R()}})}const{fileContent:U}=ge(it()),j=at(d.id),te=Qe(d.id),z=lt(d.id),se=Ye(d.id);ne.registerSimulation(d.id,{terminal:te,display:se,pibody:j});const c=ne.getSharedEmulator(),{isLoading:i,isRunning:I}=c;j.addNeededModules([]);const v=g(ke),S=g(ke);be(z.code,async k=>{typeof k=="string"&&k!==U.value&&(U.value=k,y.value&&(C.value=k,L()))});function ae(){c.recorder.start();const k=typeof z.code.value=="string"?z.code.value:"";ne.run(d.id,k);const w=be(c.recorder.state,()=>{(c.replayer.state.value==de.Finish||c.replayer.state.value==de.Timeout)&&(c.recorder.stop(),v.value=c.recorder.getRecords()),w.stop()})}function le(){c.replayer.state.value==de.Continue?(c.recorder.stop(),c.replayer.stop(),S.value=c.recorder.getRecords()):(c.recorder.stop(),v.value=c.recorder.getRecords()),c.stop()}async function Ee(){await _(v.value),await R(),v.value=[]}const Se=async()=>{V.value=!0;for(const[k,w]of x.value.entries()){const J=await we(c,U.value,w.data,h.value);await c.stopPromise(),await f(k,J)}await R(),V.value=!1},Ue=async(k,w)=>{V.value=!0;const J=await we(c,U.value,k.data,h.value);await c.stopPromise(),await f(w,J),await R(),V.value=!1};return(k,w)=>{const J=ct,B=Ie,Fe=dt,Be=nt,Ve=xe;return o(),n("div",ra,[a("div",ia,[w[4]||(w[4]=D(" Include Commands: ")),e(y)?(o(),O(J,{key:0,onChange:e(L),modelValue:e(h),"onUpdate:modelValue":w[0]||(w[0]=M=>Ae(h)?h.value=M:null),options:Ze,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):N("",!0),a("div",ua,[b(B,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:ae,disabled:e(i)||e(I)},{default:$(()=>[a("span",ma,s(e(i)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:le,disabled:e(i)||!e(I)},{default:$(()=>[a("span",va,s(e(i)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:w[1]||(w[1]=M=>Ee()),disabled:v.value.length<=0||e(l)==null},{default:$(()=>[a("span",xa,s(e(i)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:w[2]||(w[2]=M=>e(et)(e(c),e(U),e(x),e(h))),disabled:e(i)||e(V)},{default:$(()=>[a("span",fa,s(e(i)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",rounded:"",onClick:w[3]||(w[3]=M=>Se()),disabled:e(i)||!e(x)||e(V)},{default:$(()=>[a("span",ga,s(e(i)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"])])]),v.value.length>0?(o(),O(_e,{key:0,data:v.value,class:"mt-2"},null,8,["data"])):N("",!0),a("div",ba,[(o(!0),n(G,null,ee(e(x),(M,Q)=>{var fe;return o(),O(Ve,{toggleable:"",key:M.test.url,class:Z(["border-4",e(st)((fe=M.result)==null?void 0:fe.success)])},{header:$(()=>[a("div",ya,[b(Be,{variant:"on",class:"w-full"},{default:$(()=>[a("label",{for:`name ${Q+1}`},"Test "+s(Q+1),9,ha),b(Fe,{id:`name ${Q+1}`,onInput:e(L),modelValue:M.test.name,"onUpdate:modelValue":Y=>M.test.name=Y,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:Y=>e(tt)(e(c),e(U),M,e(h)),disabled:e(i)||e(V)},{default:$(()=>[a("span",ka,s(e(i)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:Y=>A(Q)},{default:$(()=>w[5]||(w[5]=[a("span",{class:"material-icons"},s("delete_forever"),-1)])),_:2},1032,["onClick"]),b(B,{type:"button",class:"w-9 h-9",rounded:"",onClick:Y=>Ue(M,Q),disabled:e(i)||!e(x)||e(V)},{default:$(()=>[a("span",wa,s(e(i)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:Y=>M.result=void 0,disabled:!e(x)||e(V)},{default:$(()=>w[6]||(w[6]=[a("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:$(()=>[b(_e,{data:M.data,class:"mt-2"},null,8,["data"]),M.result?(o(),O(e(la),{key:0,result:M.result,id:d.id},null,8,["result","id"])):N("",!0)]),_:2},1032,["class"])}),128))])])}}}),$a={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Me="tester",ul=K({__name:"TesterView",setup(t){const d=je(),r=Number(d.params.lesson_id),p=Number(d.params.unit_id),l=String(d.query.check_id);return(y,C)=>{const P=Le,x=Ne;return o(),n(G,null,[b(e(ze)),a("div",$a,[b(x,{class:"w-full rounded-none"},{default:$(()=>[b(P,{size:33,minSize:10,class:"max-w-[767px] h-full"},{default:$(()=>[b(qa,{id:Me,lesson_id:e(r),unit_id:e(p),check_id:e(l)},null,8,["lesson_id","unit_id","check_id"])]),_:1}),b(P,{size:67,minSize:10,class:"w-full h-full"},{default:$(()=>[b(e(We),{id:Me,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{ul as default};
