var He=Object.defineProperty;var Xe=(e,t,s)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var P=(e,t,s)=>Xe(e,typeof t!="symbol"?t+"":t,s);import{r as w,aZ as Ie,B as ne,A as Ke,e as De,C as Ye,D as Je,o as F,c as ee,a as T,k as z,w as H,h as k,t as be,y as qe,l as Be,a4 as Qe,u as je,f as Ze,P as me,H as et,a9 as tt,i as ae,j as se,n as st,a_ as rt,a$ as it,R as at,b0 as nt,b1 as ot}from"./index-BXslawiU.js";import{d as Ue,M as Ne,P as lt,a as ct,u as ut,s as dt}from"./store-BrpL4K3A.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as mt}from"./index-D-Li2oDx.js";import{s as pt}from"./index-B45JFP4L.js";const pe=new Map;function ht(e){if(!pe.has(e)){const r=w(""),n=w(0),l=w(0),m=w("#000000");pe.set(e,{text:r,x:n,y:l,textColor:m})}const t=pe.get(e);function s(r,n,l,m){t.text.value+=r+`\r
`,t.x.value=n,t.y.value=l,m&&(t.textColor.value=m)}function a(){t.text.value="",t.x.value=0,t.y.value=0,t.textColor.value="#000000"}return{text:t.text,x:t.x,y:t.y,textColor:t.textColor,writeText:s,clearDisplay:a}}function ue(e){return new Promise(t=>setTimeout(t,e))}class vt{constructor(){P(this,"_lock",Promise.resolve());this._lock=Promise.resolve()}acquire(){let t;const s=new Promise(r=>t=r),a=this._lock.then(()=>t);return this._lock=this._lock.then(()=>s),a}}class fe{constructor(){P(this,"mutex");P(this,"inTransaction");P(this,"receivedData");P(this,"activityCallback");P(this,"receiveCallback");P(this,"disconnectCallback");P(this,"writeChunk");P(this,"emit");P(this,"info");P(this,"prevRecvCbk");P(this,"type");if(new.target===fe)throw new Error("Cannot instantiate abstract class Transport");this.mutex=new vt,this.inTransaction=!1,this.receivedData="",this.activityCallback=()=>{},this.receiveCallback=()=>{},this.disconnectCallback=()=>{},this.prevRecvCbk=t=>{},this.writeChunk=128,this.emit=!1,this.info={},this.type=null}async getInfo(){return this.info}async write(t){const a=new TextEncoder().encode(t);try{if(a.byteLength==0)await this.writeBytes(a),this.activityCallback();else{let r=0;for(;r<a.byteLength;){const n=a.slice(r,r+this.writeChunk);await this.writeBytes(n),this.activityCallback(),r+=this.writeChunk}}}catch(r){throw r}}onActivity(t){this.activityCallback=t}onReceive(t){this.receiveCallback=t}onDisconnect(t){this.disconnectCallback=t}async startTransaction(){await ue(10);const t=await this.mutex.acquire();return this.prevRecvCbk=this.receiveCallback,this.inTransaction=!0,this.receivedData="",this.receiveCallback=s=>{this.receivedData+=s,this.emit&&this.prevRecvCbk&&this.prevRecvCbk(s)},()=>{this.prevRecvCbk&&(this.receiveCallback=this.prevRecvCbk,this.receiveCallback(this.receivedData)),this.receivedData="",this.inTransaction=!1,t()}}async readExactly(t,s=5e3){if(!this.inTransaction)throw new Error("Not in transaction");let a=Date.now()+s;for(;s<=0||Date.now()<a;){if(this.receivedData.length>=t){const n=this.receivedData.substring(0,t);return this.receivedData=this.receivedData.substring(t),n}const r=this.receivedData.length;await ue(10),this.receivedData.length>r&&(a=Date.now()+s)}throw new Error("Timeout")}async readUntil(t,s=5e3){if(!this.inTransaction)throw new Error("Not in transaction");const a=Date.now();let r=0;for(;s<=0||r<s;){const n=this.receivedData.indexOf(t)+t.length;if(n>=t.length){const l=this.receivedData.substring(0,n);return this.receivedData=this.receivedData.substring(n),l}await ue(10),r=Date.now()-a}throw console.error(`Timeout! Expected: "${t}". Received before error: "${this.receivedData}"`),new Error("Timeout reached before finding the ending sequence")}}class yt extends fe{constructor(){super();P(this,"port");P(this,"reader");P(this,"writer");P(this,"serial");if(this.port=void 0,this.type="usb",this.reader=null,this.writer=null,"serial"in navigator)this.serial=navigator.serial;else throw new Error("WebSerial not available")}async requestAccess(){var n,l,m,h;const r={filters:[{usbVendorId:11914,usbProductId:5}]};this.port=await((n=this.serial)==null?void 0:n.requestPort(r));try{const i=(l=this.port)==null?void 0:l.getInfo();this.info={vid:(m=i==null?void 0:i.usbVendorId)==null?void 0:m.toString(16).padStart(4,"0"),pid:(h=i==null?void 0:i.usbProductId)==null?void 0:h.toString(16).padStart(4,"0")}}catch(i){throw i}}async connect(){var s,a;if(!this.port)throw new Error("Port is not available");try{await this.port.open({baudRate:115200})}catch(r){throw r instanceof Error&&(r.message.includes("already open")||r.message.includes("Failed to open")||r.name==="InvalidStateError")?new Error("PORT_ALREADY_OPEN"):r}this.reader=((s=this.port.readable)==null?void 0:s.getReader())||null,this.writer=((a=this.port.writable)==null?void 0:a.getWriter())||null,this.reader&&this.listen()}async disconnect(){if(!this.reader||!this.port)throw new Error("No active connection to disconnect from");try{await this.reader.cancel()}catch{}await this.port.forget()}async writeBytes(s){if(!this.writer)throw new Error("Writer is not initialized");await this.writer.write(s)}async listen(){if(!this.reader)throw new Error("Reader is not initialized");const s=new TextDecoder;await this.write(""),await this.write("");try{for(;;){const{value:a,done:r}=await this.reader.read();if(r||!a)break;this.receiveCallback(s.decode(a))}}catch(a){throw console.log("disconnect callback"),this.disconnectCallback(),a}}async flushInput(){if(!this.reader)throw new Error("Reader is not initialized");this.receivedData=""}}const he="6e400001-b5a3-f393-e0a9-e50e24dcca9e",wt="6e400002-b5a3-f393-e0a9-e50e24dcca9e",bt="6e400003-b5a3-f393-e0a9-e50e24dcca9e";class qt extends fe{constructor(){super();P(this,"bluetooth");P(this,"device");P(this,"server");P(this,"service");P(this,"rx");P(this,"tx");P(this,"tx_limit");P(this,"_onCharacteristicChangedBound",null);P(this,"writer",null);P(this,"decoder",new TextDecoder);if(this.device=null,this.server=null,this.service=null,this.rx=null,this.tx=null,this.tx_limit=20,this.type="ble","bluetooth"in navigator)this.bluetooth=navigator.bluetooth;else throw new Error("WebBluetooth not available")}async requestAccess(){if(!this.bluetooth||typeof this.bluetooth.requestDevice!="function")throw new Error("Invalid Bluetooth object");try{const s={filters:[{services:[he]},{namePrefix:"mpy-"}],optionalServices:[he]},a=await this.bluetooth.requestDevice(s);this.device=a}catch(s){throw s}if(this.device){this.device.addEventListener("gattserverdisconnected",()=>{this.disconnectCallback()});try{this.info={name:this.device.name}}catch(s){throw s}}}async connect(){if(!this.device||!this.device.gatt)throw new Error("Device is not available");try{this.server=await this.device.gatt.connect(),this.service=await this.server.getPrimaryService(he),this.rx=await this.service.getCharacteristic(bt),this.tx=await this.service.getCharacteristic(wt)}catch{throw new Error("Pico W NUS Service not found. Is MicroPython BLE active?")}this._onCharacteristicChangedBound=s=>{const a=s.target.value;if(a){const r=this.decoder.decode(a,{stream:!0});this.receiveCallback(r),this.activityCallback()}},await this.rx.startNotifications(),this.rx.addEventListener("characteristicvaluechanged",this._onCharacteristicChangedBound)}async disconnect(){if(this.rx&&this._onCharacteristicChangedBound){this.rx.removeEventListener("characteristicvaluechanged",this._onCharacteristicChangedBound);try{await this.rx.stopNotifications()}catch(s){console.log("Could not stop notifications",s)}}this.device&&this.device.gatt&&this.device.gatt.connected&&this.device.gatt.disconnect(),this.inTransaction=!1,this.receivedData=""}async writeBytes(s){this.tx&&(await this.tx.writeValue(s),await ue(1))}async flushInput(){if(!this.rx)throw new Error("Reader(rx) is not initialized");this.receivedData=""}}class ${constructor(t){P(this,"port");P(this,"end");this.port=t,this.end=async()=>{}}static async begin(t,s=!1){var r;const a=new $(t);s=s&&t.type=="usb",await a.enterRawRepl(s);try{await a.exec("import sys,os")}catch(n){throw await((r=a.end)==null?void 0:r.call(a)),n}return a}async interruptProgram(){await this.port.write("")}async enterRawRepl(t=!1){const s=await this.port.startTransaction();try{await this.interruptProgram(),await this.port.flushInput(),await this.port.write("\r"),await this.port.readUntil(`raw REPL; CTRL-B to exit\r
`),t&&(await this.port.write(""),await this.port.readUntil("OK")),this.end=async()=>{try{await this.port.write(""),await this.port.readUntil(`>\r
`),await this.port.readUntil(">>> ")}finally{s()}}}catch(a){throw s(),a}}async exec(t,s=5e3,a=!1){if(t.length===0)return"";await this.port.write(t),await this.port.write(""),await this.port.readUntil("OK"),this.port.emit=a,a&&this.port.prevRecvCbk(this.port.receivedData);const r=(await this.port.readUntil("",s)).slice(0,-1),n=(await this.port.readUntil("",s)).slice(0,-1);if(n.length)throw new Error(n);return r}async readFile(t){const s=await this.exec(`
try:
 import binascii
 h=lambda x: binascii.hexlify(x).decode()
 h(b'')
except:
 h=lambda b: ''.join('{:02x}'.format(byte) for byte in b)
with open('${t}','rb') as f:
 while 1:
  b=f.read(64)
  if not b:break
  print(h(b),end='')
`);return s.length?new Uint8Array(s.match(/../g).map(a=>parseInt(a,16))):new Uint8Array}async readFileLines(t,s){const a=await this.exec(`
with open('${t}', 'rb') as f:
 lines = []
 for _ in range(${s}):
  line = f.readline()
  if not line:
   break
  lines.append(line)
 data = b''.join(lines)
try:
 import binascii
 h = lambda x: binascii.hexlify(x).decode()
except:
 h = lambda b: ''.join('{:02x}'.format(byte) for byte in b)
print(h(data), end='')
`);return a.length?new Uint8Array(a.match(/../g).map(r=>parseInt(r,16))):new Uint8Array}async writeFile(t,s,a=128,r=!1){if(typeof s=="string"){const h=new TextEncoder;s=new Uint8Array(h.encode(s))}const n=h=>Array.from(h).map(i=>i.toString(16).padStart(2,"0")).join(""),l=h=>{h=new Uint8Array(h);let i="b'";for(const c of h)c>=32&&c<=126?c===92||c===39?i+="\\"+String.fromCharCode(c):i+=String.fromCharCode(c):i+="\\x"+c.toString(16).padStart(2,"0");return i+="'",i},m=r?t:t+".tmp";await this.exec(`
try:
 import binascii
 h=binascii.unhexlify
 h('')
except:
 h=lambda s: bytes(int(s[i:i+2], 16) for i in range(0, len(s), 2))
f=open('${m}','wb')
w=lambda d: f.write(h(d))
o=f.write
`);for(let h=0;h<s.byteLength;h+=a){const i=s.slice(h,h+a),c="w('"+n(i)+"')",d="o("+l(i)+")";c.length<d.length?await this.exec(c):await this.exec(d)}r?await this.exec("f.close()"):await this.exec(`f.close()
try: os.remove('${t}')
except: pass
os.rename('${m}','${t}')
`)}async getDeviceInfo(){const t=await this.exec(`
try: u=os.uname()
except: u=('','','','',sys.platform)
try: v=sys.version.split(';')[1].strip()
except: v='MicroPython '+u[2]
mpy=getattr(sys.implementation, '_mpy', 0)
sp=':'.join(sys.path)
d=[u[4],u[2],u[0],v,mpy>>10,mpy&0xFF,(mpy>>8)&3,sp]
print('|'.join(str(x) for x in d))
`);let[s,a,r,n,l,m,h,i]=t.trim().split("|");const c=i.split(":");try{l=["","x86","x64","armv6","armv6m","armv7m","armv7em","armv7emsp","armv7emdp","xtensa","xtensawin","rv32imc"][parseInt(l)]}catch{l=""}let d=parseInt(m,10);const v=parseInt(h,10);return d||(d="py"),{machine:s,release:a,sysname:r,version:n,mpy_arch:l,mpy_ver:d,mpy_sub:v,sys_path:c}}async touchFile(t){await this.exec(`
f=open('${t}','wb')
f.close()
`)}async moveFile(t,s){await this.exec(`os.rename('${t}', '${s}')`)}async makeDir(t){await this.exec(`os.mkdir('${t}')`)}async makePath(t){await this.exec(`
p=''
for d in '${t}'.split('/')[:-1]:
 if not d: continue
 p += '/'+d
 try: os.mkdir(p)
 except OSError as e:
  if e.args[0] not in (17, 20): raise
`)}async removeFile(t){await this.exec("import os;os.remove('"+t+"')")}async removeDir(t){await this.exec(`import os
try:
 os.rmdir('${t}')
except OSError as e:
 if e.args[0] == 39:
  throw new Error('Directory not empty')
 else:
  throw e
`)}async removeDirForced(t){await this.exec(`import os
def rmrf(path):
    try:
      for name, type, *_ in os.ilistdir(path):
        p = path + "/" + name
        if type & 0x4000:
          print(1)
          rmrf(p)
        else:
          os.remove(p)
      os.rmdir(path)
    except OSError as e:
      pass
rmrf('`+t+"')")}async getFsStats(t="/"){return(await this.exec(`
s = os.statvfs('${t}')
fs = s[1] * s[2]
ff = s[3] * s[0]
fu = fs - ff
print('%s|%s|%s'%(fu,ff,fs))
`)).trim().split("|")}async getFiles(){return await this.exec(`
def walk(p):
 for n in os.listdir(p if p else '/'):
  fn=p+'/'+n
  try: s=os.stat(fn)
  except: s=(0,)*7
  try:
   if s[0] & 0x4000 == 0:
    print('f|'+fn+'|'+str(s[6]))
   elif n not in ('.','..'):
    print('d|'+fn+'|'+str(s[6]))
    walk(fn)
  except:
   print('f|'+p+'/???|'+str(s[6]))
walk('')
`)}async readSysInfoMD(){return await this.exec(`
import gc
gc.collect()
mu = gc.mem_alloc()
mf = gc.mem_free()
ms = mu + mf
uname=os.uname()
p=print
def size_fmt(size):
 suffixes = ['B','KiB','MiB','GiB','TiB']
 i = 0
 while size > 1024 and i < len(suffixes)-1:
  i += 1
  size //= 1024
 return "%d%s" % (size, suffixes[i])
p('## Machine')
p('- Name: \`'+uname.machine+'\`')
try:
 gc.collect()
 import microcontroller as uc
 p('- CPU: \`%s @ %s MHz\`' % (sys.platform, uc.cpu.frequency // 1_000_000))
 p('- UID: \`%s\`' % (uc.cpu.uid.hex(),))
 p('- Temp.: \`%s Â°C\`' % (uc.cpu.temperature,))
 p('- Voltage: \`%s V\`' % (uc.cpu.voltage,))
except:
 try:
  gc.collect()
  import machine
  p('- CPU: \`%s @ %s MHz\`' % (sys.platform, machine.freq() // 1_000_000))
 except:
  p('- CPU: \`'+sys.platform+'\`')
p()
p('## System')
p('- Version: \`'+sys.version.split(";")[1].strip()+'\`')
if ms:
 p('- Memory use:  \`%s / %s, free: %d%%\`' % (size_fmt(mu), size_fmt(ms), (mf * 100) // ms))
`)}}const ge=w(!1),C=w(!1),gt=w(!1),ke=w(),O=w(null),B=w(!1),_e=w(!1),Le=w(!1),Fe=w(),X=w(!1),Re=w(!1),kt=w(!1),xt=w(),te=w(!1),Et=w(!1),ve=w(!1),de=w(),K=w(!1),Se=w(!1),Pt=w(!1),_t=w();let _=null;function Rt(e){return new Promise(t=>setTimeout(t,e))}async function St(e){try{X.value=!0,Re.value=!1,await e(),Re.value=!0}catch(t){kt.value=!0,xt.value=t}finally{X.value=!1}}async function oe(e){try{K.value=!0,Se.value=!1,await e(),Se.value=!0}catch(t){Pt.value=!0,_t.value=t}finally{K.value=!1}}async function Mt(){return await fetch(Ie+"manifest.json").then(t=>t.json()).catch(()=>{})}async function Tt(){if(_){te.value=!0,ve.value=!1,de.value=void 0;try{const e=await Ct(),t=await Mt(),s=[],a=[];for(const n of Object.keys(t)){const l=e[n],m=t[n];if(!l||l!==m){const h=await fetch(Ie+n);if(!h.ok){const c=new Error(`Failed to download ${n}: HTTP ${h.status}`);throw de.value=c,ve.value=!0,c}const i=new Uint8Array(await h.arrayBuffer());i.length>0&&s.push({key:n,content:i})}}for(const n of Object.keys(e))n in t||a.push(n);const r=await $.begin(_,!0);try{for(const n of a)await r.removeFile("/pibody/"+n);for(const{key:n,content:l}of s)await oe(async()=>{await r.makePath("/pibody/"+n),await r.writeFile("/pibody/"+n,l)});await oe(async()=>{await r.writeFile("/pibody/manifest.json",JSON.stringify(t,null,2))}),Et.value=!0}finally{await r.end()}}catch(e){throw ve.value=!0,de.value=e,e}finally{te.value=!1}}}function At(e,t){let s=!1;const a=e.trim().split(`
`),r=n=>{const[l,m,h]=n.split("|");return m===t};return a.find(r)&&(s=!0),s}async function Ct(){if(!_)return{};const e=await $.begin(_),t=await e.getFiles();let s="{}";return At(t,"/pibody/manifest.json")&&(s=await Lt("/pibody/manifest.json",e)),await e.end(),JSON.parse(s)}function It(){if(/(iPad|iPhone|iPod)/g.test(navigator.userAgent))throw O.value="WS_IOS_NOT_SUPPORTED","WebSerial is not available on iOS";if(!window.isSecureContext)throw O.value="WS_UNSECURE_CONNECTION","WebSerial cannot be accessed with unsecure connection";if(!("serial"in navigator||"usb"in navigator))throw O.value="WS_NOT_SUPPORTED","WebSerial and WebUSB are not supported. Try Chrome, Edge, Opera, Brave";return!0}async function Dt(e){It();let t;if(e==="usb")t=new yt;else if(e==="ble")t=new qt;else return ke.value=new Error("Wrong connection type"),null;try{await t.requestAccess()}catch(s){return ke.value=s,null}return t}async function Bt(e,t,s){try{await e.connect(),await Ve(),C.value=!0,O.value=null}catch(a){throw ge.value=!1,C.value=!1,B.value=!1,K.value=!1,X.value=!1,gt.value=!0,ke.value=a,a instanceof Error&&a.message==="PORT_ALREADY_OPEN"?O.value="PORT_ALREADY_OPEN":O.value="UNKNOWN",a}e.onReceive(t),e.onDisconnect(()=>{_==null||_.disconnect(),_=null,C.value=!1,B.value=!1,K.value=!1,X.value=!1,ge.value=!1}),_=e}async function le(){_==null||_.disconnect(),_=null,ge.value=!1,C.value=!1,B.value=!1,X.value=!1,K.value=!1}async function Ut(){if(!_)return"";try{await _.write("\r"),B.value=!1}catch(e){Le.value=!0,B.value=!1,Fe.value=e}}async function Nt(e){if(!_||(B.value&&await _.write("\r"),e.length===0))return;const t=!0,s=-1,a=await $.begin(_,t);try{_e.value=!1,B.value=!0;const r=!0;await Rt(10),await a.exec(e,s,r),_e.value=!0}catch(r){let n;r instanceof Error?n=r.message:n=String(r),n.includes("KeyboardInterrupt")||(Le.value=!0,Fe.value=r)}finally{_.emit=!1,B.value=!1}await a.end()}async function Lt(e,t){if(!_)return"";let s="";const a=t??await $.begin(_);return await St(async()=>{const r=await a.readFile(e);s=new TextDecoder("utf-8",{fatal:!0}).decode(r)}),t||a.end(),s}async function Ft(e,t){if(!_)return;const s=await $.begin(_);await oe(async()=>await s.writeFile(e,t)),s.end()}async function Vt(e){if(!_)return;const t=await $.begin(_);await oe(async()=>await t.removeFile(e)),t.end()}async function Me(e){if(!_)return;const t=await $.begin(_);await oe(async()=>await t.removeDirForced(e)),t.end()}async function Ve(){if(!_)return"";const e=await $.begin(_);try{return(await e.getDeviceInfo()).version.trim()}finally{await e.end()}}var o=(e=>(e.PinGetValue="pin get value",e.PinGetMode="pin get mode",e.PinGetPull="pin get pull",e.AdcReadU16="adc read_u16",e.I2CScan="i2c scan",e.I2CReadFromMem="i2c readfrom_mem",e.Input="input",e.Ticks_ms="ticks ms",e.BME280ReadTemperature="BME280 read_temperature",e.BME280ReadPressure="BME280 read_pressure",e.BME280ReadHumidity="BME280 read_humidity",e.VL53L0XRead="VL53L0X read",e.VEML6040ReadRGB="VEML6040 readRGB",e.MPU6050ReadAccel="MPU6050 read_accel",e.MPU6050ReadGyro="MPU6050 read_gyro",e.Random="random value",e))(o||{});const Te=2;var E=(e=>(e.I2CWriteToMem="i2c writefrom_mem",e.PinSetValue="pin set value",e.PinSetMode="pin set mode",e.PinSetPull="pin set pull",e.PwmFreq="pwm freq",e.PwmDutyU16="pwm duty_u16",e.Output="output",e.Sleep="sleep",e.DisplayText="display text",e.DisplayClear="display clear",e.NeoPixelWrite="neopixel write",e.RawOutput="raw output",e.BME280Init="BME280 __init__",e.VL53L0XInit="VL53L0X __init__",e.VEML6040Init="VEML6040 __init__",e.MPU6050Init="MPU6050 __init__",e.KeyboardInterrupt="keyboard interrupt",e.Error="error",e))(E||{}),J=(e=>(e.Finished="finished",e.Initialized="initialized",e.Timeout="timeout",e))(J||{});const Ps=Object.values({...o,...E,...J}),Ot=new Set(Object.values(o)),$t=new Set(Object.values(J));new Set(Object.values(E));function Oe(e){return Ot.has(e)}function Gt(e){return $t.has(e)}function Wt(e){return Oe(e.command)}function zt(e){return Gt(e.command)}function Ht(e){return Oe(e.command)}const _s=[];function j(e,t){if(e.length!==t.length)return console.log(e,t),!1;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return console.log(e,t),!1;return!0}const Xt={error:()=>!0,"keyboard interrupt":()=>!0,finished:()=>!0,initialized:()=>!0,timeout:()=>!0,sleep:(e,t)=>e.request.time_ms===t.request.time_ms,output:(e,t)=>e.request.output===t.request.output,"pin set value":(e,t)=>e.request.pin===t.request.pin&&e.request.value===t.request.value,"pin set mode":(e,t)=>e.request.pin===t.request.pin&&e.request.mode===t.request.mode,"pin set pull":(e,t)=>e.request.pin===t.request.pin&&e.request.pull===t.request.pull,"pwm freq":(e,t)=>e.request.pin===t.request.pin&&e.request.freq===t.request.freq,"pwm duty_u16":(e,t)=>e.request.pin===t.request.pin&&e.request.duty_u16===t.request.duty_u16,"display text":(e,t)=>e.request.x===t.request.x&&e.request.y===t.request.y&&e.request.text===t.request.text,"display clear":()=>!0,"i2c writefrom_mem":(e,t)=>e.request.addr===t.request.addr&&j(e.request.buf,t.request.buf)&&e.request.memaddr===t.request.memaddr&&e.request.scl===t.request.scl&&e.request.sda===t.request.sda,"neopixel write":(e,t)=>e.request.pin===t.request.pin&&e.request.pixels.every((s,a)=>j(s,t.request.pixels[a])==!0),"raw output":(e,t)=>e.request.output===t.request.output,"pin get value":(e,t)=>e.request.pin===t.request.pin&&e.result===t.result,"pin get mode":(e,t)=>e.request.pin===t.request.pin&&e.result===t.result,"pin get pull":(e,t)=>e.request.pin===t.request.pin&&e.result===t.result,"adc read_u16":(e,t)=>e.request.pin===t.request.pin&&e.result===t.result,"i2c readfrom_mem":(e,t)=>e.request.addr===t.request.addr&&e.request.memaddr===t.request.memaddr&&e.request.nbytes===t.request.nbytes&&e.request.scl===t.request.scl&&e.request.sda===t.request.sda&&j(e.result,t.result),"i2c scan":(e,t)=>e.request.scl===t.request.scl&&e.request.sda===t.request.sda&&j(e.result,t.result),input:(e,t)=>e.result===t.result,"ticks ms":(e,t)=>e.result===t.result,"BME280 __init__":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl,"BME280 read_temperature":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl&&e.result===t.result,"BME280 read_pressure":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl&&e.result===t.result,"BME280 read_humidity":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl&&e.result===t.result,"VL53L0X __init__":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl,"VL53L0X read":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl&&e.result===t.result,"VEML6040 __init__":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl,"VEML6040 readRGB":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl&&j(e.result,t.result),"MPU6050 __init__":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl,"MPU6050 read_accel":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl&&j(e.result,t.result),"MPU6050 read_gyro":(e,t)=>e.request.sda===t.request.sda&&e.request.scl===t.request.scl&&j(e.result,t.result),"random value":(e,t)=>e.result===t.result};function $e(e){return e.command==="pin set value"||e.command==="pin set pull"||e.command==="pin set mode"||e.command==="pwm duty_u16"||e.command==="pwm freq"||e.command==="neopixel write"||e.command==="pin get mode"||e.command==="pin get value"||e.command==="pin get pull"||e.command==="adc read_u16"}function Rs(e,t){if($e(e)){if(!t){if(e.meta&&e.meta.varName!==void 0)return e.meta.varName;if(e.meta&&e.meta.className!==void 0)return e.meta.className+" "+e.request.pin}return"Pin "+e.request.pin}return"BUG!!!"}function Ss(e,t,s){if(!s){if(t&&t.varName!==void 0)return t.varName;if(t&&t.className!==void 0)return t.className+" "+e.pin}return"Pin "+e.pin}const ye=new Map;function Kt(e){const t=w(0);let s=null;const a=w(""),r=65e3,n=new Uint8Array(r);let l=0,m=null;const h=new TextEncoder;let i=[],c="";const d=[],v=[],g=D=>{D=c+D,c="";const L=Array.from(D);let I=0;for(;I<L.length;){const Q=L[I];if(Q==="\b"){if(i.length>0){const U=i.pop();l=Math.max(0,l-U)}I++}else if(Q==="\x1B")if(I+2<L.length)if(L[I+1]==="["&&L[I+2]==="K"){const U=i.slice(0,t.value).reduce((x,f)=>x+f,0);n.fill(0,U,l),l=U,i.splice(t.value),M(),I+=3}else I++;else{c=L.slice(I).join("");break}else{const U=h.encode(Q);for(const x of U)l<r?n[l++]=x:(n.copyWithin(0,1),n[l-1]=x);i.push(U.length),t.value=i.length,I++}}M()},M=()=>{m||(m=setTimeout(()=>{S(),m=null},16))},S=()=>{const D=new TextDecoder().decode(n.subarray(0,l));a.value=D,t.value=i.length,q()},b=()=>{a.value="",l=0,t.value=0,i=[],m&&(clearTimeout(m),m=null)},q=()=>{s&&(s.scrollTop=s.scrollHeight)},A=D=>{s=D},G=D=>{a.value=D};function Y(){return d.length>0?Promise.resolve(d.shift()):new Promise(D=>{v.push(D)})}return{id:e,output:a,setStdout:G,caret:t,write:g,clear:b,openTerminal:A,readChar:Y,inputQueue:d,resolvers:v}}function Ge(e){return ye.has(e)||ye.set(e,Kt(e)),ye.get(e)}function Yt(e,t,s,a,r,n,l){const m=w(!1),h=w(!1),i=w(!1),c=w(!1),d=w(""),v=w(!1),g=is(),M=rs();let S,b,q;Y();function A(){return new Promise(f=>{h.value&&f(),Y();const u=ne(m,W=>{W||(u.stop(),f())})})}function G(){return new Promise(f=>{if(!m.value){f();return}const u=ne(m,W=>{W||(u(),f())})})}async function Y(){h.value||(m.value=!0,a(),S=new Worker(new URL("/assets/worker-I-I3LhjQ.js",import.meta.url),{type:"module"}),S.onmessage=async f=>{const{content:u,line:W}=f.data;switch(u.command){case E.Error:t(u.request.message),c.value=!0,d.value=u.request.message,i.value=!1,v.value=!1;break;case E.KeyboardInterrupt:t(u.request.message),i.value=!1,v.value=!1;break;case J.Initialized:b=u.request.sharedArrayInterrupt,q=u.request.sharedWakeupArray,m.value=!1;break;case J.Finished:i.value=!1,M.stop(),g.stop();break;case E.Output:t(u.request.output);break;case E.PinSetValue:r(u.request.pin,u.request);break;case E.PinSetMode:r(u.request.pin,u.request);break;case E.PinSetPull:r(u.request.pin,u.request);break;case E.PwmFreq:r(u.request.pin,{freq:u.request.freq});break;case E.PwmDutyU16:r(u.request.pin,{value:u.request.duty_u16/Ue});break;case E.DisplayText:{const{text:p,x:y,y:R}=u.request;s(p,y,R)}break;case E.DisplayClear:a();break;case E.I2CWriteToMem:{const p=l(u.request.sda,u.request.scl);p.address===u.request.addr&&p.write(u.request.memaddr,u.request.buf),u.request.buf=Array.from(u.request.buf)}break;case E.NeoPixelWrite:r(u.request.pin,{arr:u.request.pixels});break;case E.RawOutput:t(u.request.output);break}if(M.state.value==V.Continue)Wt(u)&&M.storeInputToResult(u)!=V.Continue&&(M.state.value=V.Finish,g.state.value=V.Finish);else switch(u.command){case o.Input:{const p=await e.readChar();Atomics.store(u.result,0,p)}break;case o.PinGetValue:n(u.request.pin).value>.4?Atomics.store(u.result,0,1):Atomics.store(u.result,0,0);break;case o.PinGetMode:{const p=n(u.request.pin);Atomics.store(u.result,0,p.mode)}break;case o.PinGetPull:{const p=n(u.request.pin);Atomics.store(u.result,0,p.pull)}break;case o.AdcReadU16:{const p=n(u.request.pin);Atomics.store(u.result,0,p.value*65535)}break;case o.I2CReadFromMem:{const{request:p,result:y}=u,R=l(p.sda,p.scl);R.address===p.addr?R.read(y,p.memaddr,p.nbytes):Atomics.store(y,p.nbytes,1)}break;case o.I2CScan:{const{request:p,result:y}=u,R=l(p.sda,p.scl);Atomics.store(y,0,R.address)}break;case o.BME280ReadTemperature:{const{request:p,result:y}=u,R=l(p.sda,p.scl);if(R.address===118){const{temperature:N}=R.fake_read();Atomics.store(y,0,N)}else Atomics.store(y,1,1)}break;case o.BME280ReadPressure:{const{request:p,result:y}=u,R=l(p.sda,p.scl);if(R.address===118){const{pressure:N}=R.fake_read();Atomics.store(y,0,N)}else Atomics.store(y,1,1)}break;case o.BME280ReadHumidity:{const{request:p,result:y}=u,R=l(p.sda,p.scl);if(R.address===118){const{humidity:N}=R.fake_read();Atomics.store(y,0,N)}else Atomics.store(y,1,1)}break;case o.VL53L0XRead:{const{request:p,result:y}=u,R=l(p.sda,p.scl);if(R.address===41){const{distance:N}=R.fake_read();Atomics.store(y,0,N)}else Atomics.store(y,1,1)}break;case o.VEML6040ReadRGB:{const{request:p,result:y}=u,R=l(p.sda,p.scl);if(R.address===16){const[N,re,ie]=R.fake_read();Atomics.store(y,0,N),Atomics.store(y,1,re),Atomics.store(y,2,ie)}else Atomics.store(y,3,1)}break;case o.MPU6050ReadAccel:{const{request:p,result:y}=u,R=l(p.sda,p.scl);if(R.address===104){const{ax:N,ay:re,az:ie}=R.fake_read();Atomics.store(y,0,N),Atomics.store(y,1,re),Atomics.store(y,2,ie)}else Atomics.store(y,3,1)}break;case o.MPU6050ReadGyro:{const{request:p,result:y}=u,R=l(p.sda,p.scl);if(R.address===104){const{gx:N,gy:re,gz:ie}=R.fake_read();Atomics.store(y,0,N),Atomics.store(y,1,re),Atomics.store(y,2,ie)}else Atomics.store(y,3,1)}break;case o.Random:{const p=Math.random();Atomics.store(u.result,0,Math.floor(p*65535))}break}zt(u)||g.pushResult(u,W)===V.Finish&&(M.state.value=V.Finish,g.state.value=V.Finish),q&&(Atomics.store(q,0,1),Atomics.notify(q,0,1))},h.value=!0)}function D(){for(let f=0;f<29;f++)r(f,{value:0,freq:0,mode:Ne.IN});a()}async function L(f){await G(),h.value||await A(),i.value=!0,c.value=!1,d.value="",b&&(b[0]=0,b[1]=0),S.postMessage({command:"runPython",code:f,isReplay:M.state.value==V.Continue,isRecord:g.state.value==V.Continue})}function I(){i.value&&(v.value=!0,b[0]=Te,b[1]=Te,e.resolvers.length&&e.resolvers.shift()(0)),v.value=!1}function Q(){return new Promise(f=>{if(i.value){I();const u=ne(i,W=>{W||(u.stop(),f())})}else f()})}function U(){S.terminate(),i.value=!1,m.value=!1,h.value=!1,c.value=!1,d.value="",S.onmessage=null}function x(){h.value&&U(),Y()}return{connect:Y,loadingPromise:G,connectPromise:A,reconnect:x,disconnect:U,stop:I,stopPromise:Q,run:L,reset:D,isLoading:m,isConnected:h,isRunning:i,isRunError:c,isStopping:v,recorder:g,replayer:M,runError:d}}class Pe{constructor(){P(this,"sharedEmulator",null);P(this,"simulations",new Map);P(this,"currentSimulationId",w(null))}registerSimulation(t,s){this.simulations.set(t,s),this.sharedEmulator||this.initializeSharedEmulator()}unregisterSimulation(t){this.simulations.delete(t),this.currentSimulationId.value===t&&(this.currentSimulationId.value=null)}initializeSharedEmulator(){const t={write:s=>{const a=this.getCurrentSimulation();a&&a.terminal.write(s)},readChar:async()=>{const s=this.getCurrentSimulation();return s?await s.terminal.readChar():0},get resolvers(){const s=Pe.prototype.getCurrentSimulation.call(xe);return s?s.terminal.resolvers:[]}};this.sharedEmulator=Yt(t,s=>{const a=this.getCurrentSimulation();a&&a.terminal.write(s)},(s,a,r)=>{const n=this.getCurrentSimulation();n&&n.display.writeText(s,a,r)},()=>{const s=this.getCurrentSimulation();s&&s.display.clearDisplay()},(s,a)=>{const r=this.getCurrentSimulation();r&&r.pibody.setPin(s,a)},s=>{const a=this.getCurrentSimulation();return a?a.pibody.getPin(s):{id:s,value:0,mode:Ne.IN,pull:lt.NONE,freq:0,arr:[]}},(s,a)=>{const r=this.getCurrentSimulation();return r?r.pibody.getI2C(s,a):{address:0,write:()=>{},read:()=>{},fake_read:()=>{}}})}getCurrentSimulation(){return this.currentSimulationId.value?this.simulations.get(this.currentSimulationId.value):null}getSharedEmulator(){return this.sharedEmulator||this.initializeSharedEmulator(),this.sharedEmulator}async run(t,s){var a;if(!this.simulations.has(t)){console.error(`Simulation ${t} not found`);return}(a=this.sharedEmulator)!=null&&a.isRunning.value&&await this.sharedEmulator.stopPromise(),this.currentSimulationId.value=t,this.sharedEmulator||this.initializeSharedEmulator(),await this.sharedEmulator.run(s)}async stop(){this.sharedEmulator&&await this.sharedEmulator.stopPromise()}getCurrentSimulationId(){return this.currentSimulationId.value}hasSimulation(t){return this.simulations.has(t)}getInstance(){return this.sharedEmulator}hasInstance(t){return this.simulations.has(t)}async stopOthers(t){this.currentSimulationId.value=t}}const xe=new Pe;function We(e){let t;switch(e.command){case o.PinGetValue:t=e.request.pin.toString();break;case o.PinGetMode:t=e.request.pin.toString();break;case o.PinGetPull:t=e.request.pin.toString();break;case o.AdcReadU16:t=e.request.pin.toString();break;case o.I2CScan:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.I2CReadFromMem:t=e.request.addr.toString()+";"+e.request.memaddr.toString()+";"+e.request.nbytes.toString()+";"+e.request.sda.toString()+";"+e.request.scl.toString();break;case o.Input:t="";break;case o.Ticks_ms:t="";break;case o.BME280ReadTemperature:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.BME280ReadPressure:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.BME280ReadHumidity:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.VL53L0XRead:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.VEML6040ReadRGB:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.MPU6050ReadAccel:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.MPU6050ReadGyro:t=e.request.sda.toString()+";"+e.request.scl.toString();break;case o.Random:t="";break}return JSON.stringify({command:e.command,str:t})}function Ms(e){const{command:t,str:s}=JSON.parse(e);let a;switch(t){case o.PinGetValue:{const r=Number(s);a={command:t,request:{pin:r}}}break;case o.PinGetMode:{const r=Number(s);a={command:t,request:{pin:r}}}break;case o.PinGetPull:{const r=Number(s);a={command:t,request:{pin:r}}}break;case o.AdcReadU16:{const r=Number(s);a={command:t,request:{pin:r}}}break;case o.I2CScan:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.I2CReadFromMem:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]),m=Number(r[2]),h=Number(r[3]),i=Number(r[4]);a={command:t,request:{addr:n,memaddr:l,nbytes:m,sda:h,scl:i}}}break;case o.Input:a={command:t,request:{}};break;case o.Ticks_ms:a={command:t,request:{}};break;case o.BME280ReadTemperature:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.BME280ReadPressure:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.BME280ReadHumidity:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.VL53L0XRead:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.VEML6040ReadRGB:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.MPU6050ReadAccel:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.MPU6050ReadGyro:{const r=s.split(";"),n=Number(r[0]),l=Number(r[1]);a={command:t,request:{sda:n,scl:l}}}break;case o.Random:a={command:t,request:{}};break}return a}function Jt(e){const t=[];for(const{content:s}of e)Ht(s)&&t.push(s);return t}const Ae=w(!1);function Qt(e){const t=Jt(e),s=new Map;for(const a of t){const r=We(a),n=s.get(r);n===void 0?s.set(r,[a.result]):n.push(a.result)}return s}function jt(e,t){const s=[];let a=!0;for(let r=0;r<e.length&&r<t.length;r++){const n=Zt(e[r].content,t[r].content);s.push({correct:n,expected:e[r],replayed:t[r]}),a&&(a=n)}for(let r=t.length;r<e.length;r++)a=!1,s.push({correct:!1,expected:e[r],replayed:null});return{feedback:s,success:a}}function Zt(e,t){if(e.command!==t.command)return!1;const s=Xt[e.command];return s(e,t)}const Ee=[o.PinGetValue,o.PinGetPull,o.PinGetMode,o.AdcReadU16,o.I2CScan,o.I2CReadFromMem,o.Input,o.Ticks_ms,o.BME280ReadTemperature,o.BME280ReadPressure,o.BME280ReadHumidity,o.VL53L0XRead,o.VEML6040ReadRGB,o.MPU6050ReadAccel,o.MPU6050ReadGyro,o.Random,E.I2CWriteToMem,E.PinSetValue,E.PwmDutyU16,E.PwmFreq,E.Output,E.Sleep,E.DisplayText,E.DisplayClear],es=e=>e.map((t,s)=>({...t,index:s}));async function ze(e,t,s,a){s.data.length<1&&(s.result={code:t,success:!1,expected:[],replayed:[],feedback:[],message:""}),Ae.value=!0;const r=await ss(e,t,s.data,a),n=s.data,l=i=>es(i).filter(c=>a?a.includes(c.content.command):!0),{feedback:m,success:h}=jt(l(n),l(r));return s.result={code:t,success:h,expected:n,replayed:r,feedback:m,message:""},await e.stopPromise(),Ae.value=!1,s.result}function Ts(e){return e!==void 0?e?"border-green-500":"border-red-500":"border-blue-500"}async function As(e,t,s,a=Ee){for(const r of s)await ze(e,t,r,a)}async function ts(e){const t=[];for(const s of e)if(s.url)try{const a=await fetch(s.url).then(r=>r.json());t.push({data:a,test:s})}catch{const a=[];s.name="test missing",t.push({data:a,test:s})}return t}async function Cs(e,t,s,a=Ee){const r=[];let n=!0;const l=await ts(s);if(!l.length)return{correct:!1,results:[]};a.length==0&&(a=Ee);const m=xe.getInstance();if(!m)return{correct:!1,results:[]};await xe.stop();for(const h of l){const i=await ze(m,t,h,a);if(r.push(i),n=i.success,!n)break}return{correct:n,results:r}}function ss(e,t,s,a){return new Promise(r=>{e.reset(),e.recorder.start(a,s.length);const n=Qt(s);e.replayer.start(n);const l=ne(e.replayer.state,()=>{if(e.replayer.state.value==V.Finish){e.recorder.stop();const m=e.recorder.getRecords();e.stopPromise(),r(m)}else if(e.replayer.state.value==V.Timeout){e.recorder.stop();const m=e.recorder.getRecords();m.push({content:{command:J.Timeout,request:{}},line:-1}),r(m)}l.stop()});e.run(t).then(()=>{e.replayer.restartTimeout()})})}const Ce=e=>e?"oklch(0.723 0.219 149.579)":"oklch(0.637 0.237 25.331)";function Is(e,t){const s=Ge(e),a=ht(e),r=ct(e),n=ut(e),l=w();function m(){for(let c=0;c<6;c++)r.slots[c].class="",r.slots[c].style={};for(const c of r.moduleComponents)c.class="",c.style={}}async function h(c){for(const[d,v]of t.feedback.entries())if(!v.correct){i(d),c[d].scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"});break}}async function i(c){r.reset(),n.code.value=t.code,s.clear(),m(),n.highlights.value=[],l.value=c,await Ke();let d=c;const v=t.feedback[d].replayed;if(v===null?d=t.replayed.length-1:d=v.index,v===null||t.replayed[d].line<0)return;for(let S=0;S<=d;S++)if(v!==null){const b=t.replayed[S].content;switch(b.command){case E.Error:s.write(b.request.message);break;case J.Initialized:break;case J.Finished:break;case E.Output:s.write(b.request.output);break;case E.PinSetValue:r.setPin(b.request.pin,b.request);break;case E.PinSetMode:r.setPin(b.request.pin,b.request);break;case E.PinSetPull:r.setPin(b.request.pin,b.request);break;case E.PwmFreq:r.setPin(b.request.pin,{freq:b.request.freq});break;case E.PwmDutyU16:r.setPin(b.request.pin,{value:b.request.duty_u16/65535});break;case E.DisplayText:{const{text:q,x:A,y:G}=b.request;a.writeText(q,A,G)}break;case E.DisplayClear:a.clearDisplay();break;case E.I2CWriteToMem:{const q=r.slots[r.pinToIndex[b.request.sda]];if(dt(q.with)){const A=q.with.i2c;A.address===b.request.addr&&A.write(b.request.memaddr,b.request.buf)}}break;case E.NeoPixelWrite:r.setPin(b.request.pin,{arr:b.request.pixels});break;case o.PinGetValue:r.setPinWith(b.request.pin,{value:b.result});break;case o.PinGetMode:r.setPinWith(b.request.pin,{mode:b.result});break;case o.PinGetPull:r.setPinWith(b.request.pin,{pull:b.result});break;case o.AdcReadU16:r.setPinWith(b.request.pin,{value:b.result/Ue});break}}const g=t.replayed[d].content,M=t.replayed[d].line;if(n.highlights.value=[{line:M,color:Ce(t.feedback[c].correct)}],g!=null&&$e(g)){const S=r.getSlotByPinId(g.request.pin);S.style={outlineStyle:"solid",outlineColor:Ce(t.feedback[c].correct),outlineWidth:"4px"}}}return{selectNode:i,selectedIndex:l,firstError:h}}var V=(e=>(e[e.None=0]="None",e[e.Continue=1]="Continue",e[e.Finish=2]="Finish",e[e.Timeout=3]="Timeout",e[e.Error=4]="Error",e))(V||{});function rs(){let e=new Map,t=new Map;const s=w(0);let a=0,r=null;function n(){r&&clearTimeout(r),r=setTimeout(()=>{s.value=3},a)}return{storeInputToResult:i=>{n();const c=We(i);let d=t.get(c);d||(d=0);const v=e.get(c);if(!v||v.length===0||d>=v.length)return 2;const g=v[d];switch(i.command){case o.AdcReadU16:Atomics.store(i.result,0,g);break;case o.PinGetMode:Atomics.store(i.result,0,g);break;case o.PinGetPull:Atomics.store(i.result,0,g);break;case o.PinGetValue:Atomics.store(i.result,0,g);break;case o.I2CScan:for(let q=0;q<v.length;q++)Atomics.store(i.result,q,g);break;case o.I2CReadFromMem:const M=g;for(let q=0;q<M.length;q++)Atomics.store(i.result,q,M[q]);break;case o.Input:new TextEncoder().encode(g).forEach((q,A)=>Atomics.store(i.result,A,q));break;case o.BME280ReadTemperature:Atomics.store(i.result,0,g);break;case o.BME280ReadPressure:Atomics.store(i.result,0,g);break;case o.BME280ReadHumidity:Atomics.store(i.result,0,g);break;case o.VL53L0XRead:Atomics.store(i.result,0,g);break;case o.VEML6040ReadRGB:{const q=g;Atomics.store(i.result,0,q[0]),Atomics.store(i.result,1,q[1]),Atomics.store(i.result,2,q[2])}break;case o.MPU6050ReadAccel:{const q=g;Atomics.store(i.result,0,q[0]),Atomics.store(i.result,1,q[1]),Atomics.store(i.result,2,q[2])}break;case o.MPU6050ReadGyro:{const q=g;Atomics.store(i.result,0,q[0]),Atomics.store(i.result,1,q[1]),Atomics.store(i.result,2,q[2])}break;case o.Ticks_ms:Atomics.store(i.result,0,g);break;case o.Random:Atomics.store(i.result,0,g);break}return t.set(c,d+1),1},restartTimeout:n,start:(i,c=200)=>{e=i,t=new Map,s.value=1,a=c},stop:()=>{s.value=2},state:s}}let ce=!1,we=!1,Z="";function is(){let e=[];const t=w(0);let s,a,r=0;return{pushResult:(i,c)=>{if(t.value==1){let d=0,v;switch(i.command){case o.AdcReadU16:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.I2CReadFromMem:d=Array.from(i.result).slice(0,-1),v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.PinGetMode:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.PinGetPull:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.PinGetValue:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.I2CScan:d=Array.from(i.result),v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.Input:if(i.result.length>4){const g=new Uint8Array(i.result.length);let M=0;for(let q=0;q<i.result.length;q++){const A=Atomics.load(i.result,q);if(A==0)break;g[q]=A,M++}const b=new TextDecoder().decode(g.subarray(0,M));v={command:o.Input,request:i.request,result:b,meta:i.meta};break}if(ce=!0,d=i.result[0],ce){if(d===8){Z.length>0&&(Z=Z.substring(0,Z.length-1));break}Z+=String.fromCharCode(d),d===10&&(v={command:o.Input,request:i.request,result:Z,meta:i.meta},Z="",ce=!1,we=!0)}break;case o.Ticks_ms:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.BME280ReadTemperature:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.BME280ReadPressure:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.BME280ReadHumidity:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.VL53L0XRead:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.VEML6040ReadRGB:d=[i.result[0],i.result[1],i.result[2]],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.MPU6050ReadAccel:d=[i.result[0],i.result[1],i.result[2]],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.MPU6050ReadGyro:d=[i.result[0],i.result[1],i.result[2]],v={command:i.command,request:i.request,result:d,meta:i.meta};break;case o.Random:d=i.result[0],v={command:i.command,request:i.request,result:d,meta:i.meta};break;default:v=i;break}return ce?1:we&&i.command!=o.Input?(we=!1,1):(e.push({content:v,line:c}),(!a||a.includes(i.command))&&r++,s&&r>=s?2:1)}return 2},getRecords:()=>e,start:(i,c)=>{s=c,a=i,r=0,e=[],t.value=1},stop:()=>{t.value=2},state:t}}const as={class:"flex flex-col h-full"},ns={class:"flex px-2 w-full bg-zinc-900 text-white h-6 justify-between items-center"},os=De({__name:"Terminal",props:{id:{}},setup(e){const t=e,s=w(!1),a=Ge(t.id),r=w("");let n=null;const l=()=>{var i,c;((i=a==null?void 0:a.output)==null?void 0:i.value)!==r.value&&(r.value=((c=a==null?void 0:a.output)==null?void 0:c.value)||"")};ne(()=>{var i;return(i=a==null?void 0:a.output)==null?void 0:i.value},i=>{r.value=i||""},{immediate:!0});function m(i){let c=i.key;if(c==="Enter")c=`
\r`;else if(c==="Backspace")c="\b";else if(c.length>1)return;if(C.value)a.write(c);else{const d=c.charCodeAt(0);a.resolvers.length?a.resolvers.shift()(d):a.inputQueue.push(d)}}const h=w(null);return Ye(()=>{var i;a&&(a.openTerminal(h.value),r.value=((i=a.output)==null?void 0:i.value)||"",n=setInterval(l,100))}),Je(()=>{n&&clearInterval(n)}),(i,c)=>{const d=Be;return F(),ee("div",as,[T("div",ns,[c[4]||(c[4]=T("div",{class:"flex items-center gap-1"},[T("span",{class:"material-icons"},"terminal"),T("span",{class:"text-sm"},"Console")],-1)),z(d,{onClick:c[0]||(c[0]=v=>{var g;return(g=k(a))==null?void 0:g.clear()}),class:"w-4 h-4 text-white",link:""},{default:H(()=>c[3]||(c[3]=[T("span",{class:"material-icons",style:{"font-size":"16px"}},"cleaning_services",-1)])),_:1})]),T("pre",{class:"h-full font-mono overflow-auto p-2 text-white bg-black",ref_key:"el",ref:h,tabindex:"0",onKeydown:m,onFocus:c[1]||(c[1]=v=>s.value=!0),onBlur:c[2]||(c[2]=v=>s.value=!1)},[T("span",null,be(r.value),1),T("span",{class:qe([{caret:s.value},"bg-white"])}," ",2)],544)])}}}),Ds=ft(os,[["__scopeId","data-v-87555b36"]]),ls={class:"border flex justify-center items-center rounded mb-2 space-x-2"},cs={key:0,class:"material-icons"},us={key:1,class:"material-icons"},ds={key:0,class:"material-icons"},fs={key:1,class:"material-icons"},ms={class:"relative inline-block"},ps={key:1,class:"absolute top-0 right-0 block h-3 w-3 rounded-full bg-red-500 border-2 border-white"},hs={class:"flex items-center gap-4 mb-8"},vs={class:"flex justify-end gap-2"},ys={class:"flex items-center gap-4 mb-8"},ws={class:"flex justify-end gap-2"},Bs=De({__name:"IdeButtons",props:{code:{default:""},codeModifiers:{},filePath:{default:""},filePathModifiers:{},showBluetooth:{type:Boolean,default:!1},showBluetoothModifiers:{}},emits:Qe(["terminal-write","terminal-clear"],["update:code","update:filePath","update:showBluetooth"]),setup(e,{emit:t}){const s=st(),a=je(),{t:r}=Ze(),n=me(e,"code"),l=me(e,"filePath"),m=me(e,"showBluetooth"),h=w(""),i=w(""),c=t,d=x=>{c("terminal-write",x)};async function v(x){try{const f=await Dt(x);if(!f)return;await Bt(f,d,()=>{}),await Q(),h.value=x}catch(f){let u=f instanceof Error?f.message:r("pages.ide.errors.unknownConnectionError");O.value==="PORT_ALREADY_OPEN"?u=r("pages.ide.errors.portBusyError"):O.value==="WS_IOS_NOT_SUPPORTED"?u=r("pages.ide.errors.wsIOSError"):O.value==="WS_UNSECURE_CONNECTION"?u=r("pages.ide.errors.wsUnsecureError"):O.value==="WS_NOT_SUPPORTED"&&(u=r("pages.ide.errors.wsNotSupportedError")),a.add({severity:"error",summary:r("pages.ide.errors.connectionError"),detail:u,life:5e3});return}}async function g(){var x;try{await Tt()}catch{await le();const f=((x=de.value)==null?void 0:x.message)||r("pages.ide.errors.updateLibrariesFailed");a.add({severity:"error",summary:r("pages.ide.errors.updateError"),detail:f,life:5e3});return}c("terminal-clear")}function M(x){C.value?le():v(x)}const S=w(!1);function b(){Nt(n.value)}function q(x){return/\.[^\/\\]+$/.test(x)?x:`${x}.py`}const A=w(!1);function G(x,f){x?Ft(x,f):A.value=!0}function Y(){A.value=!1}function D(){const x=q(l.value);G(x,n.value),A.value=!1}let L=!1;const I=w(!1);async function Q(){const x=await Ve();x.includes(nt)?(await Me("/libs"),await Me("/Demo"),await Vt("pibody.py"),await g(),i.value="pibody"):x.includes(ot)?i.value="atlas":x==""?le():(le(),L=!0,I.value=!0)}function U(){const x=s.resolve({path:"/v2/lesson/"+rt,query:{route_id:it}}).href;window.open(x,"_blank")}return(x,f)=>{const u=Be,W=mt,p=at;return F(),ee("div",null,[et(T("div",ls,[T("p",null,be(x.$t("pages.ide.updating")),1),T("div",null,[z(k(pt),{class:"w-7 h-7"})])],512),[[tt,k(te)]]),T("div",null,[k(C)?(F(),ae(u,{key:0,id:"#run",type:"button",class:"w-9 h-9 mr-1",variant:k(B)||!k(C)?"outlined":void 0,severity:"info",rounded:"",onClick:b,disabled:k(B)||!k(C),loading:k(B)},{default:H(()=>f[11]||(f[11]=[T("span",{class:"material-icons"},"play_arrow",-1)])),_:1},8,["variant","disabled","loading"])):se("",!0),k(C)?(F(),ae(u,{key:1,type:"button",class:"w-9 h-9 mr-1",variant:!k(B)||!k(C)?"outlined":void 0,severity:"danger",rounded:"",onClick:f[0]||(f[0]=y=>k(Ut)()),disabled:!k(B)||!k(C)},{default:H(()=>f[12]||(f[12]=[T("span",{class:"material-icons"},"stop",-1)])),_:1},8,["variant","disabled"])):se("",!0),k(C)?(F(),ae(u,{key:2,type:"button",class:"w-9 h-9",variant:"outlined",severity:"secondary",rounded:"",onClick:f[1]||(f[1]=y=>G(l.value,n.value)),disabled:k(K)||k(X)||k(te)||k(B)||!k(C),loading:k(K)||k(X)||k(te)},{default:H(()=>f[13]||(f[13]=[T("span",{class:"material-icons"},"save",-1)])),_:1},8,["disabled","loading"])):se("",!0),m.value?(F(),ae(u,{key:3,type:"button",class:qe(["w-9 h-9 mr-1 text-white",[k(C)?S.value?"bg-red-500":"bg-green-500":"bg-gray-600",k(C)&&h.value!=="ble"?"hidden":""]]),rounded:"",text:"",onClick:f[2]||(f[2]=y=>M("ble")),onMouseover:f[3]||(f[3]=y=>S.value=!0),onMouseleave:f[4]||(f[4]=y=>S.value=!1),loading:k(K)||k(X)||k(te)},{default:H(()=>[S.value&&k(C)?(F(),ee("span",cs,"close")):(F(),ee("span",us,"bluetooth"))]),_:1},8,["class","loading"])):se("",!0),z(u,{type:"button",class:qe(["w-9 h-9 mr-1 text-white",[k(C)?S.value?"bg-red-500":"bg-green-500":"bg-gray-600",k(C)&&h.value!=="usb"?"hidden":""]]),rounded:"",text:"",onClick:f[5]||(f[5]=y=>M("usb")),onMouseover:f[6]||(f[6]=y=>S.value=!0),onMouseleave:f[7]||(f[7]=y=>S.value=!1),loading:k(K)||k(X)||k(te)},{default:H(()=>[S.value&&k(C)?(F(),ee("span",ds,"close")):(F(),ee("span",fs,"cable"))]),_:1},8,["class","loading"]),T("div",ms,[k(L)?(F(),ae(u,{key:0,type:"button",class:"w-9 h-9 mr-1",variant:"outlined",severity:"warn",rounded:"",onClick:U},{default:H(()=>f[14]||(f[14]=[T("span",{class:"material-icons"},"system_update_alt",-1)])),_:1})):se("",!0),k(L)?(F(),ee("span",ps)):se("",!0)])]),z(p,{visible:A.value,"onUpdate:visible":f[9]||(f[9]=y=>A.value=y),modal:"",header:x.$t("pages.ide.filename"),style:{width:"25rem"}},{default:H(()=>[T("div",hs,[z(W,{id:"filename",modelValue:l.value,"onUpdate:modelValue":f[8]||(f[8]=y=>l.value=y),class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),T("div",vs,[z(u,{type:"button",label:"Cancel",severity:"secondary",onClick:Y}),z(u,{disabled:!l.value,type:"button",label:"Save",onClick:D},null,8,["disabled"])])]),_:1},8,["visible","header"]),z(p,{visible:I.value,"onUpdate:visible":f[10]||(f[10]=y=>I.value=y),modal:"",header:x.$t("pages.ide.oldFirmware"),style:{width:"25rem"}},{default:H(()=>[T("div",ys,be(x.$t("pages.ide.oldFirmwareText")),1),T("div",ws,[z(u,{type:"button",label:x.$t("pages.ide.go"),onClick:U},null,8,["label"])])]),_:1},8,["visible","header"])])}}});export{o as I,E as O,V as R,J as T,Bs as _,ht as a,Ss as b,Cs as c,Qt as d,xe as e,Ms as f,ts as g,Ee as h,Is as i,Ps as j,As as k,Lt as l,Ae as m,ze as n,Ts as o,_s as p,Ds as q,ss as r,C as s,Ge as u,Rs as v};
