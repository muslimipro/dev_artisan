import{s as R,a as K}from"./index-kUo8DtFK.js";import{a as L,b as z}from"./index-BffwYWps.js";import{s as M}from"./index-C48zRprc.js";import{e as U,aa as G,ab as H,u as E,r as c,D as J,o as f,q as C,w as o,k as r,t as u,i as l,y as S,I as Q,g as W,f as X,h as Y,c as N,v as B,j as w,l as T,x as Z,aN as ee}from"./index-DrRumHoQ.js";import{C as D,m as ae}from"./mapClassFromDto-ByaLzb_u.js";import{s as se}from"./index-BKkVWFsp.js";import"./index-DjQFJnoV.js";import"./index-D-t7ilJh.js";import"./index-BzRn24Gq.js";import"./index-D_MVTTrq.js";import"./index-CfS82_u7.js";import"./index-C7Lnsry6.js";import"./index-BwPWftOE.js";import"./index-BMovUAwj.js";import"./index-BUc4_QyG.js";const le={class:"flex flex-col gap-1"},te={class:"flex flex-col"},oe={class:"font-bold text-sm mb-1"},re={class:"flex gap-2 justify-end"},ne=U({__name:"EditClassDialog",props:G({selectedClass:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const m=H(k,"modelValue"),p=k,g=E(),t=c(""),i=c(!1);J(()=>p.selectedClass,e=>{t.value="",e&&(t.value=e.name)},{immediate:!0});async function V(){i.value=!0;try{const{data:e}=await D.createClass(t.value);window.location.reload(),g.add({severity:"success",summary:e.message,life:2e3}),m.value=!1}catch(e){g.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{i.value=!1}}async function h(){if(p.selectedClass){i.value=!0;try{const{data:e}=await D.updateClassById(p.selectedClass.id,t.value);window.location.reload(),g.add({severity:"success",summary:e.message,life:2e3}),m.value=!1}catch(e){g.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{i.value=!1}}}return(e,d)=>{const _=M,y=se,v=S,x=Q;return f(),C(x,{visible:m.value,"onUpdate:visible":d[2]||(d[2]=a=>m.value=a),modal:"",draggable:!1,class:"m-4 max-w-md",header:p.selectedClass?e.$t("pages.teacher.editClass"):e.$t("pages.teacher.addClass")},{default:o(()=>[r("div",le,[r("div",te,[r("div",oe,u(e.$t("pages.teacher.name")),1),l(_,{type:"text",modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=a=>t.value=a)},null,8,["modelValue"])]),l(y),r("div",re,[l(v,{label:e.$t("pages.teacher.cancel"),severity:"secondary",onClick:d[1]||(d[1]=a=>m.value=!1)},null,8,["label"]),p.selectedClass==null?(f(),C(v,{key:0,label:e.$t("pages.teacher.create"),onClick:V,loading:i.value,disabled:i.value},null,8,["label","loading","disabled"])):(f(),C(v,{key:1,label:e.$t("pages.teacher.save"),onClick:h,loading:i.value,disabled:i.value},null,8,["label","loading","disabled"]))])])]),_:1},8,["visible","header"])}}}),ie={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},de={class:"flex items-center"},ue={class:"flex-grow flex gap-2 items-center"},ce={key:0,class:"text-2xl"},me={class:"flex gap-2"},Be=U({__name:"ClassesPage",setup(k){const m=E(),p=Z(),g=c(),t=c();(()=>{t.value={global:{value:null,matchMode:ee.CONTAINS}}})();const V=W(),{userInfo:h}=X(V),e=c(!1),d=c(null);function _(a){e.value=!0,d.value=a}const y=c([]),v=c(!1);async function x(){try{v.value=!0;const{data:a}=await D.getClasses();y.value=(a==null?void 0:a.map(ae))??[]}catch(a){m.add({severity:"error",summary:a.response.data.error,life:2e3})}finally{v.value=!1}}return Y(()=>{x()}),(a,n)=>{const I=S,P=L,j=M,q=z,$=R,A=K;return f(),N("div",ie,[l(A,{ref_key:"dt",ref:g,filters:t.value,"onUpdate:filters":n[2]||(n[2]=s=>t.value=s),value:y.value,dataKey:"id",loading:v.value,scrollable:"",globalFilterFields:["name","email"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:o(()=>{var s;return[r("div",de,[r("div",ue,[y.value?(f(),N("div",ce,u(a.$t("pages.teacher.classes"))+" - "+u(y.value.length),1)):B("",!0)]),((s=w(h))==null?void 0:s.user_type)=="teacher"?(f(),C(I,{key:0,label:a.$t("pages.teacher.addClass"),icon:"pi pi-plus",variant:"outlined",class:"mr-2",onClick:n[0]||(n[0]=b=>_(null))},null,8,["label"])):B("",!0),l(q,null,{default:o(()=>[l(P,null,{default:o(()=>n[4]||(n[4]=[r("i",{class:"pi pi-search"},null,-1)])),_:1}),l(j,{modelValue:t.value.global.value,"onUpdate:modelValue":n[1]||(n[1]=b=>t.value.global.value=b),placeholder:a.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]}),empty:o(()=>[T(u(a.$t("pages.teacher.noClassesFound")),1)]),loading:o(()=>[T(u(a.$t("pages.teacher.loadingClasses")),1)]),default:o(()=>[l($,{field:"name",header:a.$t("pages.teacher.name"),sortable:""},{body:o(({data:s})=>[r("div",null,u(`${s.name}`),1)]),_:1},8,["header"]),l($,{field:"creator_name",header:a.$t("pages.teacher.classTeacher"),sortable:""},{body:o(({data:s})=>[r("div",null,u(`${s.creatorName??s.creatorEmail}`),1)]),_:1},8,["header"]),l($,{field:"student_count",header:a.$t("pages.teacher.students"),sortable:""},{body:o(({data:s})=>[r("div",null,u(`${s.studentCount}`),1)]),_:1},8,["header"]),l($,{exportable:!1},{body:o(({data:s})=>{var b;return[r("div",me,[((b=w(h))==null?void 0:b.user_type)=="teacher"?(f(),C(I,{key:0,icon:"pi pi-pencil",outlined:"",rounded:"",severity:"warn",onClick:O=>_(s)},null,8,["onClick"])):B("",!0),l(I,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:O=>{var F;return w(p).push({name:((F=w(h))==null?void 0:F.user_type)=="teacher"?"teacher-class":"school-class",params:{id:s.id}})}},null,8,["onClick"])])]}),_:1})]),_:1},8,["filters","value","loading"]),l(ne,{"model-value":e.value,"onUpdate:modelValue":n[3]||(n[3]=s=>e.value=s),"selected-class":d.value},null,8,["model-value","selected-class"])])}}});export{Be as default};
