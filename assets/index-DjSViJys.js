import{s as Ne,a as Be}from"./index-DdB-repW.js";import{_ as Le}from"./MainHeader.vue_vue_type_script_setup_true_lang-BKaehogJ.js";import{d as _e,r as $,e as G,o,c as n,j as e,k as s,t as a,G as m,b as re,F as L,l as N,v as R,n as ee,q as B,w as x,p as Z,i as f,y as $e,u as Ce,$ as Ae,f as ue,h as je,D as me,C as ze}from"./index-BExCL5fg.js";import{_ as Oe}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-ObZpTFyv.js";import{l as Ge,O as D,o as z,v as ve,b as O,M as oe,m as fe,P as le,p as pe,d as se,e as Ee,I as S,i as U,f as We,g as He,h as Pe,j as Je,k as ge,a as Ke,n as Qe,u as Xe,q as Ye,r as ye,s as Ze,t as et,w as F,x as tt,y as st,z as xe,R as ae,A as be}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DsGHl5t7.js";import{s as de}from"./index-DwEp-KeZ.js";import{s as at}from"./index-CzwqxCFH.js";import{s as ot}from"./index-DF9gIomh.js";import{s as lt}from"./index-CwQ0Tyvh.js";import{C as Y}from"./cloudStorageApi-BvMPR8qa.js";import{U as he}from"./unitApi-D0Lt0use.js";import{m as nt}from"./mapUnitFromDto-BRBO9875.js";import{u as rt}from"./index-CqC99Ri3.js";import"./index-D0DOKGO5.js";import"./index-CgT0AvWL.js";import"./index-BblCiuMk.js";import"./logo-D1-3uCnC.js";import"./SimulationView-MEi_oct2.js";import"./index-D1YpQv8F.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CJopk5W9.js";import"./index-Db17F87Z.js";import"./index-DVI9NTun.js";import"./index-Bkjpn_4P.js";import"./index-CRAr9efT.js";import"./index-CTZB2cNG.js";import"./index-Ch9fKmur.js";const dt=_e("useMPDeviceStore",()=>{const t=$(localStorage.getItem("fileContent")||""),u=$(""),c=$(""),b=$(!1),i=$([]);async function w(p,_){i.value=[p],c.value=p,t.value=_}async function l(p){i.value=[p],c.value=p,t.value=await Ge(p)}function M(p){t.value=p}return{isProject:b,activeFiles:i,fileContent:t,fileName:u,filePath:c,openFile:w,loadFile:l,setCode:M}}),it={key:0,class:"text-nowrap"},ct={key:0,class:"text-white"},ut={key:1,class:"text-white"},mt={key:2,class:"text-white"},vt={key:3,class:"text-white"},ft={key:4,class:"text-white"},pt={key:5,class:"text-black w-full"},gt={class:"text-center font-mono px-1 text-white bg-black"},yt={key:6,class:"text-black w-full"},xt={class:"text-center font-mono px-1 text-white bg-black"},bt={key:7,class:"text-black w-full p-3"},ht={key:8,class:"text-white w-full"},wt={key:9,class:"text-white w-full"},kt={key:10,class:"text-white w-full"},_t={key:11,class:"text-white w-full"},$t={key:12,class:"text-black w-full"},Ct={class:"text-center font-mono px-1 text-white bg-black"},Pt={key:13,class:"text-white"},qt={key:14,class:"text-black w-full"},St={key:1,class:"text-center p-3"},ne=G({__name:"FeedbackNode",props:{message:{type:Object,required:!0}},setup(t){return(u,c)=>t.message?(o(),n("div",it,[t.message.command===e(D).PinSetValue?(o(),n("div",ct,[s("div",{style:m({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" set value",5),s("div",{style:m(e(O)(t.message.request.value)),class:"text-center font-mono px-1"}," Value "+a(e(ve)(t.message.request.value)),5)])):t.message.command===e(D).PinSetMode?(o(),n("div",ut,[s("div",{style:m({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" set mode",5),s("div",{style:m({background:e(fe)[t.message.request.mode]}),class:"text-center font-mono px-1"}," Mode "+a(e(oe)[t.message.request.mode]),5)])):t.message.command===e(D).PinSetPull?(o(),n("div",mt,[s("div",{style:m({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" set pull",5),s("div",{style:m({background:e(pe)[t.message.request.pull]}),class:"text-center font-mono px-1"}," Pull "+a(e(le)[t.message.request.pull]),5)])):t.message.command===e(D).PwmDutyU16?(o(),n("div",vt,[s("div",{style:m({background:e(z)}),class:"text-center font-mono px-1"},"PWM "+a(t.message.request.pin)+" set duty",5),s("div",{style:m(e(O)(t.message.request.duty_u16/e(se))),class:"text-center font-mono px-1"}," u16 "+a(t.message.request.duty_u16),5)])):t.message.command===e(D).PwmFreq?(o(),n("div",ft,[s("div",{style:m({background:e(z)}),class:"text-center font-mono px-1"},"PWM "+a(t.message.request.pin)+" set freq",5),s("div",{style:m(e(O)(t.message.request.freq/e(se))),class:"text-center font-mono px-1"}," Freq "+a(t.message.request.freq),5)])):t.message.command===e(D).Output?(o(),n("div",pt,[c[0]||(c[0]=s("div",{class:"text-center px-1"},"Print",-1)),s("div",gt,a(t.message.request.output),1)])):t.message.command===e(D).Sleep?(o(),n("div",yt,[c[1]||(c[1]=s("div",{class:"text-center px-1"},"Sleep",-1)),s("div",xt,a(t.message.request.time_ms)+" ms",1)])):t.message.command===e(Ee).Timeout?(o(),n("div",bt," Timeout ")):t.message.command===e(S).PinGetValue?(o(),n("div",ht,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" get value",5),s("div",{style:m(e(O)(t.message.result)),class:"text-center font-mono px-1"}," Value "+a(e(ve)(t.message.result)),5)])):t.message.command===e(S).PinGetMode?(o(),n("div",wt,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" get mode",5),s("div",{style:m({background:e(fe)[t.message.result]}),class:"text-center font-mono px-1"}," Mode "+a(e(oe)[t.message.result]),5)])):t.message.command===e(S).PinGetPull?(o(),n("div",kt,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" get pull",5),s("div",{style:m({background:e(pe)[t.message.result]}),class:"text-center font-mono px-1"}," Pull "+a(e(le)[t.message.result]),5)])):t.message.command===e(S).AdcReadU16?(o(),n("div",_t,[s("div",{style:m({background:e(U)}),class:"text-center font-mono px-1"},"ADC "+a(t.message.request.pin)+" read",5),s("div",{style:m(e(O)(t.message.result/e(se))),class:"text-center font-mono px-1"}," u16 "+a(t.message.result),5)])):t.message.command===e(S).Input?(o(),n("div",$t,[c[2]||(c[2]=s("div",{class:"text-center px-1"},"Input",-1)),s("div",Ct,a(t.message.result),1)])):t.message.command===e(D).NeoPixelWrite?(o(),n("div",Pt,[s("div",{style:m({background:e(z)}),class:"text-center font-mono px-1"},"Pin "+a(t.message.request.pin)+" write pixels",5),s("div",{style:m(e(O)(0)),class:"text-center font-mono px-1"}," pixels("+a(t.message.request.pixels.length)+") ",5)])):(o(),n("div",qt," Todo: "+a(t.message.command),1))])):(o(),n("div",St," Nothing "))}}),It={class:"flex-col overflow-auto"},Tt={class:"flex"},Ft={key:0,class:"flex text-white border-2 border-blue-500"},Ut={class:"text-black text-nowrap"},Mt={key:1,class:"flex text-white border-2 border-blue-500"},Vt={class:"text-black text-nowrap"},Dt={key:2,class:"flex text-white border-2 border-blue-500"},Rt={class:"text-black text-nowrap"},Nt={key:3,class:"flex text-white border-2 border-blue-500"},Bt={class:"text-black text-nowrap"},Lt={key:4,class:"flex text-white border-2 border-blue-500"},At={class:"text-black text-nowrap"},jt={key:5,class:"flex text-black border-2 border-blue-500"},qe=G({__name:"Inputs",props:{inputs:{}},setup(t){const u=re(()=>{const c=[];for(let[b,i]of t.inputs){const w=We(b);c.push({...w,result:i})}return c});return(c,b)=>(o(),n(L,null,[u.value.length===0?(o(),n(L,{key:0},[N("Nothing")],64)):R("",!0),s("div",It,[(o(!0),n(L,null,ee(u.value,i=>(o(),n("div",Tt,[i.command===e(S).PinGetValue?(o(),n("div",Ft,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),s("div",Ut,a(i.result),1)])):i.command===e(S).PinGetMode?(o(),n("div",Mt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),s("div",Vt,a(i.result.map(w=>e(oe)[w])),1)])):i.command===e(S).PinGetPull?(o(),n("div",Dt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Pin "+a(i.request.pin)+" get values:",5),s("div",Rt,a(i.result.map(w=>e(le)[w])),1)])):i.command===e(S).AdcReadU16?(o(),n("div",Nt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+a(i.request.pin)+" read u16:",5),s("div",Bt,a(i.result),1)])):i.command===e(S).Input?(o(),n("div",Lt,[s("div",{style:m({background:e(U)}),class:"text-center text-nowrap font-mono px-1"},"Console input:",4),s("div",At,a(i.result),1)])):(o(),n("div",jt,"TODO: "+a(i.command),1))]))),256))])],64))}}),zt={class:"flex items-center gap-2"},Ot={class:"font-bold"},Gt={class:"flex"},Et=["onClick"],Wt={class:"text-center"},Ht={key:0,class:"text-center"},Jt={key:0,class:"flex items-center justify-center h-20"},Kt=G({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(t){const u=t,{selectNode:c,selectedIndex:b,firstError:i}=He(u.id,u.result),w=re(()=>Pe(u.result.replayed)),l=$(null),M=$([]);return(p,_)=>{const P=$e,A=de;return o(),B(A,null,{header:x(()=>[s("div",zt,[s("div",Ot,a(p.$t("result")),1),u.result.success===!1?(o(),B(P,{key:0,severity:"danger",onClick:_[0]||(_[0]=g=>e(i)(M.value))},{default:x(()=>[N(a(p.$t("first error")),1)]),_:1})):R("",!0)])]),default:x(()=>[s("div",{ref_key:"scrollContainer",ref:l,class:"flex overflow-auto mb-2"},[(o(!0),n(L,null,ee(u.result.feedback,(g,q)=>{var E,j;return o(),n("div",Gt,[s("button",{class:Z(["flex",e(b)===q?"border border-blue-500":""]),onClick:K=>e(c)(q),ref_for:!0,ref:K=>M.value[q]=K},[s("div",Wt,[N(a(g.correct?p.$t("correct"):p.$t("incorrect"))+" ",1),f(ne,{message:(E=g.replayed)==null?void 0:E.content,class:Z(["border-4 rounded-md",g.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),g.correct?R("",!0):(o(),n("div",Ht,[_[1]||(_[1]=N(a("Expected")+" ")),f(ne,{message:(j=g.expected)==null?void 0:j.content,class:Z(["border-4 rounded-md",g.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,Et),q+1<u.result.feedback.length?(o(),n("div",Jt,"→")):R("",!0)])}),256))],512),_[2]||(_[2]=N(" Input used: ")),f(qe,{inputs:w.value},null,8,["inputs"])]),_:1})}}}),Qt={class:"flex overflow-auto mb-2"},Xt={class:"text-center"},Yt={key:0,class:"flex items-center justify-center h-12"},we=G({__name:"TestDataTimeline",props:{data:{}},setup(t){const u=re(()=>Pe(t.data));return(c,b)=>{const i=de;return o(),B(i,{header:"Expected"},{default:x(()=>[s("div",Qt,[(o(!0),n(L,null,ee(c.data,(w,l)=>(o(),n("div",{class:"flex",key:l},[s("div",Xt,[f(e(ne),{message:w.content,class:"border-4 border-blue-500"},null,8,["message"])]),l+1<c.data.length?(o(),n("div",Yt,"→")):R("",!0)]))),128))]),b[0]||(b[0]=N(" Inputs: ")),f(e(qe),{inputs:u.value},null,8,["inputs"])]),_:1})}}}),Zt=_e("tester-store",()=>{const t=Ce(),u=$(null),c=$(!1),b=$(!1),i=$(!1);function w(p){i.value=p}async function l(p,_){try{c.value=!0;const{data:P}=await he.getUnitByIdandLessonId(p,_);u.value=nt(P)}catch(P){t.add({severity:"error",summary:P.response.data.error,life:2e3})}finally{c.value=!1}}async function M(p,_,P){try{b.value=!0,await he.updateUnitByIdandLessonId(p,_,P)}catch(A){t.add({severity:"error",summary:A.response.data.error,life:2e3})}finally{b.value=!1}}return{selectedUnit:u,isUnitLoading:c,setDataSaving:w,loadUnitByIdandLessonId:l,updateUnitByIdandLessonId:M}}),es={class:"h-full flex flex-col"},ts={class:"p-4"},ss={class:"flex w-full gap-1"},as={class:"material-icons"},os={class:"material-icons"},ls={class:"material-icons"},ns={class:"material-icons"},rs={class:"material-icons"},ds={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},is={class:"flex gap-2 w-full"},cs=["for"],us={class:"material-icons"},ms={class:"material-icons"},vs=G({__name:"TesterControls",props:{id:{}},setup(t){const u=t,c=Ce(),b=Ae(),i=ze(),w=Zt(),{selectedUnit:l}=ue(w),{loadUnitByIdandLessonId:M,setDataSaving:p,updateUnitByIdandLessonId:_}=w,P=Number(i.params.lesson_id),A=Number(i.params.unit_id),g=$([]);je(async()=>{var r;try{await M(A,P);const d=(r=l.value)==null?void 0:r.content;if(V.value=d.answer,Q.setCode(V.value),l.value){if(l.value.data.tests&&(g.value=await Je(l.value.data.tests)),l.value.data.neededModules)for(const h of l.value.data.neededModules)h.module&&h.slot&&te.newModuleToSlot(h.module,h.slot);l.value.data.includedCommandsForTests=l.value.data.includedCommandsForTests??[...ge]}}catch(d){console.log(d)}});async function q(){if(l.value!=null){p(!0);try{await _(A,P,{content:l.value.content,data:l.value.data})}catch(r){let d="";r instanceof Error?d=r.message:d=String(r),c.add({severity:"error",summary:"Failed to save",detail:d,life:3e3})}finally{p(!1)}}}const E=rt(()=>{q()},1e3,{maxWait:5e3});async function j(r){const d=JSON.stringify(r),h=new Blob([d],{type:"application/json"}),y=new FormData;y.append("file",h,"default.test.json");const{data:T}=await Y.uploadFile(y,"tests");return T.source_url}async function K(){if(l.value!=null)try{const r=await j(I.value);l.value.data.tests?l.value.data.tests.push({name:"",url:r}):(l.value.data.tests=[],l.value.data.tests.push({name:"",url:r})),g.value.push({data:I.value,test:{name:"",url:r}}),I.value=[],await q()}catch(r){c.add({severity:"error",summary:r.response.data.error,life:2e3})}}function Se(r){b.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{var d,h;try{const y=g.value[r].test.url;await Y.deleteFile(y),(h=(d=l.value)==null?void 0:d.data.tests)==null||h.splice(r,1),g.value.splice(r,1),q()}catch(y){c.add({severity:"error",summary:y.response.data.error,life:2e3})}}})}const{fileContent:V}=ue(dt()),te=Ke(u.id),Ie=Qe(u.id),Q=Xe(u.id),Te=Ye(u.id);ye.registerSimulation(u.id,{terminal:Ie,display:Te,pibody:te});const v=ye.getSharedEmulator(),{isLoading:C,isRunning:ie}=v;te.addNeededModules([]);const I=$(xe),Fe=$(xe);me(Q.code,r=>{typeof r=="string"&&r!==V.value&&(V.value=r,l.value&&(l.value.content.answer=r))});function Ue(){v.recorder.start();const r=typeof Q.code.value=="string"?Q.code.value:"";v.run(r);const d=me(v.recorder.state,()=>{(v.replayer.state.value==ae.Finish||v.replayer.state.value==ae.Timeout)&&(v.recorder.stop(),I.value=v.recorder.getRecords()),d.stop()})}function Me(){v.replayer.state.value==ae.Continue?(v.recorder.stop(),v.replayer.stop(),Fe.value=v.recorder.getRecords()):(v.recorder.stop(),I.value=v.recorder.getRecords()),v.stop()}function X(){var r;return((r=l.value)==null?void 0:r.data.includedCommandsForTests)??ge}const Ve=async()=>{if(!(!l.value||!l.value.content.tests)){F.value=!0;for(const[r,d]of g.value.entries()){const h=await be(v,V.value,d.data,X());await v.stopPromise();const y=l.value.data.tests[r].url,T=await j(h);l.value.data.tests[r].url=T,g.value[r].test.url=T,g.value[r].data=h;try{await Y.deleteFile(y)}catch(W){c.add({severity:"error",summary:W.response.data.error,life:2e3})}}await q(),F.value=!1}},De=async(r,d)=>{if(!l.value||!l.value.data.tests)return;F.value=!0;const h=await be(v,V.value,r.data,X());await v.stopPromise();const y=l.value.data.tests[d].url,T=await j(h);l.value.data.tests[d].url=T,g.value[d].test.url=T,g.value[d].data=h,q();try{await Y.deleteFile(y)}catch(W){c.add({severity:"error",summary:W.response.data.error,life:2e3})}F.value=!1};return(r,d)=>{const h=lt,y=$e,T=ot,W=at,Re=de;return o(),n("div",es,[s("div",ts,[d[4]||(d[4]=N(" Include Commands: ")),e(l)?(o(),B(h,{key:0,onChange:e(E),modelValue:e(l).data.includedCommandsForTests,"onUpdate:modelValue":d[0]||(d[0]=k=>e(l).data.includedCommandsForTests=k),options:Ze,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):R("",!0),s("div",ss,[f(y,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:Ue,disabled:e(C)||e(ie)},{default:x(()=>[s("span",as,a(e(C)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),f(y,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:Me,disabled:e(C)||!e(ie)},{default:x(()=>[s("span",os,a(e(C)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),f(y,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:d[1]||(d[1]=k=>K()),disabled:I.value.length<=0||e(l)==null},{default:x(()=>[s("span",ls,a(e(C)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),f(y,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:d[2]||(d[2]=k=>e(et)(e(v),e(V),g.value,X())),disabled:e(C)||e(F)},{default:x(()=>[s("span",ns,a(e(C)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),f(y,{type:"button",class:"w-9 h-9",rounded:"",onClick:d[3]||(d[3]=k=>Ve()),disabled:e(C)||!g.value||e(F)},{default:x(()=>[s("span",rs,a(e(C)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"])])]),I.value.length>0?(o(),B(we,{key:0,data:I.value,class:"mt-2"},null,8,["data"])):R("",!0),s("div",ds,[(o(!0),n(L,null,ee(g.value,(k,H)=>{var ce;return o(),B(Re,{toggleable:"",key:k.test.url,class:Z(["border-4",e(st)((ce=k.result)==null?void 0:ce.success)])},{header:x(()=>[s("div",is,[f(W,{variant:"on",class:"w-full"},{default:x(()=>[s("label",{for:`name ${H+1}`},"Test "+a(H+1),9,cs),f(T,{id:`name ${H+1}`,onInput:e(E),modelValue:k.test.name,"onUpdate:modelValue":J=>k.test.name=J,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),f(y,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:J=>e(tt)(e(v),e(V),k,X()),disabled:e(C)||e(F)},{default:x(()=>[s("span",us,a(e(C)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),f(y,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:J=>Se(H)},{default:x(()=>d[5]||(d[5]=[s("span",{class:"material-icons"},a("delete_forever"),-1)])),_:2},1032,["onClick"]),f(y,{type:"button",class:"w-9 h-9",rounded:"",onClick:J=>De(k,H),disabled:e(C)||!g.value||e(F)},{default:x(()=>[s("span",ms,a(e(C)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),f(y,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:J=>k.result=void 0,disabled:!g.value||e(F)},{default:x(()=>d[6]||(d[6]=[s("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:x(()=>[f(we,{data:k.data,class:"mt-2"},null,8,["data"]),k.result?(o(),B(e(Kt),{key:0,result:k.result,id:u.id},null,8,["result","id"])):R("",!0)]),_:2},1032,["class"])}),128))])])}}}),fs={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},ke="tester",zs=G({__name:"TesterView",setup(t){return(u,c)=>{const b=Ne,i=Be;return o(),n(L,null,[f(e(Le)),s("div",fs,[f(i,{class:"w-full rounded-none"},{default:x(()=>[f(b,{size:33,minSize:10,class:"max-w-[767px] h-full"},{default:x(()=>[f(vs,{id:ke})]),_:1}),f(b,{size:67,minSize:10,class:"w-full h-full"},{default:x(()=>[f(e(Oe),{id:ke,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{zs as default};
