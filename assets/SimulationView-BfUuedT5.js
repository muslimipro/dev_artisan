import{T as de}from"./index-DnxWnOWO.js";import{e as E,r as B,B as H,C as q,A as ce,o as i,c as x,a as p,v as h,h as e,t as V,F as L,q as J,y as $,aW as ae,k as G,j as z,i as A,z as re,b as W,I as O,S as fe,a4 as xe,P as se,H as N,w as oe,X as R,Q as ne,a9 as ve,l as he}from"./index-RQaPKU3q.js";import{s as ye}from"./index-i87uic1r.js";import{a as pe}from"./IdeButtons.vue_vue_type_script_setup_true_lang-BoC8OHM6.js";import{o as we,e as le,m as me,M as ge,f as be,g as Se,h as ke,a as X,j as Pe,r as Me,k as _e,l as $e,n as Ae,b as Le}from"./store-qJ2iV4r-.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce="/assets/pibody-D7u87r6i.png",De=["width","height"],T=12,Te=E({__name:"DisplayView",props:{id:{default:"default"}},setup(g){const s=g,t=B(112),w=B(160),S=B(null),y=B(null),u=B(0),a=pe(s.id);a.text.value||(a.text.value="");function d(n){const l=n.deltaY>0?1:-1;u.value+=l*T,u.value=Math.max(0,u.value);const{lines:b,visibleLines:v}=o();u.value=Math.min(b.length*T,u.value),f(b,v)}function o(){const n=[];let l=0;return y.value&&a.text.value&&(String(a.text.value).split(`
`).forEach(v=>{let m="";v.split(" ").forEach(M=>{const P=m+M+" ";y.value.measureText(P).width>t.value?(n.push(m),m=M+" "):m=P}),n.push(m)}),l=Math.ceil(w.value/T)),{lines:n,visibleLines:l}}function f(n,l){if(y.value){y.value.fillStyle="#FFFFFF",y.value.fillRect(0,0,t.value,w.value),y.value.fillStyle=String(a.textColor.value)||"#000000",y.value.font="12px Monaco";const b=Math.floor(u.value/T);for(let v=0;v<l;v++){const m=b+v;if(m<n.length){const k=(v+1)*T-u.value%T;y.value.fillText(n[m],0,k)}}}}return H([a.text,a.textColor],()=>{const{lines:n,visibleLines:l}=o();u.value=Math.max(0,(n.length-l)*T),f(n,l)}),q(async()=>{if(await ce(),!!S.value&&(y.value=S.value.getContext("2d"),y.value)){y.value.fillStyle="#FFFFFF",y.value.fillRect(0,0,t.value,w.value);const{lines:n,visibleLines:l}=o();u.value=0,f(n,l)}}),(n,l)=>(i(),x("div",{class:"display-container",onWheel:d},[p("canvas",{ref_key:"canvas",ref:S,width:t.value,height:w.value,style:{border:"1px solid black",width:"112px",height:"160px"}},null,8,De)],32))}}),ze=Y(Te,[["__scopeId","data-v-0149e8f3"]]),ie=E({__name:"PinInfo",props:{pin:{},withPin:{},isLeft:{type:Boolean}},setup(g){return(s,t)=>(i(),x(L,null,[p("div",{class:$(["flex",s.isLeft?"flex-row":"flex-row-reverse"])},[p("div",{style:h({background:e(we)}),class:"text-center font-mono px-1 mr-1"},V(e(le)[s.pin.id].name),5),(i(!0),x(L,null,J(e(le)[s.pin.id].able,w=>(i(),x("div",{style:h({background:w.color}),class:"text-center font-mono px-1 mr-1"},V(w.name),5))),256))],2),p("div",{class:$(["flex my-1 mb-3",s.isLeft?"flex-row":"flex-row-reverse"])},[p("div",{style:h({background:`${e(me)[s.pin.mode]}`}),class:"text-center px-4 mr-1 rounded-lg"},V(e(ge)[s.pin.mode]),5),p("div",{style:h(e(be)(s.pin,s.withPin)),class:"text-center px-4 mr-1 rounded-lg bg-black"},V(e(Se)(s.pin,s.withPin)),5)],2)],64))}}),Fe=["id"],Ie=E({__name:"SlotView",props:{slot:{},index:{},id:{}},setup(g){const{isOutside:s}=ke(ae("theref")),t=X(g.id),{maxAreaIndex:w,fromSlotIndex:S,settings:y}=t,u=g.index<3;return(a,d)=>{var o;return i(),x(L,null,[p("div",{id:`slot-${a.slot.id}`,ref:"theref",class:$(["absolute w-20 h-20 rounded-lg text-center",[{"bg-green-200/[0.5]":e(w)==a.index,"bg-blue-200/[0.5]":e(S)==a.index&&a.index<6},a.slot.class]]),style:h([a.slot.style,e(Pe)(a.slot)])},[!e(s)&&((o=e(y))!=null&&o.showPinInfo)?(i(),x("div",{key:0,class:"absolute w-fit whitespace-nowrap text-white flex flex-col text-xs bg-black/70",style:h(u?"left:100%":"right:100%")},[G(ie,{pin:a.slot.pin2,withPin:a.slot.with.pin2,isLeft:u},null,8,["pin","withPin"]),G(ie,{pin:a.slot.pin3,withPin:a.slot.with.pin3,isLeft:u},null,8,["pin","withPin"])],4)):z("",!0)],14,Fe),e(s)?z("",!0):(i(),A(re,{key:0,to:`#pibody-${a.id}`},null,8,["to"]))],64)}}}),He=["width","height"],Ee=["points","stroke"],F=3,I=14,j=10,Be=E({__name:"Connector",props:{start:{},end:{},style:{},isJST:{type:Boolean},id:{}},setup(g){const s=g,t=X(s.id),w=W(()=>{const{start:d,end:o}=s;let f=40,n=0;s.isJST&&(n=155,f=-20);const l=[{x:d.x,y:d.y+n}];return l.push({x:d.x,y:d.y+n-f}),l.push({x:(o.x+d.x)/2,y:d.y+n-f}),l.push({x:(o.x+d.x)/2,y:o.y-o.yOffset}),l.push({x:o.x,y:o.y-o.yOffset}),l.push({x:o.x,y:o.y}),l}),S={Jumper:[{color:"orange",offset:-F,end:-I/2},{color:"red",offset:0,end:0},{color:"saddlebrown",offset:F,end:I/2}],JST:[{color:"black",offset:-F,end:I/3},{color:"red",offset:0,end:I/7},{color:"blue",offset:F,end:-I/7},{color:"yellow",offset:F*2,end:-I/3}]},y=W(()=>{const d=w.value,o=[];return(s.isJST?S.JST:S.Jumper).forEach(n=>{const l=n.offset,b=n.end;let v="";for(let M=0;M<d.length-2;M++){const P=d[M];v+=`${P.x-u.value.x-l},${P.y-u.value.y-l} `}const m=d[d.length-2];v+=`${m.x-u.value.x+(s.isJST?b:l)},${m.y-u.value.y-l} `;const k=d[d.length-1];v+=`${k.x-u.value.x+b},${k.y-u.value.y+3} `,o.push({color:n.color,points:v})}),o}),u=W(()=>{const d=[],o=[];for(const v of w.value)d.push(v.x),o.push(v.y);const f=Math.min(...d)-j,n=Math.min(...o)-j,l=Math.max(...d)+j,b=Math.max(...o)+j;return{x:f,y:n,w:l-f,h:b-n}}),a=d=>{s.end.at!==t.pinNone&&t.moveConnectorEnd(s,d,s.isJST)};return(d,o)=>(i(),x(L,null,[s.isJST==!1?(i(),x("div",{key:0,class:"absolute bg-black cursor-move",style:h([s.style,{left:s.end.x-12+"px",top:s.end.y+"px",width:s.end.w+"px",height:s.end.h+"px"}]),onPointerdown:[o[0]||(o[0]=O(f=>f.preventDefault(),["prevent"])),a]},null,36)):(i(),x("div",{key:1,class:"absolute bg-gray-300 cursor-move",style:h([s.style,{left:s.end.x-8+"px",top:s.end.y+"px",width:"15px",height:s.end.h+"px"}]),onPointerdown:[o[1]||(o[1]=O(f=>f.preventDefault(),["prevent"])),a]},null,36)),p("div",{class:"absolute pointer-events-none",style:h([s.style,e(Me)(u.value)])},[(i(),x("svg",{xmlns:"http://www.w3.org/2000/svg",width:u.value.w,height:u.value.h},[(i(!0),x(L,null,J(y.value,(f,n)=>(i(),x("polyline",{key:n,points:f.points,stroke:f.color,fill:"none","stroke-width":F,"stroke-linejoin":"round","stroke-linecap":"round"},null,8,Ee))),128))],8,He))],4)],64))}}),Je=Y(Be,[["__scopeId","data-v-e9ee8bd7"]]),Ge=E({__name:"Canvas",setup(g){const s=ae("canvasEl");return q(async()=>{s.value&&(await _e(s.value),requestAnimationFrame($e))}),fe(()=>{s.value&&Ae(s.value)}),(t,w)=>(i(),x("canvas",{ref_key:"canvasEl",ref:s},null,512))}}),Ve=["id"],je=["id"],Oe={class:"absolute top-[22px] right-[7px] flex flex-col gap-1"},We=["id"],Ne={class:"max-h-fit w-full overflow-auto flex flex-wrap gap-2 justify-center items-start mt-2",style:{"touch-action":"none",padding:"15px 0 15px 0"}},Re=E({__name:"SimulationView",props:xe({id:{},horizontal:{type:Boolean}},{neededModules:{default:[]},neededModulesModifiers:{},slots:{default:[]},slotsModifiers:{}}),emits:["update:neededModules","update:slots"],setup(g){const s=g,t=X(s.id,s.horizontal),{toDelete:w,slots:S,modules:y,isConnect8or9:u,chosenPin8or9:a,pin8:d,pin9:o,settings:f,clearSlotsModulesClasses:n,modulesWerePut:l,lightUp:b,isConnectGorH:v,getSlot:m}=t,k=se(g,"neededModules"),M=se(g,"slots");q(()=>{t.putModuleList(M.value)});function P(C){if(l.value=!0,!(!k.value||k.value.length===0)){n();for(const r of k.value){if(!r.slot||!r.module)continue;if(t.getSlotPinWith(r.slot).type!==r.module){b(r.slot,r.module),l.value=!1;break}}}}const U=Le(()=>{M.value=t.slotHasList()},100);H([t.slotHasList],()=>{U()});for(const C of t.slots)H(()=>C.with.type,()=>{P()},{immediate:!0});H(()=>t.pin8.with.type,()=>{P(t.pin8)},{immediate:!0}),H(()=>t.pin9.with.type,()=>{P(t.pin9)},{immediate:!0}),H(k,()=>{for(const C of t.slots)P()});function ue(){pe(s.id).clearDisplay(),t.reset()}return(C,r)=>{var ee,te;const Q=ye,K=he,Z=de;return i(),x("div",{id:`emulator-${s.id}`,key:`emulator-${s.id}`,class:$({"h-[450px] flex flex-row":C.horizontal,"h-full flex flex-col":!C.horizontal,"parent relative items-stretch overflow-hidden select-none":!0})},[p("div",{id:`pibody-${s.id}`,class:"relative h-[450px] flex-shrink-0 overflow-x-hidden overflow-y-auto w-[450px]"},[G(Q,{src:e(Ce),width:"384px",draggable:"false",class:"absolute pt-4 min-w-[384px]",style:{left:"32px",top:"0px"}},null,8,["src"]),G(ze,{class:"absolute top-[217px] left-[168px] w-[112px] h-[160px]",id:`${s.id}`},null,8,["id"]),p("div",Oe,[N((i(),A(K,{severity:(ee=e(f))!=null&&ee.showPinInfo?void 0:"secondary",class:"w-5 h-7",onClick:r[0]||(r[0]=c=>{var _;return e(t).setSettings({showPinInfo:!((_=e(f))!=null&&_.showPinInfo)})})},{default:oe(()=>r[3]||(r[3]=[p("span",{class:"material-icons",style:{"font-size":"18px"}},"question_mark",-1)])),_:1},8,["severity"])),[[Z,`Pin Information: ${(te=e(f))!=null&&te.showPinInfo?"On":"Off"}`,void 0,{left:!0}]]),N((i(),A(K,{severity:"secondary",class:"w-5 h-7",onClick:ue},{default:oe(()=>r[4]||(r[4]=[p("span",{class:"material-icons",style:{"font-size":"20px"}},"restart_alt",-1)])),_:1})),[[Z,"Reset pibody",void 0,{left:!0}]])]),(i(!0),x(L,null,J(e(S),(c,_)=>(i(),A(Ie,{key:_,slot:c,index:_,id:s.id},null,8,["slot","index","id"]))),128)),p("div",{class:"absolute bg-black",style:h({left:e(t).usb.x+"px",top:e(t).usb.y-70+"px",width:e(t).usb.w+"px",height:e(t).usb.h+50+"px"})},null,4),p("div",{class:"absolute",style:h({left:e(t).onLED.x+"px",top:e(t).onLED.y+"px",width:e(t).onLED.w+"px",height:e(t).onLED.h+"px"})},null,4),(e(u)||e(t).helpArrows[8].visible)&&!e(t).helpArrows[9].visible?(i(),x("div",{key:0,class:"absolute flex items-center justify-center animate-bounce-up z-20 pointer-events-none",style:h({left:e(t).helpArrows[8].x+"px",top:e(t).helpArrows[8].y+"px"})},[p("span",{class:$(["material-icons",[e(a)===e(d)?"!text-green-500":"text-gray-500",e(t).helpArrows[8].class]]),style:h({...e(t).helpArrows[8].style,fontSize:"37px",transform:"rotate(180deg)"})},"navigation",6),r[5]||(r[5]=p("span",{class:"absolute text-white font-bold -mt-2 top-4 text-[13px]"},"8",-1))],4)):z("",!0),(e(u)||e(t).helpArrows[9].visible)&&!e(t).helpArrows[8].visible?(i(),x("div",{key:1,class:"absolute flex items-center justify-center animate-bounce-down z-20 pointer-events-none",style:h({left:e(t).helpArrows[9].x+"px",top:e(t).helpArrows[9].y+"px"})},[p("span",{class:$(["material-icons",[e(a)===e(o)?"!text-green-500":"text-gray-500",e(t).helpArrows[9].class]]),style:h({...e(t).helpArrows[9].style,fontSize:"37px"})},"navigation",6),r[6]||(r[6]=p("span",{class:"absolute text-white font-bold -mt-2 top-5 text-[13px]"},"9",-1))],4)):z("",!0),(e(v)||e(t).helpArrows.G.visible)&&!e(t).helpArrows.H.visible?(i(),x("div",{key:2,class:"absolute flex items-center justify-center animate-bounce-up z-20 pointer-events-none",style:h({left:e(t).helpArrows.G.x+"px",top:e(t).helpArrows.G.y+"px"})},[p("span",{class:$(["material-icons",[e(a)===e(m)("G")?"!text-green-500":"text-gray-500",e(t).helpArrows.G.class]]),style:h({...e(t).helpArrows.G.style,fontSize:"28px"})},"navigation",6),r[7]||(r[7]=p("span",{class:"absolute text-white font-bold -mt-2 top-4 text-[10px]"},"G",-1))],4)):z("",!0),(e(v)||e(t).helpArrows.H.visible)&&!e(t).helpArrows.G.visible?(i(),x("div",{key:3,class:"absolute flex items-center justify-center animate-bounce-up z-20 pointer-events-none",style:h({left:e(t).helpArrows.H.x+"px",top:e(t).helpArrows.H.y+"px"})},[p("span",{class:$(["material-icons",[e(a)===e(m)("H")?"!text-green-500":"text-gray-500",e(t).helpArrows.H.class]]),style:h({...e(t).helpArrows.H.style,fontSize:"28px"})},"navigation",6),r[8]||(r[8]=p("span",{class:"absolute text-white font-bold -mt-2 top-4 text-[10px]"},"H",-1))],4)):z("",!0),G(Ge,{class:"absolute top-0 left-0 z-10 w-full h-full pointer-events-none",id:s.id},null,8,["id"])],8,je),p("div",{id:`module-list-${s.id}`,class:"relative h-full flex-1 overflow-auto overflow-x-hidden w-[450px]"},[p("div",Ne,[(i(!0),x(L,null,J(e(t).neededModules.value,(c,_)=>(i(),A(ne(c.is),R({key:_,class:c.class,style:c.style,ref_for:!0},c,{onPointerdown:[D=>e(t).startDragFromModuleList(c,D),r[1]||(r[1]=O(D=>D.preventDefault(),["prevent"]))],class:"flex-none w-20 h-20 cursor-move"}),null,16,["class","style","onPointerdown"]))),128)),N(p("div",{class:$(["absolute top-0 left-0 h-full w-full",{"bg-red-500/[0.8]":e(w)}])},r[9]||(r[9]=[p("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},[p("span",{class:"material-icons",style:{"font-size":"100px"}},"delete")],-1)]),2),[[ve,e(w)]])])],8,We),(i(!0),x(L,null,J(e(y),(c,_)=>(i(),A(re,{defer:"",to:c.dragging?`#emulator-${s.id}`:`#pibody-${s.id}`,key:c.id},[c.putOn8or9&&c.connector.end.x!==0&&c.connector.end.y!==0?(i(),A(Je,R({key:0,ref_for:!0},c.connector,{id:s.id}),null,16,["id"])):z("",!0),(i(),A(ne(c.is),R({class:c.class,style:[c.style,{left:c.x+"px",top:c.y+"px"}],ref_for:!0},c,{onPointerdown:[D=>e(t).startDragFromSlot(c,_,c.on,D),r[2]||(r[2]=O(D=>D.preventDefault(),["prevent"]))],class:"absolute w-20 h-20 rounded-xl cursor-move",style:{"touch-action":"none"}}),null,16,["class","style","onPointerdown"]))],8,["to"]))),128))],10,Ve)}}}),Ze=Y(Re,[["__scopeId","data-v-51912414"]]);export{Ze as S};
