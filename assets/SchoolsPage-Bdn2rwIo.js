import{e as z,a4 as R,u as G,P as I,r as n,B as q,b as X,o as b,i as S,w as B,a as l,k as i,j as w,c as j,t as $,l as H,R as F,G as L,y as Y,g as Z,s as ee,C as le,h as T,F as oe,n as se}from"./index-8eYd0-Co.js";import{S as E}from"./schoolApi-BwSNx1fk.js";import{_ as te}from"./SchoolsTable.vue_vue_type_script_setup_true_lang-CxzjKPBt.js";import{s as K}from"./index-c_rbGUP2.js";import{s as J}from"./index-B50-4SOK.js";import{s as ae}from"./index-DW8h8G0I.js";import{s as ne}from"./index-B3NttIqY.js";import{s as de}from"./index-DSyhlytj.js";import"./index-D24MRCgv.js";import"./index-DRGFISwW.js";import"./index-VgJXLjdG.js";import"./index-CQCkvxda.js";import"./index-eKsVto-V.js";import"./index-CsjCzc3Q.js";import"./index-CSTKEaPu.js";import"./index-Drl6JR_B.js";import"./index-C5W94n6N.js";import"./index-ahqnJA0E.js";import"./index-H-9SRDzX.js";import"./index-fKBIE13H.js";import"./xlsx.min-BNDpkytq.js";import"./mapClassFromDto-BHXsJaNm.js";import"./index-VaRh2XWh.js";import"./index-BB-HFA2F.js";const ie={class:"flex flex-col gap-1"},ue={class:"flex flex-col"},re={class:"flex items-end justify-between gap-4 mb-1"},me={class:"flex gap-2"},ce={class:"flex flex-col"},ve={key:0,class:"flex flex-col"},fe={class:"flex flex-col"},pe={class:"flex gap-2"},xe={class:"flex flex-col"},ye={class:"flex flex-col"},be={class:"flex flex-col"},ge={key:0,class:"flex flex-col"},Ve={class:"flex gap-2 items-center"},_e={class:"font-bold text-sm"},Se={class:"flex gap-2 justify-end"},ke=z({__name:"EditSchoolDialog",props:R({selectedSchool:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(D){const _=G(),x=I(D,"modelValue"),m=D,r=n(""),c=n(""),v=n(0),g=n(0),t=n(0),o=n(""),f=n(""),p=n(""),y=n("");q(()=>m.selectedSchool,s=>{r.value="",c.value="",y.value="",v.value=0,g.value=0,t.value=0,o.value="",f.value="",p.value="",s&&(r.value=s.address,c.value=s.country,v.value=s.num_max_classes,g.value=s.num_max_students,t.value=s.num_max_teachers,o.value=s.title_en,f.value=s.title_kz,p.value=s.title_ru,V.value=new Date(s.subscription_end))},{immediate:!0});const C=["en","kk","ru"],d=n("en"),V=n(new Date),k=X(()=>{const s=new Date,e=new Date(V.value);s.setHours(0,0,0,0),e.setHours(0,0,0,0);const P=e.getTime()-s.getTime();return Math.ceil(P/(1e3*60*60*24))}),u=n(!1);async function U(){u.value=!0;try{const{data:s}=await E.createSchool(r.value,c.value,y.value,v.value,g.value,t.value,k.value,o.value,f.value,p.value);_.add({severity:"success",summary:s.message,life:2e3}),window.location.reload(),x.value=!1}catch(s){_.add({severity:"error",summary:s.response.data.error,detail:s,life:2e3})}finally{u.value=!1}}async function M(){if(m.selectedSchool!=null){u.value=!0;try{const{data:s}=await E.updateSchool(m.selectedSchool.id,r.value,c.value,v.value,g.value,t.value,o.value,f.value,p.value);_.add({severity:"success",summary:s.message,life:2e3}),window.location.reload(),x.value=!1}catch(s){_.add({severity:"error",summary:s.response.data.error,detail:s,life:2e3})}finally{u.value=!1}}}return(s,e)=>{const P=de,h=ne,A=ae,O=J,Q=K,N=H,W=F;return b(),S(W,{visible:x.value,"onUpdate:visible":e[12]||(e[12]=a=>x.value=a),modal:"",draggable:!1,class:"m-4 max-w-md",header:m.selectedSchool?"Edit school":"Add school"},{default:B(()=>[l("div",ie,[l("div",ue,[l("div",re,[e[13]||(e[13]=l("div",{class:"font-bold text-sm"},"School name",-1)),i(P,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),options:C,allowEmpty:!1,size:"small"},null,8,["modelValue"])]),d.value=="en"?(b(),S(h,{key:"en",type:"text",modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a)},null,8,["modelValue"])):d.value=="kk"?(b(),S(h,{key:"kk",type:"text",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a)},null,8,["modelValue"])):d.value=="ru"?(b(),S(h,{key:"ru",type:"text",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value=a)},null,8,["modelValue"])):w("",!0)]),l("div",me,[l("div",ce,[e[14]||(e[14]=l("div",{class:"font-bold text-sm mb-1"},"Country",-1)),i(h,{type:"text",modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),class:"w-full"},null,8,["modelValue"])]),m.selectedSchool==null?(b(),j("div",ve,[e[15]||(e[15]=l("div",{class:"font-bold text-sm mb-1"},"Email",-1)),i(h,{type:"text",modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=a=>y.value=a),class:"w-full"},null,8,["modelValue"])])):w("",!0)]),l("div",fe,[e[16]||(e[16]=l("div",{class:"font-bold text-sm mb-1"},"Address",-1)),i(h,{type:"text",modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value=a)},null,8,["modelValue"])]),l("div",pe,[l("div",xe,[e[17]||(e[17]=l("div",{class:"font-bold text-sm mb-1"},"Max classes",-1)),i(A,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=a=>v.value=a),useGrouping:!1,fluid:"",min:0},null,8,["modelValue"])]),l("div",ye,[e[18]||(e[18]=l("div",{class:"font-bold text-sm mb-1"},"Max teachers",-1)),i(A,{modelValue:t.value,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value=a),useGrouping:!1,fluid:"",min:0},null,8,["modelValue"])]),l("div",be,[e[19]||(e[19]=l("div",{class:"font-bold text-sm mb-1"},"Max students",-1)),i(A,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=a=>g.value=a),useGrouping:!1,fluid:"",min:0},null,8,["modelValue"])])]),m.selectedSchool==null?(b(),j("div",ge,[e[20]||(e[20]=l("div",{class:"font-bold text-sm mb-1"},"Subscription expiration",-1)),l("div",Ve,[i(O,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value=a),class:"flex-1"},null,8,["modelValue"]),l("div",_e,"Total days: "+$(k.value),1)])])):w("",!0),i(Q),l("div",Se,[i(N,{label:"Cancel",severity:"secondary",onClick:e[11]||(e[11]=a=>x.value=!1)}),m.selectedSchool==null?(b(),S(N,{key:0,label:"Create",onClick:U,loading:u.value,disabled:u.value},null,8,["loading","disabled"])):(b(),S(N,{key:1,label:"Save",onClick:M,loading:u.value,disabled:u.value},null,8,["loading","disabled"]))])])]),_:1},8,["visible","header"])}}}),he={class:"flex flex-col gap-1"},De={class:"flex flex-col"},$e={class:"flex flex-col"},Ce={class:"flex flex-col"},we={class:"flex flex-col"},Ue={class:"flex gap-2 items-center"},Me={class:"font-bold text-sm"},Te={class:"flex gap-2 justify-end"},Be=z({__name:"ProlongSchoolDialog",props:R({selectedSchool:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(D){const _=G(),x=I(D,"modelValue"),m=D;q(()=>m.selectedSchool,t=>{t&&(r.value=new Date(t.subscription_end))},{immediate:!0});const r=n(new Date);function c(t){const o=new Date,f=new Date(t);o.setHours(0,0,0,0),f.setHours(0,0,0,0);const p=f.getTime()-o.getTime();return Math.ceil(p/(1e3*60*60*24))}const v=n(!1);async function g(){if(m.selectedSchool!=null){v.value=!0;try{const{data:t}=await E.prolongSchool(m.selectedSchool.id,r.value);_.add({severity:"success",summary:t.message,life:2e3}),window.location.reload(),x.value=!1}catch(t){_.add({severity:"error",summary:t.response.data.error,detail:t,life:2e3})}finally{v.value=!1}}}return(t,o)=>{const f=J,p=K,y=H,C=F;return b(),S(C,{visible:x.value,"onUpdate:visible":o[2]||(o[2]=d=>x.value=d),modal:"",draggable:!1,class:"m-4 max-w-md",header:m.selectedSchool?"Edit school":"Add school"},{default:B(()=>[l("div",he,[l("div",De,[o[3]||(o[3]=l("div",{class:"font-bold text-sm mb-1"},"School name",-1)),L(" "+$(t.selectedSchool.title_en),1)]),l("div",$e,[o[4]||(o[4]=l("div",{class:"font-bold text-sm mb-1"},"Email",-1)),L(" "+$(t.selectedSchool.manager_email),1)]),l("div",Ce,[o[5]||(o[5]=l("div",{class:"font-bold text-sm mb-1"},"Subscription expiration",-1)),l("span",{class:Y(c(new Date(t.selectedSchool.subscription_end))<0?"text-red-500":"text-green-500")},$(t.selectedSchool.subscription_end.split("T")[0])+" (left "+$(c(new Date(t.selectedSchool.subscription_end)))+") ",3)]),l("div",we,[o[6]||(o[6]=l("div",{class:"font-bold text-sm mb-1"},"Choose new subscription end",-1)),l("div",Ue,[i(f,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=d=>r.value=d),class:"flex-1"},null,8,["modelValue"]),l("div",Me,"Total days: "+$(c(r.value)),1)])]),i(p),l("div",Te,[i(y,{label:"Cancel",severity:"secondary",onClick:o[1]||(o[1]=d=>x.value=!1)}),i(y,{label:"Save",onClick:g,loading:v.value,disabled:v.value},null,8,["loading","disabled"])])])]),_:1},8,["visible","header"])}}}),Ee={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},Pe={class:"flex gap-2"},al=z({__name:"SchoolsPage",setup(D){const _=G(),x=se(),m=Z(),{userInfo:r}=ee(m),c=n(!1),v=n(null);function g(d){c.value=!0,v.value=d}const t=n(!1),o=n();function f(d){t.value=!0,o.value=d}const p=n([]),y=n(!1);async function C(){try{y.value=!0;const{data:d}=await E.getSchools();p.value=d??[]}catch(d){_.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{y.value=!1}}return le(()=>{C()}),(d,V)=>{const k=H;return b(),j(oe,null,[l("div",Ee,[i(T(te),{schools:p.value,loading:y.value},{"header-extra":B(()=>[i(k,{label:"Add",icon:"pi pi-plus",severity:"success",variant:"outlined",class:"mr-2",onClick:V[0]||(V[0]=u=>g(null))})]),actions:B(({row:u})=>{var U,M;return[l("div",Pe,[((U=T(r))==null?void 0:U.user_type)=="super_admin"?(b(),S(k,{key:0,icon:"pi pi-credit-card",outlined:"",rounded:"",severity:"help",onClick:s=>f(u)},null,8,["onClick"])):w("",!0),((M=T(r))==null?void 0:M.user_type)=="super_admin"?(b(),S(k,{key:1,icon:"pi pi-pencil",outlined:"",rounded:"",severity:"warn",onClick:s=>g(u)},null,8,["onClick"])):w("",!0),i(k,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:s=>T(x).push({name:"admin-school",params:{id:u.id}})},null,8,["onClick"])])]}),_:1},8,["schools","loading"])]),i(ke,{modelValue:c.value,"onUpdate:modelValue":V[1]||(V[1]=u=>c.value=u),"selected-school":v.value},null,8,["modelValue","selected-school"]),i(Be,{modelValue:t.value,"onUpdate:modelValue":V[2]||(V[2]=u=>t.value=u),"selected-school":o.value},null,8,["modelValue","selected-school"])],64)}}});export{al as default};
