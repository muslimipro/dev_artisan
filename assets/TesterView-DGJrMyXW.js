import{S as be,_ as xe,T as we,s as ke,a as Se}from"./SimulationView-D1_hCmis.js";import{_ as $e}from"./IdeHeader.vue_vue_type_script_setup_true_lang-CR_36jJY.js";import{s as Ce}from"./index-CaXwPlLo.js";import{h as Re,s as Le}from"./index-CzboWzNt.js";import{d as G,h as w,q,o as _,c as y,a as i,F as N,n as P,aq as H,t as b,m as ne,ag as Ie,ad as Fe,f as Te,ae as U,i as De,A as le,l as Ne,b as u,w as h,u as d,ar as Ve,x as oe,s as ze}from"./index-Bhyg0tYJ.js";import{f as Me,d as ae,i as Ae}from"./index-B4kWUiC7.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Pe}from"./SavedCloud.vue_vue_type_script_setup_true_lang-DiRsdDHC.js";import{a as j}from"./index-DLljYxXt.js";import{u as Ee}from"./editor-store-B9YKNVwA.js";import"./logo-LmxoA71s.js";import"./pibody-BwAjMvHk.js";import"./index-Dt4hp1KX.js";const Je={class:"w-full flex flex-col gap-4"},Be={class:"flex items-center gap-1"},He={class:"flex-1 flex gap-0.5"},je=["onClick"],qe={class:"flex items-center gap-1"},Ue={class:"flex-1 flex gap-0.5"},Ge=["onClick"],Ke={class:"flex items-center gap-1"},We={class:"flex-1 flex gap-0.5"},Qe=["onClick"],Xe={key:0,class:"border rounded p-2 bg-gray-50 mt-4"},Ye={class:"font-semibold text-sm mb-2"},Ze={class:"text-xs overflow-auto"},et={key:1,class:"border rounded p-2 bg-gray-50 mt-4"},tt={class:"font-semibold text-sm mb-2"},st={class:"text-xs overflow-auto"},nt=G({__name:"ReplayTimeline",props:{feedback:{},inputs:{}},setup(k){const C=w(null),R=w(null),I=w(null),F=w(null);function a(o){C.value=o,R.value=S.value[o]??null,I.value=null,F.value=null}const S=q(()=>{const o=[];let p=0;for(let c=0;c<k.feedback.length;c++)p<k.inputs.length&&c>k.inputs[p].outputLength?(o.push({success:!0,expected:null,replayed:null}),p++):o.push(k.feedback[c]);return console.log(o),o}),D=q(()=>{const o=[];let p=0;for(let c=0;c<k.feedback.length;c++)p<k.inputs.length&&c>=k.inputs[p].outputLength?(o.push(k.inputs[p]),p++):o.push(null);return console.log(o),o});function f(o){I.value=D.value[o],F.value=o,R.value=null,C.value=null}return(o,p)=>(_(),y("div",Je,[i("div",Be,[p[0]||(p[0]=i("span",{class:"text-sm font-semibold w-20"},"Expected",-1)),i("div",He,[(_(!0),y(N,null,P(S.value,(c,g)=>(_(),y("div",{key:`expected-${g}`,class:H(["flex-1 h-5 cursor-pointer",{"bg-blue-300":c.success&&c.expected,"bg-red-400":!c.success&&c.expected,"bg-gray-100":!c.expected}]),onClick:$=>a(g)},null,10,je))),128))])]),i("div",qe,[p[1]||(p[1]=i("span",{class:"text-sm font-semibold w-20"},"Replayed",-1)),i("div",Ue,[(_(!0),y(N,null,P(S.value,(c,g)=>(_(),y("div",{key:`replayed-${g}`,class:H(["flex-1 h-5 cursor-pointer",c.replayed?c.success?"bg-green-300":"bg-red-400":"bg-gray-100"]),onClick:$=>a(g)},null,10,Ge))),128))])]),i("div",Ke,[p[2]||(p[2]=i("span",{class:"text-sm font-semibold w-20"},"Input",-1)),i("div",We,[(_(!0),y(N,null,P(D.value,(c,g)=>(_(),y("div",{key:"idx",class:H(["flex-1 h-5 cursor-pointer",{"bg-purple-400":c,"bg-gray-100":!c}]),onClick:$=>f(g)},null,10,Qe))),128))])]),R.value!=null?(_(),y("div",Xe,[i("h2",Ye,"Feedback at index: "+b(C.value),1),i("pre",Ze,b(JSON.stringify(R.value,null,2)),1)])):ne("",!0),I.value?(_(),y("div",et,[i("h2",tt,"Input(s) at outputLength "+b(F.value),1),i("pre",st,b(JSON.stringify(I.value,null,2)),1)])):ne("",!0)]))}}),lt=Oe(nt,[["__scopeId","data-v-3c612cee"]]),ot={class:"p-4"},at={class:"flex w-full"},it={class:"material-icons"},ut={class:"material-icons"},ct={class:"material-icons"},rt={class:"material-icons"},dt={class:"flex justify-end"},pt={class:"flex flex-col gap-4 mt-2"},ft=["for"],mt={class:"material-icons"},gt={class:"material-icons"},ht=G({__name:"TesterControls",setup(k){const{locale:C}=Ie(),R=Fe(),I=Ee(),{setStepSaving:F}=I;let a=w(null);const S=q(()=>a.value?a.value.content.tests:[]);Te(async()=>{const t=Ve();try{const{data:e}=await j.getStepTranslationByID(t.params.id.toString(),C.value);if(a.value=e,D.value=a.value.content.solution,a.value.content.highlights)for(const l of a.value.content.highlights)f.newModuleToSlot(l.module,l.slot)}catch(e){console.log(e)}});const{fileContent:D}=U(Me()),f=ae(),{isLoading:o,isReplaying:p,isReplayTimeout:c}=U(f),g=w({moduleList:[],output:[],input:[]}),$=w({moduleList:[],output:[],input:[]}),E=De();let M=[];function ie(){M=[];for(const t of f.getSlots())M.push(t.with.type);g.value.moduleList=M,f.startRecording()}function ue(){g.value=f.stopRecording(),g.value.moduleList=M}function ce(t,e){const l={},s=Math.min(t.length,e.length);for(let n=0;n<s;n++)JSON.stringify(t[n])!==JSON.stringify(e[n])&&(l[n]={expected:{...t[n]},replayed:{...e[n]}});return l}const V=w([]);function re(t,e){const l=[];for(let s=0;s<t.length&&s<e.length;s++)l.push({success:A(t[s],e[s]),expected:t[s],replayed:e[s]});for(let s=e.length;s<t.length;s++)l.push({success:!1,expected:t[s],replayed:null});for(let s=t.length;s<e.length;s++)l.push({success:!1,expected:null,replayed:e[s]});return l}function de(t,e){const l=pe(t,e),s=[];let n=t.length,m=e.length;for(;n>0&&m>0;)A(t[n-1],e[m-1])?(s.unshift({success:!0,expected:t[n-1],replayed:e[m-1]}),n--,m--):l[n-1][m]>=l[n][m-1]?(s.unshift({success:!1,expected:t[n-1],replayed:null}),n--):(s.unshift({success:!1,expected:null,replayed:e[m-1]}),m--);for(;n>0;)s.unshift({success:!1,expected:t[n-1],replayed:null}),n--;for(;m>0;)s.unshift({success:!1,expected:null,replayed:e[m-1]}),m--;return s}function pe(t,e){const l=Array(t.length+1).fill(0).map(()=>Array(e.length+1).fill(0));for(let s=1;s<=t.length;s++)for(let n=1;n<=e.length;n++)A(t[s-1],e[n-1])?l[s][n]=l[s-1][n-1]+1:l[s][n]=Math.max(l[s-1][n],l[s][n-1]);return l}function A(t,e){return JSON.stringify(t)===JSON.stringify(e)}function z(t){return JSON.stringify(t)}function K(t,e){const l=W(t),s=W(e),n=new Set;for(const r in l)l[r]===1&&s[r]===1&&n.add(r);const m=t.map((r,v)=>({action:r,index:v})).filter(({action:r})=>n.has(z(r))),x=e.map((r,v)=>({action:r,index:v})).filter(({action:r})=>n.has(z(r))),T=[],L=new Map;x.forEach(({action:r,index:v})=>{L.set(z(r),v)}),m.forEach(({action:r,index:v})=>{const se=L.get(z(r));se!==void 0&&T.push([v,se])}),T.sort((r,v)=>r[0]-v[0]);const B=[];let ee=0,te=0;for(const[r,v]of[...T,[t.length,e.length]])B.push(...fe(t.slice(ee,r),e.slice(te,v))),r<t.length&&v<e.length&&B.push({success:!0,expected:t[r],replayed:e[v]}),ee=r+1,te=v+1;return B}function fe(t,e){const l=[],s=Math.min(t.length,e.length);let n=0;for(;n<s;n++){const m=A(t[n],e[n]);l.push({success:m,expected:t[n],replayed:e[n]})}for(;n<t.length;n++)l.push({success:!1,expected:t[n],replayed:null});for(;n<e.length;n++)l.push({success:!1,expected:null,replayed:e[n]});return l}function W(t){const e={};return t.forEach(l=>{const s=z(l);e[s]=(e[s]||0)+1}),e}const O=w({name:"Histogram",algo:K});le(O,()=>{const t=[];V.value.forEach(e=>{e.expected!==null&&t.push(e.expected)}),V.value=Q(t,$.value.output)});const me=w([{name:"LCS",algo:de},{name:"Linear",algo:re},{name:"Histogram",algo:K}]);function Q(t,e){return O.value.algo(t,e)}const X=w([]);function Y(t){return X.value=t.input,new Promise(e=>{console.log(t),f.startReplaying(t.input,t.output.length);const l=le(p,()=>{if(!p.value){$.value=f.getRecordedResults();let s="error";console.log(ce(t.output,$.value.output)),V.value=Q(t.output,$.value.output),console.log(V.value),JSON.stringify(t.output)===JSON.stringify($.value.output)&&(s="success"),E.add({severity:s,summary:"Replayed",life:3e3}),e()}c.value&&(E.add({severity:"warn",summary:"Replay timeout",life:3e3}),e()),l.stop()})})}const ge=async()=>{for(const t of S.value)await Z(t)},Z=async t=>{var l;D.value=((l=a.value)==null?void 0:l.content.solution)??D.value;const e=await fetch(t.url).then(s=>s.json());if(e.moduleList)for(let s=0;s<e.moduleList.length;s++){const n=e.moduleList[s];f.newModuleToSlotIndex(n,s)}await oe(),await Y(e),await f.stopPromise()},he=async t=>{const e=await fetch(t.url).then(l=>l.json());await oe(),await Y(e),await f.stopPromise()};async function J(){if(a.value!=null){F(!0);try{await j.updateStepTranslationByID(a.value.step,C.value,a.value.name,a.value.content)}catch{E.add({severity:"error",summary:"Failed to save",detail:"I dunno what happened. Go cry to Bekzat; say that saving tests doesn't work",life:3e3})}finally{F(!1)}}}const ve=Ae(()=>{J()},1e3,{maxWait:5e3});async function _e(){if(a.value==null)return;const t={moduleList:g.value.moduleList,output:g.value.output,input:g.value.input},e=JSON.stringify(t),l=new Blob([e],{type:"application/json"}),s=new FormData;s.append("file",l,"default.test.json");const{data:n}=await j.uploadFile(s);a.value.content.tests?a.value.content.tests.push({name:"",url:n.presigned_url}):(a.value.content.tests=[],a.value.content.tests.push({name:"",url:n.presigned_url})),J()}function ye(t){R.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{var e;(e=a.value)==null||e.content.tests.splice(t,1),J()}})}return(t,e)=>{const l=ze,s=Re,n=Le,m=Ce;return _(),y(N,null,[i("div",ot,[Ne(" Recorded: "+b(g.value.output.length)+" Replayed: "+b($.value.output.length)+" ",1),i("div",at,[u(l,{type:"button",class:"w-9 h-9 mr-1",severity:"success",rounded:"",onClick:ie,disabled:d(o)||d(f).isRecording},{default:h(()=>[i("span",it,b(d(o)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),u(l,{type:"button",class:"w-9 h-9 mr-1",severity:"danger",rounded:"",onClick:ue,disabled:d(o)||!d(f).isRecording},{default:h(()=>[i("span",ut,b(d(o)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),u(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[0]||(e[0]=x=>_e()),disabled:g.value.output.length<=0||d(a)==null},{default:h(()=>[i("span",ct,b(d(o)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),u(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:e[1]||(e[1]=x=>ge()),disabled:d(o)||d(f).isRecording||!S.value},{default:h(()=>[i("span",rt,b(d(o)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),i("div",dt,[u(Pe)]),u(s,{modelValue:O.value,"onUpdate:modelValue":e[2]||(e[2]=x=>O.value=x),options:me.value,optionLabel:"name",placeholder:"Select diff algorithm",class:"w-full md:w-40"},null,8,["modelValue","options"])]),i("div",pt,[(_(!0),y(N,null,P(S.value,(x,T)=>(_(),y("div",{class:"flex gap-2 w-full",key:x.url},[u(m,{variant:"on",class:"w-full"},{default:h(()=>[i("label",{for:`name${T}`},"Name",8,ft),u(n,{id:`name${T}`,onInput:e[3]||(e[3]=L=>d(ve)()),modelValue:x.name,"onUpdate:modelValue":L=>x.name=L,"aria-describedby":"username-help",class:"w-full",size:"small"},null,8,["id","modelValue","onUpdate:modelValue"])]),_:2},1024),u(l,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:L=>Z(x),disabled:d(o)||d(f).isRecording},{default:h(()=>[i("span",mt,b(d(o)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),u(l,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:L=>he(x),disabled:d(o)||d(f).isRecording},{default:h(()=>[i("span",gt,b(d(o)?"hourglass_top":"task"),1)]),_:2},1032,["onClick","disabled"]),u(l,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:L=>ye(T)},{default:h(()=>e[4]||(e[4]=[i("span",{class:"material-icons"},b("delete_forever"),-1)])),_:2},1032,["onClick"])]))),128))])]),u(lt,{feedback:V.value,inputs:X.value},null,8,["feedback","inputs"])],64)}}}),vt={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Tt=G({__name:"TesterView",setup(k){const C=ae(),{isRecording:R}=U(C);return(I,F)=>{const a=ke,S=Se;return _(),y(N,null,[u($e),i("div",vt,[u(S,{class:"w-full rounded-none"},{default:h(()=>[u(a,{size:50,minSize:10,class:"max-w-[467px] w-full"},{default:h(()=>[u(be)]),_:1}),u(a,{size:50,minSize:10},{default:h(()=>[u(S,{layout:"vertical",class:"h-full w-full"},{default:h(()=>[u(a,{size:65,minSize:10},{default:h(()=>[u(xe,{disabled:d(R)},null,8,["disabled"])]),_:1}),u(a,{size:35,minSize:10},{default:h(()=>[u(we)]),_:1})]),_:1})]),_:1}),u(a,{size:50,minSize:10},{default:h(()=>[u(ht)]),_:1})]),_:1})])],64)}}});export{Tt as default};
