import{s as P}from"./index-BQKo0YUX.js";import{e as N,f as q,r as y,b as z,o as t,c as o,a as v,i as h,j as E,G,t as S,k as u,w as A,y as H,F as I,q as V,h as c,b2 as J,l as Q,d as X,u as Y,a5 as Z,s as ee,C as te,K as se}from"./index-RQaPKU3q.js";import{L as ne}from"./lessonApi-CDtd4rn4.js";import{m as oe}from"./mapLessonFromDto-C2sH6sUU.js";import{u as ie,a as ae}from"./store-qJ2iV4r-.js";import{_ as re,a as le,b as ue,c as ce}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_bad98aaa_lang-Cy-QTQYp.js";import{_ as F}from"./MdViewer.vue_vue_type_style_index_0_lang-Bca--o1a.js";import{s as de,a as pe}from"./index-BJXW17cL.js";import{s as fe}from"./index-i87uic1r.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./mapUnitFromDto-DRcH-Z8v.js";import"./transformUnitDtosToPages-BbPlv-Pt.js";import"./index-CH_iu5NA.js";import"./index-DZ_1xp5G.js";import"./index-DoQeMzHI.js";import"./index-6V6lXQ4K.js";import"./index-CY8HVpGr.js";import"./index-3r_oBTLo.js";import"./index-DP6Jkdyj.js";import"./index-BctX0Pow.js";import"./index-CBvRvFRr.js";import"./index-CdWRCESg.js";import"./index-CJfAG3aM.js";import"./index-5bVhi2nm.js";import"./index-Cvpkor55.js";import"./index-vGkf9gTg.js";import"./index-Rzgfwlcn.js";import"./index-5bJt7VTk.js";const ve={class:"rounded-2xl max-w-4xl mx-auto border border-slate-100 gap-1 flex flex-col bg-slate-100 p-4"},ye={class:"flex items-center justify-between"},he={key:0,class:"text-2xl"},_e={class:"flex gap-2 items-center"},ge={key:0,class:"flex gap-2 flex-wrap"},we={key:1,style:{"max-width":"160px","max-height":"120px",overflow:"hidden"}},xe={key:2},be={class:"flex justify-end"},Te={key:0},ke={key:1,class:"flex gap-2 flex-wrap"},$e={key:2},Ce={class:"rounded-xl overflow-clip"},De={key:3},Le={class:"rounded-xl overflow-clip"},Se={key:4},Ae={class:"rounded-xl overflow-clip",style:{"max-width":"560px","max-height":"420px"}},Ee=N({__name:"TeacherReviseViewer",props:{classData:{},unitType:{},unitContent:{}},setup(b){const{t:s}=q(),e=b,d=y(),_=y();(()=>{_.value={global:{value:null,matchMode:J.CONTAINS}}})();const r=[],k=[],l=y(0);function D(){r.push(0),k.push(s("pages.teacher.studentAnswers"));for(const n of e.classData)r.push(n.id),k.push(n.name.length>0?n.name:n.email)}D();const p=z(()=>e.classData.find(n=>n.id===r[l.value]));function $(n){var a,m;return!((a=e.unitContent)!=null&&a.options)||!((m=n.answer)!=null&&m.options)?[]:e.unitContent.options.filter(g=>n.answer.options.includes(g.id))}function f(n){return n==="completed"?"text-primary600":n==="attempted"?"text-rose400":n==="started"?"text-warning400":""}function U(){l.value=0}function W(){l.value-=1,l.value<0&&(l.value=0)}function K(){l.value+=1,l.value==r.length&&(l.value=r.length-1)}function O(n){for(let a=0;a<r.length;a++)r[a]==n&&(l.value=a)}function R(n){var a,m,g,L;for(let C=0;C<r.length;C++)if(r[C]==n){const x=e.classData.find(j=>j.id===r[C]);if(e.unitType=="options")return x;if(e.unitType=="submit-image")return((a=x.answer)==null?void 0:a.url)??"";let w="";return e.unitType=="open"&&(w=((m=x.answer)==null?void 0:m.open)??""),e.unitType=="code"&&(w=((g=x.answer)==null?void 0:g.code)??""),e.unitType=="pibody"&&(w=((L=x.answer)==null?void 0:L.code)??""),w.length>25?w.substring(0,25)+"...":w}}return(n,a)=>{var x,w,j,M;const m=Q,g=de,L=fe,C=pe;return t(),o("div",ve,[v("div",ye,[e.classData?(t(),o("div",he,[l.value!=0?(t(),h(m,{key:0,tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-left",outlined:"",onClick:a[0]||(a[0]=i=>U())},null,8,["tooltip"])):E("",!0),G(" "+S(k[l.value]),1)])):E("",!0),v("div",_e,[u(m,{tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-left",rounded:"",severity:"contrast",onClick:a[1]||(a[1]=i=>W()),disabled:l.value==0},null,8,["tooltip","disabled"]),u(m,{tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-right",rounded:"",severity:"contrast",onClick:a[2]||(a[2]=i=>K()),disabled:l.value==r.length-1},null,8,["tooltip","disabled"])])]),v("div",null,[r[l.value]==0?(t(),h(C,{key:0,ref_key:"dt",ref:d,filters:_.value,"onUpdate:filters":a[3]||(a[3]=i=>_.value=i),value:e.classData,dataKey:"id",globalFilterFields:["name","status"],class:"rounded-md overflow-hidden w-full",scrollable:"",scrollHeight:"400px"},{default:A(()=>[u(g,{field:"name",header:n.$t("pages.teacher.name"),sortable:""},{body:A(({data:i})=>[v("div",null,S(`${i.name.length>0?i.name:i.email}`),1)]),_:1},8,["header"]),u(g,{field:"status",header:n.$t("pages.school.status"),sortable:""},{body:A(({data:i})=>[v("div",{class:H(f(i.status))},S(`${i.status}`),3)]),_:1},8,["header"]),u(g,{header:n.$t("pages.teacher.answer"),exportable:!1,sortable:""},{body:A(({data:i})=>[e.unitType=="options"?(t(),o("div",ge,[(t(!0),o(I,null,V($(R(i.id)),B=>(t(),o("div",{key:B.id},[u(c(F),{text:B.text},null,8,["text"])]))),128))])):e.unitType=="submit-image"?(t(),o("div",we,[u(L,{src:R(i.id),style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,["src"])])):(t(),o("div",xe,S(`${R(i.id)}`),1))]),_:1},8,["header"]),u(g,{header:"",exportable:!1,class:"text-right",headerClass:"text-right"},{body:A(({data:i})=>[v("div",be,[u(m,{tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:B=>O(i.id)},null,8,["tooltip","onClick"])])]),_:1})]),_:1},8,["filters","value"])):(t(),o(I,{key:1},[e.unitType=="open"?(t(),o("div",Te,S(((x=p.value.answer)==null?void 0:x.open)??""),1)):e.unitType=="options"?(t(),o("div",ke,[(t(!0),o(I,null,V($(p.value),i=>(t(),o("div",{key:i.id},[u(c(F),{text:i.text},null,8,["text"])]))),128))])):e.unitType=="code"?(t(),o("div",$e,[v("div",Ce,[u(c(F),{text:` \`\`\`python
${((w=p.value.answer)==null?void 0:w.code)??""}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(t(),o("div",De,[v("div",Le,[u(c(F),{text:` \`\`\`python
${((j=p.value.answer)==null?void 0:j.code)??""}
\`\`\` `},null,8,["text"])])])):e.unitType=="submit-image"?(t(),o("div",Se,[v("div",Ae,[u(L,{src:(M=p.value.answer)==null?void 0:M.url,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,["src"])])])):E("",!0)],64))])])}}}),je=me(Ee,[["__scopeId","data-v-bad98aaa"]]),Fe=X("teacher-revise-store",()=>{const b=Y(),s=y(null),e=y(!1),d=y([]),_=y(null),T=y(null),r=y(!1),k=y(!1);async function l(p,$){try{e.value=!0;const{data:f}=await ne.getLessonWithClassData(p,$);s.value=oe(f),await D()}catch(f){b.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{e.value=!1}}async function D(){if(s.value)try{d.value=[],s.value.pages.forEach(p=>{p.groups.forEach($=>{$.units.forEach(f=>{d.value.push(f),(f.unitType=="code"||f.unitType=="pibody")&&(r.value=!0,T.value=ie("emulatorID"),T.value.setCode("")),f.unitType=="pibody"&&(k.value=!0,_.value=ae("emulatorID"),_.value.addNeededModules([]))})})})}catch(p){console.error("Error loading units:",p)}finally{}}return{selectedLesson:s,isLessonLoading:e,units:d,showPibody:k,showCode:r,loadLessonWithClassData:l}}),Ie={key:1,class:"flex-grow px-4 py-2"},Ne=N({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(b){const s=b;let e=!1;return Z(()=>{s.unit.classData&&(s.unit.unitType=="options"&&(e=!0),s.unit.unitType=="open"&&(e=!0),s.unit.unitType=="code"&&(e=!0),s.unit.unitType=="pibody"&&(e=!0),s.unit.unitType=="checklist"&&(e=!0),s.unit.unitType=="submit-image"&&(e=!0))}),(d,_)=>{const T=P;return t(),o("div",null,[d.loading?(t(),h(T,{key:0,class:"flex justify-center items-center w-10 h-full"})):(t(),o("div",Ie,[s.unit.unitType=="article"?(t(),h(c(re),{key:0,article:s.unit.content},null,8,["article"])):s.unit.unitType=="options"?(t(),h(c(le),{key:1,"options-data":s.unit.content,state:s.unit.studentState},null,8,["options-data","state"])):s.unit.unitType=="open"?(t(),h(c(ue),{key:2,state:s.unit.studentState},null,8,["state"])):s.unit.unitType=="video"?(t(),h(c(ce),{key:3,video:s.unit.content},null,8,["video"])):E("",!0),c(e)?(t(),h(c(je),{key:4,classData:s.unit.classData,unitType:s.unit.unitType,unitContent:s.unit.content},null,8,["classData","unitType","unitContent"])):E("",!0)]))])}}}),Re={ref:"rootEl",class:"flex flex-col gap-8"},Be=N({__name:"UnitsView",props:{units:{}},setup(b){return(s,e)=>(t(),o("div",Re,[(t(!0),o(I,null,V(s.units,d=>(t(),h(Ne,{key:d.id,unit:d},null,8,["unit"]))),128))],512))}}),Ve={class:"h-full flex flex-col overflow-y-auto relative bg-white"},Me={class:"w-full max-w-screen-lg mx-auto py-8"},Pe={key:1,class:"flex justify-center"},Ue={key:2},yt=N({__name:"TeacherRevisePage",setup(b){const s=se(),e=Fe(),{units:d,isLessonLoading:_,selectedLesson:T}=ee(e),{loadLessonWithClassData:r}=e;return te(()=>{r(s.params.class_id,s.params.lesson_id)}),(k,l)=>{const D=P;return t(),o("div",Ve,[v("div",Me,[c(_)?(t(),h(D,{key:0,class:"flex justify-center"})):c(T)?(t(),o("div",Ue,[u(Be,{units:c(d)},null,8,["units"])])):(t(),o("div",Pe,"No lesson found"))])])}}});export{yt as default};
