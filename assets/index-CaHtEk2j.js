import{_ as pe,a as ve,b as fe,c as me,s as ye}from"./VideoViewer.vue_vue_type_script_setup_true_lang-DFOOG0te.js";import{s as ee}from"./index-Bu8zIjCH.js";import{d as ge,u as we,r as o,A as te,f as Q,b as R,e as Y,o as i,c,q as y,j as n,v as T,C as se,F as be,n as _e,D as Z,h as he,E as xe,k as d,i as m,t as Se,G as ke,w as G,H as J,K as Le,x as Ce,y as $e}from"./index-DcapWIgY.js";import{u as Ee,a as Pe}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-CDZfPaDU.js";import{S as Ie}from"./SimulationView-CFUUrLB1.js";import{_ as Ue}from"./CodeViewer.vue_vue_type_script_setup_true_lang-IcX6bNbV.js";import{_ as je}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-CQ1Qxs9t.js";import{u as oe}from"./useLocaleStore-DCHvRxBE.js";import{L as Be}from"./lessonApi-DDM0ZogN.js";import{m as Ae}from"./mapLessonFromDto-DxMZVnwf.js";import{m as De}from"./mapUnitFromDto-BRBO9875.js";import{U as X}from"./unitApi-DVYndemw.js";import{u as ne}from"./index-CN-mlZVJ.js";import"./index-BTFbEIbj.js";import"./index-DdqczI40.js";import"./index-BBBkOwxZ.js";import"./index-C7uFx1yG.js";import"./index-BKGqSKvC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CQ8RkMui.js";import"./index-CPCPR8Ib.js";import"./index-BP2AELCe.js";import"./index-BWiVxrSA.js";import"./index-CcE3EFP3.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-CGD_PO48.js";const ae=ge("project-store",()=>{const j=we(),e=o(null),g=o(!1),h=o(!1),B=o(!1),C=o(!1),p=o(!1),S=o(0),A=o(0),a=o([]),w=o([]),k=o(0),b=o(new Map),$=o([]),K=o(!1),W=o(!1),F=o(!1),V=o(!0),v=o(""),D=o(null),M=o(null),x=o([]),L=o([]),E=te(),P=oe(),{lang:N}=Q(P),I=o(void 0),f=R(()=>{var s;return F.value&&(((s=D.value)==null?void 0:s.modulesWerePut)??!0)&&V.value});async function t(s,u){try{g.value=!0,I.value=E.userRole==="editor"?N.value:void 0;const{data:l}=await Be.getLessonById(s,u,I.value);e.value=Ae(l),await _()}catch(l){j.add({severity:"error",summary:l.response.data.error,life:2e3})}finally{g.value=!1}}async function _(){if(e.value)try{p.value=!0,S.value=0,b.value.clear(),a.value=[];const s=[];e.value.pages.forEach(l=>{l.groups.forEach(z=>{z.units.forEach(H=>{s.push(H.id)})})});const{data:u}=await X.getUnitsByIdsandLessonId(s,e.value.id,I.value);for(const l of u)a.value.push(De(l)),["code","pibody"].includes(l.unit_type)&&O(l.unit_type,a.value[a.value.length-1])}catch(s){console.error("Error preloading units:",s)}finally{p.value=!1}}function q(s,u){if(e.value!=null){for(const[l,z]of w.value.entries())for(const[H,ce]of z.units.entries())if(ce.id==s){w.value[l].units[H].studentState.answer=u;break}}}function O(s,u){let l="";if(v.value==""||u.content.starting!=""){l=`emulator-${u.id}`;const z=u.studentState.answer.code;M.value=Ee(l),M.value.setCode(z)}v.value=l??v.value,s=="pibody"&&(D.value=Pe(v.value),x.value=u.data.neededModules,D.value.addNeededModules(x.value),l!=""&&(L.value=u.studentState.answer.slots))}function r(){b.value.clear(),S.value=0,p.value=!1}function ie(s){F.value=s}function le(){V.value=!0}async function re(s){if(v.value=="")return;const u=Number(v.value.split("-")[1]);s.code=M.value.code,q(u,s),await X.saveUnitByIdandLessonId(u,e.value.id,{answer:s})}const U=R(()=>e.value?e.value.pages[A.value]??null:null),ue=R({get:()=>{var s;return((s=U.value)==null?void 0:s.showPibody)??!1},set:s=>{U.value&&(U.value.showPibody=s)}}),de=R({get:()=>{var s;return((s=U.value)==null?void 0:s.showCode)??!1},set:s=>{U.value&&(U.value.showCode=s)}});return{selectedLesson:e,isLessonLoading:g,isUnitLoading:h,units:a,groups:w,groupIndex:k,isGroupLoading:B,isSubmitLoading:C,isLoadingUnits:p,preloadingProgress:S,submitExist:K,correct:W,submitEnabled:f,pageProgress:$,emulatorID:v,neededModules:x,slots:L,showPibody:ue,showCode:de,setSubmitable:ie,loadLessonById:t,loadAllUnits:_,clearUnitsCache:r,saveAnswer:q,runCodePressed:le,saveStudentIdeState:re}}),Me={key:1,class:"flex-grow px-4 py-2"},Ne=Y({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(j){const e=j,g=se(),h=ae(),{saveAnswer:B,setSubmitable:C}=h;function p(a){e.unit.unitType=="options"?C(a.options.length>0):e.unit.unitType=="open"&&C(a.open.length>0),B(e.unit.id,a),S(a)}const S=ne(a=>{A(a)},1e3,{maxWait:5e3});async function A(a){await X.saveUnitByIdandLessonId(e.unit.id,Number(g.params.id),{answer:a})}return(a,w)=>{const k=ee;return i(),c("div",null,[a.loading?(i(),y(k,{key:0,class:"flex justify-center items-center w-10 h-full"})):(i(),c("div",Me,[e.unit.unitType=="article"?(i(),y(n(pe),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(i(),y(n(ve),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:p},null,8,["options-data","state"])):e.unit.unitType=="open"?(i(),y(n(fe),{key:2,state:e.unit.studentState,onSaveAnswer:p},null,8,["state"])):e.unit.unitType=="video"?(i(),y(n(me),{key:3,video:e.unit.content},null,8,["video"])):T("",!0)]))])}}}),ze={ref:"rootEl",class:"flex flex-col gap-8"},Re=Y({__name:"UnitsView",props:{units:{}},setup(j){return(e,g)=>(i(),c("div",ze,[(i(!0),c(be,null,_e(e.units,h=>(i(),y(Ne,{key:h.id,unit:h},null,8,["unit"]))),128))],512))}}),Te={class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},We={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},Fe={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},Ve={class:"flex items-center gap-4"},qe={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4 justify-center"},Oe={class:"text-2xl"},Ge={class:"flex-1 overflow-y-auto mt-16 mb-0 w-full"},Ke={key:1,class:"flex justify-center"},He={key:2},Je={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},Qe={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},Xe={class:"relative h-full"},Ye={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Ze={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},et={class:"relative h-full"},tt={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Et=Y({__name:"ProjectPage",setup(j){const e=se(),g=Ce(),h=te(),B=oe(),{lang:C}=Q(B);Z(C,async(f,t)=>{f!==t&&a.value&&await W(Number(e.params.id),(e.query.route_id??"").toString())});const p=ae(),{units:S,isLessonLoading:A,selectedLesson:a,emulatorID:w,neededModules:k,slots:b,showPibody:$,showCode:K}=Q(p),{loadLessonById:W,saveStudentIdeState:F}=p;function V(){g.push({name:"projects2"})}Z(b,()=>{v({slots:b.value})});const v=ne(f=>{F(f)},1e3,{maxWait:5e3});function D(f){v({slots:b.value})}const M=()=>{const f=e.path.replace("/project/","/lesson/");g.push(`${f}/edit`)},x=o(window.innerWidth),L=o(16),E=o(!0),P=o(!0);function N(){if(x.value=window.innerWidth,x.value<=1300){L.value=16;return}const t=452-(x.value-1024)/2;L.value=t>16?t:16}he(()=>{N(),W(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",N)}),xe(()=>{window.removeEventListener("resize",N)});const I=R(()=>x.value<=1920?{}:"calc((-100vw + 1920px) / 2)");return(f,t)=>{const _=$e,q=ee,O=ye;return i(),c("div",Te,[d("div",We,[d("div",Fe,[d("div",Ve,[m(_,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:V})]),n(a)?(i(),c("div",qe,[d("div",Oe,Se(n(a).name),1)])):T("",!0),t[9]||(t[9]=d("div",{class:"w-10"},null,-1))])]),d("div",Ge,[d("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:ke({paddingLeft:L.value+"px",paddingRight:L.value+"px"})},[n(A)?(i(),y(q,{key:0,class:"flex justify-center"})):n(a)?(i(),c("div",He,[m(Re,{units:n(S)},null,8,["units"])])):(i(),c("div",Ke,"No lesson found")),n(h).userRole=="editor"?(i(),c("div",Je,[m(n(je)),m(_,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:M})])):T("",!0)],4)]),n($)?(i(),c("div",Qe,[m(_,{icon:"pi pi-microchip",severity:"secondary",onClick:t[0]||(t[0]=r=>E.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),m(O,{visible:E.value,"onUpdate:visible":t[4]||(t[4]=r=>E.value=r),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${I.value}`}}},{header:G(()=>t[10]||(t[10]=[d("div",null,null,-1)])),container:G(()=>[d("div",Xe,[d("div",Ye,[m(_,{icon:"pi pi-chevron-left",severity:"secondary",onClick:t[1]||(t[1]=r=>E.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(i(),y(n(Ie),{id:n(w),key:n(w),slots:n(b),"onUpdate:slots":t[2]||(t[2]=r=>J(b)?b.value=r:null),neededModules:n(k),"onUpdate:neededModules":t[3]||(t[3]=r=>J(k)?k.value=r:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):T("",!0),n(K)?(i(),c("div",Ze,[m(_,{icon:"pi pi-code",severity:"secondary",onClick:t[5]||(t[5]=r=>P.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),m(O,{visible:P.value,"onUpdate:visible":t[8]||(t[8]=r=>P.value=r),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${I.value}`}}},{header:G(()=>t[11]||(t[11]=[d("div",null,null,-1)])),container:G(()=>[d("div",et,[d("div",tt,[m(_,{icon:"pi pi-chevron-right",severity:"secondary",onClick:t[6]||(t[6]=r=>P.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(i(),y(Le,null,[(i(),y(n(Ue),{id:n(w),key:n(w),connectbuttons:n($),"onUpdate:connectbuttons":t[7]||(t[7]=r=>J($)?$.value=r:null),onSaveAnswer:D},null,8,["id","connectbuttons"]))],1024))])]),_:1},8,["visible","pt"])])):T("",!0)])}}});export{Et as default};
