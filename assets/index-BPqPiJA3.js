import{s as Le,a as Ne}from"./index-CFEJNvZt.js";import{e as K,o,c as n,h as t,a,t as s,v as u,b as ve,F as G,G as D,j as N,q as ee,i as O,w as $,k as b,d as Pe,u as De,r as g,y as Z,l as Ie,a6 as Oe,s as ge,C as Ge,B as be,L as Ae,K as je}from"./index-8eYd0-Co.js";import{_ as ze}from"./MainHeader.vue_vue_type_script_setup_true_lang-9nA_jXJL.js";import"./index-v1ivQW6n.js";import{_ as We}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-D0Jwc_il.js";import{O as T,v as oe,T as Xe,I as m,b as H,f as He,d as Te,g as ye,h as he,l as Ke,i as Je,u as Qe,a as Ye,e as ne,j as Ze,k as et,m as V,n as tt,o as st,p as ke,R as de,r as we}from"./IdeButtons.vue_vue_type_script_setup_true_lang-BjZTJ3Qu.js";import{o as W,v as qe,c as X,M as ie,m as $e,P as ue,p as pe,d as re,i as q,a as at,u as lt,b as ot}from"./store-DJ783GSL.js";import"./CodeEditorView.vue_vue_type_script_setup_true_lang-Cltxh41k.js";import{s as xe}from"./index-CvjYr3FY.js";import{s as nt}from"./index-Ca4SICfI.js";import{s as dt}from"./index-B3NttIqY.js";import{s as rt}from"./index-DSx-p37b.js";import{U as Ce}from"./unitApi-COQDlsTX.js";import{m as ct}from"./mapUnitFromDto-C-vlLM9s.js";import{C as ce}from"./cloudStorageApi-bDCOPLaA.js";import"./UserMenu.vue_vue_type_script_setup_true_lang-BRlzN8C8.js";import"./index-WXQmNEQQ.js";import"./index-B8MXaspB.js";import"./logo-D1-3uCnC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PremiumForm.vue_vue_type_script_setup_true_lang-Ba8DXsyo.js";import"./index-19jCyGXe.js";import"./otherApi-DDWnLwKS.js";import"./index-Ck89Hfr2.js";import"./index-eKsVto-V.js";import"./index-c_rbGUP2.js";import"./index-DCkUGzHX.js";import"./LocaleSelectButton.vue_vue_type_script_setup_true_lang-DZQGeYqM.js";import"./index-DSyhlytj.js";import"./language-DYQF8nnT.js";import"./index-BqAwfTve.js";import"./SimulationView-_SSNKHsZ.js";import"./index-CID063JX.js";import"./index-DQafit8Y.js";import"./index-CH_iu5NA.js";import"./index-ahqnJA0E.js";import"./index-fKBIE13H.js";import"./index-VgJXLjdG.js";import"./index-C5W94n6N.js";import"./index-CrUX9qwQ.js";import"./index-CQCkvxda.js";import"./index-CsjCzc3Q.js";const it={key:0,class:"text-nowrap"},ut={key:0,class:"text-white"},mt={key:1,class:"text-white"},vt={key:2,class:"text-white"},xt={key:3,class:"text-white"},ft={key:4,class:"text-white"},gt={key:5,class:"text-black w-full"},bt={class:"text-center font-mono px-1 text-white bg-black"},yt={key:6,class:"text-black w-full"},ht={class:"text-center font-mono px-1 text-white bg-black"},kt={key:7,class:"text-black w-full p-3"},wt={key:8,class:"text-white"},qt={key:9,class:"text-black w-full"},$t={class:"text-center font-mono px-1 text-white bg-black"},pt={key:10,class:"text-white w-full"},Ct={key:11,class:"text-white w-full"},_t={key:12,class:"text-white w-full"},Mt={key:13,class:"text-white w-full"},Pt={key:14,class:"text-black w-full"},It={class:"text-center font-mono px-1 text-white bg-black"},Tt={key:15,class:"text-black w-full"},Rt={class:"text-center px-1"},Et={class:"text-center font-mono px-1 text-white bg-black"},St={key:16,class:"text-black w-full"},Ut={class:"text-center px-1"},Ft={class:"text-center font-mono px-1 text-white bg-black"},Bt={key:17,class:"text-black w-full"},Vt={class:"text-center px-1"},Lt={class:"text-center font-mono px-1 text-white bg-black"},Nt={key:18,class:"text-black w-full"},Dt={class:"text-center font-mono px-1 text-white bg-black"},Ot={key:19,class:"text-black w-full"},Gt={class:"text-center px-1"},At={class:"text-center font-mono px-1 text-white bg-black"},jt={key:20,class:"text-black w-full"},zt={class:"text-center px-1"},Wt={class:"text-center font-mono px-1 text-white bg-black"},Xt={key:21,class:"text-black w-full"},Ht={class:"text-center px-1"},Kt={class:"text-center font-mono px-1 text-white bg-black"},Jt={key:22,class:"text-black w-full"},Qt={class:"text-center font-mono px-1 text-white bg-black"},Yt={key:23,class:"text-black w-full"},Zt={class:"text-center px-1"},es={class:"text-center font-mono px-1 text-white bg-black"},ts={key:24,class:"text-black w-full"},ss={class:"text-center font-mono px-1 text-white bg-black"},as={key:25,class:"text-black w-full"},ls={class:"text-center px-1"},os={class:"text-center font-mono px-1 text-white bg-black"},ns={key:26,class:"text-black w-full"},ds={class:"text-center font-mono px-1 text-white bg-black"},rs={key:27,class:"text-black w-full"},cs={class:"text-center px-1"},is={class:"text-center font-mono px-1 text-white bg-black"},us={key:28,class:"text-black w-full"},ms={class:"text-center px-1"},vs={class:"text-center font-mono px-1 text-white bg-black"},xs={key:29,class:"text-black w-full"},fs={class:"text-center font-mono px-1 text-white bg-black"},gs={key:30,class:"text-black w-full"},bs={key:1,class:"text-center p-3"},me=K({__name:"FeedbackNode",props:{message:{type:Object,required:!0},isExpected:{type:Boolean,required:!0}},setup(e){return(d,c)=>e.message?(o(),n("div",it,[e.message.command===t(T).PinSetValue?(o(),n("div",ut,[a("div",{style:u({background:t(W)}),class:"text-center font-mono px-1"},s(t(oe)(e.message,e.isExpected))+" set value",5),a("div",{style:u(t(X)(e.message.request.value)),class:"text-center font-mono px-1"}," Value "+s(t(qe)(e.message.request.value)),5)])):e.message.command===t(T).PinSetMode?(o(),n("div",mt,[a("div",{style:u({background:t(W)}),class:"text-center font-mono px-1"},s(t(oe)(e.message,e.isExpected))+" set mode",5),a("div",{style:u({background:t($e)[e.message.request.mode]}),class:"text-center font-mono px-1"}," Mode "+s(t(ie)[e.message.request.mode]),5)])):e.message.command===t(T).PinSetPull?(o(),n("div",vt,[a("div",{style:u({background:t(W)}),class:"text-center font-mono px-1"},s(t(oe)(e.message,e.isExpected))+" set pull",5),a("div",{style:u({background:t(pe)[e.message.request.pull]}),class:"text-center font-mono px-1"}," Pull "+s(t(ue)[e.message.request.pull]),5)])):e.message.command===t(T).PwmDutyU16?(o(),n("div",xt,[a("div",{style:u({background:t(W)}),class:"text-center font-mono px-1"},"PWM "+s(e.message.request.pin)+" set duty",5),a("div",{style:u(t(X)(e.message.request.duty_u16/t(re))),class:"text-center font-mono px-1"}," u16 "+s(e.message.request.duty_u16),5)])):e.message.command===t(T).PwmFreq?(o(),n("div",ft,[a("div",{style:u({background:t(W)}),class:"text-center font-mono px-1"},"PWM "+s(e.message.request.pin)+" set freq",5),a("div",{style:u(t(X)(e.message.request.freq/t(re))),class:"text-center font-mono px-1"}," Freq "+s(e.message.request.freq),5)])):e.message.command===t(T).Output?(o(),n("div",gt,[c[0]||(c[0]=a("div",{class:"text-center px-1"},"Print",-1)),a("div",bt,s(e.message.request.output),1)])):e.message.command===t(T).Sleep?(o(),n("div",yt,[c[1]||(c[1]=a("div",{class:"text-center px-1"},"Sleep",-1)),a("div",ht,s(e.message.request.time_ms)+" ms",1)])):e.message.command===t(Xe).Timeout?(o(),n("div",kt," Timeout ")):e.message.command===t(T).NeoPixelWrite?(o(),n("div",wt,[a("div",{style:u({background:t(W)}),class:"text-center font-mono px-1"},"NeoPixel "+s(e.message.request.pin)+" write pixels",5),a("div",{style:u(t(X)(0)),class:"text-center font-mono px-1"}," pixels("+s(e.message.request.pixels.length)+") ",5)])):e.message.command===t(T).DisplayText?(o(),n("div",qt,[c[2]||(c[2]=a("div",{class:"text-center px-1"},"Display print",-1)),a("div",$t,s(e.message.request.text),1)])):e.message.command===t(m).PinGetValue?(o(),n("div",pt,[a("div",{style:u({background:t(q)}),class:"text-center font-mono px-1"},s(t(H)(e.message.request,e.message.meta,e.isExpected))+" get value",5),a("div",{style:u(t(X)(e.message.result)),class:"text-center font-mono px-1"}," Value "+s(t(qe)(e.message.result)),5)])):e.message.command===t(m).PinGetMode?(o(),n("div",Ct,[a("div",{style:u({background:t(q)}),class:"text-center font-mono px-1"},s(t(H)(e.message.request,e.message.meta,e.isExpected))+" get mode",5),a("div",{style:u({background:t($e)[e.message.result]}),class:"text-center font-mono px-1"}," Mode "+s(t(ie)[e.message.result]),5)])):e.message.command===t(m).PinGetPull?(o(),n("div",_t,[a("div",{style:u({background:t(q)}),class:"text-center font-mono px-1"},s(t(H)(e.message.request,e.message.meta,e.isExpected))+" get pull",5),a("div",{style:u({background:t(pe)[e.message.result]}),class:"text-center font-mono px-1"}," Pull "+s(t(ue)[e.message.result]),5)])):e.message.command===t(m).AdcReadU16?(o(),n("div",Mt,[a("div",{style:u({background:t(q)}),class:"text-center font-mono px-1"},"ADC "+s(e.message.request.pin)+" read ",5),a("div",{style:u(t(X)(e.message.result/t(re))),class:"text-center font-mono px-1"}," u16 "+s(e.message.result),5)])):e.message.command===t(m).Input?(o(),n("div",Pt,[c[3]||(c[3]=a("div",{class:"text-center px-1"},"Input",-1)),a("div",It,s(e.message.result),1)])):e.message.command===t(m).I2CScan?(o(),n("div",Tt,[a("div",Rt,"I2CScan sda:"+s(e.message.request.sda)+" scl: "+s(e.message.request.scl),1),a("div",Et,s(e.message.result),1)])):e.message.command===t(m).I2CReadFromMem?(o(),n("div",St,[a("div",Ut,"I2CReadFromMem sda:"+s(e.message.request.sda)+" scl: "+s(e.message.request.scl)+" addr:"+s(e.message.request.addr)+" memaddr:"+s(e.message.request.memaddr)+" nbytes:"+s(e.message.request.nbytes),1),a("div",Ft,s(e.message.result),1)])):e.message.command===t(T).I2CWriteToMem?(o(),n("div",Bt,[a("div",Vt,"I2CWriteToMem sda:"+s(e.message.request.sda)+" scl: "+s(e.message.request.scl)+" addr:"+s(e.message.request.addr)+" memaddr:"+s(e.message.request.memaddr),1),a("div",Lt,s(e.message.request.buf),1)])):e.message.command===t(T).BME280Init?(o(),n("div",Nt,[c[4]||(c[4]=a("div",{class:"text-center px-1"},"BME280 init",-1)),a("div",Dt," sda:"+s(e.message.request.sda)+" scl:"+s(e.message.request.scl),1)])):e.message.command===t(m).BME280ReadTemperature?(o(),n("div",Ot,[a("div",Gt,"BME280 "+s(e.message.request.sda)+" "+s(e.message.request.scl)+" read temperature",1),a("div",At,s(e.message.result)+" °C ",1)])):e.message.command===t(m).BME280ReadPressure?(o(),n("div",jt,[a("div",zt,"BME280 "+s(e.message.request.sda)+" "+s(e.message.request.scl)+" read pressure",1),a("div",Wt,s(e.message.result)+" Pa ",1)])):e.message.command===t(m).BME280ReadHumidity?(o(),n("div",Xt,[a("div",Ht,"BME280 "+s(e.message.request.sda)+" "+s(e.message.request.scl)+" read humidity",1),a("div",Kt,s(e.message.result)+" % ",1)])):e.message.command===t(T).VEML6040Init?(o(),n("div",Jt,[c[5]||(c[5]=a("div",{class:"text-center px-1"},"VEML6040 init",-1)),a("div",Qt," sda:"+s(e.message.request.sda)+" scl:"+s(e.message.request.scl),1)])):e.message.command===t(m).VEML6040ReadRGB?(o(),n("div",Yt,[a("div",Zt,"VEML6040 "+s(e.message.request.sda)+" "+s(e.message.request.scl)+" read rgb",1),a("div",es," r:"+s(e.message.result[0])+" g:"+s(e.message.result[1])+" b:"+s(e.message.result[2]),1)])):e.message.command===t(T).VL53L0XInit?(o(),n("div",ts,[c[6]||(c[6]=a("div",{class:"text-center px-1"},"VL53L0X init",-1)),a("div",ss," sda:"+s(e.message.request.sda)+" scl:"+s(e.message.request.scl),1)])):e.message.command===t(m).VL53L0XRead?(o(),n("div",as,[a("div",ls,"VL53L0X "+s(e.message.request.sda)+" "+s(e.message.request.scl)+" read",1),a("div",os," distance:"+s(e.message.result)+" mm ",1)])):e.message.command===t(T).MPU6050Init?(o(),n("div",ns,[c[7]||(c[7]=a("div",{class:"text-center px-1"},"MPU6050 init",-1)),a("div",ds," sda:"+s(e.message.request.sda)+" scl:"+s(e.message.request.scl),1)])):e.message.command===t(m).MPU6050ReadAccel?(o(),n("div",rs,[a("div",cs,"MPU6050 "+s(e.message.request.sda)+" "+s(e.message.request.scl)+" read accel",1),a("div",is," ax:"+s(e.message.result[0]/16384)+" ay:"+s(e.message.result[1]/16384)+" az:"+s(e.message.result[2]/16384),1)])):e.message.command===t(m).MPU6050ReadGyro?(o(),n("div",us,[a("div",ms,"MPU6050 "+s(e.message.request.sda)+" "+s(e.message.request.scl)+" read gyro",1),a("div",vs," gx:"+s(e.message.result[0]/131)+" gy:"+s(e.message.result[1]/131)+" gz:"+s(e.message.result[2]/131),1)])):e.message.command===t(m).Random?(o(),n("div",xs,[c[8]||(c[8]=a("div",{class:"text-center px-1"},"Random",-1)),a("div",fs,s(e.message.result),1)])):(o(),n("div",gs," Todo: "+s(e.message.command),1))])):(o(),n("div",bs," Nothing "))}}),ys={class:"flex-col overflow-auto"},hs={key:0,class:"flex text-white border-2 border-blue-500"},ks={class:"text-black text-nowrap"},ws={key:1,class:"flex text-white border-2 border-blue-500"},qs={class:"text-black text-nowrap"},$s={key:2,class:"flex text-white border-2 border-blue-500"},ps={class:"text-black text-nowrap"},Cs={key:3,class:"flex text-white border-2 border-blue-500"},_s={class:"text-black text-nowrap"},Ms={key:4,class:"flex text-white border-2 border-blue-500"},Ps={class:"text-black text-nowrap"},Is={key:5,class:"flex text-white border-2 border-blue-500"},Ts={class:"text-black text-nowrap"},Rs={key:6,class:"flex text-white border-2 border-blue-500"},Es={class:"text-black text-nowrap"},Ss={key:7,class:"flex text-white border-2 border-blue-500"},Us={class:"text-black text-nowrap"},Fs={key:8,class:"flex text-white border-2 border-blue-500"},Bs={class:"text-black text-nowrap"},Vs={key:9,class:"flex text-white border-2 border-blue-500"},Ls={class:"text-black text-nowrap"},Ns={key:10,class:"flex text-white border-2 border-blue-500"},Ds={class:"text-black text-nowrap"},Os={key:11,class:"flex text-white border-2 border-blue-500"},Gs={class:"text-black text-nowrap"},As={key:12,class:"flex text-white border-2 border-blue-500"},js={class:"text-black text-nowrap"},zs={key:13,class:"flex text-white border-2 border-blue-500"},Ws={class:"text-black text-nowrap"},Xs={key:14,class:"flex text-white border-2 border-blue-500"},Hs={class:"text-black text-nowrap"},Ks={key:15,class:"flex text-black border-2 border-blue-500"},Re=K({__name:"Inputs",props:{inputs:{},isExpected:{type:Boolean}},setup(e){const d=ve(()=>{const c=[];for(const[p,l]of e.inputs){const y=He(p);c.push({...y,result:l})}return c});return(c,p)=>(o(),n(G,null,[d.value.length===0?(o(),n(G,{key:0},[D("Nothing")],64)):N("",!0),a("div",ys,[(o(!0),n(G,null,ee(d.value,l=>(o(),n("div",{key:l.command,class:"flex"},[l.command===t(m).PinGetValue?(o(),n("div",hs,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},s(t(H)(l.request,l.meta,c.isExpected))+" get value: ",5),a("div",ks,s(l.result),1)])):l.command===t(m).PinGetMode?(o(),n("div",ws,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},s(t(H)(l.request,l.meta,c.isExpected))+" get mode: ",5),a("div",qs,s(l.result.map(y=>t(ie)[y])),1)])):l.command===t(m).PinGetPull?(o(),n("div",$s,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},s(t(H)(l.request,l.meta,c.isExpected))+" get pull: ",5),a("div",ps,s(l.result.map(y=>t(ue)[y])),1)])):l.command===t(m).AdcReadU16?(o(),n("div",Cs,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+s(l.request.pin)+" read u16:",5),a("div",_s,s(l.result),1)])):l.command===t(m).Input?(o(),n("div",Ms,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},"Console input:",4),a("div",Ps,s(l.result),1)])):l.command===t(m).I2CScan?(o(),n("div",Is,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},"I2CScan:",4),a("div",Ts,s(l.result),1)])):l.command===t(m).I2CReadFromMem?(o(),n("div",Rs,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},"I2CReadFromMem:",4),a("div",Es,s(l.result),1)])):l.command===t(m).BME280ReadTemperature?(o(),n("div",Ss,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(l.request.sda)+" "+s(l.request.scl)+" read_temperature: ",5),a("div",Us,s(l.result),1)])):l.command===t(m).BME280ReadPressure?(o(),n("div",Fs,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(l.request.sda)+" "+s(l.request.scl)+" read_pressure: ",5),a("div",Bs,s(l.result),1)])):l.command===t(m).BME280ReadHumidity?(o(),n("div",Vs,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(l.request.sda)+" "+s(l.request.scl)+" read_humidity: ",5),a("div",Ls,s(l.result),1)])):l.command===t(m).VEML6040ReadRGB?(o(),n("div",Ns,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"}," VEML6040 "+s(l.request.sda)+" "+s(l.request.scl)+" readRGB: ",5),a("div",Ds,s(l.result),1)])):l.command===t(m).VL53L0XRead?(o(),n("div",Os,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"}," VL53L0X "+s(l.request.sda)+" "+s(l.request.scl)+" read: ",5),a("div",Gs,s(l.result),1)])):l.command===t(m).MPU6050ReadAccel?(o(),n("div",As,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"}," MPU6050 "+s(l.request.sda)+" "+s(l.request.scl)+" read accel: ",5),a("div",js,s(l.result),1)])):l.command===t(m).MPU6050ReadGyro?(o(),n("div",zs,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"}," MPU6050 "+s(l.request.sda)+" "+s(l.request.scl)+" read gyro: ",5),a("div",Ws,s(l.result),1)])):l.command===t(m).Random?(o(),n("div",Xs,[a("div",{style:u({background:t(q)}),class:"text-center text-nowrap font-mono px-1"},"Random:",4),a("div",Hs,s(l.result),1)])):(o(),n("div",Ks,"TODO: "+s(l),1))]))),128))])],64))}}),Js={class:"flex overflow-auto mb-2"},Qs={class:"text-center"},Ys={key:0,class:"flex items-center justify-center h-12"},_e=K({__name:"TestDataTimeline",props:{data:{}},setup(e){const d=ve(()=>Te(e.data));return(c,p)=>{const l=xe;return o(),O(l,{header:"Expected"},{default:$(()=>[a("div",Js,[(o(!0),n(G,null,ee(c.data,(y,C)=>(o(),n("div",{class:"flex",key:C},[a("div",Qs,[b(me,{message:y.content,isExpected:!0,class:"border-4 border-blue-500"},null,8,["message"])]),C+1<c.data.length?(o(),n("div",Ys,"→")):N("",!0)]))),128))]),p[0]||(p[0]=D(" Inputs: ")),b(Re,{inputs:d.value,isExpected:!0},null,8,["inputs"])]),_:1})}}}),Zs=Pe("tester-store",()=>{const e=De(),d=g(null),c=g(!1),p=g(!1),l=g(!1),y=g(!1),C=g(!1),P=g(0),x=g(0),h=g(null),R=g(""),E=g([]),_=g(),U=g(),f=g();async function L(r,i,I){try{c.value=!0;const{data:v}=await Ce.getUnitByIdandLessonId(r,i);d.value=ct(v)}catch(v){e.add({severity:"error",summary:v.response.data.error,life:2e3})}finally{c.value=!1}try{if(d.value==null)return;if(P.value=i,x.value=r,d.value.unitType=="checklist"){if(I==null)return;h.value=I;const v=d.value.data;if(f.value=v.checks.find(S=>S.id===h.value),f.value==null)return;R.value=f.value.solution,E.value=await ye(f.value.tests),_.value=f.value.includedCommandsForTests??[...he],C.value=!0,y.value=!0;return}d.value.content&&(R.value=d.value.content.answer),d.value.data.tests&&(E.value=await ye(d.value.data.tests)),d.value.data.neededModules&&(U.value=d.value.data.neededModules),_.value=d.value.data.includedCommandsForTests??[...he],y.value=!0}catch(v){e.add({severity:"error",summary:v,life:2e3})}finally{c.value=!1}}async function A(r){if(!(x.value==null||P.value==null))try{p.value=!0,await Ce.updateUnitByIdandLessonId(x.value,P.value,r)}catch(i){e.add({severity:"error",summary:i.response.data.error,life:2e3})}finally{p.value=!1}}async function F(){if(d.value!=null){l.value=!0;try{C.value?f.value&&(f.value.solution=R.value,f.value.includedCommandsForTests=_.value):(d.value.content.answer=R.value,d.value.data.includedCommandsForTests=_.value),await A({content:d.value.content,data:d.value.data})}catch(r){let i="";r instanceof Error?i=r.message:i=String(r),e.add({severity:"error",summary:"Failed to save",detail:i,life:3e3})}finally{l.value=!1}}}async function j(r){const i=JSON.stringify(r),I=new Blob([i],{type:"application/json"}),v=new FormData;v.append("file",I,"default.test.json");const{data:S}=await ce.uploadFile(v,"tests");return S.source_url}async function te(r){if(d.value!=null)try{const i=await j(r);if(i==""){e.add({severity:"error",summary:"not saved",life:2e3});return}if(C.value){if(!f.value)return;f.value.tests?f.value.tests.push({name:"",url:i}):(f.value.tests=[],f.value.tests.push({name:"",url:i}))}else d.value.data.tests?d.value.data.tests.push({name:"",url:i}):(d.value.data.tests=[],d.value.data.tests.push({name:"",url:i}));E.value.push({data:r,test:{name:"",url:i}})}catch(i){e.add({severity:"error",summary:i.response.data.error,life:2e3})}}async function z(r){var i,I,v;if(d.value!=null)try{const S=E.value[r].test.url;if(await ce.deleteFile(S),C.value){const ae=d.value.data;f.value=ae.checks.find(le=>le.id===h.value),f.value&&((i=f.value.tests)==null||i.splice(r,1))}else(v=(I=d.value)==null?void 0:I.data.tests)==null||v.splice(r,1);E.value.splice(r,1)}catch(S){e.add({severity:"error",summary:S.response.data.error,life:2e3})}}async function se(r,i){if(!d.value)return;let I;const v=await j(i);if(v==""){e.add({severity:"error",summary:"not saved",life:2e3});return}if(C.value){if(!f.value||!f.value.tests)return;I=f.value.tests[r].url,f.value.tests[r].url=v}else{if(!d.value.data.tests)return;I=d.value.data.tests[r].url,d.value.data.tests[r].url=v}E.value[r].test.url=v,E.value[r].data=i;try{await ce.deleteFile(I)}catch(S){e.add({severity:"error",summary:S.response.data.error,life:2e3})}}return{selectedUnit:d,isUnitLoading:c,isInited:y,code:R,testsData:E,includedCommandsForTests:_,neededModules:U,loadUnitData:L,saveUnit:F,createTest:te,deleteTest:z,updateTest:se}}),ea=Pe("useMPDeviceStore",()=>{const e=g(localStorage.getItem("fileContent")||""),d=g(""),c=g(""),p=g(!1),l=g([]);async function y(x,h){l.value=[x],c.value=x,e.value=h}async function C(x){l.value=[x],c.value=x,e.value=await Ke(x)}function P(x){e.value=x}return{isProject:p,activeFiles:l,fileContent:e,fileName:d,filePath:c,openFile:y,loadFile:C,setCode:P}}),ta={class:"flex items-center gap-2"},sa={class:"font-bold"},aa=["onClick"],la={class:"text-center"},oa={key:0,class:"text-center"},na={key:0,class:"flex items-center justify-center h-20"},da=K({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(e){const d=e,{selectNode:c,selectedIndex:p,firstError:l}=Je(d.id,d.result),y=ve(()=>Te(d.result.replayed)),C=g(null),P=g([]);return(x,h)=>{const R=Ie,E=xe;return o(),O(E,null,{header:$(()=>[a("div",ta,[a("div",sa,s(x.$t("result")),1),d.result.success===!1?(o(),O(R,{key:0,severity:"danger",onClick:h[0]||(h[0]=_=>t(l)(P.value))},{default:$(()=>[D(s(x.$t("firsterror")),1)]),_:1})):N("",!0)])]),default:$(()=>[a("div",{ref_key:"scrollContainer",ref:C,class:"flex overflow-auto mb-2"},[(o(!0),n(G,null,ee(d.result.feedback,(_,U)=>{var f,L;return o(),n("div",{class:"flex",key:U},[a("button",{class:Z(["flex",t(p)===U?"border border-blue-500":""]),onClick:A=>t(c)(U),ref_for:!0,ref:A=>P.value[U]=A},[a("div",la,[D(s(_.correct?x.$t("correct"):x.$t("incorrect"))+" ",1),b(me,{message:(f=_.replayed)==null?void 0:f.content,isExpected:!1,class:Z(["border-4 rounded-md",_.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),_.correct?N("",!0):(o(),n("div",oa,[h[1]||(h[1]=D(s("Expected")+" ")),b(me,{message:(L=_.expected)==null?void 0:L.content,isExpected:!0,class:Z(["border-4 rounded-md",_.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,aa),U+1<d.result.feedback.length?(o(),n("div",na,"→")):N("",!0)])}),128))],512),h[2]||(h[2]=D(" Input used: ")),b(Re,{inputs:y.value,isExpected:!1},null,8,["inputs"])]),_:1})}}}),ra={class:"h-full flex flex-col"},ca={class:"p-4"},ia={class:"flex w-full gap-1"},ua={class:"material-icons"},ma={class:"material-icons"},va={class:"material-icons"},xa={class:"material-icons"},fa={class:"material-icons"},ga={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},ba={class:"flex gap-2 w-full"},ya=["for"],ha={class:"material-icons"},ka={class:"material-icons"},wa=K({__name:"TesterControls",props:{id:{},lesson_id:{},unit_id:{},check_id:{}},setup(e){const d=e,c=Oe(),p=Zs(),{selectedUnit:l,isInited:y,code:C,neededModules:P,testsData:x,includedCommandsForTests:h}=ge(p),{saveUnit:R,loadUnitData:E,createTest:_,deleteTest:U,updateTest:f}=p;Ge(async()=>{try{if(await E(d.unit_id,d.lesson_id,d.check_id),!y)return;if(F.value=C.value,z.setCode(F.value),P.value)for(const k of P.value)k.module&&k.slot&&j.newModuleToSlot(k.module,k.slot)}catch(k){console.log(k)}});const L=ot(async()=>{await R()},1e3,{maxWait:5e3});function A(k){c.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{await U(k),await R()}})}const{fileContent:F}=ge(ea()),j=at(d.id),te=Qe(d.id),z=lt(d.id),se=Ye(d.id);ne.registerSimulation(d.id,{terminal:te,display:se,pibody:j});const r=ne.getSharedEmulator(),{isLoading:i,isRunning:I}=r;j.addNeededModules([]);const v=g(ke),S=g(ke);be(z.code,async k=>{typeof k=="string"&&k!==F.value&&(F.value=k,y.value&&(C.value=k,L()))});function ae(){r.recorder.start();const k=typeof z.code.value=="string"?z.code.value:"";ne.run(d.id,k);const w=be(r.recorder.state,()=>{(r.replayer.state.value==de.Finish||r.replayer.state.value==de.Timeout)&&(r.recorder.stop(),v.value=r.recorder.getRecords()),w.stop()})}function le(){r.replayer.state.value==de.Continue?(r.recorder.stop(),r.replayer.stop(),S.value=r.recorder.getRecords()):(r.recorder.stop(),v.value=r.recorder.getRecords()),r.stop()}async function Ee(){await _(v.value),await R(),v.value=[]}const Se=async()=>{V.value=!0;for(const[k,w]of x.value.entries()){const J=await we(r,F.value,w.data,h.value);await r.stopPromise(),await f(k,J)}await R(),V.value=!1},Ue=async(k,w)=>{V.value=!0;const J=await we(r,F.value,k.data,h.value);await r.stopPromise(),await f(w,J),await R(),V.value=!1};return(k,w)=>{const J=rt,B=Ie,Fe=dt,Be=nt,Ve=xe;return o(),n("div",ra,[a("div",ca,[w[4]||(w[4]=D(" Include Commands: ")),t(y)?(o(),O(J,{key:0,onChange:t(L),modelValue:t(h),"onUpdate:modelValue":w[0]||(w[0]=M=>Ae(h)?h.value=M:null),options:Ze,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):N("",!0),a("div",ia,[b(B,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:ae,disabled:t(i)||t(I)},{default:$(()=>[a("span",ua,s(t(i)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:le,disabled:t(i)||!t(I)},{default:$(()=>[a("span",ma,s(t(i)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:w[1]||(w[1]=M=>Ee()),disabled:v.value.length<=0||t(l)==null},{default:$(()=>[a("span",va,s(t(i)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:w[2]||(w[2]=M=>t(et)(t(r),t(F),t(x),t(h))),disabled:t(i)||t(V)},{default:$(()=>[a("span",xa,s(t(i)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",rounded:"",onClick:w[3]||(w[3]=M=>Se()),disabled:t(i)||!t(x)||t(V)},{default:$(()=>[a("span",fa,s(t(i)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"])])]),v.value.length>0?(o(),O(_e,{key:0,data:v.value,class:"mt-2"},null,8,["data"])):N("",!0),a("div",ga,[(o(!0),n(G,null,ee(t(x),(M,Q)=>{var fe;return o(),O(Ve,{toggleable:"",key:M.test.url,class:Z(["border-4",t(st)((fe=M.result)==null?void 0:fe.success)])},{header:$(()=>[a("div",ba,[b(Be,{variant:"on",class:"w-full"},{default:$(()=>[a("label",{for:`name ${Q+1}`},"Test "+s(Q+1),9,ya),b(Fe,{id:`name ${Q+1}`,onInput:t(L),modelValue:M.test.name,"onUpdate:modelValue":Y=>M.test.name=Y,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:Y=>t(tt)(t(r),t(F),M,t(h)),disabled:t(i)||t(V)},{default:$(()=>[a("span",ha,s(t(i)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:Y=>A(Q)},{default:$(()=>w[5]||(w[5]=[a("span",{class:"material-icons"},s("delete_forever"),-1)])),_:2},1032,["onClick"]),b(B,{type:"button",class:"w-9 h-9",rounded:"",onClick:Y=>Ue(M,Q),disabled:t(i)||!t(x)||t(V)},{default:$(()=>[a("span",ka,s(t(i)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:Y=>M.result=void 0,disabled:!t(x)||t(V)},{default:$(()=>w[6]||(w[6]=[a("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:$(()=>[b(_e,{data:M.data,class:"mt-2"},null,8,["data"]),M.result?(o(),O(da,{key:0,result:M.result,id:d.id},null,8,["result","id"])):N("",!0)]),_:2},1032,["class"])}),128))])])}}}),qa={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Me="tester",ul=K({__name:"TesterView",setup(e){const d=je(),c=Number(d.params.lesson_id),p=Number(d.params.unit_id),l=String(d.query.check_id);return(y,C)=>{const P=Le,x=Ne;return o(),n(G,null,[b(t(ze)),a("div",qa,[b(x,{class:"w-full rounded-none"},{default:$(()=>[b(P,{size:33,minSize:10,class:"max-w-[767px] h-full"},{default:$(()=>[b(wa,{id:Me,lesson_id:t(c),unit_id:t(p),check_id:t(l)},null,8,["lesson_id","unit_id","check_id"])]),_:1}),b(P,{size:67,minSize:10,class:"w-full h-full"},{default:$(()=>[b(t(We),{id:Me,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{ul as default};
