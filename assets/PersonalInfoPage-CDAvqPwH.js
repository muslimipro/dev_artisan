import{T as ee}from"./index-De9rL6wl.js";import{e as M,P as ae,u as R,J as se,s as q,r as u,D as le,o as n,i as g,w as y,a as s,k as m,G as F,t as v,j as B,h as t,U as A,ag as te,l as H,R as Y,f as re,g as oe,b as L,c as S,y as ne,H as ie}from"./index-BXslawiU.js";import{h as ue,z as P,s as de}from"./index-DkBeW8WF.js";import{s as G}from"./index-BbHqUexW.js";import{s as ce}from"./index-D-Li2oDx.js";import{s as me}from"./index-BB79oU2T.js";const ve={class:"text-blue-500"},pe={class:"flex flex-col gap-1"},fe={class:"flex gap-1 justify-end"},ge=M({__name:"VerifyEmailDialog",props:{modelValue:{type:Boolean,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(j){const i=ae(j,"modelValue"),d=R(),E=se(),{user:l}=q(E),_=u(!1),r=u(0);let p;const x=()=>{r.value=60,p=setInterval(()=>{r.value>0?r.value--:clearInterval(p)},1e3)};async function w(){_.value=!0;try{const{data:o}=await A.sendVerificationEmail();d.add({severity:"success",summary:o.message,life:2e3}),x()}catch(o){d.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}finally{_.value=!1}}return le(()=>{clearInterval(p)}),(o,$)=>{const k=te("i18n-t"),f=H,V=G,U=Y;return n(),g(U,{visible:i.value,"onUpdate:visible":$[0]||($[0]=b=>i.value=b),modal:"",draggable:!1,class:"m-4 max-w-md",header:o.$t("dialog.verifyYourEmail")},{footer:y(()=>[s("div",pe,[s("div",fe,[m(f,{label:r.value>0?`${o.$t("pages.login.resendIn")} ${r.value}s`:o.$t("dialog.sendVerificationEmail"),onClick:w,loading:_.value,disabled:_.value||r.value>0},null,8,["label","loading","disabled"])]),r.value>0?(n(),g(V,{key:0,severity:"success"},{default:y(()=>[F(v(o.$t("pages.settings.weHaveSentLinkToVerifyEmail")),1)]),_:1})):B("",!0)])]),default:y(()=>[s("div",null,[m(k,{keypath:"dialog.confirmEmailAddress"},{email:y(()=>{var b;return[s("span",ve,v((b=t(l))==null?void 0:b.email),1)]}),_:1})])]),_:1},8,["visible","header"])}}}),ye={class:"p-6 bg-white rounded-2xl gap-10"},_e={class:"text-heading-3-bold text-neutral900"},be={key:0},he={class:"flex flex-col md:flex-row items-center gap-8"},xe={class:"flex flex-col sm:flex-row gap-4"},we={class:"flex flex-col gap-2"},$e={class:"text-body-medium-regular text-neutral900"},ke={class:"p-4 rounded-lg bg-neutral50 flex flex-col gap-2"},Ve={class:"text-heading-5-semibold text-neutral900"},Ie={key:0,class:"text-body-medium-regular text-neutral"},Te={class:"flex flex-col gap-6"},Ce={class:"flex flex-col gap-1"},De={class:"text-body-medium-regular text-neutral900"},Se={class:"flex flex-col gap-1"},Ae={class:"text-body-medium-regular text-neutral400"},Ee={class:"flex gap-6 items-center"},Ue={key:1,class:"p-1 bg-primary h-6 w-6 rounded-full flex items-center justify-center"},Be=["src"],Re=M({__name:"PersonalInfoPage",setup(j){var N;const{t:i}=re(),d=R(),E=oe(),{userInfo:l,userLabel:_}=q(E),r=u(null),p=u(!1),x=u(!1),w=u(!1),o=L(()=>{var e;const a=(e=l.value)==null?void 0:e.user_type;return a?i(`pages.settings.userTypes.${a}`):""}),$=L(()=>{var e;const a=(e=l.value)==null?void 0:e.user_type;return a?i(`pages.settings.userTypeDescriptions.${a}`):""}),k=u(!1),f=u(!1),V=u(!1),U=u({name:((N=l.value)==null?void 0:N.name)??""}),b=ue(P.object({name:P.string().min(1,{message:i("pages.login.nameIsRequired")}).max(100,{message:i("pages.login.max100chars")})})),J=async a=>{if(!(f.value||!a.valid)){f.value=!0;try{await A.updateUserInfo({name:a.states.name.value}),d.add({severity:"success",summary:i("pages.settings.successfullySaved"),life:2e3}),V.value=!1}catch(e){d.add({severity:"error",summary:e.response.data.error,life:3e3})}finally{f.value=!1}}},K=async a=>{var I;const e=(I=a.target.files)==null?void 0:I[0];if(e){p.value=!0;try{const c=new FormData;c.append("file",e);const{data:T}=await A.uploadAvatar(c);l.value.large_avatar_url=T.large_avatar_url,l.value.small_avatar_url=T.small_avatar_url,d.add({severity:"success",summary:i("pages.settings.successfullySaved"),life:2e3})}catch(c){d.add({severity:"error",summary:c.response.data.error,life:3e3})}finally{p.value=!1,r.value&&(r.value.value="")}}},O=async()=>{x.value=!0;try{await A.deleteAvatar(),l.value.large_avatar_url="",l.value.small_avatar_url="",d.add({severity:"success",summary:i("pages.settings.successfullySaved"),life:2e3})}catch(a){d.add({severity:"error",summary:a.response.data.error,life:3e3})}finally{x.value=!1}};return(a,e)=>{const I=me,c=H,T=ce,Q=G,W=de,X=Y,Z=ee;return n(),S("div",ye,[s("div",_e,v(a.$t("personalInfo")),1),t(l)?(n(),g(W,{key:1,initialValues:U.value,resolver:t(b),onSubmit:J,class:"flex flex-col gap-6"},{default:y(h=>{var z;return[s("div",he,[t(l).large_avatar_url?(n(),g(I,{key:0,image:t(l).large_avatar_url,shape:"circle",class:"!w-24 !h-24 shrink-0 cursor-pointer",pt:{image:{class:"object-cover w-full h-full"}},onClick:e[0]||(e[0]=D=>w.value=!0)},null,8,["image"])):(n(),g(I,{key:1,label:t(_),shape:"circle",class:"!w-24 !h-24 shrink-0 text-xl"},null,8,["label"])),s("input",{ref_key:"avatarInput",ref:r,type:"file",accept:"image/*",class:"hidden",onChange:K},null,544),s("div",xe,[m(c,{type:"button",label:a.$t("pages.settings.uploadNewPicture"),variant:"outlined",class:"max-w-fit max-h-8 py-2 px-3 rounded-md",pt:{label:{class:"action-small-regular whitespace-nowrap"}},loading:p.value,onClick:e[1]||(e[1]=D=>{var C;return(C=r.value)==null?void 0:C.click()})},null,8,["label","loading"]),m(c,{type:"button",label:a.$t("pages.settings.deleteAvatar"),variant:"outlined",severity:"secondary",disabled:!t(l).large_avatar_url,class:ne(["max-w-full sm:max-w-fit max-h-8 py-2 px-3 rounded-md",{"!text-neutral-200 !border-neutral-200":!t(l).large_avatar_url,"text-neutral !border-200":t(l).large_avatar_url}]),pt:{label:{class:"action-small-regular whitespace-nowrap"}},loading:x.value,onClick:O},null,8,["label","disabled","class","loading"])])]),s("div",we,[s("div",$e,v(a.$t("pages.settings.accountType")),1),s("div",ke,[s("div",Ve,v(o.value),1),$.value?(n(),S("div",Ie,v($.value),1)):B("",!0)])]),s("div",Te,[s("div",Ce,[s("div",De,v(a.$t("pages.settings.name")),1),m(T,{name:"name",type:"text",fluid:"",placeholder:a.$t("pages.settings.name"),onInput:e[2]||(e[2]=D=>{var C;return V.value=D.target.value!==(((C=t(l))==null?void 0:C.name)??"")})},null,8,["placeholder"]),(z=h.name)!=null&&z.invalid?(n(),g(Q,{key:0,severity:"error",size:"small",variant:"simple"},{default:y(()=>[F(v(h.name.error.message),1)]),_:2},1024)):B("",!0)]),s("div",Se,[s("div",Ae,v(a.$t("email")),1),s("div",Ee,[m(T,{value:t(l).email,type:"text",fluid:"",placeholder:a.$t("email"),disabled:"",class:"flex-1"},null,8,["value","placeholder"]),t(l).verified?ie((n(),S("div",Ue,e[6]||(e[6]=[s("i",{class:"pi pi-check text-white",style:{"font-size":"0.75rem"}},null,-1)]))),[[Z,a.$t("pages.settings.verified")]]):(n(),g(c,{key:0,label:a.$t("dialog.verifyYourEmail"),severity:"warn",variant:"outlined",class:"flex-1",onClick:e[3]||(e[3]=D=>k.value=!0)},null,8,["label"]))])])])]}),_:1},8,["initialValues","resolver"])):(n(),S("div",be,"No user")),m(c,{type:"submit",label:a.$t("saveChanges"),size:"small",class:"w-fit self-end",disabled:f.value||!V.value,loading:f.value},null,8,["label","disabled","loading"]),m(ge,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=h=>k.value=h)},null,8,["modelValue"]),m(X,{visible:w.value,"onUpdate:visible":e[5]||(e[5]=h=>w.value=h),modal:"",draggable:!1,"show-header":!1,"dismissable-mask":!0,style:{width:"24rem"},pt:{root:{class:"!bg-transparent !shadow-none !border-none"},content:{class:"!p-0 !bg-transparent"},mask:{class:"backdrop-blur-sm"}}},{default:y(()=>[s("img",{src:t(l).large_avatar_url,alt:"avatar",class:"w-full aspect-square rounded-full object-cover"},null,8,Be)]),_:1},8,["visible"])])}}});export{Re as default};
