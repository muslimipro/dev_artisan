import{f as _e,d as he,a as ge}from"./index-oK-f2wHd.js";import{d as ye,q as be,u as xe,s as J,r as g,c as w,a as A,b as r,e as f,F as k,k as P,i as U,h,K as we,H as X,t as S,f as y,w as Se,D as ke,L as $e,M as Ae,E as G,o as Ce}from"./index-DzQ9i4kW.js";import{u as Ve,e as Pe,g as Be}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-CcZR8S8L.js";import{s as Ie}from"./index-Bc9889-c.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Ee}from"./index-Bc45zl3-.js";import{s as De}from"./index-CIEjUuGN.js";import{s as Te}from"./index-DBogPJ2C.js";import{u as Le}from"./stores-DAZY9PS4.js";import{h as B}from"./http-gL39vg9U.js";const je={submitStep:Fe,getStudentProjectStepsByID:Ne,getStudentStepTranslationByID:Re,resetStepsProgress:We,saveStudentStepStateByID:Ue};async function Ne(t){try{return await B.get(`/student/project/${t}/steps`)}catch(n){throw console.log(n),n}}async function Re(t){try{return await B.get(`/student/step/${t}`)}catch(n){throw console.log(n),n}}async function Ue(t,n){try{return await B.put(`/student/step/${t.id}/save`,n)}catch(l){throw console.log(l),l}}async function Fe(t,n){try{return await B.put(`/student/step/${t}/submit`,{student_answer:n})}catch(l){throw console.log(l),l}}async function We(t){try{return await B.delete(`/project/${t}/reset`)}catch(n){throw console.log(n),n}}async function qe(t){const{data:n}=await je.getStudentStepTranslationByID(t.id.toString()),l=n;return{id:t.id.toString(),title:l.name,type:t.step_type,progress:t.status,inner:l.content,answer:l.user_answer,state:l.step_state,access_type:t.access_type,accessibility:t.accessibility,skip_submit:t.skip_submit}}const Y=ye("useLessonStore",()=>{const t=be(),n=xe(),l="emu",o=Ve(l),{newModuleToSlot:m,clearSlots:i,reset:a,slots:u,helpArrows:v,moduleComponents:$}=o;o.addNeededModules([]);const C=Le(),{fileContent:L}=J(C),{setCode:_}=C,V=Pe(l),{setStdout:Z,clear:F}=V,W=Be(l),d=g(null),p=g(null),j=g(!1),N=g(!0),M=g(!0),O=g(!0),ee=w(()=>{if(!b.value||!b.value.inner.tests||b.value.inner.tests.length===0)return!0;let e;for(const c of E.value)if(c.result)if(c.result.success)e=!0;else{e=!1;break}return e}),te=w(()=>N.value&&M.value),q=g(!1),z=g(!1),se=w(()=>L.value),E=g([]),b=w(()=>{var e;return p.value==null?null:((e=d.value)==null?void 0:e.steps[p.value])??null});async function ne(){b.value&&(b.value.inner.tests&&(E.value=await _e(b.value.inner.tests)),b.value.inner.includedCommandsForTests=b.value.inner.includedCommandsForTests??[...he])}let D=0;function oe(e){e!=null&&(d.value=e)}function le(e){d.value!=null&&(d.value.steps=e,p.value!=null&&K(p.value))}function re(e){p.value=e}function ie(e){d.value==null||p.value==null||(d.value.steps[p.value].progress=e)}function ae(e){d.value==null||p.value==null||p.value+1!=d.value.steps.length&&(d.value.steps[p.value+1].accessibility=e)}function ue(e,c){d.value==null||p.value==null||d.value.steps[p.value].inner.options!=null&&(d.value.steps[p.value].inner.options[c].correct=e)}async function K(e){var H,Q;if(d.value==null)return;p.value=e;const c=d.value.steps[p.value];if(c.title==""){j.value=!0;const x=await qe({id:c.id,status:c.progress,step_type:c.type,skip_submit:c.skip_submit,access_type:c.access_type,accessibility:c.accessibility});d.value.steps[e]=x,j.value=!1}const s=d.value.steps[p.value];if(a(),i(),R(),_(""),F(),z.value=!(((H=s.inner.platformActions)==null?void 0:H.includes("hide-ide"))??!1),q.value=!(((Q=s.inner.platformActions)==null?void 0:Q.includes("hide-sim"))??!1),s.progress=="nothing"||t.name=="module"){if(s.inner.platformActions!=null&&s.inner.platformActions!=null&&s.inner.platformActions.length>0){for(const x of s.inner.platformActions)if(x=="code2ide"&&_(s.inner.starting??""),x=="auto-put"&&s.inner.highlights!=null)for(const T of s.inner.highlights)D++,m(T.module,T.slot)}if(s.inner.userActions!=null&&s.inner.userActions!=null&&s.inner.userActions.length>0)for(const x of s.inner.userActions)x=="put-module"&&(N.value=!1,i()),x=="run-code"&&(M.value=!1)}else{if(s.state==null||s.state==null)return;if(s.state.code!=null&&s.state.code!=null&&(_(s.state.code),W.code.value=s.state.code),s.state.stdout!=null&&s.state.stdout!=null&&Z(s.state.stdout),s.state.slots!=null&&s.state.slots!=null){s.state.slots.pop();for(const[x,T]of s.state.slots.entries()){const ve=o.slots[x].id;m(T,ve)}}s.state.testsData!=null&&s.state.testsData!=null&&(E.value=s.state.testsData)}}function ce(e){d.value==null||p.value==null||(d.value.steps[p.value].state={code:e.code,stdout:e.stdout,slots:e.slots,testsData:e.testsData})}function de(){if(d.value==null||p.value==null)return;const e=d.value.steps[p.value];if(a(),i(),R(),_(""),F(),d.value.steps[p.value].state={code:"",stdout:"",slots:[],testsData:[]},e.inner.platformActions!=null&&e.inner.platformActions!=null&&e.inner.platformActions.length>0){for(const c of e.inner.platformActions)if(c=="code2ide"&&(_(e.inner.starting??""),W.code.value=e.inner.starting??""),c=="auto-put"&&e.inner.highlights!=null)for(const s of e.inner.highlights)D++,m(s.module,s.slot)}}function pe(e,c){if(e==="8"||e==="9")v[e].style={color:"rgba(0, 157, 255)"},v[e].visible=!0;else{const s=(e??"A").charCodeAt(0)-65;u[s].style={backgroundColor:"rgba(0, 157, 255, 0.26)",boxShadow:"0 0 15px rgb(0, 157, 255)"}}$.forEach(s=>{if(s.type==c){s.style={animation:"breathing 1s ease-out infinite normal",boxShadow:"0 0 15px rgb(0, 157, 255)",borderRadius:"10px"};return}})}function R(){for(let e=0;e<=5;e++)u[e].class="",u[e].style={};for(const e of $)e.class="",e.style={};for(const e in v){const c=v[e];c.visible=!1,c.style={},c.class=""}}function fe(){M.value=!0}function me(e,c){D<=0?e===c?n.add({severity:"success",summary:"Correct, good job!",detail:"Module has been put successfully",life:3e3}):n.add({severity:"error",summary:"Wrong!",detail:"Keep trying",life:3e3}):D--}return{lesson:d,step:b,stepIndex:p,stepLoading:j,userCode:se,testsData:E,testsSuccess:ee,fetchStepAllTests:ne,submitEnabled:te,modulesWerePut:N,codeWasRun:M,codeWasChecked:O,simVisible:q,ideVisible:z,setLesson:oe,setSteps:le,setStepIndex:re,updateStatus:ie,updateAccess:ae,changeStep:K,runCodePressed:fe,saveOption:ue,lightUp:pe,clearSlotsModulesClasses:R,toastModulePut:me,saveStepStateLocally:ce,restartStep:de}});async function kt(t,n){const{data:l}=await ge.getStepTranslationByID(t.id.toString()),o=l;return{id:t.id.toString(),title:o.name,type:t.step_type,progress:"nothing",inner:n||o.content.contents==null?{contents:[],modules:[]}:o.content,access_type:t.access_type,skip_submit:t.skip_submit}}const ze={class:"flex flex-col gap-2"},Ke={key:1},He={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},Qe=["src"],Ge={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Je=["src"],Xe={key:2},Ye=["src"],I=A({__name:"ContentsView",props:{contents:{}},setup(t){const n=t;function l(o){return o.replace("shorts","embed")}return(o,m)=>{const i=X("v-md-preview");return r(),f("div",ze,[(r(!0),f(k,null,P(n.contents,a=>{var u;return r(),f("div",{key:a.id},[a.type=="text"?(r(),U(i,{key:0,text:a.text},null,8,["text"])):a.type=="video"?(r(),f("div",Ke,[(u=a.text)!=null&&u.includes("embed")?(r(),f("div",He,[h("iframe",{credentialless:"",src:l(a.text),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Qe),m[0]||(m[0]=h("iframe",null,null,-1))])):(r(),f("div",Ge,[h("iframe",{credentialless:"",src:l(a.text??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Je)]))])):a.type=="tinkercad"?(r(),f("div",Xe,[h("iframe",{credentialless:"",width:"450",height:"287",src:a.text,frameborder:"0",marginwidth:"0",marginheight:"0",scrolling:"no"},null,8,Ye)])):we("",!0)])}),128))])}}}),Ze={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},$t=A({__name:"ArticleStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t;return(l,o)=>(r(),f(k,null,[h("div",Ze,S(n.step.title),1),y(I,{contents:n.step.inner.contents},null,8,["contents"])],64))}}),Oe={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},At=A({__name:"CodeStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=Y();J(n);const l=t;return g(0),(o,m)=>(r(),f(k,null,[h("div",Oe,S(l.step.title),1),y(I,{contents:l.step.inner.contents},null,8,["contents"])],64))}}),et={class:"flex flex-col gap-4"},tt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},st={class:"flex w-full justify-between"},nt={class:"flex flex-col gap-2"},ot={class:"w-40 mb-[29px] border rounded-lg h-[40px] place-items-center bg-white",draggable:"true"},lt={class:"content-center h-full"},rt={class:"flex flex-col gap-2"},it=A({__name:"MatchStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=t,l=w(()=>{var m;return(m=n.step.inner.pairs)==null?void 0:m.map(i=>i.key)}),o=w(()=>{var m;return(m=n.step.inner.pairs)==null?void 0:m.map(i=>i.value)});return(m,i)=>{const a=Ie;return r(),f("div",et,[h("div",tt,S(n.step.title),1),y(I,{contents:n.step.inner.contents},null,8,["contents"]),h("div",st,[h("div",nt,[(r(!0),f(k,null,P(l.value,u=>(r(),f("div",{key:u,class:"flex flex-col"},[h("div",ot,[h("div",lt,S(u),1)])]))),128))]),h("div",rt,[(r(!0),f(k,null,P(o.value,u=>(r(),f("div",{key:u,class:"flex flex-col"},[i[0]||(i[0]=h("div",{class:"w-40 h-10 border-dashed border-gray-300 rounded-border border-x border-y"},null,-1)),y(a,{size:"small",severity:"warn",variant:"simple",class:"mb-2"},{default:Se(()=>[ke(S(u.length>0?u:"..."),1)]),_:2},1024)]))),128))])])])}}}),Ct=Me(it,[["__scopeId","data-v-265024ce"]]),at={class:"flex flex-col gap-4"},ut={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},Vt=A({__name:"OpenStep",props:$e({step:{},isPreview:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const n=Ae(t,"modelValue"),l=t,o=g(null);return(m,i)=>{const a=Ee;return r(),f("div",at,[h("div",ut,S(l.step.title),1),y(I,{contents:l.step.inner.contents},null,8,["contents"]),l.isPreview?(r(),U(a,{key:0,type:"text",modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"])):(r(),U(a,{key:1,type:"text",modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=u=>n.value=u),size:"small",placeholder:"Enter your answer"},null,8,["modelValue"]))])}}}),ct={class:"flex flex-col gap-4"},dt={class:"text-[33px] font-semibold mb-4 text-center border-b pb-2"},pt={key:0,class:"flex flex-col gap-4 ml-4"},ft={key:1,class:"flex flex-col gap-4 ml-4"},Pt=A({__name:"QuestionStep",props:{step:{},isPreview:{type:Boolean}},setup(t){const n=Y(),{saveOption:l}=n,o=t,m=w(()=>o.step.inner.single),i=g(null),a=g([]);return G([a],()=>{if(!o.isPreview&&o.step.inner.options!=null&&!o.step.inner.single)for(const[u,v]of o.step.inner.options.entries())l(a.value.some($=>$==v.text),u)}),G([i],()=>{if(!o.isPreview&&o.step.inner.options!=null&&o.step.inner.single)for(const[u,v]of o.step.inner.options.entries())l(i.value==v.text,u)}),Ce(()=>{if(!o.isPreview&&o.step.inner.options!=null&&(i.value=null,a.value=[],o.step.answer.question))for(const[u,v]of o.step.inner.options.entries())o.step.answer.question[u]&&(a.value.push(v.text),i.value=v.text)}),(u,v)=>{const $=Te,C=X("v-md-preview"),L=De;return r(),f("div",ct,[h("div",dt,S(o.step.title),1),y(I,{contents:o.step.inner.contents},null,8,["contents"]),m.value?(r(),f("div",pt,[(r(!0),f(k,null,P(o.step.inner.options,_=>(r(),f("div",{key:_.id,class:"flex gap-2"},[y($,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=V=>i.value=V),inputId:_.id,name:"dynamic",value:_.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),y(C,{text:_.text},null,8,["text"])]))),128))])):(r(),f("div",ft,[(r(!0),f(k,null,P(o.step.inner.options,_=>(r(),f("div",{key:_.id,class:"flex gap-2"},[y(L,{modelValue:a.value,"onUpdate:modelValue":v[1]||(v[1]=V=>a.value=V),inputId:_.id,name:"option",value:_.text,class:"mt-1"},null,8,["modelValue","inputId","value"]),y(C,{text:_.text},null,8,["text"])]))),128))]))])}}});export{Ct as M,$t as _,je as a,kt as b,At as c,Vt as d,Pt as e,qe as t,Y as u};
