import{T as ae}from"./index-BwXDmMAh.js";import{a as E,r as _,G as D,o as U,E as re,b as f,e as y,h as c,$ as g,g as e,t as z,F as L,j as A,n as C,a7 as le,f as B,l as R,k as S,aj as ie,c as H,C as q,_ as ue,a2 as ce,a3 as Z,U as T,w as ee,ah as O,S as j,W as te,q as de}from"./index-BBjKxJpX.js";import{s as fe}from"./index-CDtTVAa8.js";import{h as pe,o as xe,C as se,q as he,M as ve,D as ye,E as me,a as Y,F as we,G as ge,H as be,J as ke,K as $e}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-C9SBy8KS.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as Me}from"./index-T6Lj112h.js";const Pe="/assets/pibody-CmiHEiCK.png",Se=["width","height"],I=12,Ce=E({__name:"DisplayView",props:{id:{default:"default"}},setup(s){const n=s,t=_(112),v=_(160),M=_(null),h=_(null),a=_(0),b=pe(n.id);b.text.value||(b.text.value="");function r(o){const p=o.deltaY>0?1:-1;a.value+=p*I,a.value=Math.max(0,a.value);const{lines:m,visibleLines:x}=l();a.value=Math.min(m.length*I,a.value),d(m,x)}function l(){const o=[];let p=0;return h.value&&b.text.value&&(String(b.text.value).split(`
`).forEach(x=>{let w="";x.split(" ").forEach($=>{const u=w+$+" ";h.value.measureText(u).width>t.value?(o.push(w),w=$+" "):w=u}),o.push(w)}),p=Math.ceil(v.value/I)),{lines:o,visibleLines:p}}function d(o,p){if(h.value){h.value.fillStyle="#FFFFFF",h.value.fillRect(0,0,t.value,v.value),h.value.fillStyle=String(b.textColor.value)||"#000000",h.value.font="12px Monaco";const m=Math.floor(a.value/I);for(let x=0;x<p;x++){const w=m+x;if(w<o.length){const k=(x+1)*I-a.value%I;h.value.fillText(o[w],0,k)}}}}return D([b.text,b.textColor],()=>{const{lines:o,visibleLines:p}=l();a.value=Math.max(0,(o.length-p)*I),d(o,p)}),U(async()=>{if(await re(),!!M.value&&(h.value=M.value.getContext("2d"),h.value)){h.value.fillStyle="#FFFFFF",h.value.fillRect(0,0,t.value,v.value);const{lines:o,visibleLines:p}=l();a.value=0,d(o,p)}}),(o,p)=>(f(),y("div",{class:"display-container",onWheel:r},[c("canvas",{ref_key:"canvas",ref:M,width:t.value,height:v.value,style:{border:"1px solid black",width:"112px",height:"160px"}},null,8,Se)],32))}}),Le=G(Ce,[["__scopeId","data-v-0149e8f3"]]),ne=E({__name:"PinInfo",props:{pin:{},withPin:{},isLeft:{type:Boolean}},setup(s){return(n,t)=>(f(),y(L,null,[c("div",{class:C(["flex",s.isLeft?"flex-row":"flex-row-reverse"])},[c("div",{style:g({background:e(xe)}),class:"text-center font-mono px-1 mr-1"},z(e(se)[s.pin.id].name),5),(f(!0),y(L,null,A(e(se)[s.pin.id].able,v=>(f(),y("div",{style:g({background:v.color}),class:"text-center font-mono px-1 mr-1"},z(v.name),5))),256))],2),c("div",{class:C(["flex my-1 mb-3",s.isLeft?"flex-row":"flex-row-reverse"])},[c("div",{style:g({background:`${e(he)[s.pin.mode]}`}),class:"text-center px-4 mr-1 rounded-lg"},z(e(ve)[s.pin.mode]),5),c("div",{style:g(e(ye)(s.pin,s.withPin)),class:"text-center px-4 mr-1 rounded-lg bg-black"},z(e(me)(s.pin,s.withPin)),5)],2)],64))}}),Fe=["id"],Ie=E({__name:"SlotView",props:{slot:{},index:{},id:{}},setup(s){const{isOutside:n}=Me(le("theref")),t=Y(s.id),{maxAreaIndex:v,fromSlotIndex:M,settings:h}=t,a=s.index<3;return(b,r)=>{var l;return f(),y(L,null,[c("div",{id:`slot-${s.slot.id}`,ref:"theref",class:C(["absolute w-20 h-20 rounded-lg text-center",[{"bg-green-200/[0.5]":e(v)==s.index,"bg-blue-200/[0.5]":e(M)==s.index},s.slot.class]]),style:g([s.slot.style,e(we)(s.slot)])},[!e(n)&&((l=e(h))!=null&&l.showPinInfo)?(f(),y("div",{key:0,class:"absolute w-fit whitespace-nowrap text-white flex flex-col text-xs bg-black/70",style:g(a?"left:100%":"right:100%")},[B(ne,{pin:s.slot.pin2,withPin:s.slot.with.pin2,isLeft:a},null,8,["pin","withPin"]),B(ne,{pin:s.slot.pin3,withPin:s.slot.with.pin3,isLeft:a},null,8,["pin","withPin"])],4)):R("",!0)],14,Fe),e(n)?R("",!0):(f(),S(ie,{key:0,to:`#pibody-${s.id}`},null,8,["to"]))],64)}}}),De=["width","height"],Ee=["points","stroke"],N=3,oe=14,V=10,_e=E({__name:"Connector",props:{start:{},end:{},style:{},id:{}},setup(s){const n=s,t=Y(n.id),v=H(()=>{const{start:r,end:l}=n,d=40,o=[{x:r.x,y:r.y}];return o.push({x:r.x,y:r.y-d}),o.push({x:(l.x+r.x)/2,y:r.y-d}),o.push({x:(l.x+r.x)/2,y:l.y-l.yOffset}),o.push({x:l.x,y:l.y-l.yOffset}),o.push({x:l.x,y:l.y}),o}),M=[{color:"orange",offset:-N,end:-oe/2},{color:"red",offset:0,end:0},{color:"saddlebrown",offset:N,end:oe/2}],h=H(()=>{const r=v.value,l=[];return M.forEach(d=>{const o=d.offset,p=d.end;let m="";for(let k=0;k<r.length-2;k++){const $=r[k];m+=`${$.x-a.value.x-o},${$.y-a.value.y-o} `}const x=r[r.length-2];m+=`${x.x-a.value.x+o},${x.y-a.value.y-o} `;const w=r[r.length-1];m+=`${w.x-a.value.x+p},${w.y-a.value.y+3} `,l.push({color:d.color,points:m})}),l}),a=H(()=>{const r=[],l=[];for(const x of v.value)r.push(x.x),l.push(x.y);const d=Math.min(...r)-V,o=Math.min(...l)-V,p=Math.max(...r)+V,m=Math.max(...l)+V;return{x:d,y:o,w:p-d,h:m-o}}),b=r=>{n.end.at!==t.pinNone&&t.moveConnectorEnd(n,r)};return(r,l)=>(f(),y(L,null,[c("div",{class:"absolute bg-black cursor-move",style:g([n.style,{left:n.end.x-12+"px",top:n.end.y+"px",width:n.end.w+"px",height:n.end.h+"px"}]),onPointerdown:[l[0]||(l[0]=q(d=>d.preventDefault(),["prevent"])),b]},null,36),c("div",{class:"absolute pointer-events-none",style:g([n.style,e(ge)(a.value)])},[(f(),y("svg",{xmlns:"http://www.w3.org/2000/svg",width:a.value.w,height:a.value.h},[(f(!0),y(L,null,A(h.value,(d,o)=>(f(),y("polyline",{key:o,points:d.points,stroke:d.color,fill:"none","stroke-width":N,"stroke-linejoin":"round","stroke-linecap":"round"},null,8,Ee))),128))],8,De))],4)],64))}}),Te=G(_e,[["__scopeId","data-v-9a0ab2fc"]]),ze=E({__name:"Canvas",setup(s){const n=le("canvasEl");return U(async()=>{n.value&&(await be(n.value),requestAnimationFrame(ke))}),ue(()=>{n.value&&$e(n.value)}),(t,v)=>(f(),y("canvas",{ref_key:"canvasEl",ref:n},null,512))}}),Ae=["id"],Be=["id"],Ve={class:"absolute top-4 right-1 flex flex-col gap-1"},We={class:"material-icons"},He=["id"],Oe={class:"max-h-fit w-full overflow-auto flex flex-wrap gap-2 justify-center items-start mt-2",style:{"touch-action":"none",padding:"15px 0 15px 0"}},je=E({__name:"SimulationView",props:ce({id:{},horizontal:{type:Boolean}},{neededModules:{default:[]},neededModulesModifiers:{},slots:{default:[]},slotsModifiers:{}}),emits:["update:neededModules","update:slots"],setup(s){const n=s,t=Y(n.id,n.horizontal),{toDelete:v,slots:M,modules:h,isConnect8or9:a,chosenPin8or9:b,pin8:r,pin9:l,settings:d,clearSlotsModulesClasses:o,modulesWerePut:p,lightUp:m}=t,x=Z(s,"neededModules"),w=Z(s,"slots");U(()=>{t.putModuleList(w.value)});function k($){if(p.value=!0,!(!x.value||x.value.length===0)){o();for(const u of x.value){if(!u.slot||!u.module)continue;if(t.getSlotPinWith(u.slot).type!==u.module){m(u.slot,u.module),p.value=!1;break}}}}D([t.slotHasList],()=>{w.value=t.slotHasList()});for(const $ of t.slots)D(()=>$.with.type,()=>{k()},{immediate:!0});return D(()=>t.pin8.with.type,()=>{k(t.pin8)},{immediate:!0}),D(()=>t.pin9.with.type,()=>{k(t.pin9)},{immediate:!0}),D(x,()=>{for(const $ of t.slots)k()}),($,u)=>{var J,Q;const W=fe,K=de,X=ae;return f(),y("div",{id:`emulator-${n.id}`,key:`emulator-${n.id}`,class:C({"h-[450px] flex flex-row":s.horizontal,"h-full flex flex-col":!s.horizontal,"parent relative items-stretch border-t border-surface overflow-hidden select-none":!0})},[c("div",{id:`pibody-${n.id}`,class:"relative h-[450px] flex-shrink-0 overflow-x-hidden overflow-y-auto w-[450px]"},[B(W,{src:e(Pe),width:"384px",draggable:"false",class:"absolute pt-4 min-w-[384px]",style:{left:"32px",top:"0px"}},null,8,["src"]),B(Le,{class:"absolute top-[217px] left-[168px] w-[112px] h-[160px]",id:`${n.id}`},null,8,["id"]),c("div",Ve,[T((f(),S(K,{type:"button",class:C(["w-9 h-9 mr-1",(J=e(d))!=null&&J.showPinInfo?"bg-green-500":"bg-gray-500"]),rounded:"",onClick:u[0]||(u[0]=i=>{var P;return e(t).setSettings({showPinInfo:!((P=e(d))!=null&&P.showPinInfo)})})},{default:ee(()=>{var i;return[c("span",We,z(((i=e(d))!=null&&i.showPinInfo,"help_center")),1)]}),_:1},8,["class"])),[[X,`Pin Information: ${(Q=e(d))!=null&&Q.showPinInfo?"On":"Off"}`,void 0,{left:!0}]]),T((f(),S(K,{type:"button",class:"w-9 h-9 mr-1 bg-gray-500",rounded:"",onClick:u[1]||(u[1]=i=>e(t).reset())},{default:ee(()=>[...u[4]||(u[4]=[c("span",{class:"material-icons"},"restart_alt",-1)])]),_:1})),[[X,"Reset pibody",void 0,{left:!0}]])]),(f(!0),y(L,null,A(e(M),(i,P)=>(f(),S(Ie,{key:P,slot:i,index:P,id:n.id},null,8,["slot","index","id"]))),128)),c("div",{class:"absolute bg-black",style:g({left:e(t).usb.x+"px",top:e(t).usb.y-70+"px",width:e(t).usb.w+"px",height:e(t).usb.h+50+"px"})},null,4),c("div",{class:"absolute",style:g({left:e(t).onLED.x+"px",top:e(t).onLED.y+"px",width:e(t).onLED.w+"px",height:e(t).onLED.h+"px"})},null,4),T(c("div",{class:"absolute flex items-center justify-center animate-bounce-up z-10 pointer-events-none",style:g({left:e(t).helpArrows[8].x+"px",top:e(t).helpArrows[8].y+"px"})},[c("span",{class:C(["icon-arrow-down text-5xl",[e(b)===e(r)?"text-green-500":"text-gray-500",e(t).helpArrows[8].class]]),style:g(e(t).helpArrows[8].style)},null,6),u[5]||(u[5]=c("span",{class:"absolute text-white font-bold -mt-2"},"8",-1))],4),[[O,e(t).helpArrows[8].visible||e(a)]]),T(c("div",{class:"absolute flex items-center justify-center animate-bounce-down z-10 pointer-events-none",style:g({left:e(l).x-10+"px",top:e(l).y+8+"px"})},[c("span",{class:C(["icon-arrow-up text-5xl",e(b)===e(l)?"text-green-500":"text-gray-500"]),style:g(e(t).helpArrows[9].style)},null,6),u[6]||(u[6]=c("span",{class:"absolute text-white font-bold -mt-2"},"9",-1))],4),[[O,e(t).helpArrows[9].visible||e(a)]]),B(ze,{class:"absolute top-0 left-0 z-10 w-full h-full pointer-events-none",id:n.id},null,8,["id"])],8,Be),c("div",{id:`module-list-${n.id}`,class:"relative h-full flex-1 overflow-auto overflow-x-hidden w-[450px]"},[c("div",Oe,[(f(!0),y(L,null,A(e(t).neededModules.value,(i,P)=>(f(),S(te(i.is),j({key:P,class:i.class,style:i.style},{ref_for:!0},i,{onPointerdown:[F=>e(t).startDragFromModuleList(i,F),u[2]||(u[2]=q(F=>F.preventDefault(),["prevent"]))],class:"flex-none w-20 h-20 cursor-move"}),null,16,["class","style","onPointerdown"]))),128)),T(c("div",{class:C(["absolute top-0 left-0 h-full w-full",{"bg-red-500/[0.8]":e(v)}])},[...u[7]||(u[7]=[c("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},[c("span",{class:"material-icons",style:{"font-size":"100px"}},"delete")],-1)])],2),[[O,e(v)]])])],8,He),(f(!0),y(L,null,A(e(h),(i,P)=>(f(),S(ie,{defer:"",to:i.dragging?`#emulator-${n.id}`:`#pibody-${n.id}`,key:i.id},[i.putOn8or9&&i.connector.end.x!==0&&i.connector.end.y!==0?(f(),S(Te,j({key:0,ref_for:!0},i.connector,{id:n.id}),null,16,["id"])):R("",!0),(f(),S(te(i.is),j({class:i.class,style:[i.style,{left:i.x+"px",top:i.y+"px"}]},{ref_for:!0},i,{onPointerdown:[F=>e(t).startDragFromSlot(i,P,i.on,F),u[3]||(u[3]=q(F=>F.preventDefault(),["prevent"]))],class:"absolute w-20 h-20 rounded-xl cursor-move",style:{"touch-action":"none"}}),null,16,["class","style","onPointerdown"]))],8,["to"]))),128))],10,Ae)}}}),Ke=G(je,[["__scopeId","data-v-006ddc76"]]);export{Ke as S};
