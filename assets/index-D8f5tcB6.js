import{T as re}from"./index-CID063JX.js";import{s as ie}from"./index-BqAwfTve.js";import{s as ae}from"./index-DQafit8Y.js";import{s as de}from"./index-CfMinl4z.js";import{e as ue,J as pe,s as T,B as j,r as V,a5 as ce,C as me,D as ve,b as fe,S as ge,o as n,c as d,h as t,a as s,k as l,F as W,q as he,v as M,j as c,i as S,w as v,L as h,H as ye,N as we,t as F,T as be,K as xe,n as _e,l as ke}from"./index-8eYd0-Co.js";import{b as Ce}from"./store-DJ783GSL.js";import{S as Se}from"./SimulationView-_SSNKHsZ.js";import"./IdeButtons.vue_vue_type_script_setup_true_lang-BjZTJ3Qu.js";import"./CodeEditorView.vue_vue_type_script_setup_true_lang-Cltxh41k.js";import{_ as $e}from"./CodeViewer.vue_vue_type_script_setup_true_lang-B9vO23Mu.js";import{_ as Le}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-BkFfrpR3.js";import{u as Be}from"./useLocaleStore-CGKTShgd.js";import{u as qe,U as ze,N as Pe}from"./NavigationBar-BKZ8uUYb.js";import"./index-CH_iu5NA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-eKsVto-V.js";import"./index-WXQmNEQQ.js";import"./index-B8MXaspB.js";import"./index-B3NttIqY.js";import"./index-DRGFISwW.js";import"./index-VgJXLjdG.js";import"./index-CQCkvxda.js";import"./index-CsjCzc3Q.js";import"./language-DYQF8nnT.js";import"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_bad98aaa_lang-ETJTZl1d.js";import"./MdViewer.vue_vue_type_style_index_0_lang-1aZPBoDA.js";import"./index-C5W94n6N.js";import"./index-ahqnJA0E.js";import"./index-H-9SRDzX.js";import"./SubmitImageReviseViewer.vue_vue_type_script_setup_true_lang-BBzbA190.js";import"./index-CrUX9qwQ.js";import"./TinkercadViewer.vue_vue_type_script_setup_true_lang-BQ1DgHPi.js";import"./index-DZEPUsZQ.js";import"./index-fKBIE13H.js";import"./index-19jCyGXe.js";import"./unitApi-COQDlsTX.js";import"./lessonApi-B_VTKClk.js";import"./mapLessonFromDto-C9SLSKbW.js";import"./mapUnitFromDto-C-vlLM9s.js";const Ue={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},De={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},Re={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},Ee={class:"flex items-center gap-4"},Ne={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},Te={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},je={key:1,class:"flex justify-center"},Ve={key:2},We={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},Me={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},Fe={class:"flex items-center gap-3 mb-2"},Ae={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},Ie={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},Oe={class:"relative h-full"},Ke={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Ge={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},He={class:"relative h-full"},Je={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Qe={key:0,class:"absolute right-0 top-0 z-10 h-[38px] p-[1px]"},Xe={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},Ye={class:"flex flex-col items-center"},Ze={class:"text-4xl font-bold mb-8"},et={class:"text-md text-gray-500"},Mt=ue({__name:"LessonPage",setup(tt){const i=xe(),p=_e(),$=pe(),A=Be(),{lang:I}=T(A);j(I,async(o,e)=>{o!==e&&u.value&&await z(Number(i.params.id),(i.query.route_id??"").toString())});const q=qe(),{isLessonLoading:O,selectedLesson:u,pageProgress:K,groupStatus:y,emulatorID:w,neededModules:L,slots:m,pibodyDrawerVisible:f,codeDrawerVisible:g,showPibody:b,showCode:G,isPreloadingUnits:H,preloadingProgress:J,answersCache:Q,startingCodeExist:X}=T(q),{loadLessonById:z,runCodePressed:Y,saveStudentIdeState:Z,pageBack:ee,resetEmulator:te}=q;function se(o){var a;const e=((a=u.value)==null?void 0:a.pages.reduce((k,C)=>k+C.groups.length,0))||1;return o/e*100}function P(){var o;((o=u.value)==null?void 0:o.lessonType)=="module"?p.push("/v2/docs"):i.query.route_id&&i.query.route_id!=""?p.push("/v2/route/"+i.query.route_id):$.userRole=="editor"?p.push("/v2/routes"):p.push("/v2/home")}j(m,()=>{U({slots:m.value})});const U=Ce(o=>{Z(o)},1e3,{maxWait:5e3});function oe(o){U({slots:m.value})}const x=V(window.innerWidth),_=V(16);function B(){if(x.value=window.innerWidth,x.value<=1300){_.value=16;return}const e=452-(x.value-1024)/2;_.value=e>16?e:16}ce(async()=>{var o,e,a;await z(Number(i.params.id),(i.query.route_id??"").toString()),i.query.route_id=="10"&&((o=u.value)==null?void 0:o.lessonType)!="learn"?p.replace({path:i.path.replace("/lesson/","/lesson-blocks/"),query:i.query}):((e=u.value)==null?void 0:e.lessonType)=="project"?p.replace({path:i.path.replace("/lesson/","/project/"),query:i.query}):((a=u.value)==null?void 0:a.studentProgress)==100&&$.userRole!="editor"&&p.replace({path:`${i.path}/revise`,query:i.query})}),me(async()=>{y.value="continue",B(),window.addEventListener("resize",B),window.addEventListener("beforeunload",R)}),ve(()=>{window.removeEventListener("resize",B)});const D=fe(()=>x.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),le=()=>{p.push(`${i.path}/edit`)};ge(()=>{window.removeEventListener("beforeunload",R)});function R(o){if(y.value!="completed"&&Q.value.size>0)return o.preventDefault(),!0}return(o,e)=>{const a=ke,k=de,C=ae,E=ie,ne=re;return n(),d(W,null,[t(y)!="completed"?(n(),d("div",Ue,[s("div",De,[s("div",Re,[s("div",Ee,[l(a,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:P})]),t(u)?(n(),d("div",Ne,[(n(!0),d(W,null,he(t(u).pages,(r,N)=>(n(),d("div",{key:N,class:"h-full",style:M({width:se(r.groups.length)+"%"})},[l(k,{value:t(K)[N]/r.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):c("",!0),e[9]||(e[9]=s("div",{class:"w-10"},null,-1))])]),s("div",Te,[s("div",{class:"w-full h-full max-w-screen-lg mx-auto",style:M({paddingLeft:_.value+"px",paddingRight:_.value+"px"})},[t(O)?(n(),S(C,{key:0,class:"flex justify-center"})):t(u)?(n(),d("div",Ve,[l(ze,{pages:t(u).pages},null,8,["pages"])])):(n(),d("div",je,"No lesson found")),t($).userRole=="editor"?(n(),d("div",We,[l(t(Le)),l(a,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:le}),l(a,{variant:"text",severity:"contrast",onClick:t(ee)},{default:v(()=>e[10]||(e[10]=[s("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):c("",!0),t(H)?(n(),d("div",Me,[s("div",Fe,[l(C,{style:{width:"20px",height:"20px"}}),e[11]||(e[11]=s("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),l(k,{value:t(J),"show-value":!0,class:"h-2"},null,8,["value"])])):c("",!0)],4)]),s("div",Ae,[l(Pe)]),t(b)?(n(),d("div",Ie,[l(a,{icon:"pi pi-microchip",severity:"secondary",onClick:e[0]||(e[0]=r=>f.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),l(E,{visible:t(f),"onUpdate:visible":e[4]||(e[4]=r=>h(f)?f.value=r:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${D.value}`}}},{header:v(()=>e[12]||(e[12]=[s("div",null,null,-1)])),container:v(()=>[s("div",Oe,[s("div",Ke,[l(a,{icon:"pi pi-chevron-left",severity:"secondary",onClick:e[1]||(e[1]=r=>f.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),S(t(Se),{id:t(w),key:t(w),slots:t(m),"onUpdate:slots":e[2]||(e[2]=r=>h(m)?m.value=r:null),neededModules:t(L),"onUpdate:neededModules":e[3]||(e[3]=r=>h(L)?L.value=r:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):c("",!0),t(G)?(n(),d("div",Ge,[l(a,{icon:"pi pi-code",severity:"secondary",onClick:e[5]||(e[5]=r=>g.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),l(E,{visible:t(g),"onUpdate:visible":e[8]||(e[8]=r=>h(g)?g.value=r:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${D.value}`}}},{header:v(()=>e[13]||(e[13]=[s("div",null,null,-1)])),container:v(()=>[s("div",He,[s("div",Je,[l(a,{icon:"pi pi-chevron-right",severity:"secondary",onClick:e[6]||(e[6]=r=>g.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),t(X)?(n(),d("div",Qe,[ye(l(a,{icon:"pi pi-replay",variant:"link",onClick:t(te),class:"h-[36px] rounded-lg text-sm"},null,8,["onClick"]),[[ne,o.$t("revertToStartingCode")]])])):c("",!0),(n(),S(we,null,[(n(),S(t($e),{id:t(w),key:t(w),connectbuttons:t(b),"onUpdate:connectbuttons":e[7]||(e[7]=r=>h(b)?b.value=r:null),onRun:t(Y),onSaveAnswer:oe},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):c("",!0)])):c("",!0),l(be,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:v(()=>[t(y)=="completed"?(n(),d("div",Xe,[e[14]||(e[14]=s("div",{class:"text-5xl"},"⚡️",-1)),s("div",Ye,[s("div",Ze,F(o.$t("goodWork")),1),s("div",et,F(o.$t("keepLearning")),1)]),s("div",null,[l(a,{label:o.$t("continue"),class:"rounded-full w-56 text-xl",onClick:P},null,8,["label"])])])):c("",!0)]),_:1})],64)}}});export{Mt as default};
